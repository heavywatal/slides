<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>5. Data cleansing and conversion: numbers, text — Hands-on Introduction to R 2023</title>
<link rel="icon" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="5. Data cleansing and conversion: numbers, text — Hands-on Introduction to R 2023">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/english2023r/5-content.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-V60H2JH0G6');
</script>
<link rel="stylesheet" href="/slides/lib/reveal.js/dist/reveal.css">
<script type="module">
import { Reveal } from "/slides/lib/reveal.js/reveal.js";
Reveal.configure({width: 1440, height: 1080});
</script>
<style>
html { font-size: 240%; }
</style>
<link rel="stylesheet" href="/slides/lib/katex/katex.min.css">
<script type="module" src="/slides/lib/katex/katex.min.js"></script>
<link rel="stylesheet" href="/slides/lib/iconify.css">
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<link rel="stylesheet" href="/slides/css/style-reveal.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<h1 id="hands-on-introduction-to-r-2023"><a href=".">Hands-on Introduction to R 2023</a></h1>
<div class="author">
岩嵜 航 (Watal M. Iwasaki, PhD)
</div>
<div class="affiliation">
Graduate School of Life Sciences, Tohoku University
</div>
<ol>
<li><a href="1-introduction.html">Introduction: what is data analysis and R basics</a>
<li><a href="2-visualization.html">Data visualization and reporting</a>
<li><a href="3-structure1.html">Data transformation 1: extract, summarize</a>
<li><a href="4-structure2.html">Data transformation 2: join, pivot</a>
<li class="current-deck"><a href="5-content.html">Data cleansing and conversion: numbers, text</a>
<li><a href="6-input.html">Data input and interpretation</a>
<li><a href="7-distribution.html">Statistical modeling 1: probability distribution, likelihood</a>
<li><a href="8-glm.html">Statistical modeling 2: linear regression</a>
</ol>
<div class="footnote">
2023-12-01 Tohoku University<br>
<a href="https://heavywatal.github.io/slides/english2023r/">https://heavywatal.github.io/slides/english2023r/</a>
</div>

</section>
<section>
<h2 id="purposes-of-this-hands-on-lectures">Purposes of this hands-on lectures</h2>
<h3 id="-every-biological-research-involves-data-and-models">✅ <del>Every biological research involves data and models</del></h3>
<h3 id="-you-want-to-do-reproducible-analysis">✅ <del>You want to do reproducible analysis</del></h3>
<h3 id="-learn-how-to-do-it-and-how-to-learn-more">⬜ Learn how to do it and how to learn more</h3>
<ul>
<li>Overview what R can do.</li>
<li>Know where to consult when you have a problem.</li>
</ul>
<h3 id="-glance-at-the-basics-of-data-analysis">⬜ Glance at the basics of data analysis</h3>
<hr>
<p>You don&rsquo;t have to remember every command.<br>
Just repeat forgetting and searching.</p>
</section>
<section>
<h2 id="outline-of-data-analysis">Outline of data analysis</h2>
<ol>
<li>Setup computer environment ✅</li>
<li>Get and read input data ⬜ day 6</li>
<li>Exploratory data analysis
<ul>
<li><strong>Preparation</strong> (harder than it seems) ⬜ day 3&ndash;5 👈</li>
<li><strong>Visualization</strong>, generating hypotheses (fun!) ✅ day 2</li>
<li><strong>Statistical analysis</strong>, testing hypotheses ⬜ day 7&ndash;8</li>
</ul>
</li>
<li>Report ✅ day 2</li>
</ol>
<figure>
<a href="https://r4ds.hadley.nz/intro">
<img src="/slides/image/r4ds/data-science.png" width="720">
<figcaption><small>https://r4ds.hadley.nz/intro</small></figcaption>
</a>
</figure>
</section>
<section>
<h2 id="learning-data-preparation-in-two-categories">Learning data preparation in two categories</h2>
<div style="float: right;">
<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="180">
</a><br>
<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="180">
</a>
</div>
<ul>
<li>Processing data structure <span style="opacity: 0.5;">— day 3&ndash;4</span>
<ul>
<li>Extract subsets &mdash; <code>select()</code>, <code>filter()</code></li>
<li>Summarize by group &mdash; <code>group_by()</code>, <code>summarize()</code></li>
<li>Sort rows &mdash; <code>arrange()</code></li>
<li>Combine tables &mdash; <code>*_join()</code></li>
<li>Pivot longer ↔ wider &mdash; <code>pivot_longer()</code>, <code>pivot_wider()</code></li>
</ul>
</li>
<li><strong>Processing data content</strong> 👈 day 5
<ul>
<li>Type conversion: continuous vs discrete, factors, time</li>
<li>Mathematical conversion: logarithm, normalization</li>
<li>Handling outliers and missing values</li>
<li>Character manipulation: pattern matching</li>
</ul>
</li>
</ul>
<p><small style="display: block; text-align: right;"><a href="https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b">
本橋智光「前処理大全」
</a></small></p>
</section>
<section>
<h2 id="tidyverse-a-collection-of-r-packages-for-data-science">tidyverse: a collection of R packages for data science</h2>
<a href="https://www.tidyverse.org/">
<img src="/slides/image/rstats/hex-badges8.png" width="33%" style="float: right;">
</a>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;tidyverse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">conflicted</span><span class="p">)</span> <span class="c1"># charm for safe coding</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>  <span class="c1"># load core packages at once</span>
</span></span></code></pre></div><pre tabindex="0"><code>── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
</code></pre><p>Consistently designed to cover all the processes in data analysis.</p>
<figure style="margin-block: 0;">
<a href="https://r4ds.hadley.nz/intro">
<img src="/slides/image/r4ds/data-science.png" width="720">
<figcaption><small>https://r4ds.hadley.nz/intro</small></figcaption>
</a>
</figure>
</section>
<section>
<h2 id="data-types-revisit">Data types (revisit)</h2>
<ul>
<li><strong>atomic vector: one-dimensional array. very basic.</strong>
<ul>
<li><code>logical</code>: (<code>TRUE</code> or <code>FALSE</code>)</li>
<li><code>numeric</code>: (integer <code>42L</code> or real number <code>3.1416</code>)</li>
<li><code>character</code>: (<code>&quot;a string&quot;</code>)</li>
<li><code>factor</code>: (hybrid of character and integer)</li>
</ul>
</li>
<li><code>array</code>: multi-dimensional array.
<ul>
<li><code>matrix</code>: two-dimensional array.</li>
</ul>
</li>
<li><code>list</code>: subspecies of vector that can be heterogenous.</li>
<li><strong><code>data.frame</code>: Rectangular table of the vectors. important</strong> <br>
There are alternatives called <strong><code>tibble</code></strong> and <strong><code>tbl_df</code></strong>.</li>
</ul>

</section>
<section>
<h2 id="vector-one-dimensional-array">vector: one-dimensional array</h2>
<p>R is good at <strong>element-wise operation</strong> on vectors.<br>
There is no scalar type; it is treated as a vector of length 1.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span>  <span class="c1"># length of 3</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>           <span class="c1"># the same length</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  2  4 18
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="m">10</span>          <span class="c1"># length of 1</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>           <span class="c1"># the shorter vector is recycled</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 11 12 19
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;</span> <span class="m">5</span>           <span class="c1"># is it smaller than 5?</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  TRUE  TRUE FALSE
</code></pre>
</section>
<section>
<h2 id="numeric-vector">numeric vector</h2>
<p>Type of a real number is <code>double</code> (double-precision floating-point number):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="m">42</span>
</span></span><span class="line"><span class="cl"><span class="nf">typeof</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;double&#34;
</code></pre><p>Integers can be created by explicit conversion or with suffix <code>L</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">typeof</span><span class="p">(</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">answer</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;integer&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">whoami</span> <span class="o">=</span> <span class="m">24601L</span>
</span></span><span class="line"><span class="cl"><span class="nf">typeof</span><span class="p">(</span><span class="n">whoami</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;integer&#34;
</code></pre><p>Usually you don&rsquo;t have to care about this, though.</p>

</section>
<section>
<h2 id="element-wise-mathematical-functions">Element-wise mathematical functions</h2>
<p>receive a vector, and calculate something for each element:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1.000000 1.414214 1.732051
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 0.0000000 0.6931472 1.0986123
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 0.0000000 0.3010300 0.4771213
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  2.718282  7.389056 20.085537
</code></pre><p><small style="display: block; text-align: right;"><a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/00Index.html">https://stat.ethz.ch/R-manual/R-patched/library/base/html/00Index.html</a></small></p>

</section>
<section>
<h2 id="dataframe-is-a-set-of-column-vectors">data.frame is a set of column vectors</h2>
<p>There are several ways to modify column contents:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dia</span> <span class="o">=</span> <span class="n">diamonds</span>    <span class="c1"># copy to keep the original intact</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># dollar operator $</span>
</span></span><span class="line"><span class="cl"><span class="n">dia</span><span class="o">$</span><span class="n">price</span> <span class="o">=</span> <span class="m">147</span> <span class="o">*</span> <span class="n">dia</span><span class="o">$</span><span class="n">price</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># [[&#34;column name&#34;]]</span>
</span></span><span class="line"><span class="cl"><span class="n">dia[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span> <span class="o">=</span> <span class="m">147</span> <span class="o">*</span> <span class="n">dia[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># tidyverse with pipe</span>
</span></span><span class="line"><span class="cl"><span class="n">dia</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">price</span> <span class="o">=</span> <span class="m">147</span> <span class="o">*</span> <span class="n">price</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">filter</span><span class="p">(</span><span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">summarize</span><span class="p">(</span><span class="n">avg_price</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>
</span></span></code></pre></div><p><code>mutate()</code> is easy to incorporate into pipelines.</p>

</section>
<section>
<h2 id="normalization-min-max">Normalization (min-max)</h2>
<p>so that minimum = 0 and maximum = 1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">normalized_minmax</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">price</span> <span class="o">=</span> <span class="p">(</span><span class="n">price</span> <span class="o">-</span> <span class="nf">min</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="o">-</span> <span class="nf">min</span><span class="p">(</span><span class="n">price</span><span class="p">)))</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table        price    x    y    z
    1  0.23     Ideal     E     SI2  61.5    55 0.000000e+00 3.95 3.98 2.43
    2  0.21   Premium     E     SI1  59.8    61 0.000000e+00 3.89 3.84 2.31
    3  0.23      Good     E     VS1  56.9    65 5.406282e-05 4.05 4.07 2.31
    4  0.29   Premium     I     VS2  62.4    58 4.325026e-04 4.20 4.23 2.63
   --                                                                      
53937  0.72      Good     D     SI1  63.1    55 1.314267e-01 5.69 5.75 3.61
53938  0.70 Very Good     D     SI1  62.8    60 1.314267e-01 5.66 5.68 3.56
53939  0.86   Premium     H     SI2  61.0    58 1.314267e-01 6.15 6.12 3.74
53940  0.75     Ideal     D     SI2  62.2    55 1.314267e-01 5.83 5.87 3.64
</code></pre>
</section>
<section>
<h2 id="normalization-z-score">Normalization (z-score)</h2>
<p>so that average = 0 and standard deviation = 1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">normalized_z</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">price</span> <span class="o">=</span> <span class="p">(</span><span class="n">price</span> <span class="o">-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="o">/</span> <span class="nf">sd</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table      price    x    y    z
    1  0.23     Ideal     E     SI2  61.5    55 -0.9040868 3.95 3.98 2.43
    2  0.21   Premium     E     SI1  59.8    61 -0.9040868 3.89 3.84 2.31
    3  0.23      Good     E     VS1  56.9    65 -0.9038361 4.05 4.07 2.31
    4  0.29   Premium     I     VS2  62.4    58 -0.9020815 4.20 4.23 2.63
   --                                                                    
53937  0.72      Good     D     SI1  63.1    55 -0.2947280 5.69 5.75 3.61
53938  0.70 Very Good     D     SI1  62.8    60 -0.2947280 5.66 5.68 3.56
53939  0.86   Premium     H     SI2  61.0    58 -0.2947280 6.15 6.12 3.74
53940  0.75     Ideal     D     SI2  62.2    55 -0.2947280 5.83 5.87 3.64
</code></pre><p><code>price = as.vector(scale(price))</code> is equivalent.</p>

</section>
<section>
<h2 id="the-shapes-of-distributions-remain-the-same">The shapes of distributions remain the same</h2>
<p>Only the value ranges are changed.</p>
<p><img src="./figure/normalize-plot-1.png" alt="plot of chunk normalize-plot"></p>
<p>They are sensitive to outliers and asymmetric/skewed distributions.<br>
Consider log transformation, outlier removal, and so on before normalization.</p>

</section>
<section>
<h2 id="removing-outliers">Removing outliers</h2>
<p>An example to remove the observations out of average ± 3SD ($\lvert z \rvert \ge 3$):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">filter</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">price</span> <span class="o">-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="o">/</span> <span class="nf">sd</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">3</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table price    x    y    z
    1  0.23     Ideal     E     SI2  61.5    55   326 3.95 3.98 2.43
    2  0.21   Premium     E     SI1  59.8    61   326 3.89 3.84 2.31
    3  0.23      Good     E     VS1  56.9    65   327 4.05 4.07 2.31
    4  0.29   Premium     I     VS2  62.4    58   334 4.20 4.23 2.63
   --                                                               
52731  0.72      Good     D     SI1  63.1    55  2757 5.69 5.75 3.61
52732  0.70 Very Good     D     SI1  62.8    60  2757 5.66 5.68 3.56
52733  0.86   Premium     H     SI2  61.0    58  2757 6.15 6.12 3.74
52734  0.75     Ideal     D     SI2  62.2    55  2757 5.83 5.87 3.64
</code></pre><p><strong>Note</strong>: Whether and how to remove outliers highly depend on the context.</p>

</section>
<section>
<h2 id="tidyrdrop_na"><code>tidyr::drop_na()</code></h2>
<p>drops rows containing missing values <code>NA</code> (in given columns).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">tibble</span><span class="o">::</span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kc">NA</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">|&gt;</span> <span class="n">tidyr</span><span class="o">::</span><span class="nf">drop_na</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>  x y z
1 1 a D
</code></pre><p>🔰 Exclude characters with <strong>missing height or mass</strong> in <code>starwars</code>.</p>
<pre tabindex="0"><code>              name height mass hair_color  skin_color eye_color birth_year  sex    gender homeworld species     films  vehicles starships
 1  Luke Skywalker    172   77      blond        fair      blue       19.0 male masculine  Tatooine   Human &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
 2           C-3PO    167   75       &lt;NA&gt;        gold    yellow      112.0 none masculine  Tatooine   Droid &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 3           R2-D2     96   32       &lt;NA&gt; white, blue       red       33.0 none masculine     Naboo   Droid &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 4     Darth Vader    202  136       none       white    yellow       41.9 male masculine  Tatooine   Human &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
--                                                                                                                                       
56         Tarfful    234  136      brown       brown      blue         NA male masculine  Kashyyyk Wookiee &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
57 Raymus Antilles    188   79      brown       light     brown         NA male masculine  Alderaan   Human &lt;chr [2]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
58       Sly Moore    178   48       none        pale     white         NA &lt;NA&gt;      &lt;NA&gt;    Umbara    &lt;NA&gt; &lt;chr [2]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
59      Tion Medon    206   80       none        grey     black         NA male masculine    Utapau  Pau&#39;an &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
</code></pre>
</section>
<section>
<h2 id="tidyrreplace_na"><code>tidyr::replace_na()</code></h2>
<p>replaces missing values <code>NA</code> with an arbitrary value.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">tibble</span><span class="o">::</span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kc">NA</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">|&gt;</span> <span class="n">tidyr</span><span class="o">::</span><span class="nf">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">9999</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;unknown&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>     x       y    z
1    1       a    D
2    2 unknown    E
3 9999       c &lt;NA&gt;
</code></pre><p>🔰 Replace missing hair color with &ldquo;UNKNOWN&rdquo; in <code>starwars</code>.</p>
<pre tabindex="0"><code>                   name height mass hair_color       skin_color eye_color birth_year            sex    gender homeworld species     films  vehicles starships
1                 C-3PO    167   75    UNKNOWN             gold    yellow        112           none masculine  Tatooine   Droid &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
2                 R2-D2     96   32    UNKNOWN      white, blue       red         33           none masculine     Naboo   Droid &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
3                 R5-D4     97   32    UNKNOWN       white, red       red         NA           none masculine  Tatooine   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
4                Greedo    173   74    UNKNOWN            green     black         44           male masculine     Rodia  Rodian &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
5 Jabba Desilijic Tiure    175 1358    UNKNOWN green-tan, brown    orange        600 hermaphroditic masculine Nal Hutta    Hutt &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
</code></pre>
</section>
<section>
<h2 id="dplyrna_if"><code>dplyr::na_if()</code></h2>
<p>converts a value to <code>NA</code> if matched:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">tibble</span><span class="o">::</span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kc">NA</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">|&gt;</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">na_if</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">na_if</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s">&#34;a&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>   x    y    z
1 NA &lt;NA&gt;    D
2  2 &lt;NA&gt;    E
3 NA    c &lt;NA&gt;
</code></pre><p>🔰 Convert &ldquo;none&rdquo; in <code>sex</code> to <code>NA</code> in <code>starwars</code>.</p>
<pre tabindex="0"><code>    name height mass hair_color  skin_color eye_color birth_year  sex    gender homeworld species     films  vehicles starships
1  C-3PO    167   75       &lt;NA&gt;        gold    yellow        112 &lt;NA&gt; masculine  Tatooine   Droid &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
2  R2-D2     96   32       &lt;NA&gt; white, blue       red         33 &lt;NA&gt; masculine     Naboo   Droid &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
3  R5-D4     97   32       &lt;NA&gt;  white, red       red         NA &lt;NA&gt; masculine  Tatooine   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
4  IG-88    200  140       none       metal       red         15 &lt;NA&gt; masculine      &lt;NA&gt;   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
5 R4-P17     96   NA       none silver, red red, blue         NA &lt;NA&gt;  feminine      &lt;NA&gt;   Droid &lt;chr [2]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
6    BB8     NA   NA       none        none     black         NA &lt;NA&gt; masculine      &lt;NA&gt;   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
</code></pre>
</section>
<section>
<h2 id="dplyrcoalesce-complements-missing-values"><code>dplyr::coalesce()</code> complements missing values</h2>
<p><code>NA</code> in the first vector is complemented with the value in the next vector:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">tibble</span><span class="o">::</span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kc">NA</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">|&gt;</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">y_or_z</span> <span class="o">=</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">coalesce</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>   x    y    z y_or_z
1  1    a    D      a
2  2 &lt;NA&gt;    E      E
3 NA    c &lt;NA&gt;      c
</code></pre><p>Different types of variables cannot be used:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">|&gt;</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">x_or_y</span> <span class="o">=</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">coalesce</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>Error in `dplyr::mutate()`:
ℹ In argument: `x_or_y = dplyr::coalesce(x, y)`.
Caused by error in `dplyr::coalesce()`:
! Can&#39;t combine `..1` &lt;double&gt; and `..2` &lt;character&gt;.
</code></pre><p>🔰 Complement missing values in <code>hair_color</code> with <code>skin_color</code> in <code>starwars</code>.</p>

</section>
<section>
<h2 id="dplyrif_else-is-a-vectorized-switch"><code>dplyr::if_else()</code> is a vectorized switch</h2>
<p>returns a vector filled with elements from <code>x</code> or <code>y</code> depending on <code>condition</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">condition</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dplyr</span><span class="o">::</span><span class="nf">if_else</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]   1   2 300
</code></pre><p>🔰 Increase the height of droids 100-fold in <code>starwars</code>.</p>
<pre tabindex="0"><code>             name height mass hair_color  skin_color eye_color birth_year    sex    gender homeworld species     films  vehicles starships
 1 Luke Skywalker    172   77      blond        fair      blue       19.0   male masculine  Tatooine   Human &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
 2          C-3PO  16700   75       &lt;NA&gt;        gold    yellow      112.0   none masculine  Tatooine   Droid &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 3          R2-D2   9600   32       &lt;NA&gt; white, blue       red       33.0   none masculine     Naboo   Droid &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 4    Darth Vader    202  136       none       white    yellow       41.9   male masculine  Tatooine   Human &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
--                                                                                                                                        
84            Rey     NA   NA      brown       light     hazel         NA female  feminine      &lt;NA&gt;   Human &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
85    Poe Dameron     NA   NA      brown       light     brown         NA   male masculine      &lt;NA&gt;   Human &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
86            BB8     NA   NA       none        none     black         NA   none masculine      &lt;NA&gt;   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
87 Captain Phasma     NA   NA       none        none   unknown         NA female  feminine      &lt;NA&gt;   Human &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
</code></pre>
</section>
<section>
<h2 id="character-type-string">character type (string)</h2>
<p>Using double quotes <code>&quot;</code> is recommended:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="s">&#34;This is a string&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="s">&#39;If I want to include a &#34;quote&#34; inside a string, I use single quotes&#39;</span>
</span></span></code></pre></div><p>Closing quotes are easily forgotten.
Calm down, and push <kbd>esc</kbd> or <kbd>ctrl</kbd><kbd>c</kbd>.</p>
<pre tabindex="0"><code>&gt; &#34;This is a string without a closing quote
+
+
+ HELP I&#39;M STUCK
</code></pre><p><small style="display: block; text-align: right;"><a href="https://r4ds.hadley.nz/strings.html">https://r4ds.hadley.nz/strings.html</a></small></p>

</section>
<section>
<h2 id="base-r-functions-for-characters-are-hard-to-use">Base R functions for characters are hard to use</h2>
<ul>
<li>
<p>Inconsistent and cryptic function names:<br>
<code>grep</code>, <code>grepl</code>, <code>regexpr</code>, <code>gregexpr</code>, <code>regexec</code><br>
<code>sub</code>, <code>gsub</code>, <code>substr</code>, <code>substring</code></p>
</li>
<li>
<p>Inconsistent argument positions:<br></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">grep</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>Inconsistent treatment of missing values <code>NA</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kc">NA</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">paste</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># NA is not distinguished from character &#34;NA&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;1 a&#34;  &#34;2 NA&#34; &#34;NA c&#34;
</code></pre></li>
</ul>

</section>
<section>
<h2 id="stringr-part-of-tidyverse-for-character-processing">stringr: part of tidyverse for character processing</h2>
<a href="https://stringr.tidyverse.org/">
<img src="/_img/hex-stickers/stringr.webp" width="180" style="float: right;">
</a>
<ul>
<li>Consistent function and argument names.</li>
<li><code>|&gt;</code>able: 1st argument is always a <code>string</code> vector to modify.</li>
<li>Respect input attributes and structures.
<ul>
<li>Zero-length input produces zero-length output.</li>
<li>A missing value <code>NA</code> in input remains <code>NA</code> in output.</li>
</ul>
</li>
<li>Well-documented on <a href="https://stringr.tidyverse.org/">the official website</a>.</li>
</ul>
<figure style="margin: 0;">
<a href="https://stringr.tidyverse.org/">
<img src="/slides/image/cheatsheet/strings.png" width="40%">
<img src="/slides/image/cheatsheet/strings-regex.png" width="40%">
</a>
</figure>

</section>
<section>
<h2 id="basic-operations-on-character-strings">Basic operations on character strings</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fruit4</span> <span class="o">=</span> <span class="nf">head</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="m">4L</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">print</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;apple&#34;   &#34;apricot&#34; &#34;avocado&#34; &#34;banana&#34; 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_length</span><span class="p">(</span><span class="n">fruit4</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 5 7 7 6
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">fruit4</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>         <span class="c1"># substring</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;ppl&#34; &#34;pri&#34; &#34;voc&#34; &#34;ana&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">,</span> <span class="n">fruit4</span><span class="p">,</span> <span class="s">&#34;!&#34;</span><span class="p">)</span>  <span class="c1"># concatenate</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;1 apple!&#34;   &#34;2 apricot!&#34; &#34;3 avocado!&#34; &#34;4 banana!&#34; 
</code></pre><p>🔰 Get a subset of <code>words</code> longer than 9 characters.</p>
<p>🔰 Apply <code>str_sub()</code> and <code>str_c()</code> to those long words.</p>

</section>
<section>
<h2 id="pattern-matching">Pattern matching</h2>
<p>is not just exact match.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># starts with &#34;a&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_subset</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="s">&#34;^a&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;apple&#34;   &#34;apricot&#34; &#34;avocado&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># ends with &#34;r&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_subset</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="s">&#34;r$&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;bell pepper&#34;  &#34;chili pepper&#34; &#34;cucumber&#34;     &#34;pear&#34;        
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 3-4 alphanumeric characters</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_subset</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="s">&#34;^\\w{3,4}$&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;date&#34; &#34;fig&#34;  &#34;lime&#34; &#34;nut&#34;  &#34;pear&#34; &#34;plum&#34;
</code></pre><p>What do <code>^</code>, <code>$</code>, and other symbols mean?</p>

</section>
<section>
<h2 id="regular-expressions-regex-regexp">Regular expressions (regex, regexp)</h2>
<div class="column-container">
  <div class="column" style="min-width: 0;">
<table>
  <thead>
      <tr>
          <th>meta</th>
          <th>matches</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>\d</code></td>
          <td>digit <code>[0-9]</code></td>
      </tr>
      <tr>
          <td><code>\s</code></td>
          <td>space <code>[ \t\n\r]</code></td>
      </tr>
      <tr>
          <td><code>\w</code></td>
          <td>word character <code>[a-zA-Z0-9_]</code></td>
      </tr>
      <tr>
          <td><code>.</code></td>
          <td><strong>any character</strong></td>
      </tr>
      <tr>
          <td><code>^</code></td>
          <td>beginning of line</td>
      </tr>
      <tr>
          <td><code>$</code></td>
          <td>end of line</td>
      </tr>
  </tbody>
</table>
  </div>
  <div class="column" style="flex-shrink: 1.2; min-width: 0;">
<table>
  <thead>
      <tr>
          <th>operator</th>
          <th>matches</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>a?</code></td>
          <td>0 or 1 time</td>
      </tr>
      <tr>
          <td><code>a*</code></td>
          <td>0 or more times</td>
      </tr>
      <tr>
          <td><code>a+</code></td>
          <td>1 or more times</td>
      </tr>
      <tr>
          <td><code>a{n,m}</code></td>
          <td>n&ndash;m times</td>
      </tr>
      <tr>
          <td><code>a(?=c)</code></td>
          <td><code>a</code> followed by <code>c</code></td>
      </tr>
      <tr>
          <td><code>(?&lt;=b)a</code></td>
          <td><code>a</code> preceded by <code>b</code></td>
      </tr>
  </tbody>
</table>
  </div>
</div>
<p><small style="display: block; text-align: right;"><a href="https://unicode-org.github.io/icu/userguide/strings/regexp.html#regular-expression-metacharacters">https://unicode-org.github.io/icu/userguide/strings/regexp.html#regular-expression-metacharacters</a></small></p>
<dl>
<dt><a href="https://duckduckgo.com/?q=escape+sequence">escape sequence</a></dt>
<dd><code>&quot;\n&quot;</code> is a line break; <code>&quot;\t&quot;</code> is a tab; <strong><code>&quot;\d&quot;</code> is invalid</strong>.</dd>
<dd><code>&quot;\\&quot;</code> is a backslash; <strong>write <code>&quot;\\d&quot;</code> to mean regex <code>&quot;\d&quot;</code></strong>.</dd>
</dl>
</section>
<section>
<figure style="margin: 0;">
<a href="https://stringr.tidyverse.org/">
<img src="/slides/image/cheatsheet/strings-regex.png" width="100%">
<figcaption><small>https://stringr.tidyverse.org/</small></figcaption>
</a>
</figure>
</section>
<section>
<h2 id="practice-of-regular-expressions">Practice of regular expressions</h2>
<p>🔰 Learn pattern matching by applying <code>str_subset()</code> to <code>fruit</code>:</p>
<ul>
<li>contains &ldquo;o&rdquo;</li>
<li>starts with &ldquo;o&rdquo;</li>
<li>ends with &ldquo;berry&rdquo;</li>
<li>starts with &ldquo;c&rdquo; and ends with &ldquo;r&rdquo;</li>
<li>contains a space; does not contain any space</li>
</ul>
<p>🔰 <code>starnames = starwars[[&quot;name&quot;]]</code>:</p>
<ul>
<li>contains a digit; does not contain any digit</li>
<li>consists of 3 or more words</li>
<li>does not contain any lowercase letter</li>
</ul>

</section>
<section>
<h2 id="str_detect"><code>str_detect()</code></h2>
<p>Returns <code>TRUE</code>/<code>FALSE</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fruit4</span> <span class="o">=</span> <span class="nf">head</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="m">4L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">fruit4</span><span class="p">,</span> <span class="s">&#34;^a&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  TRUE  TRUE  TRUE FALSE
</code></pre><p>🔰 From <code>starwars</code>, extract rows whose <code>name</code> does not contain space.</p>
<pre tabindex="0"><code>        name height mass hair_color  skin_color eye_color birth_year    sex    gender homeworld species     films  vehicles starships
 1     C-3PO    167   75       &lt;NA&gt;        gold    yellow        112   none masculine  Tatooine   Droid &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 2     R2-D2     96   32       &lt;NA&gt; white, blue       red         33   none masculine     Naboo   Droid &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 3     R5-D4     97   32       &lt;NA&gt;  white, red       red         NA   none masculine  Tatooine   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
 4 Chewbacca    228  112      brown     unknown      blue        200   male masculine  Kashyyyk Wookiee &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [2]&gt;
--                                                                                                                                   
21   Tarfful    234  136      brown       brown      blue         NA   male masculine  Kashyyyk Wookiee &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
22      Finn     NA   NA      black        dark      dark         NA   male masculine      &lt;NA&gt;   Human &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
23       Rey     NA   NA      brown       light     hazel         NA female  feminine      &lt;NA&gt;   Human &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
24       BB8     NA   NA       none        none     black         NA   none masculine      &lt;NA&gt;   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
</code></pre>
</section>
<section>
<h2 id="str_extract"><code>str_extract()</code></h2>
<p>Returns matched substring or <code>NA</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fruit4</span> <span class="o">=</span> <span class="nf">head</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="m">4L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_extract</span><span class="p">(</span><span class="n">fruit4</span><span class="p">,</span> <span class="s">&#34;^a..&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;app&#34; &#34;apr&#34; &#34;avo&#34; NA   
</code></pre><p>🔰 Remove numeric characters from <code>clarity</code> column of <code>diamonds</code>.</p>
<pre tabindex="0"><code>      carat       cut color clarity depth table price    x    y    z
    1  0.23     Ideal     E      SI  61.5    55   326 3.95 3.98 2.43
    2  0.21   Premium     E      SI  59.8    61   326 3.89 3.84 2.31
    3  0.23      Good     E      VS  56.9    65   327 4.05 4.07 2.31
    4  0.29   Premium     I      VS  62.4    58   334 4.20 4.23 2.63
   --                                                               
53937  0.72      Good     D      SI  63.1    55  2757 5.69 5.75 3.61
53938  0.70 Very Good     D      SI  62.8    60  2757 5.66 5.68 3.56
53939  0.86   Premium     H      SI  61.0    58  2757 6.15 6.12 3.74
53940  0.75     Ideal     D      SI  62.2    55  2757 5.83 5.87 3.64
</code></pre>
</section>
<section>
<h2 id="str_replace-str_replace_all"><code>str_replace()</code>, <code>str_replace_all()</code></h2>
<p>Those captured by parentheses<code>()</code> can be used by back-reference <code>\1</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fruit4</span> <span class="o">=</span> <span class="nf">head</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="m">4L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">fruit4</span><span class="p">,</span> <span class="s">&#34;..$&#34;</span><span class="p">,</span> <span class="s">&#34;!!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;app!!&#34;   &#34;apric!!&#34; &#34;avoca!!&#34; &#34;bana!!&#34; 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">fruit4</span><span class="p">,</span> <span class="s">&#34;(..)$&#34;</span><span class="p">,</span> <span class="s">&#34;_\\1_&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;app_le_&#34;   &#34;apric_ot_&#34; &#34;avoca_do_&#34; &#34;bana_na_&#34; 
</code></pre><p>🔰 Replace all the numbers in <code>starwars$name</code> with zero.</p>
<pre tabindex="0"><code>    name height mass hair_color  skin_color eye_color birth_year  sex    gender homeworld species     films  vehicles starships
1  C-0PO    167   75       &lt;NA&gt;        gold    yellow        112 none masculine  Tatooine   Droid &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
2  R0-D0     96   32       &lt;NA&gt; white, blue       red         33 none masculine     Naboo   Droid &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
3  R0-D0     97   32       &lt;NA&gt;  white, red       red         NA none masculine  Tatooine   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
4  IG-00    200  140       none       metal       red         15 none masculine      &lt;NA&gt;   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
5 R0-P00     96   NA       none silver, red red, blue         NA none  feminine      &lt;NA&gt;   Droid &lt;chr [2]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
6    BB0     NA   NA       none        none     black         NA none masculine      &lt;NA&gt;   Droid &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
</code></pre>
</section>
<section>
<h2 id="regex-for-column-selection-with-dplyr-tidyr">Regex for column selection with dplyr, tidyr</h2>
<p><code>matches()</code> can play the roles of <code>starts_with()</code>/<code>ends_with()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl">                        <span class="c1"># starts_with(&#34;c&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">diamonds</span> <span class="o">|&gt;</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#34;^c&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1"># ends_with(&#34;s&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">starwars</span> <span class="o">|&gt;</span> <span class="n">dplyr</span><span class="o">::</span><span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#34;s$&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1"># digits only</span>
</span></span><span class="line"><span class="cl"><span class="n">world_bank_pop</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">tidyr</span><span class="o">::</span><span class="nf">pivot_longer</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#34;^\\d+$&#34;</span><span class="p">),</span> <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;year&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>See <a href="https://tidyselect.r-lib.org/reference/language.html">selection helpers</a> for more details.</p>

</section>
<section>
<h2 id="formatting-strings">Formatting strings</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fruit4</span> <span class="o">=</span> <span class="nf">head</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="m">4L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_to_upper</span><span class="p">(</span><span class="n">fruit4</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;APPLE&#34;   &#34;APRICOT&#34; &#34;AVOCADO&#34; &#34;BANANA&#34; 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">stringr</span><span class="o">::</span><span class="nf">str_pad</span><span class="p">(</span><span class="n">fruit4</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="s">&#34;left&#34;</span><span class="p">,</span> <span class="s">&#34;_&#34;</span><span class="p">)</span>   <span class="c1"># Fix width by filling spaces</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;___apple&#34; &#34;_apricot&#34; &#34;_avocado&#34; &#34;__banana&#34;
</code></pre><p><code>stringr</code> is built on top of a more comprehensive package,
<a href="https://stringi.gagolewski.com/"><code>stringi</code></a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">stringi</span><span class="o">::</span><span class="nf">stri_trans_nfkc</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;ｶﾀｶﾅ&#34;</span><span class="p">,</span> <span class="s">&#34;４２&#34;</span><span class="p">))</span>  <span class="c1"># 半角カナ・全角数字に対処</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;カタカナ&#34; &#34;42&#34;      
</code></pre><p>🔰 Turn <code>starwars</code>&rsquo;s <code>name</code> column to lowercase.</p>

</section>
<section>
<h2 id="converting-strings-to-something-else">Converting strings to something else</h2>
<a href="https://readr.tidyverse.org/">
<img src="/_img/hex-stickers/readr.webp" width="180" style="float: right;">
</a>
<p>It is not stringr&rsquo;s job, but readr&rsquo;s:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">readr</span><span class="o">::</span><span class="nf">parse_number</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;p = 0.02 *&#34;</span><span class="p">,</span> <span class="s">&#34;N_A = 6e23&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 2e-02 6e+23
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">readr</span><span class="o">::</span><span class="nf">parse_double</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;0.02&#34;</span><span class="p">,</span> <span class="s">&#34;6e+23&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 2e-02 6e+23
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">readr</span><span class="o">::</span><span class="nf">parse_logical</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="s">&#34;true&#34;</span><span class="p">,</span> <span class="s">&#34;0&#34;</span><span class="p">,</span> <span class="s">&#34;false&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  TRUE  TRUE FALSE FALSE
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">readr</span><span class="o">::</span><span class="nf">parse_date</span><span class="p">(</span><span class="s">&#34;2020-06-03&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;2020-06-03&#34;
</code></pre><p><code>6e+23</code> means $6 \times 10 ^ {23}$, not $6e^{23}$.</p>

</section>
<section>
<h2 id="factor-type-to-represent-categorical-variables"><code>factor</code> type to represent categorical variables</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">month_levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span>                       <span class="c1"># possible values</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Jan&#34;</span><span class="p">,</span> <span class="s">&#34;Feb&#34;</span><span class="p">,</span> <span class="s">&#34;Mar&#34;</span><span class="p">,</span> <span class="s">&#34;Apr&#34;</span><span class="p">,</span> <span class="s">&#34;May&#34;</span><span class="p">,</span> <span class="s">&#34;Jun&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Jul&#34;</span><span class="p">,</span> <span class="s">&#34;Aug&#34;</span><span class="p">,</span> <span class="s">&#34;Sep&#34;</span><span class="p">,</span> <span class="s">&#34;Oct&#34;</span><span class="p">,</span> <span class="s">&#34;Nov&#34;</span><span class="p">,</span> <span class="s">&#34;Dec&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x1</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Dec&#34;</span><span class="p">,</span> <span class="s">&#34;Apr&#34;</span><span class="p">,</span> <span class="s">&#34;Jan&#34;</span><span class="p">,</span> <span class="s">&#34;Mar&#34;</span><span class="p">)</span>      <span class="c1"># normal string vector</span>
</span></span><span class="line"><span class="cl"><span class="n">y1</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">month_levels</span><span class="p">)</span>  <span class="c1"># convert it to factor</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] Dec Apr Jan Mar
Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
</code></pre><p>Looks like character, but they are internally <strong>integer</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">typeof</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;integer&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">as.integer</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>                          <span class="c1"># factor to integer</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 12  4  1  3
</code></pre><p>🔰 See <code>str(iris)</code> for a factor variable at hand.</p>

</section>
<section>
<h2 id="factor-difference-from-string-1"><code>factor</code>: difference from string 1</h2>
<p>Possible values (levels) are known and fixed.<br>
That is, a typo becomes <code>NA</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x2</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Dec&#34;</span><span class="p">,</span> <span class="s">&#34;Apr&#34;</span><span class="p">,</span> <span class="s">&#34;Jam&#34;</span><span class="p">,</span> <span class="s">&#34;Mar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">factor</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">month_levels</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] Dec  Apr  &lt;NA&gt; Mar 
Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
</code></pre><p>A string vector including all the levels can be converted easily:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">as.factor</span><span class="p">(</span><span class="n">starwars[[</span><span class="s">&#34;gender&#34;</span><span class="n">]]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code> [1] masculine masculine masculine masculine feminine  masculine feminine  masculine masculine masculine masculine masculine masculine masculine masculine masculine masculine &lt;NA&gt;      masculine masculine masculine masculine masculine masculine masculine masculine feminine  masculine masculine masculine masculine masculine masculine feminine  masculine masculine masculine masculine masculine masculine masculine feminine  masculine masculine feminine  masculine masculine masculine masculine masculine masculine masculine masculine feminine  masculine masculine masculine masculine &lt;NA&gt;      &lt;NA&gt;      masculine masculine feminine  feminine  feminine  masculine masculine masculine feminine  masculine masculine feminine  feminine  feminine  masculine masculine feminine  masculine masculine masculine &lt;NA&gt;      masculine masculine feminine  masculine masculine feminine 
Levels: feminine masculine
</code></pre>
</section>
<section>
<h2 id="factor-difference-from-string-2"><code>factor</code>: difference from string 2</h2>
<p>can be sorted in an arbitrary (non-alphabetical) order:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x1</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Dec&#34;</span><span class="p">,</span> <span class="s">&#34;Apr&#34;</span><span class="p">,</span> <span class="s">&#34;Jan&#34;</span><span class="p">,</span> <span class="s">&#34;Mar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">sort</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>     <span class="c1"># alphabetical order as always</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;Apr&#34; &#34;Dec&#34; &#34;Jan&#34; &#34;Mar&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y1</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">month_levels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">sort</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>     <span class="c1"># in the order of the levels</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] Jan Mar Apr Dec
Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
</code></pre>
</section>
<section>
<h2 id="factor-categorical-variables-in-figures"><code>factor</code>: categorical variables in figures</h2>
<p>can be sorted in an arbitrary (non-alphabetical) order:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mpg_fct</span> <span class="o">=</span> <span class="n">mpg</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">drv</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;f&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">,</span> <span class="s">&#34;4&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><p><img src="./figure/factor-plot-1.png" alt="plot of chunk factor-plot"></p>

</section>
<section>
<h2 id="ordered-factor"><code>ordered</code> factor</h2>
<p>can be compared with inequality operators.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x1</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Dec&#34;</span><span class="p">,</span> <span class="s">&#34;Apr&#34;</span><span class="p">,</span> <span class="s">&#34;Jan&#34;</span><span class="p">,</span> <span class="s">&#34;Mar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y3</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">month_levels</span><span class="p">,</span> <span class="n">ordered</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">class</span><span class="p">(</span><span class="n">y3</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;ordered&#34; &#34;factor&#34; 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">y3</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] Dec Apr Jan Mar
Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; Oct &lt; Nov &lt; Dec
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y3</span> <span class="o">&lt;</span> <span class="s">&#34;Sep&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] FALSE  TRUE  TRUE  TRUE
</code></pre><p>🔰 See <code>str(diamonds)</code> for ordered variables at hand.<br>
🔰 Extract rows whose <code>cut</code> is better than &ldquo;Premium&rdquo;.</p>

</section>
<section>
<h2 id="forcats-part-of-tidyverse-for-factor-type">forcats: part of tidyverse for factor type</h2>
<a href="https://forcats.tidyverse.org/">
<img src="/_img/hex-stickers/forcats.webp" width="180" style="float: right;">
</a>
<ul>
<li><code>fct_reorder()</code>: by another variable.</li>
<li><code>fct_infreq()</code>: to reorder by the frequency of values.</li>
<li><code>fct_relevel()</code>: to change the order by hand.</li>
<li><code>fct_lump()</code>: collapses the least frequent values into &ldquo;other&rdquo;.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">diamonds_fct</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">forcats</span><span class="o">::</span><span class="nf">fct_infreq</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">mpg_fct</span> <span class="o">=</span> <span class="n">mpg</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">fl</span> <span class="o">=</span> <span class="n">forcats</span><span class="o">::</span><span class="nf">fct_lump</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="m">2</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="./figure/fct-infreq-1.png" alt="plot of chunk fct-infreq"></p>
</section>
<section>
<h2 id="practice-to-reorder-variables-in-figures">Practice to reorder variables in figures</h2>
<p>🔰 Reproduce the following figure of <code>mpg</code>:</p>
<p><img src="./figure/plot-factor-1.png" alt="plot of chunk plot-factor"></p>

</section>
<section>
<h2 id="converting-a-categorical-variable-to-index-variables">Converting a categorical variable to index variables</h2>
<p>equivalent to pivoting a binary variable wider.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">iris</span> <span class="o">|&gt;</span> <span class="n">tibble</span><span class="o">::</span><span class="nf">rowid_to_column</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="m">1L</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">tidyr</span><span class="o">::</span><span class="nf">pivot_wider</span><span class="p">(</span><span class="n">names_from</span> <span class="o">=</span> <span class="n">Species</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">values_from</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">values_fill</span> <span class="o">=</span> <span class="m">0L</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>    rowid Sepal.Length Sepal.Width Petal.Length Petal.Width setosa versicolor virginica
  1     1          5.1         3.5          1.4         0.2      1          0         0
  2     2          4.9         3.0          1.4         0.2      1          0         0
  3     3          4.7         3.2          1.3         0.2      1          0         0
  4     4          4.6         3.1          1.5         0.2      1          0         0
 --                                                                                    
147   147          6.3         2.5          5.0         1.9      0          0         1
148   148          6.5         3.0          5.2         2.0      0          0         1
149   149          6.2         3.4          5.4         2.3      0          0         1
150   150          5.9         3.0          5.1         1.8      0          0         1
</code></pre><p>🔰 Try transforming back to the original <code>iris</code>.</p>

</section>
<section>
<h2 id="date-time-type-posixct-posixlt">Date-time type: POSIXct, POSIXlt</h2>
<ul>
<li>POSIXct: elapsed time since the epoch in seconds. machine-friendly.</li>
<li>POSIXlt: named list(sec, min, hour, mday, mon, year, &hellip;). human-readable.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">now</span> <span class="o">=</span> <span class="s">&#34;2023-04-12 14:10:00&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ct</span> <span class="o">=</span> <span class="nf">as.POSIXct</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">unclass</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1681276200
attr(,&#34;tzone&#34;)
[1] &#34;&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lt</span> <span class="o">=</span> <span class="nf">as.POSIXlt</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">unclass</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">as_tibble</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>  sec min hour mday mon year wday yday isdst zone gmtoff
1   0  10   14   12   3  123    3  101     0  JST     NA
</code></pre><p>Who is in charge of date-time in tidyverse?</p>
</section>
<section>
<h2 id="lubridate--tidyverse-package-for-date-and-time">lubridate &mdash; tidyverse package for date and time</h2>
<a href="https://lubridate.tidyverse.org/">
<img src="/_img/hex-stickers/lubridate.webp" width="180" style="float: right;">
</a>
<p>convert character/numeric vectors to POSIXct date times:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lubridate</span><span class="o">::</span><span class="nf">ymd</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;20230412&#34;</span><span class="p">,</span> <span class="s">&#34;2023-04-12&#34;</span><span class="p">,</span> <span class="s">&#34;23/04/12&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;2023-04-12&#34; &#34;2023-04-12&#34; &#34;2023-04-12&#34;
</code></pre><p>extract values from POSIXct in arbitrary unit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">today</span> <span class="o">=</span> <span class="n">lubridate</span><span class="o">::</span><span class="nf">ymd</span><span class="p">(</span><span class="m">20230412</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">lubridate</span><span class="o">::</span><span class="nf">month</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 4
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lubridate</span><span class="o">::</span><span class="nf">wday</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] Wed
Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat
</code></pre>
</section>
<section>
<h2 id="processing-data-contents--roundup">Processing data contents | roundup</h2>
<div style="float: right;">
<a href="https://stringr.tidyverse.org/">
<img src="/_img/hex-stickers/stringr.webp" width="180">
</a><br>
<a href="https://forcats.tidyverse.org/">
<img src="/_img/hex-stickers/forcats.webp" width="180">
</a><br>
<a href="https://lubridate.tidyverse.org/">
<img src="/_img/hex-stickers/lubridate.webp" width="180">
</a><br>
</div>
<ul>
<li>Types of atomic vectors: character, numeric, factor, datetime, etc.</li>
<li><a href="https://stringr.tidyverse.org/">stringr</a> for character type
<ul>
<li><strong>Regular expressions</strong> are super-powerful.</li>
</ul>
</li>
<li><a href="https://forcats.tidyverse.org/">forcats</a> for factor type</li>
<li><a href="https://lubridate.tidyverse.org/">lubridate</a> for date and time</li>
</ul>
<p>Print out <a href="https://www.rstudio.com/resources/cheatsheets/">PDF cheat sheets</a>,
and keep them within reach.</p>
</section>
<section>
<h2 id="now-you-have-skills-for-data-preparation">Now you have skills for data preparation</h2>
<div style="float: right;">
<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="180">
</a><br>
<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="180">
</a>
<a href="https://stringr.tidyverse.org/">
<img src="/_img/hex-stickers/stringr.webp" width="180">
</a>
</div>
<ul>
<li>Processing data structure day 3 and 4
<ul>
<li>Extract subsets &mdash; <code>select()</code>, <code>filter()</code></li>
<li>Summarize by group &mdash; <code>group_by()</code>, <code>summarize()</code></li>
<li>Sort rows &mdash; <code>arrange()</code></li>
<li>Combine tables &mdash; <code>*_join()</code></li>
<li>Pivot longer ↔ wider &mdash; <code>pivot_longer()</code>, <code>pivot_wider()</code></li>
</ul>
</li>
<li><strong>Processing data content</strong> 👈 day 5
<ul>
<li>Type conversion: continuous vs discrete, factors, time</li>
<li>Mathematical conversion: logarithm, normalization</li>
<li>Handling outliers and missing values</li>
<li>Character manipulation: pattern matching</li>
</ul>
</li>
</ul>
<p><small style="display: block; text-align: right;"><a href="https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b">
本橋智光「前処理大全」
</a></small></p>
</section>
<section>
<h2 id="-challenge-play-with-built-in-datasets">🔰 Challenge: play with built-in datasets</h2>
<div style="float: right;">
<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="180">
</a><br>
<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="180">
</a><br>
<a href="https://forcats.tidyverse.org/">
<img src="/_img/hex-stickers/forcats.webp" width="180">
</a><br>
<a href="https://lubridate.tidyverse.org/">
<img src="/_img/hex-stickers/lubridate.webp" width="180">
</a><br>
</div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dplyr</span><span class="o">::</span><span class="n">storms</span>
</span></span><span class="line"><span class="cl"><span class="n">dplyr</span><span class="o">::</span><span class="n">starwars</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">billboard</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">cms_patient_experience</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">cms_patient_care</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">relig_income</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">us_rent_income</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">who</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">population</span>
</span></span><span class="line"><span class="cl"><span class="n">tidyr</span><span class="o">::</span><span class="n">world_bank_pop</span>
</span></span><span class="line"><span class="cl"><span class="n">forcats</span><span class="o">::</span><span class="n">gss_cat</span>
</span></span><span class="line"><span class="cl"><span class="n">lubridate</span><span class="o">::</span><span class="n">lakers</span>
</span></span><span class="line"><span class="cl"><span class="n">ggplot2</span><span class="o">::</span><span class="n">midwest</span>
</span></span><span class="line"><span class="cl"><span class="n">ggplot2</span><span class="o">::</span><span class="n">msleep</span>
</span></span><span class="line"><span class="cl"><span class="n">ggplot2</span><span class="o">::</span><span class="n">txhousing</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="reference">Reference</h2>
<dl>
<dt>R for Data Science &mdash; Hadley Wickham et al.</dt>
<dd><a href="https://r4ds.hadley.nz">https://r4ds.hadley.nz</a>,
<a href="https://amzn.to/4cpL6w8">Paperback</a>,
<a href="https://amzn.to/2yyFRKt">日本語版書籍</a></dd>
</dl>
<p><a href="https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&amp;linkCode=ll1&amp;tag=heavywatal-22&amp;linkId=8a3fd4e9a0c944b1b41242bbab8d147b">前処理大全 &mdash; 本橋智光</a><br>
<a href="https://amzn.to/2Yy5LND">RユーザのためのRStudio[実践]入門 (宇宙船本) &mdash; 松村ら</a></p>
<dl>
<dt>Official documents:</dt>
<dd><a href="https://www.tidyverse.org/">tidyverse</a>,
<a href="https://dplyr.tidyverse.org/">dplyr</a>,
<a href="https://tidyr.tidyverse.org/">tidyr</a>,
<a href="https://stringr.tidyverse.org/">stringr</a>,
<a href="https://forcats.tidyverse.org/">forcats</a>,
<a href="https://lubridate.tidyverse.org/">lubridate</a></dd>
<dt>Older versions</dt>
<dd>「<a href="https://heavywatal.github.io/slides/nagoya2018/">Rにやらせて楽しよう — データの可視化と下ごしらえ</a>」
岩嵜航 2018</dd>
<dd>「Rを用いたデータ解析の基礎と応用」石川由希 2019 名古屋大学</dd>
<dd>「<a href="https://heavywatal.github.io/slides/tmd2022/">Rによるデータ前処理実習</a>」
岩嵜航 2022 東京医科歯科大</dd>
<dd>「<a href="https://comicalcommet.github.io/r-training-2023/">Rを用いたデータ解析の基礎と応用</a>」
石川由希 2023 名古屋大学</dd>
</dl>
<a href="6-input.html" class="readmore">
6. Data input and interpretation
</a>
</section>
</div>
</div>
</body>
</html>
