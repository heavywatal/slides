<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>Tidying and transforming data with R â€” Hands-on R Lecture for Makino Lab</title>
<link rel="stylesheet" href="/slides/reveal.js/css/reveal.css">
<link rel="stylesheet" href="/slides/css/theme-reveal.css">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="Tidying and transforming data with R â€” Hands-on R Lecture for Makino Lab">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/makino2019r/3-tidy-data.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks â€” Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<meta name="generator" content="Hugo 0.56.0-DEV" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "\\[", right: "\\]", display: true},
      {left: "$", right: "$", display: false}
    ]
  });
});
</script>
<style>
.katex {
  font-size: 1.12em;
}

.katex-display > .katex {
  text-align: left;
  padding-left: 2rem;
}
</style>

<script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-41178626-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css"></p>

<h1 id="hands-on-r-lecture-for-makino-lab"><a href=".">Hands-on R Lecture for Makino Lab</a></h1>

<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki)
</div>

<div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡
</div>

<ol start="0">
<li><a href="0-why-r.html">Why do we use R?</a>
<li><a href="1-basic-r.html">R basics</a>
<li><a href="2-ggplot.html">Visualization with R</a>
<li class="current-deck"><a href="3-tidy-data.html">Tidying and transforming data with R</a>
<li><a href="4-statistics.html">Statistical analysis with R</a>
<li><a href="5-git.html">File management with Git+GitHub</a>
</ol>

<div class="footnote">
è³‡æ–™ä½œæˆå”åŠ›: çŸ³å·ç”±å¸Œ (åå¤å±‹å¤§å­¦ ç†å­¦ç ”ç©¶ç§‘ è„³å›è·¯æ§‹é€ å­¦ è¬›å¸«)<br>
2019-10-16 ç”Ÿç‰©æ£Ÿå¤§ä¼šè­°å®¤
</div>
</section>
<section>
<h2 id="ä½¿ãˆã‚‹å½¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ãˆã‚‹">ä½¿ãˆã‚‹å½¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ãˆã‚‹</h2>

<blockquote>
<p>Happy families are all alike;<br>
every unhappy family is unhappy in its own way<br>
&mdash; Leo Tolstoy &ldquo;Anna Karenina&rdquo;</p>

<p>tidy datasets are all alike,<br>
but every messy dataset is messy in its own way<br>
&mdash; Hadley Wickham</p>
</blockquote>

<dl>
<dt>å‡ºç™ºç‚¹ã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã•ã¾ã–ã¾</dt>
<dd>laboratory notebook, field notebookã€</dd>
<dd>database, simulation&hellip;</dd>
<dt>è§£æã‚„ä½œå›³ã«ä½¿ãˆã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¯ã»ã¼æ±ºã¾ã£ã¦ã‚‹</dt>
<dd><code>ggplot(data, ...)</code>, <code>glm(..., data, ...)</code>, &hellip;</dd>
</dl>

</section>
<section>
<h2 id="æ•´ç„¶ãƒ‡ãƒ¼ã‚¿-tidy-data">æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data</h2>

<ul>
<li>Each <strong>variable (å¤‰æ•°)</strong> must have its own <strong>column (åˆ—)</strong>.</li>
<li>Each <strong>observation (è¦³æ¸¬)</strong> must have its own <strong>row (è¡Œ)</strong>.</li>
<li>Each <strong>value</strong> must have its own <strong>cell</strong>.</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">print</span><span class="p">(</span>diamonds<span class="p">)</span></code></pre></div>
<pre><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
    3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
   --                                                                  
53937  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
53939  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre>

<p><a href="http://r4ds.had.co.nz/tidy-data.html">http://r4ds.had.co.nz/tidy-data.html</a><br>
<a href="https://speakerdeck.com/fnshr/zheng-ran-detatutenani">https://speakerdeck.com/fnshr/zheng-ran-detatutenani</a><br></p>

</section>
<section>
<h2 id="tidy-data-nbsp-vs-nbsp-messy-data">tidy data &nbsp; vs &nbsp; messy data</h2>

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/figure/fnshr/tidy-data-ex1.png" height="550" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/figure/fnshr/messy-data-ex1.png" width="300" style="transform: translate(-14px, 0);">
    <div style="position: absolute; top: 440px;">
    Each variable has its own column.<br>
    Each observation has its own row.<br>
    Each value has its own cell.<br><br>
    </div>
  </div>
</div>
<div class="cite" style="position: absolute; bottom: 18px; right: 24px;">
<a href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</div>
</section>
<section>
<h2 id="tidy-data-nbsp-vs-nbsp-messy-data">tidy data &nbsp; vs &nbsp; messy data</h2>

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/figure/fnshr/tidy-data-ex1-var.png" height="580" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/figure/fnshr/messy-data-ex1-var.png" width="420" style="transform: translate(-36px, -10px);">
    <div style="position: absolute; top: 440px;">
    <strong>Each variable has its own column.</strong><br>
    Each observation has its own row.<br>
    Each value has its own cell.<br><br>
    </div>
  </div>
</div>
<div class="cite" style="position: absolute; bottom: 18px; right: 24px;">
<a href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</div>
</section>
<section>
<h2 id="tidy-data-nbsp-vs-nbsp-messy-data">tidy data &nbsp; vs &nbsp; messy data</h2>

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/figure/fnshr/tidy-data-ex1-obs.png" height="530" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/figure/fnshr/messy-data-ex1-obs.png" width="300" style="transform: translate(-24px, 0);">
    <div style="position: absolute; top: 440px;">
    Each variable has its own column.<br>
    <strong>Each observation has its own row.</strong><br>
    Each value has its own cell.<br><br>
    </div>
  </div>
</div>
<div class="cite" style="position: absolute; bottom: 18px; right: 24px;">
<a href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</div>
</section>
<section>
<h2 id="tidy-data-nbsp-vs-nbsp-messy-data">tidy data &nbsp; vs &nbsp; messy data</h2>

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/figure/fnshr/tidy-data-ex1-obs.png" height="530" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/figure/fnshr/messy-data-ex1-val.png" width="300" style="transform: translate(-14px, 4px);">
    <div style="position: absolute; top: 440px;">
    Each variable has its own column.<br>
    Each observation has its own row.<br>
    <strong>Each value has its own cell.</strong><br><br>
    </div>
  </div>
</div>
<div class="cite" style="position: absolute; bottom: 18px; right: 24px;">
<a href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</div>
</section>
<section>
<h2 id="today-we-learn-data-preparation">Today we learn data preparation</h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">VADeaths</code></pre></div>
<pre><code>      Rural Male Rural Female Urban Male Urban Female
50-54       11.7          8.7       15.4          8.4
55-59       18.1         11.7       24.3         13.6
60-64       26.9         20.3       37.0         19.3
65-69       41.0         30.9       54.6         35.1
70-74       66.0         54.3       71.1         50.0
</code></pre>

<p>â†“ä¸‹ã”ã—ã‚‰ãˆ</p>

<pre><code>   lbound ubound region    sex death
    &lt;int&gt;  &lt;int&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
 1     50     54  Rural   Male  11.7
 2     50     54  Rural Female   8.7
 3     50     54  Urban   Male  15.4
 4     50     54  Urban Female   8.4
--                                  
17     70     74  Rural   Male  66.0
18     70     74  Rural Female  54.3
19     70     74  Urban   Male  71.1
20     70     74  Urban Female  50.0
</code></pre>

</section>
<section>
<h2 id="tidyverseã«ä¾¿åˆ©ãªé“å…·ãŒæƒã£ã¦ã‚‹">tidyverseã«ä¾¿åˆ©ãªé“å…·ãŒæƒã£ã¦ã‚‹</h2>

<p><a href="https://www.tidyverse.org/">
<img src="/slides/figure/rstats/hex-badges.png" width="260" align="right">
</a></p>

<p>Rã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ‰‹ã«æ‰±ã†ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç¾¤</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&#34;tidyverse&#34;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>tidyverse<span class="p">)</span>
<span class="c1"># core packages are loaded</span></code></pre></div>
<ul>
<li>çµ±ä¸€çš„ãªä½¿ã„å‹æ‰‹</li>
<li>ã‚·ãƒ³ãƒ—ãƒ«ãªé–¢æ•°ã‚’ç¹‹ã’ã¦ä½¿ã†ãƒ‡ã‚¶ã‚¤ãƒ³</li>
</ul>

<figure>
<a href="http://r4ds.had.co.nz/wrangle-intro.html">
<img src="/slides/figure/r4ds/data-science-wrangle.png">
<figcaption class="url">http://r4ds.had.co.nz/wrangle-intro.html</figcaption>
</a>
</figure>

<p>ä»Šå›ã¯ãã‚Œã‚‰ã®ã”ãä¸€éƒ¨ã‚’ã”ç´¹ä»‹</p>

</section>
<section>
<h2 id="dplyr-data-frameã®é«˜é€Ÿå‡¦ç†æ‹…å½“">dplyr &mdash; data.frameã®é«˜é€Ÿå‡¦ç†æ‹…å½“</h2>

<p><a href="https://dplyr.tidyverse.org/">
<img src="/slides/figure/rstats/hex-dplyr.png" width="120" align="right">
</a></p>

<p>ã‚·ãƒ³ãƒ—ãƒ«ãªé–¢æ•°ãŒãŸãã•ã‚“ã€‚<br>
ç¹‹ã’ã¦ä½¿ã† (piping)</p>

<dl>
<dt>æŠ½å‡º</dt>
<dd><code>filter()</code>, <code>select()</code>, <code>distinct()</code>, <code>sample_n()</code></dd>
<dt>å¤‰æ›´ãƒ»è¿½åŠ </dt>
<dd><code>mutate()</code>, <code>rename()</code></dd>
<dt>è¦ç´„ãƒ»é›†è¨ˆ</dt>
<dd><code>group_by()</code>, <code>summarize()</code>, <code>count()</code></dd>
<dt>ã‚½ãƒ¼ãƒˆ</dt>
<dd><code>arrange()</code></dd>
<dt>çµåˆ</dt>
<dd>è¡Œæ–¹å‘: <code>bind_rows()</code></dd>
<dd>åˆ—æ–¹å‘: <code>left_join()</code>, <code>inner_join()</code>, <code>full_join()</code></dd>
</dl>

<p><em>etc.</em></p>

</section>
<section>
<h2 id="dplyrã®åŸºæœ¬çš„ãªä½¿ã„æ–¹">dplyrã®åŸºæœ¬çš„ãªä½¿ã„æ–¹</h2>

<p>å°ã•ãªé–¢æ•°ã‚’ç¹‹ã’ã¦ä½¿ã†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>              <span class="c1"># ç”Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‡ºç™ºã—ã¦</span>
  select<span class="p">(</span>carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">)</span> <span class="o">%&gt;%</span>    <span class="c1"># åˆ—ã‚’æŠ½å‡ºã—ã¦</span>
  filter<span class="p">(</span>carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span>            <span class="c1"># è¡Œã‚’æŠ½å‡ºã—ã¦</span>
  group_by<span class="p">(</span><span class="kp">cut</span><span class="p">)</span> <span class="o">%&gt;%</span>                <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
  summarize_all<span class="p">(</span><span class="kp">mean</span><span class="p">)</span> <span class="o">%&gt;%</span>          <span class="c1"># ãã‚Œãã‚Œå¹³å‡ã‚’è¨ˆç®—</span>
  <span class="kp">print</span><span class="p">()</span>                          <span class="c1"># è¡¨ç¤ºã—ã¦ã¿ã‚‹</span></code></pre></div>
<pre><code>        cut    carat    price
      &lt;ord&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1      Fair 2.297692 11972.12
2      Good 2.139226 14628.99
3 Very Good 2.120232 15133.04
4   Premium 2.155707 14992.23
5     Ideal 2.147463 15589.13
</code></pre>

<p>What is <code>%&gt;%</code> ?</p>

</section>
<section>
<h2 id="pipe-operator-ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­">Pipe operator (ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­) <code>%&gt;%</code></h2>

<p>ãƒ‘ã‚¤ãƒ—ã®å·¦å´ã®å¤‰æ•°ã‚’ã€å³å´ã®é–¢æ•°ã®ç¬¬ä¸€å¼•æ•°ã«ã­ã˜è¾¼ã‚€:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># These are equivalent:</span>
diamonds <span class="o">%&gt;%</span> filter<span class="p">(</span>carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span>
filter<span class="p">(</span>diamonds<span class="p">,</span> carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span></code></pre></div>
<p>ä¸‹ã”ã—ã‚‰ãˆã®æµã‚Œä½œæ¥­ã«ä¾¿åˆ©:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">diamonds <span class="o">%&gt;%</span> select<span class="p">(</span>carat<span class="p">,</span> price<span class="p">)</span> <span class="o">%&gt;%</span> filter<span class="p">(</span>carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kc">...</span>
<span class="c1">#   data %&gt;%  do_A()  %&gt;%  do_B()  %&gt;%  do_C()  %&gt;% ...</span></code></pre></div>
<p>[PRACTICE] Rewrite the following code without <code>%&gt;%</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">seq_len</span><span class="p">(</span><span class="m">6</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">sum</span><span class="p">()</span></code></pre></div>
<pre><code>[1] 21
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kc">letters</span> <span class="o">%&gt;%</span> <span class="kp">toupper</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">(</span><span class="m">3</span><span class="p">)</span></code></pre></div>
<pre><code>[1] &quot;A&quot; &quot;B&quot; &quot;C&quot;
</code></pre>

<p>[ANSWER]</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">sum</span><span class="p">(</span><span class="kp">seq_len</span><span class="p">(</span><span class="m">6</span><span class="p">))</span>
<span class="kp">head</span><span class="p">(</span><span class="kp">toupper</span><span class="p">(</span><span class="kc">letters</span><span class="p">),</span> <span class="m">3</span><span class="p">)</span></code></pre></div>
</section>
<section>
<h2 id="if-we-don-t-use-pipe-operator">If we don&rsquo;t use pipe operator <code>%&gt;%</code></h2>

<p>ğŸ˜ Use temporary variables (ä¸€æ™‚å¤‰æ•°):</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">tmp1 <span class="o">=</span> select<span class="p">(</span>diamonds<span class="p">,</span> carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">)</span>   <span class="c1"># åˆ—ã‚’æŠ½å‡ºã—ã¦</span>
tmp2 <span class="o">=</span> filter<span class="p">(</span>tmp1<span class="p">,</span> carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span>               <span class="c1"># è¡Œã‚’æŠ½å‡ºã—ã¦</span>
tmp3 <span class="o">=</span> group_by<span class="p">(</span>tmp2<span class="p">,</span> <span class="kp">cut</span><span class="p">)</span>                   <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
result <span class="o">=</span> summarize_all<span class="p">(</span>tmp3<span class="p">,</span> <span class="kp">mean</span><span class="p">)</span>           <span class="c1"># ãã‚Œãã‚Œå¹³å‡ã‚’è¨ˆç®—</span></code></pre></div>
<p>ğŸ˜ Reuse the same variable:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> select<span class="p">(</span>diamonds<span class="p">,</span> carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">)</span> <span class="c1"># åˆ—ã‚’æŠ½å‡ºã—ã¦</span>
result <span class="o">=</span> filter<span class="p">(</span>result<span class="p">,</span> carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span>           <span class="c1"># è¡Œã‚’æŠ½å‡ºã—ã¦</span>
result <span class="o">=</span> group_by<span class="p">(</span>result<span class="p">,</span> <span class="kp">cut</span><span class="p">)</span>               <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
result <span class="o">=</span> summarize_all<span class="p">(</span>result<span class="p">,</span> <span class="kp">mean</span><span class="p">)</span>         <span class="c1"># ãã‚Œãã‚Œå¹³å‡ã‚’è¨ˆç®—</span></code></pre></div>
<p>Not too bad, but redundant.</p>

</section>
<section>
<h2 id="if-we-don-t-use-pipe-operator">If we don&rsquo;t use pipe operator <code>%&gt;%</code></h2>

<p>ğŸ˜« Do it without temporary variables:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> summarize_all<span class="p">(</span>                <span class="c1"># ãã‚Œãã‚Œå¹³å‡ã‚’è¨ˆç®—</span>
    group_by<span class="p">(</span>                            <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
      filter<span class="p">(</span>                              <span class="c1"># è¡Œã‚’æŠ½å‡ºã—ã¦</span>
        select<span class="p">(</span>diamonds<span class="p">,</span> carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">),</span> <span class="c1"># åˆ—ã‚’æŠ½å‡ºã—ã¦</span>
        carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">),</span>                        <span class="c1"># è¡Œã‚’æŠ½å‡ºã—ã¦</span>
      <span class="kp">cut</span><span class="p">),</span>                              <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
    <span class="kp">mean</span><span class="p">)</span>                              <span class="c1"># ãã‚Œãã‚Œå¹³å‡ã‚’è¨ˆç®—</span></code></pre></div>
<p>ğŸ¤ª Unreadable:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> summarize_all<span class="p">(</span>group_by<span class="p">(</span>filter<span class="p">(</span>select<span class="p">(</span>diamonds<span class="p">,</span> carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">),</span> carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">),</span> <span class="kp">cut</span><span class="p">),</span> <span class="kp">mean</span><span class="p">)</span></code></pre></div>
<p>Very difficult to follow the logic.</p>

</section>
<section>
<h2 id="let-s-use-pipe-operator">Let&rsquo;s use pipe operator <code>%&gt;%</code></h2>

<p>ğŸ˜ Easy to follow the logic:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  select<span class="p">(</span>carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">)</span> <span class="o">%&gt;%</span>    <span class="c1"># åˆ—ã‚’æŠ½å‡ºã—ã¦</span>
  filter<span class="p">(</span>carat <span class="o">&gt;</span> <span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span>            <span class="c1"># è¡Œã‚’æŠ½å‡ºã—ã¦</span>
  group_by<span class="p">(</span><span class="kp">cut</span><span class="p">)</span> <span class="o">%&gt;%</span>                <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
  summarize_all<span class="p">(</span><span class="kp">mean</span><span class="p">)</span> <span class="o">%&gt;%</span>          <span class="c1"># ãã‚Œãã‚Œå¹³å‡ã‚’è¨ˆç®—</span>
  <span class="kp">print</span><span class="p">()</span>                          <span class="c1"># è¡¨ç¤ºã—ã¦ã¿ã‚‹</span></code></pre></div>
<pre><code>        cut    carat    price
      &lt;ord&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1      Fair 2.297692 11972.12
2      Good 2.139226 14628.99
3 Very Good 2.120232 15133.04
4   Premium 2.155707 14992.23
5     Ideal 2.147463 15589.13
</code></pre>

<p>æ…£ã‚Œã‚‹ã¾ã§ã¯ã¡ã‚‡ã£ã¨å¤§å¤‰ã‹ã‚‚ã€‚ç„¡ç†ã—ã¦ä½¿ã‚ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã€‚</p>

</section>
<section>
<h2 id="dplyr-basics">dplyr basics</h2>

<p>Load the package, and view the data.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>tidyverse<span class="p">)</span>
<span class="kp">print</span><span class="p">(</span>diamonds<span class="p">)</span>
View<span class="p">(</span>diamonds<span class="p">)</span>  <span class="c1"># RStudio</span></code></pre></div>
<pre><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
    3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
   --                                                                  
53937  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
53939  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-select">dplyr basics: <code>select()</code></h2>

<p>Select columns (åˆ—) by names.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  select<span class="p">(</span>carat<span class="p">,</span> <span class="kp">cut</span><span class="p">,</span> price<span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut price
      &lt;dbl&gt;     &lt;ord&gt; &lt;int&gt;
    1  0.23     Ideal   326
    2  0.21   Premium   326
    3  0.23      Good   327
    4  0.29   Premium   334
   --                      
53937  0.72      Good  2757
53938  0.70 Very Good  2757
53939  0.86   Premium  2757
53940  0.75     Ideal  2757
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-select">dplyr basics: <code>select()</code></h2>

<p>Select columns (åˆ—) by numbers.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  select<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">7</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut price
      &lt;dbl&gt;     &lt;ord&gt; &lt;int&gt;
    1  0.23     Ideal   326
    2  0.21   Premium   326
    3  0.23      Good   327
    4  0.29   Premium   334
   --                      
53937  0.72      Good  2757
53938  0.70 Very Good  2757
53939  0.86   Premium  2757
53940  0.75     Ideal  2757
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-select">dplyr basics: <code>select()</code></h2>

<p>Select columns (åˆ—) by negative match.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  select<span class="p">(</span><span class="o">-</span>carat<span class="p">,</span> <span class="o">-</span><span class="kp">cut</span><span class="p">,</span> <span class="o">-</span>price<span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      color clarity depth table     x     y     z
      &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1     E     SI2  61.5    55  3.95  3.98  2.43
    2     E     SI1  59.8    61  3.89  3.84  2.31
    3     E     VS1  56.9    65  4.05  4.07  2.31
    4     I     VS2  62.4    58  4.20  4.23  2.63
   --                                            
53937     D     SI1  63.1    55  5.69  5.75  3.61
53938     D     SI1  62.8    60  5.66  5.68  3.56
53939     H     SI2  61.0    58  6.15  6.12  3.74
53940     D     SI2  62.2    55  5.83  5.87  3.64
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-select">dplyr basics: <code>select()</code></h2>

<p>Select columns (åˆ—) by partial match.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  select<span class="p">(</span>starts_with<span class="p">(</span><span class="s">&#34;c&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut color clarity
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt;
    1  0.23     Ideal     E     SI2
    2  0.21   Premium     E     SI1
    3  0.23      Good     E     VS1
    4  0.29   Premium     I     VS2
   --                              
53937  0.72      Good     D     SI1
53938  0.70 Very Good     D     SI1
53939  0.86   Premium     H     SI2
53940  0.75     Ideal     D     SI2
</code></pre>

<p>See <a href="https://tidyselect.r-lib.org/reference/select_helpers.html">tidyselect helpers</a> for more details.</p>

</section>
<section>
<h2 id="dplyr-basics-filter">dplyr basics: <code>filter()</code></h2>

<p>Filter rows (è¡Œ) by exact match.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  filter<span class="p">(</span>cut <span class="o">==</span> <span class="s">&#34;Ideal&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat   cut color clarity depth table price     x     y     z
      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23 Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.23 Ideal     J     VS1  62.8    56   340  3.93  3.90  2.46
    3  0.31 Ideal     J     SI2  62.2    54   344  4.35  4.37  2.71
    4  0.30 Ideal     I     SI2  62.0    54   348  4.31  4.34  2.68
   --                                                              
21548  0.71 Ideal     E     SI1  61.9    56  2756  5.71  5.73  3.54
21549  0.71 Ideal     G     VS1  61.4    56  2756  5.76  5.73  3.53
21550  0.72 Ideal     D     SI1  60.8    57  2757  5.75  5.76  3.50
21551  0.75 Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-filter">dplyr basics: <code>filter()</code></h2>

<p>Filter rows (è¡Œ) by group membership.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  filter<span class="p">(</span>cut <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;Ideal&#34;</span><span class="p">,</span> <span class="s">&#34;Good&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat   cut color clarity depth table price     x     y     z
      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23 Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.23  Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    3  0.31  Good     J     SI2  63.3    58   335  4.34  4.35  2.75
    4  0.30  Good     J     SI1  64.0    55   339  4.25  4.28  2.73
   --                                                              
26454  0.71 Ideal     G     VS1  61.4    56  2756  5.76  5.73  3.53
26455  0.72 Ideal     D     SI1  60.8    57  2757  5.75  5.76  3.50
26456  0.72  Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
26457  0.75 Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-filter">dplyr basics: <code>filter()</code></h2>

<p>Filter rows (è¡Œ) with unequal sign.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  filter<span class="p">(</span>price <span class="o">&gt;=</span> <span class="m">1000</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.70     Ideal     E     SI1  62.5    57  2757  5.70  5.72  3.57
    2  0.86      Fair     E     SI2  55.1    69  2757  6.45  6.33  3.52
    3  0.70     Ideal     G     VS2  61.6    56  2757  5.70  5.67  3.50
    4  0.71 Very Good     E     VS2  62.4    57  2759  5.68  5.73  3.56
   --                                                                  
39438  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
39439  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
39440  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
39441  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-filter">dplyr basics: <code>filter()</code></h2>

<p>Filter rows (è¡Œ) by multiple conditions (AND).</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  filter<span class="p">(</span>carat <span class="o">&gt;</span> <span class="m">2</span> <span class="o">&amp;</span> price <span class="o">&lt;</span> <span class="m">14000</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>    carat       cut color clarity depth table price     x     y     z
    &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
  1  2.06   Premium     J      I1  61.2    58  5203  8.10  8.07  4.95
  2  2.14      Fair     J      I1  69.4    57  5405  7.74  7.70  5.36
  3  2.15      Fair     J      I1  65.5    57  5430  8.01  7.95  5.23
  4  2.22      Fair     J      I1  66.7    56  5607  8.04  8.02  5.36
 --                                                                  
641  2.07   Premium     H     SI1  62.7    58 13993  8.14  8.09  5.09
642  2.07      Good     I     SI1  63.6    58 13993  8.09  7.99  5.11
643  2.13 Very Good     J     SI1  62.8    58 13996  8.13  8.17  5.12
644  2.11   Premium     J     SI1  62.4    58 13996  8.27  8.17  5.13
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-filter">dplyr basics: <code>filter()</code></h2>

<p>Filter rows (è¡Œ) by multiple conditions (OR).</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  filter<span class="p">(</span>carat <span class="o">&gt;</span> <span class="m">2</span> <span class="o">|</span> price <span class="o">&lt;</span> <span class="m">14000</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
    3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
   --                                                                  
53023  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
53024  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
53025  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
53026  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-mutate">dplyr basics: <code>mutate()</code></h2>

<p>Create new columns or modify existing columns.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>ratio <span class="o">=</span> price <span class="o">/</span> carat<span class="p">,</span>
         price <span class="o">=</span> price <span class="o">*</span> <span class="m">108.36</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut color clarity depth table     price     x     y     z    ratio
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55  35325.36  3.95  3.98  2.43 1417.391
    2  0.21   Premium     E     SI1  59.8    61  35325.36  3.89  3.84  2.31 1552.381
    3  0.23      Good     E     VS1  56.9    65  35433.72  4.05  4.07  2.31 1421.739
    4  0.29   Premium     I     VS2  62.4    58  36192.24  4.20  4.23  2.63 1151.724
   --                                                                               
53937  0.72      Good     D     SI1  63.1    55 298748.52  5.69  5.75  3.61 3829.167
53938  0.70 Very Good     D     SI1  62.8    60 298748.52  5.66  5.68  3.56 3938.571
53939  0.86   Premium     H     SI2  61.0    58 298748.52  6.15  6.12  3.74 3205.814
53940  0.75     Ideal     D     SI2  62.2    55 298748.52  5.83  5.87  3.64 3676.000
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-summarize">dplyr basics: <code>summarize()</code></h2>

<p>Summarize column values.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  summarize<span class="p">(</span><span class="kp">mean</span><span class="p">(</span>price<span class="p">),</span> <span class="kp">max</span><span class="p">(</span>carat<span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>  mean(price) max(carat)
        &lt;dbl&gt;      &lt;dbl&gt;
1      3932.8       5.01
</code></pre>

<p>Use <code>min()</code>, <code>max()</code>, <code>mean()</code>, <code>median()</code>, <code>var()</code>, <code>sd()</code>, etc.</p>

</section>
<section>
<h2 id="dplyr-basics-summarize">dplyr basics: <code>summarize()</code></h2>

<p>Summarize column values by groups.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  group_by<span class="p">(</span><span class="kp">cut</span><span class="p">)</span> <span class="o">%&gt;%</span>
  summarize<span class="p">(</span>avg_price <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>price<span class="p">),</span>
            max_carat <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>carat<span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>        cut avg_price max_carat
      &lt;ord&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1      Fair  4358.758      5.01
2      Good  3928.864      3.01
3 Very Good  3981.760      4.00
4   Premium  4584.258      4.01
5     Ideal  3457.542      3.50
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-arrange">dplyr basics: <code>arrange()</code></h2>

<p>Sort rows. Use <code>desc()</code> for reversed order.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">result <span class="o">=</span> diamonds <span class="o">%&gt;%</span>
  arrange<span class="p">(</span>color<span class="p">,</span> desc<span class="p">(</span>carat<span class="p">))</span> <span class="o">%&gt;%</span>  <span class="c1"># è‰²ã®æ˜‡é †ã€‚è‰²ãŒåŒã˜ãªã‚‰å¤§ãã•é™é †</span>
  <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  3.40      Fair     D      I1  66.8    52 15964  9.42  9.34  6.27
    2  2.75     Ideal     D      I1  60.9    57 13156  9.04  8.98  5.49
    3  2.58 Very Good     D     SI2  58.9    63 14749  9.08  9.01  5.33
    4  2.57   Premium     D     SI2  58.9    58 17924  8.99  8.94  5.28
   --                                                                  
53937  0.27 Very Good     J    VVS2  60.8    57   443  4.16  4.20  2.54
53938  0.24 Very Good     J    VVS2  62.8    57   336  3.94  3.96  2.48
53939  0.24     Ideal     J    VVS2  62.8    57   432  3.96  3.94  2.48
53940  0.23     Ideal     J     VS1  62.8    56   340  3.93  3.90  2.46
</code></pre>

</section>
<section>
<h2 id="dplyr-basics-join">dplyr basics: <code>*_join()</code></h2>

<p>Combine two tables depending on column values.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">band_members <span class="o">%&gt;%</span> inner_join<span class="p">(</span>band_instruments<span class="p">,</span> by <span class="o">=</span> <span class="s">&#34;name&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>   name    band  plays
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
1  John Beatles guitar
2  Paul Beatles   bass
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">band_members <span class="o">%&gt;%</span> left_join<span class="p">(</span>band_instruments<span class="p">,</span> by <span class="o">=</span> <span class="s">&#34;name&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>   name    band  plays
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
1  Mick  Stones   &lt;NA&gt;
2  John Beatles guitar
3  Paul Beatles   bass
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">band_members <span class="o">%&gt;%</span> full_join<span class="p">(</span>band_instruments<span class="p">,</span> by <span class="o">=</span> <span class="s">&#34;name&#34;</span><span class="p">)</span></code></pre></div>
<pre><code>   name    band  plays
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
1  Mick  Stones   &lt;NA&gt;
2  John Beatles guitar
3  Paul Beatles   bass
4 Keith    &lt;NA&gt; guitar
</code></pre>

</section>
<section>
<h2 id="tidyr-data-frameã®å¤‰å½¢-æ•´å½¢æ‹…å½“">tidyr &mdash; data.frameã®å¤‰å½¢ãƒ»æ•´å½¢æ‹…å½“</h2>

<p><a href="https://tidyr.tidyverse.org/">
<img src="/slides/figure/rstats/hex-tidyr.png" width="120" align="right">
</a></p>

<dl>
<dt>æ¨ªé•·ã‹ã‚‰ç¸¦é•·ã«</dt>
<dd><code>pivot_longer()</code></dd>
<dt>ç¸¦é•·ã‹ã‚‰æ¨ªé•·ã«</dt>
<dd><code>pivot_wider()</code></dd>
<dt>å…¥ã‚Œå­æ§‹é€ ã‚’ã¤ãã‚‹ã€è§£æ¶ˆã™ã‚‹</dt>
<dd><code>nest()</code>, <code>unnest()</code></dd>
<dt>1åˆ—ã‚’è¤‡æ•°ã®åˆ—ã«åˆ†é›¢</dt>
<dd><code>separate()</code></dd>
</dl>

<p><em>etc.</em></p>

</section>
<section>
<h2 id="tidyr-pivot-longer-æ¨ªé•·ã‹ã‚‰ç¸¦é•·ã«"><code>tidyr::pivot_longer()</code> æ¨ªé•·ã‹ã‚‰ç¸¦é•·ã«</h2>

<p>è¤‡æ•°åˆ—ã«ã¾ãŸãŒã‚‹å€¤ã‚’1åˆ—ã«ã™ã‚‹(ã“ã“ã§ã¯<code>value</code>)ã€‚<br>
ãã®ãƒ©ãƒ™ãƒ«ã‚‚åˆã‚ã›ã¦ç§»å‹•(ã“ã“ã§ã¯<code>name</code>)ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">iris_long <span class="o">=</span> iris <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">(</span><span class="m">2L</span><span class="p">)</span> <span class="o">%&gt;%</span>     <span class="c1"># æœ€åˆã®2è¡Œã ã‘</span>
  rownames_to_column<span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>        <span class="c1"># IDåˆ—ã‚’è¿½åŠ </span>
  <span class="kp">print</span><span class="p">()</span> <span class="o">%&gt;%</span>                         <span class="c1"># é€”ä¸­çµŒéã‚’è¡¨ç¤º</span>
  pivot_longer<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="o">-</span>id<span class="p">,</span> <span class="o">-</span>Species<span class="p">),</span> names_to <span class="o">=</span> <span class="s">&#34;name&#34;</span><span class="p">,</span> values_to <span class="o">=</span> <span class="s">&#34;value&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span>                             <span class="c1"># id, Speciesä»¥å¤–ã®å€¤ã‚’ç§»å‹•</span></code></pre></div>
<pre><code>     id Sepal.Length Sepal.Width Petal.Length Petal.Width Species
  &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;fct&gt;
1     1          5.1         3.5          1.4         0.2  setosa
2     2          4.9         3.0          1.4         0.2  setosa
     id Species         name value
  &lt;chr&gt;   &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt;
1     1  setosa Sepal.Length   5.1
2     1  setosa  Sepal.Width   3.5
3     1  setosa Petal.Length   1.4
4     1  setosa  Petal.Width   0.2
5     2  setosa Sepal.Length   4.9
6     2  setosa  Sepal.Width   3.0
7     2  setosa Petal.Length   1.4
8     2  setosa  Petal.Width   0.2
</code></pre>

</section>
<section>
<h2 id="tidyr-pivot-wider-ç¸¦é•·ã‹ã‚‰æ¨ªé•·ã«"><code>tidyr::pivot_wider()</code> ç¸¦é•·ã‹ã‚‰æ¨ªé•·ã«</h2>

<p>1åˆ—ã«åã¾ã£ã¦ã„ãŸå€¤(<code>value</code>)ã‚’è¤‡æ•°åˆ—ã®è¡Œåˆ—ã«å¤‰æ›ã€‚<br>
ãã®ãƒ©ãƒ™ãƒ«(<code>name</code>)ã‚’åˆ—ã®åå‰ã«ã™ã‚‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">iris_long <span class="o">%&gt;%</span> <span class="kp">print</span><span class="p">()</span> <span class="o">%&gt;%</span>              <span class="c1"># ã•ã£ãlong-formatã«ã—ãŸã‚„ã¤</span>
  pivot_wider<span class="p">(</span>names_from <span class="o">=</span> name<span class="p">,</span> values_from <span class="o">=</span> value<span class="p">)</span>   <span class="c1"># æ¨ªé•·ã«æˆ»ã™</span></code></pre></div>
<pre><code>     id Species         name value
  &lt;chr&gt;   &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt;
1     1  setosa Sepal.Length   5.1
2     1  setosa  Sepal.Width   3.5
3     1  setosa Petal.Length   1.4
4     1  setosa  Petal.Width   0.2
5     2  setosa Sepal.Length   4.9
6     2  setosa  Sepal.Width   3.0
7     2  setosa Petal.Length   1.4
8     2  setosa  Petal.Width   0.2
</code></pre>

<pre><code>     id Species Sepal.Length Sepal.Width Petal.Length Petal.Width
  &lt;chr&gt;   &lt;fct&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1     1  setosa          5.1         3.5          1.4         0.2
2     2  setosa          4.9         3.0          1.4         0.2
</code></pre>

</section>
<section>
<h2 id="tidyr-separate-åˆ—ã‚’åˆ†é›¢"><code>tidyr::separate()</code> åˆ—ã‚’åˆ†é›¢</h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">iris_long <span class="o">%&gt;%</span> <span class="kp">print</span><span class="p">()</span> <span class="o">%&gt;%</span>
  separate<span class="p">(</span>name<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;part&#34;</span><span class="p">,</span> <span class="s">&#34;measure&#34;</span><span class="p">))</span> <span class="c1"># åˆ—ã‚’åˆ†é›¢</span></code></pre></div>
<pre><code>     id Species         name value
  &lt;chr&gt;   &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt;
1     1  setosa Sepal.Length   5.1
2     1  setosa  Sepal.Width   3.5
3     1  setosa Petal.Length   1.4
4     1  setosa  Petal.Width   0.2
5     2  setosa Sepal.Length   4.9
6     2  setosa  Sepal.Width   3.0
7     2  setosa Petal.Length   1.4
8     2  setosa  Petal.Width   0.2
</code></pre>

<pre><code>     id Species  part measure value
  &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;
1     1  setosa Sepal  Length   5.1
2     1  setosa Sepal   Width   3.5
3     1  setosa Petal  Length   1.4
4     1  setosa Petal   Width   0.2
5     2  setosa Sepal  Length   4.9
6     2  setosa Sepal   Width   3.0
7     2  setosa Petal  Length   1.4
8     2  setosa Petal   Width   0.2
</code></pre>

</section>
<section>
<h2 id="tidyr-nest-å…¥ã‚Œå­ã«ã™ã‚‹"><code>tidyr::nest()</code> å…¥ã‚Œå­ã«ã™ã‚‹</h2>

<p>ã‚°ãƒ«ãƒ¼ãƒ—æ¯ã«data.frameã‚’åŒºåˆ‡ã£ã¦listå‹ã®åˆ—ã«å…¥ã‚Œã‚‹ã€‚</p>

<figure>
<a href="https://www.tidyverse.org/articles/2019/09/tidyr-1-0-0/">
<img src="/slides/figure/rstats/nest-pack-chop.png" height="500">
<br>
<figcaption class="url">https://www.tidyverse.org/articles/2019/09/tidyr-1-0-0/</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="tidyr-nest-å…¥ã‚Œå­ã«ã™ã‚‹"><code>tidyr::nest()</code> å…¥ã‚Œå­ã«ã™ã‚‹</h2>

<p>ã‚°ãƒ«ãƒ¼ãƒ—æ¯ã«data.frameã‚’åŒºåˆ‡ã£ã¦listå‹ã®åˆ—ã«å…¥ã‚Œã‚‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">iris_nested <span class="o">=</span> iris <span class="o">%&gt;%</span>
  as_tibble<span class="p">()</span> <span class="o">%&gt;%</span>
  nest<span class="p">(</span>data <span class="o">=</span> <span class="o">-</span>Species<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>     Species              data
       &lt;fct&gt;   &lt;vctrs_list_of&gt;
1     setosa &lt;tbl_df [50 x 4]&gt;
2 versicolor &lt;tbl_df [50 x 4]&gt;
3  virginica &lt;tbl_df [50 x 4]&gt;
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">iris_nested<span class="o">$</span>data<span class="p">[[</span><span class="m">1L</span><span class="p">]]</span></code></pre></div>
<pre><code>   Sepal.Length Sepal.Width Petal.Length Petal.Width
          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1          5.1         3.5          1.4         0.2
 2          4.9         3.0          1.4         0.2
 3          4.7         3.2          1.3         0.2
 4          4.6         3.1          1.5         0.2
--                                                  
47          5.1         3.8          1.6         0.2
48          4.6         3.2          1.4         0.2
49          5.3         3.7          1.5         0.2
50          5.0         3.3          1.4         0.2
</code></pre>

</section>
<section>
<h2 id="purrr">purrr</h2>

<p><a href="https://purrr.tidyverse.org/">
<img src="/slides/figure/rstats/hex-purrr.png" width="120" align="right">
</a></p>

<p>listã‚„ãƒ«ãƒ¼ãƒ—ã®å‡¦ç†æ‹…å½“ã€‚</p>

<ul>
<li><code>map()</code>, <code>walk()</code></li>
<li><code>map_int()</code>, <code>map_dbl()</code>, <code>map_chr()</code></li>
<li><code>map_dfr()</code></li>
<li><code>pmap()</code>, <code>map2()</code></li>
<li><code>flatten()</code></li>
<li><em>etc.</em></li>
</ul>

<p>æ¨™æº–Rã® <code>lapply()</code>, <code>sapply()</code>, <code>vapply()</code>, <code>unlist()</code> ãªã©ã®ä»£ã‚ã‚Šã«</p>

</section>
<section>
<h2 id="purrr-map-ãƒªã‚¹ãƒˆã®å„è¦ç´ ã«é–¢æ•°ã‚’é©ç”¨"><code>purrr::map()</code>: ãƒªã‚¹ãƒˆã®å„è¦ç´ ã«é–¢æ•°ã‚’é©ç”¨</h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">v <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>      <span class="c1"># é•·ã•3ã®ãƒ™ã‚¯ãƒˆãƒ«</span>
v <span class="o">+</span> <span class="m">10</span>              <span class="c1"># ãã‚Œãã‚Œã«+10</span></code></pre></div>
<pre><code>[1] 11 12 13
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">plus_ten <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>x <span class="o">+</span> <span class="m">10</span><span class="p">}</span>  <span class="c1"># +10ã™ã‚‹é–¢æ•°</span>
purrr<span class="o">::</span>map<span class="p">(</span>v<span class="p">,</span> plus_ten<span class="p">)</span>          <span class="c1"># ãã‚Œãã‚Œã«é©ç”¨</span></code></pre></div>
<pre><code>[[1]]
[1] 11

[[2]]
[1] 12

[[3]]
[1] 13
</code></pre>

<p>ã“ã®ä¾‹ã§ã¯ã‚ã¾ã‚Šå¬‰ã—ããªã„ã‘ã©ã€ä½¿ã„ã©ã“ã‚ã¯çµæ§‹ã‚ã‚‹</p>

</section>
<section>
<h2 id="read-multiple-files-in-a-directory">Read multiple files in a directory</h2>

<pre><code>r-training-2019/       # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ€ä¸Šéš
â”œâ”€â”€ data/              # ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚Â Â  â”œâ”€â”€ cheetah.tsv    # åŒã˜å½¢ã®ãƒ‡ãƒ¼ã‚¿
â”‚Â Â  â”œâ”€â”€ giraffe.tsv
â”‚Â Â  â””â”€â”€ zebra.tsv
â”œâ”€
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># Get the file list: &#34;data/cheetah.tsv&#34;, ...</span>
files <span class="o">=</span> fs<span class="o">::</span>dir_ls<span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">,</span> glob <span class="o">=</span> <span class="s">&#34;*.tsv&#34;</span><span class="p">)</span>

<span class="c1"># Read and combine</span>
purrr<span class="o">::</span>map_dfr<span class="p">(</span>files<span class="p">,</span> readr<span class="o">::</span>read_tsv<span class="p">)</span>

<span class="c1"># It is equivalent to</span>
purrr<span class="o">::</span>map<span class="p">(</span>files<span class="p">,</span> readr<span class="o">::</span>read_tsv<span class="p">)</span> <span class="o">%&gt;%</span>
  dplyr<span class="o">::</span>bind_rows<span class="p">()</span></code></pre></div>
</section>
<section>
<h2 id="example-vadeaths">Example: <code>VADeaths</code></h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">as.data.frame</span><span class="p">(</span>VADeaths<span class="p">)</span>                  <span class="c1"># data.frameã«å¤‰æ›</span>
                                         <span class="c1"># è¡Œåã‚’åˆ—ã«</span>
                                         <span class="c1"># ç¸¦é•·ã«å¤‰å½¢ã—ãŸã„</span></code></pre></div>
<pre><code>      Rural Male Rural Female Urban Male Urban Female
50-54       11.7          8.7       15.4          8.4
55-59       18.1         11.7       24.3         13.6
60-64       26.9         20.3       37.0         19.3
65-69       41.0         30.9       54.6         35.1
70-74       66.0         54.3       71.1         50.0
</code></pre>

</section>
<section>
<h2 id="example-vadeaths">Example: <code>VADeaths</code></h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">as.data.frame</span><span class="p">(</span>VADeaths<span class="p">)</span> <span class="o">%&gt;%</span>              <span class="c1"># data.frameã«å¤‰æ›</span>
  tibble<span class="o">::</span>rownames_to_column<span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">)</span>      <span class="c1"># è¡Œåã‚’åˆ—ã«</span>
                                         <span class="c1"># ç¸¦é•·ã«å¤‰å½¢ã—ãŸã„</span></code></pre></div>
<pre><code>    age Rural Male Rural Female Urban Male Urban Female
1 50-54       11.7          8.7       15.4          8.4
2 55-59       18.1         11.7       24.3         13.6
3 60-64       26.9         20.3       37.0         19.3
4 65-69       41.0         30.9       54.6         35.1
5 70-74       66.0         54.3       71.1         50.0
</code></pre>

</section>
<section>
<h2 id="example-vadeaths">Example: <code>VADeaths</code></h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">as.data.frame</span><span class="p">(</span>VADeaths<span class="p">)</span> <span class="o">%&gt;%</span>              <span class="c1"># data.frameã«å¤‰æ›</span>
  tibble<span class="o">::</span>rownames_to_column<span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># è¡Œåã‚’åˆ—ã«</span>
  pivot_longer<span class="p">(</span><span class="o">-</span>age<span class="p">)</span>                     <span class="c1"># ageä»¥å¤–ã‚’ç§»å‹•ã—ã¦ç¸¦é•·åŒ–</span>
                                         <span class="c1"># æ–°ã—ã„nameåˆ—ã‚’åˆ†å‰²</span></code></pre></div>
<pre><code>     age         name value
   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;
 1 50-54   Rural Male  11.7
 2 50-54 Rural Female   8.7
 3 50-54   Urban Male  15.4
 4 50-54 Urban Female   8.4
--                         
17 70-74   Rural Male  66.0
18 70-74 Rural Female  54.3
19 70-74   Urban Male  71.1
20 70-74 Urban Female  50.0
</code></pre>

</section>
<section>
<h2 id="example-vadeaths">Example: <code>VADeaths</code></h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kp">as.data.frame</span><span class="p">(</span>VADeaths<span class="p">)</span> <span class="o">%&gt;%</span>              <span class="c1"># data.frameã«å¤‰æ›</span>
  tibble<span class="o">::</span>rownames_to_column<span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># è¡Œåã‚’åˆ—ã«</span>
  pivot_longer<span class="p">(</span><span class="o">-</span>age<span class="p">)</span> <span class="o">%&gt;%</span>                 <span class="c1"># ageä»¥å¤–ã‚’ç§»å‹•ã—ã¦ç¸¦é•·åŒ–</span>
  separate<span class="p">(</span>name<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;region&#34;</span><span class="p">,</span> <span class="s">&#34;sex&#34;</span><span class="p">))</span>     <span class="c1"># æ–°ã—ã„nameåˆ—ã‚’åˆ†å‰²</span></code></pre></div>
<pre><code>     age region    sex value
   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
 1 50-54  Rural   Male  11.7
 2 50-54  Rural Female   8.7
 3 50-54  Urban   Male  15.4
 4 50-54  Urban Female   8.4
--                          
17 70-74  Rural   Male  66.0
18 70-74  Rural Female  54.3
19 70-74  Urban   Male  71.1
20 70-74  Urban Female  50.0
</code></pre>

</section>
<section>
<h2 id="example-vadeaths">Example: <code>VADeaths</code></h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">va_deaths <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span>VADeaths<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># data.frameã«å¤‰æ›</span>
  tibble<span class="o">::</span>rownames_to_column<span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># è¡Œåã‚’åˆ—ã«</span>
  pivot_longer<span class="p">(</span><span class="o">-</span>age<span class="p">)</span> <span class="o">%&gt;%</span>                 <span class="c1"># ageä»¥å¤–ã‚’ç§»å‹•ã—ã¦ç¸¦é•·åŒ–</span>
  separate<span class="p">(</span>name<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;region&#34;</span><span class="p">,</span> <span class="s">&#34;sex&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="c1"># æ–°ã—ã„nameåˆ—ã‚’åˆ†å‰²</span>
  separate<span class="p">(</span>age<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;lbound&#34;</span><span class="p">,</span> <span class="s">&#34;ubound&#34;</span><span class="p">),</span> <span class="s">&#34;-&#34;</span><span class="p">,</span> convert <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span>                                <span class="c1"># ä¸‹é™ã¨ä¸Šé™ã‚’åˆ†é›¢</span></code></pre></div>
<pre><code>   lbound ubound region    sex value
    &lt;int&gt;  &lt;int&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
 1     50     54  Rural   Male  11.7
 2     50     54  Rural Female   8.7
 3     50     54  Urban   Male  15.4
 4     50     54  Urban Female   8.4
--                                  
17     70     74  Rural   Male  66.0
18     70     74  Rural Female  54.3
19     70     74  Urban   Male  71.1
20     70     74  Urban Female  50.0
</code></pre>

</section>
<section>
<h2 id="example-vadeaths-åˆ¥è§£">Example: <code>VADeaths</code> åˆ¥è§£</h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">va_deaths <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span>VADeaths<span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># data.frameã«å¤‰æ›</span>
  tibble<span class="o">::</span>rownames_to_column<span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># è¡Œåã‚’åˆ—ã«</span>
  tidyr<span class="o">::</span>pivot_longer<span class="p">(</span>                   <span class="c1"># ç¸¦é•·ã«å¤‰å½¢ã—ãŸã„</span>
    <span class="o">-</span>age<span class="p">,</span>                                <span class="c1"># ageä»¥å¤–ã®åˆ—ã«å…¥ã£ã¦ã‚‹å€¤ã‚’ç§»å‹•</span>
    names_to <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;region&#34;</span><span class="p">,</span> <span class="s">&#34;sex&#34;</span><span class="p">),</span>       <span class="c1"># å…ƒã®åˆ—åã‚’2ã¤ã«åˆ†é›¢</span>
    names_sep <span class="o">=</span> <span class="s">&#34; &#34;</span><span class="p">,</span>                     <span class="c1"># ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ‡ã‚‹</span>
    values_to <span class="o">=</span> <span class="s">&#34;death&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>             <span class="c1"># å€¤ã®è¡Œãå…ˆã®åˆ—å</span>
  tidyr<span class="o">::</span>separate<span class="p">(</span>age<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;lbound&#34;</span><span class="p">,</span> <span class="s">&#34;ubound&#34;</span><span class="p">),</span> <span class="s">&#34;-&#34;</span><span class="p">,</span> convert <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">print</span><span class="p">()</span>                                <span class="c1"># ä¸‹é™ã¨ä¸Šé™ã‚’åˆ†é›¢</span></code></pre></div>
<pre><code>   lbound ubound region    sex death
    &lt;int&gt;  &lt;int&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
 1     50     54  Rural   Male  11.7
 2     50     54  Rural Female   8.7
 3     50     54  Urban   Male  15.4
 4     50     54  Urban Female   8.4
--                                  
17     70     74  Rural   Male  66.0
18     70     74  Rural Female  54.3
19     70     74  Urban   Male  71.1
20     70     74  Urban Female  50.0
</code></pre>

</section>
<section>
<h2 id="example-vadeaths">Example: <code>VADeaths</code></h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">va_deaths <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>lbound<span class="p">,</span> death<span class="p">))</span> <span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>color <span class="o">=</span> sex<span class="p">,</span> shape <span class="o">=</span> region<span class="p">),</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span> <span class="o">+</span>
  theme_classic<span class="p">(</span>base_size <span class="o">=</span> <span class="m">16</span><span class="p">)</span></code></pre></div>
<p><img src="figure/vadeaths_plot-1.png" alt="plot of chunk vadeaths_plot"></p>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe">Visualize and summarize <code>anscombe</code></h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">anscombe <span class="o">%&gt;%</span>
  rowid_to_column<span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span>              <span class="c1"># IDã‚’ã¤ã‘ã¦ãŠã</span>
                                     <span class="c1"># x y ã§å§‹ã¾ã‚‹åˆ—ã®å€¤ã‚’ç§»ã—ã¦ç¸¦é•·ã«</span></code></pre></div>
<pre><code>      id    x1    x2    x3    x4    y1    y2    y3    y4
   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    10    10    10     8  8.04  9.14  7.46  6.58
 2     2     8     8     8     8  6.95  8.14  6.77  5.76
 3     3    13    13    13     8  7.58  8.74 12.74  7.71
 4     4     9     9     9     8  8.81  8.77  7.11  8.84
--                                                      
 8     8     4     4     4    19  4.26  3.10  5.39 12.50
 9     9    12    12    12     8 10.84  9.13  8.15  5.56
10    10     7     7     7     8  4.82  7.26  6.42  7.91
11    11     5     5     5     8  5.68  4.74  5.73  6.89
</code></pre>

<p>ggplot does not accept this format. Let&rsquo;s transformt it.</p>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe">Visualize and summarize <code>anscombe</code></h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">anscombe <span class="o">%&gt;%</span>
  rowid_to_column<span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>          <span class="c1"># IDã‚’ã¤ã‘ã¦ãŠã</span>
  pivot_longer<span class="p">(</span>matches<span class="p">(</span><span class="s">&#34;^x|y&#34;</span><span class="p">))</span>      <span class="c1"># x y ã§å§‹ã¾ã‚‹åˆ—ã®å€¤ã‚’ç§»ã—ã¦ç¸¦é•·ã«</span>

                                     <span class="c1"># nameåˆ—ã‚’åˆ†å‰²</span></code></pre></div>
<pre><code>      id  name value
   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
 1     1    x1 10.00
 2     1    x2 10.00
 3     1    x3 10.00
 4     1    x4  8.00
--                  
85    11    y1  5.68
86    11    y2  4.74
87    11    y3  5.73
88    11    y4  6.89
</code></pre>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe">Visualize and summarize <code>anscombe</code></h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">anscombe <span class="o">%&gt;%</span>
  rowid_to_column<span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>          <span class="c1"># IDã‚’ã¤ã‘ã¦ãŠã</span>
  pivot_longer<span class="p">(</span>matches<span class="p">(</span><span class="s">&#34;^x|y&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span>  <span class="c1"># x y ã§å§‹ã¾ã‚‹åˆ—ã®å€¤ã‚’ç§»ã—ã¦ç¸¦é•·ã«</span>
  separate<span class="p">(</span>name<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;axis&#34;</span><span class="p">,</span> <span class="s">&#34;group&#34;</span><span class="p">),</span> <span class="m">1L</span><span class="p">,</span> convert <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
                                     <span class="c1"># nameåˆ—ã‚’åˆ†å‰²</span></code></pre></div>
<pre><code>      id  axis group value
   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;
 1     1     x     1 10.00
 2     1     x     2 10.00
 3     1     x     3 10.00
 4     1     x     4  8.00
--                        
85    11     y     1  5.68
86    11     y     2  4.74
87    11     y     3  5.73
88    11     y     4  6.89
</code></pre>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe">Visualize and summarize <code>anscombe</code></h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">tidy_anscombe <span class="o">=</span> anscombe <span class="o">%&gt;%</span>
  rowid_to_column<span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>          <span class="c1"># IDã‚’ã¤ã‘ã¦ãŠã</span>
  pivot_longer<span class="p">(</span>matches<span class="p">(</span><span class="s">&#34;^x|y&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span>  <span class="c1"># x y ã§å§‹ã¾ã‚‹åˆ—ã®å€¤ã‚’ç§»ã—ã¦ç¸¦é•·ã«</span>
  separate<span class="p">(</span>name<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;axis&#34;</span><span class="p">,</span> <span class="s">&#34;group&#34;</span><span class="p">),</span> <span class="m">1L</span><span class="p">,</span> convert <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
                                     <span class="c1"># nameåˆ—ã‚’åˆ†å‰²</span>
  pivot_wider<span class="p">(</span>names_from <span class="o">=</span> axis<span class="p">,</span> values_from <span class="o">=</span> value<span class="p">)</span> <span class="o">%&gt;%</span>
                                     <span class="c1"># axisåˆ—å†…ã® x y ã‚’åˆ—ã«ã—ã¦æ¨ªé•·åŒ–</span>
  dplyr<span class="o">::</span>arrange<span class="p">(</span>group<span class="p">)</span> <span class="o">%&gt;%</span>          <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ä¸¦ã¹ã‚‹</span>
  <span class="kp">print</span><span class="p">()</span>                            <span class="c1"># ggplotã—ãŸã„å½¢ï¼</span></code></pre></div>
<pre><code>      id group     x     y
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1     1    10  8.04
 2     2     1     8  6.95
 3     3     1    13  7.58
 4     4     1     9  8.81
--                        
41     8     4    19 12.50
42     9     4     8  5.56
43    10     4     8  7.91
44    11     4     8  6.89
</code></pre>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe-åˆ¥è§£">Visualize and summarize <code>anscombe</code> åˆ¥è§£</h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">tidy_anscombe <span class="o">=</span> anscombe <span class="o">%&gt;%</span>
  tidyr<span class="o">::</span>pivot_longer<span class="p">(</span>                <span class="c1"># ç¸¦é•·ã«å¤‰å½¢ã—ãŸã„</span>
    everything<span class="p">(),</span>                     <span class="c1"># ã™ã¹ã¦ã®åˆ—ã«ã¤ã„ã¦</span>
    names_to <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;.value&#34;</span><span class="p">,</span> <span class="s">&#34;group&#34;</span><span class="p">),</span>  <span class="c1"># æ–°ã—ã„åˆ—å</span>
    names_sep <span class="o">=</span> <span class="m">1L</span><span class="p">,</span>                   <span class="c1"># åˆ‡ã‚‹ä½ç½®</span>
    names_ptypes <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>group <span class="o">=</span> <span class="kt">integer</span><span class="p">()))</span> <span class="o">%&gt;%</span>   <span class="c1"># å‹å¤‰æ›</span>
  dplyr<span class="o">::</span>arrange<span class="p">(</span>group<span class="p">)</span> <span class="o">%&gt;%</span>           <span class="c1"># ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ä¸¦ã¹ã‚‹</span>
  <span class="kp">print</span><span class="p">()</span>                             <span class="c1"># ggplotã—ãŸã„å½¢ï¼</span></code></pre></div>
<pre><code>   group     x     y
   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    10  8.04
 2     1     8  6.95
 3     1    13  7.58
 4     1     9  8.81
--                  
41     4    19 12.50
42     4     8  5.56
43     4     8  7.91
44     4     8  6.89
</code></pre>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe">Visualize and summarize <code>anscombe</code></h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">ggplot<span class="p">(</span>tidy_anscombe<span class="p">,</span> aes<span class="p">(</span>x<span class="p">,</span> y<span class="p">))</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">3</span><span class="p">)</span> <span class="o">+</span>
  stat_smooth<span class="p">(</span>method <span class="o">=</span> lm<span class="p">,</span> se <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> fullrange <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span> group<span class="p">,</span> nrow <span class="o">=</span> <span class="m">1L</span><span class="p">)</span></code></pre></div>
<p><img src="figure/plot_anscombe-1.png" title="plot of chunk plot_anscombe" alt="plot of chunk plot_anscombe" width="98%" /></p>

</section>
<section>
<h2 id="visualize-and-summarize-anscombe">Visualize and summarize <code>anscombe</code></h2>

<p>4çµ„ã®x-yã¯ã€å¹³å‡ãƒ»åˆ†æ•£ãƒ»ç›¸é–¢ä¿‚æ•°ãŒã»ã¼åŒã˜ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">tidy_anscombe <span class="o">%&gt;%</span>
  dplyr<span class="o">::</span>group_by<span class="p">(</span>group<span class="p">)</span> <span class="o">%&gt;%</span>   <span class="c1"># groupåˆ—ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦</span>
  dplyr<span class="o">::</span>summarize<span class="p">(</span>            <span class="c1"># x, yåˆ—ã‚’ä½¿ã£ã¦summarize</span>
    mean_x <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span>
    mean_y <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>y<span class="p">),</span>
    sd_x <span class="o">=</span> sd<span class="p">(</span>x<span class="p">),</span>
    sd_y <span class="o">=</span> sd<span class="p">(</span>y<span class="p">),</span>
    cor_xy <span class="o">=</span> cor<span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span>
  <span class="p">)</span></code></pre></div>
<pre><code>  group mean_x   mean_y     sd_x     sd_y    cor_xy
  &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     1      9 7.500909 3.316625 2.031568 0.8164205
2     2      9 7.500909 3.316625 2.031657 0.8162365
3     3      9 7.500000 3.316625 2.030424 0.8162867
4     4      9 7.500909 3.316625 2.030579 0.8165214
</code></pre>

</section>
<section>
<h2 id="ä¾‹é¡Œ-æ•°å€¤-å˜ä½ã«ãªã£ã¡ã‚ƒã£ã¦ã‚‹åˆ—ã‚’å‡¦ç†">ä¾‹é¡Œ: æ•°å€¤+å˜ä½ã«ãªã£ã¡ã‚ƒã£ã¦ã‚‹åˆ—ã‚’å‡¦ç†</h2>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">women2 <span class="o">=</span> women <span class="o">%&gt;%</span> sample_n<span class="p">(</span><span class="m">2L</span><span class="p">)</span> <span class="o">%&gt;%</span> dplyr<span class="o">::</span>mutate<span class="p">(</span>height <span class="o">=</span> <span class="kp">paste0</span><span class="p">(</span>height<span class="p">,</span> <span class="s">&#34;in&#34;</span><span class="p">),</span> weight <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span>weight<span class="p">,</span> <span class="s">&#34;lbs&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="kp">print</span><span class="p">()</span></code></pre></div>
<pre><code>  height  weight
1   69in 150 lbs
2   58in 115 lbs
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># å˜ä½ã‚’æ¨ã¦ã‚‹ (ã‚¹ãƒšãƒ¼ã‚¹ã®æœ‰ç„¡ã«ã‚ˆã‚‰ãšå¯èƒ½)</span>
women2 <span class="o">%&gt;%</span> dplyr<span class="o">::</span>mutate<span class="p">(</span>weight <span class="o">=</span> readr<span class="o">::</span>parse_number<span class="p">(</span>weight<span class="p">))</span></code></pre></div>
<pre><code>  height weight
1   69in    150
2   58in    115
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># å˜ä½ã‚’æ–°ã—ã„åˆ—ã«åˆ†ã‘ã‚‹</span>
women2 <span class="o">%&gt;%</span>
  tidyr<span class="o">::</span>separate<span class="p">(</span>height<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;height&#34;</span><span class="p">,</span> <span class="s">&#34;uh&#34;</span><span class="p">),</span> <span class="m">-2L</span><span class="p">,</span> convert<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
  tidyr<span class="o">::</span>separate<span class="p">(</span>weight<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;weight&#34;</span><span class="p">,</span> <span class="s">&#34;uw&#34;</span><span class="p">),</span> <span class="s">&#34; &#34;</span><span class="p">,</span> convert<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></div>
<pre><code>  height uh weight  uw
1     69 in    150 lbs
2     58 in    115 lbs
</code></pre>

</section>
<section>
<h2 id="tidying-and-transforming-data-with-r-summary">Tidying and transforming data with R: Summary</h2>

<ul>
<li><strong>Tidy data</strong> is required for analysis and visualization.</li>
<li>R + tidyverse can handle it.

<ul>
<li>Original/raw data can be in any format,<br>
but it should have some regular patterns.</li>
</ul></li>
<li>You don&rsquo;t have to remember all the details.</li>
</ul>
</section>
<section>
<h2 id="reference">Reference</h2>

<dl>
<dt>R for Data Science &mdash; Hadley Wickham and Garrett Grolemund</dt>
<dd><a href="http://r4ds.had.co.nz/">http://r4ds.had.co.nz/</a></dd>
<dd><a href="https://amzn.to/2tbRmVc">Book</a></dd>
<dd><a href="https://amzn.to/2yyFRKt">æ—¥æœ¬èªç‰ˆæ›¸ç±(Rã§ã¯ã˜ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹)</a></dd>
<dt>Older versions</dt>
<dd>ã€Œ<a href="https://heavywatal.github.io/slides/nagoya2018/">Rã«ã‚„ã‚‰ã›ã¦æ¥½ã—ã‚ˆã† â€” ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¨ä¸‹ã”ã—ã‚‰ãˆ</a>ã€
å²©åµœèˆª 2018</dd>
<dd>ã€ŒRã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨ã€çŸ³å·ç”±å¸Œ 2019 åå¤å±‹å¤§å­¦</dd>
<dt>Official documents:</dt>
<dd><a href="https://www.tidyverse.org/">tidyverse</a>,
<a href="https://dplyr.tidyverse.org/">dplyr</a>,
<a href="https://tidyr.tidyverse.org/">tidyr</a>,
<a href="https://purrr.tidyverse.org/">purrr</a>,
<a href="https://tibble.tidyverse.org/">tibble</a>,
<a href="https://readr.tidyverse.org/">readr</a>,
<a href="https://readxl.tidyverse.org/">readxl</a>,
<a href="https://stringr.tidyverse.org/">stringr</a></dd>
<dt>æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ &mdash; <a href="https://twitter.com/f_nisihara">@f_nisihara</a></dt>
<dd><a href="https://speakerdeck.com/fnshr/zheng-ran-detatutenani">https://speakerdeck.com/fnshr/zheng-ran-detatutenani</a></dd>
<dd><a href="http://id.fnshr.info/2017/01/09/tidy-data-intro/">http://id.fnshr.info/2017/01/09/tidy-data-intro/</a></dd>
</dl>

<p><a href="./" class="readmore">
ç›®æ¬¡ã«æˆ»ã‚‹
</a>
</section>
<section>
<h2 id="ãŠã¾ã‘-æ–‡å­—åˆ—å‡¦ç†">ãŠã¾ã‘: æ–‡å­—åˆ—å‡¦ç†</h2>

<p>å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«å¤‰æ›</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kt">c</span><span class="p">(</span><span class="s">&#34;ï½”ï½ï¼•ï¼“&#34;</span><span class="p">,</span> <span class="s">&#34;ï¼«ï¼²ï¼¡ï¼³&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  stringi<span class="o">::</span>stri_trans_nfkc<span class="p">()</span></code></pre></div>
<pre><code>[1] &quot;tp53&quot; &quot;KRAS&quot;
</code></pre>

<p>è¤‡é›‘ãªæŠ½å‡ºãƒ»ç½®æ›ã‚’ã—ãŸã„å ´åˆã¯
<a href="https://stringr.tidyverse.org/">stringrãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</a>
ã§æ­£è¦è¡¨ç¾ã‚’ä½¿ã†:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kt">c</span><span class="p">(</span><span class="s">&#34;Who am I? 24601!&#34;</span><span class="p">,</span> <span class="s">&#34;p = 0.02 *&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  str_extract<span class="p">(</span><span class="s">&#34;[\\d\\.]+&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># é€£ç¶šã™ã‚‹æ•°å­—ã¾ãŸã¯å°æ•°ç‚¹ã‚’æŠ½å‡º</span>
  <span class="kp">as.numeric</span><span class="p">()</span>                  <span class="c1"># æ•°å€¤ã«å¤‰æ›</span></code></pre></div>
<pre><code>Error in str_extract(., &quot;[\\d\\.]+&quot;): could not find function &quot;str_extract&quot;
</code></pre>

<p>æ­£è¦è¡¨ç¾ã¯å¼·åŠ›ï¼</p>

</section>
<section>
<h2 id="åå‰ã®è¡çª-ä¸Šæ›¸ããªã©ã«ã‚ˆã‚‹äº‹æ•…ã‚’é˜²ã">åå‰ã®è¡çªãƒ»ä¸Šæ›¸ããªã©ã«ã‚ˆã‚‹äº‹æ•…ã‚’é˜²ã</h2>

<p><code>filter(...)</code> ã§ã‚‚å‹•ãã®ã«ã‚ã–ã‚ã–é ­ã« <code>dplyr::</code> ä»˜ã‘ã‚‹ï¼Ÿ</p>

<ul>
<li>ä»Šå›ã®ç™ºè¡¨ã§ã¯ã€ã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç”±æ¥ã‹ã‚’ãªã‚‹ã¹ãæ˜ç¤ºã—ãŸã‹ã£ãŸ</li>
<li>ã»ã‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„è‡ªåˆ†ã®ä½œæ¥­ã«ã‚ˆã£ã¦ã€<br>
<strong>åŒã˜åå‰ã®é–¢æ•°ã§ä¸Šæ›¸ãã•ã‚Œã¡ã‚ƒã£ã¦ã‚‚å¤§ä¸ˆå¤«ãªã‚ˆã†ã«:</strong></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">filter <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span> <span class="kr">return</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>     <span class="c1"># ã†ã£ã‹ã‚ŠåŒåã®é–¢æ•°ã‚’ä½œã‚‹</span>
filter<span class="p">(</span>iris<span class="p">,</span> Petal.Length <span class="o">&lt;</span> <span class="m">1.2</span><span class="p">)</span>         <span class="c1"># æ–°ã—ã„ã»ã†ãŒä½¿ã‚ã‚Œã¡ã‚ƒã†</span></code></pre></div>
<pre><code>NULL
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">dplyr<span class="o">::</span>filter<span class="p">(</span>iris<span class="p">,</span> Petal.Length <span class="o">&lt;</span> <span class="m">1.2</span><span class="p">)</span>  <span class="c1"># æ˜ç¤ºã—ãŸã®ã§å¤§ä¸ˆå¤«</span></code></pre></div>
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;fct&gt;
1          4.3         3.0          1.1         0.1  setosa
2          4.6         3.6          1.0         0.2  setosa
</code></pre>

</section>
</div>
</div>
<script src="/slides/reveal.js/js/reveal.js"></script>
<script>
Reveal.initialize({
  width: 960,
  height: 720,
  margin: 0,
  controls: true,
  controlsTutorial: false,
  controlsBackArrows: 'faded',
  progress: false,
  slideNumber: 'c/t',
  history: false,
  keyboard: true,
  overview: true,
  center: false,
  touch: true,
  loop: false,
  rtl: false,
  shuffle: false,
  fragments: true,
  fragmentInURL: false,
  embedded: false,
  help: true,
  showNotes: false,
  mouseWheel: false,
  transition: 'none',
  transitionSpeed: 'fast',
  backgroundTransition: 'none',
  viewDistance: 1,
  dependencies: [
    { src: '\/slides\/reveal.js\/plugin\/notes\/notes.js', async: true }
  ]
});
</script>
<script>
{
const reload_all_img = function() {
  const imgs = document.getElementsByTagName("img");
  for (let i = 0; i < imgs.length; ++i) {
    const src = imgs[i].src;
    imgs[i].src += "?q";
    imgs[i].src = src;
  }
};
const reload_src_element = function(ev) {
  const original_src = ev.srcElement.src;
  ev.srcElement.src += "?q";
  ev.srcElement.src = original_src;
};
const reload_src = function(ev) {
  if (ev.shiftKey || ev.metaKey || ev.altKey) {
    reload_all_img();
  } else {
    reload_src_element(ev);
  }
};
const img_elements = document.getElementsByTagName("img");
for (let i = 0; i < img_elements.length; ++i) {
  img_elements[i].onclick = reload_src;
}
};
</script>
</body>
</html>
