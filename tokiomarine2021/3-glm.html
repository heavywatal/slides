<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>3. 一般化線形モデル — 統計モデリング概論 DSHC 2021</title>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<link rel="stylesheet" href="/slides/css/theme-reveal.css">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="3. 一般化線形モデル — 統計モデリング概論 DSHC 2021">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/tokiomarine2021/3-glm.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<meta name="generator" content="Hugo 0.83.1" />
<link rel="stylesheet" href="/lib/katex/katex.min.css">
<script defer src="/lib/katex/katex.min.js"></script>
<script defer src="/lib/katex/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "\\[", right: "\\]", display: true},
      {left: "$", right: "$", display: false}
    ]
  });
});
</script>
<style>
.katex {
  font-size: 1.12em;
}

.katex-display > .katex {
  text-align: left;
  padding-left: 2rem;
}
</style>

<script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-41178626-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css">
<h1 id="統計モデリング概論-dshc-2021"><a href=".">統計モデリング概論 DSHC 2021</a></h1>
<div class="author">
岩嵜 航 (Watal M. Iwasaki, PhD)
</div>
<div class="affiliation">
東北大学 生命科学研究科 進化ゲノミクス分野 特任助教<br>
(Graduate School of Life Sciences, Tohoku University)
</div>
<ol>
<li><a href="1-introduction.html">導入</a>
<li><a href="2-stats-model.html">統計モデルの基本</a>
<li class="current-deck"><a href="3-glm.html">一般化線形モデル</a>
<li><a href="4-bayesian.html">階層ベイズモデル</a>
</ol>
<div class="footnote">
2021-06-30 東京海上 Data Science Hill Climb
<a href="https://heavywatal.github.io/slides/tokiomarine2021/">https://heavywatal.github.io/slides/tokiomarine2021/</a>
</div>

</section>
<section>
<h2 id="前章で見た統計モデル">前章で見た統計モデル</h2>
<p>確率変数$X$はパラメータ$\theta$の確率分布$f$に&quot;従う&quot;: 
$X \sim f(\theta) $</p>
<p>e.g., ある植物が作る種の数$X$は平均値$\lambda$のポアソン分布に従う:</p>
<div>\[\begin{split}
X \sim \text{Poisson}(\lambda)
\end{split}\]</div>
<p><img src="figure/only-dist-1.png" alt="plot of chunk only-dist"></p>
<p>これを一般化線形モデル(GLM)として見ることもできる。</p>

</section>
<section>
<h2 id="一般化線形モデルglmとして記述してみる">一般化線形モデル(GLM)として記述してみる</h2>
<p>個体$i$の種子数$y_i$は平均値$\lambda_i$のポアソン分布に従う。<br>
平均値$\lambda_i$は<strong>他のデータによらず$\beta_0$で一定</strong>。</p>
<div>\[\begin{split}
y_i &\sim \text{Poisson}(\lambda_i) \\
\lambda_i &= \beta_0
\end{split}\]</div>
<p><img src="figure/glm-without-x-1.png" alt="plot of chunk glm-without-x"></p>
<p>種子数をY軸にして、式を2つに分けただけ&hellip;?<br>
<strong>説明変数</strong>を含むモデルを見ればご利益が分かるかも。</p>

</section>
<section>
<h2 id="説明変数が1つある一般化線形モデル">説明変数が1つある一般化線形モデル</h2>
<p>個体$i$の種子数$y_i$は平均値$\lambda_i$のポアソン分布に従う。<br>
平均値の対数$\log(\lambda_i)$は<strong>その個体の大きさ$x_i$に比例</strong>する。</p>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.0;">
<figure>
<img src="glm.drawio.svg" width="100%"><br>
</figure>
  </div>
  <div class="column" style="flex-shrink: 1.0;">
<p><img src="figure/glm-poisson-1.png" alt="plot of chunk glm-poisson"></p>
  </div>
</div>
<p>この場合は<strong>単回帰</strong>。説明変数が複数あると<strong>重回帰</strong>。</p>

</section>
<section>
<h2 id="複数の説明変数を同時に扱う重回帰">複数の説明変数を同時に扱う重回帰</h2>
<p>\[\begin{split}
y_i &= \text{Poisson}(\lambda_i) \\
\log(\lambda_i) &= \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + \ldots
\end{split}\]</p>
<p>気温も湿度も高いほどビールが売れる、とか</p>
<p><img src="figure/multiple-regression-1.png" alt="plot of chunk multiple-regression"></p>
<p>今度は<strong>確率分布</strong>と<strong>連結関数</strong>を変えてみよう。</p>

</section>
<section>
<h2 id="ロジスティック回帰">ロジスティック回帰</h2>
<ul>
<li>確率分布: <strong>二項分布</strong></li>
<li>連結関数: $\text{logit}(p) = \log \frac {p} {1 - p}$</li>
</ul>
<p>何かの成否に対する何かの因子の影響、とか</p>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.0; padding-top: 1rem;">
<p>街角の10人のうち何人半袖か。<br>
その日の気温によって割合が変化。</p>
<p>\[\begin{split}
y_i &\sim \text{Binomial}(n,~p_i) \\
\text{logit}(p_i) &= \beta_0 + \beta_1 x_i
\end{split}\]</p>
  </div>
  <div class="column" style="flex-shrink: 1.0;">
<p><img src="figure/glm-logistic-1.png" alt="plot of chunk glm-logistic"></p>
  </div>
</div>
</section>
<section>
<h2 id="ロジスティック回帰-狭義">ロジスティック回帰 (狭義)</h2>
<ul>
<li>確率分布: <strong>ベルヌーイ分布</strong> ($n = 1$ の二項分布)</li>
<li>連結関数: $\text{logit}(p) = \log \frac {p} {1 - p}$</li>
</ul>
<p>何かの成否に対する何かの因子の影響、とか</p>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.0; padding-top: 1rem;">
<p>風が吹けば桶屋が儲かる。</p>
<p>\[\begin{split}
y_i &\sim \text{Bernoulli}(p_i) \\
  &= \text{Binomial}(1,~p_i) \\
\text{logit}(p_i) &= \beta_0 + \beta_1 x_i
\end{split}\]</p>
  </div>
  <div class="column" style="flex-shrink: 1.0;">
<p><img src="figure/wind-1.png" alt="plot of chunk wind"></p>
  </div>
</div>

</section>
<section>
<h2 id="一般線形モデル-化無し-はglmの一種">一般線形モデル (“化”無し) はGLMの一種</h2>
<ul>
<li>確率分布: <strong>正規分布</strong></li>
<li>連結関数: <strong>恒等関数</strong>(なにもせずそのまま)</li>
</ul>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.0; padding-top: 1rem;">
<p>\[\begin{split}
y_i &\sim \mathcal{N}(\mu_i,~\sigma^2) \\
\text{identity}(\mu_i) &= \beta_0 + \beta_1 x_i
\end{split}\]</p>
  </div>
  <div class="column" style="flex-shrink: 1.0;">
<p><img src="figure/glm-weight-1.png" alt="plot of chunk glm-weight"></p>
  </div>
</div>
<p>最小二乗法の直線あてはめと同じ。
分散分析もこの枠組で考えられる。</p>

</section>
<section>
<h2 id="分散分析-uanualysis-uouf-uvauriance-anova-as-glm">分散分析 (<u>An</u>alysis <u>o</u>f <u>va</u>riance, ANOVA) as GLM</h2>
<p><strong>質的な説明変数</strong>を持つ正規分布・恒等連結のGLM、と解釈可能。<br>
<span title="ダミー変数とも呼ばれる"><strong>指示変数</strong></span> (0 or 1) に変換してから重回帰する。</p>
<table>
<thead>
<tr>
<th>天気</th>
<th style="text-align:center">→</th>
<th style="text-align:center">$x_1$ ☀️ 晴れ</th>
<th style="text-align:center">$x_2$ ☔️ 雨</th>
</tr>
</thead>
<tbody>
<tr>
<td>☁️ くもり</td>
<td style="text-align:center"></td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td>☀️ 晴れ</td>
<td style="text-align:center"></td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td>☔️ 雨</td>
<td style="text-align:center"></td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p>\[\begin{split}
y_i &= \mathcal{N}(\mu_i,\sigma^2) \\
\mu_i &= \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i}
\end{split}\]</p>
<p>くもり☁️ $\beta_0$ を基準に、晴れの効果☀️ $\beta_1$ と雨の効果☔️ $\beta_2$ が求まる。</p>
<p>GLMなら確率分布・連結関数を変えてもっと柔軟にモデリングできる。</p>

</section>
<section>
<h2 id="共分散分析-uanualysis-of-ucovauriance-ancova-as-glm">共分散分析 (<u>An</u>alysis of <u>cova</u>riance, ANCOVA) as GLM</h2>
<p><strong>質的変数と量的変数を両方</strong>含むGLM、と解釈可能。<br>
正規分布・等分散・恒等連結などが仮定される。</p>
<p><img src="figure/glm-ancova-1.png" alt="plot of chunk glm-ancova"></p>
<p>GLMなら確率分布・連結関数を変えてもっと柔軟にモデリングできる。</p>

</section>
<section>
<h2 id="一般化線形モデルglmふりかえり">一般化線形モデル(GLM)ふりかえり</h2>
<p>確率分布・連結関数を変えて柔軟にモデリングできる。<br>
特定の組み合わせには名前がある。</p>
<table>
<thead>
<tr>
<th>名前</th>
<th>確率分布</th>
<th>連結関数</th>
<th>説明変数</th>
</tr>
</thead>
<tbody>
<tr>
<td>ポアソン回帰</td>
<td>ポアソン分布</td>
<td>log</td>
<td></td>
</tr>
<tr>
<td>ロジスティック回帰</td>
<td>二項分布</td>
<td>logit</td>
<td></td>
</tr>
<tr>
<td>一般線形回帰</td>
<td>正規分布</td>
<td>恒等</td>
<td></td>
</tr>
<tr>
<td>分散分析</td>
<td>正規分布</td>
<td>恒等</td>
<td>質的変数</td>
</tr>
<tr>
<td>共分散分析</td>
<td>正規分布</td>
<td>恒等</td>
<td>質的変数+量的変数</td>
</tr>
</tbody>
</table>
<p>ほかにもいろいろある。</p>

</section>
<section>
<h2 id="データはひとつモデルはたくさん">データはひとつ、モデルはたくさん</h2>
<p><img src="figure/many-models-1.png" alt="plot of chunk many-models"></p>
<p>さて、どうやって選ぶ？</p>

</section>
<section>
<h2 id="ruby尤rtゆうrt度ruby-likelihood"><ruby>尤<rt>ゆう</rt>度</ruby> (likelihood)</h2>
<p><ruby>尤<rt>もっと</rt></ruby>もらしさ。
モデルのあてはまりの良さの尺度のひとつ。</p>
<p><strong>あるモデル$M$の下でそのデータ$D$が観察される確率</strong>。<br>
定義通り素直に書くと<br>
$\text{Prob}(D \mid M)$</p>
<p>データ$D$を固定し、モデル$M$の関数とみなしたものが<strong>尤度関数</strong>:<br>
$L(M \mid D)$</p>
<p>モデルの構造も固定してパラメータ$\theta$だけ動かす場合はこう書く:<br>
$L(\theta \mid D)$ とか $L(\theta)$ とか</p>

</section>
<section>
<h2 id="逸脱度-deviation">逸脱度 deviation</h2>
<p>尤度の対数を取ってマイナス2倍したもの。
</section>
<section>
<h2 id="過適合-over-fitting">過適合 over-fitting</h2>
<p>パラメータを増やすほど<strong>現データへの</strong>適合度・尤度は高まる。</p>
<p>が、新たなデータに対する予測は悪くなる。</p>

</section>
<section>
<h2 id="aic-赤池情報量基準">AIC: 赤池情報量基準</h2>
<div>\[\begin{split}
  \text{AIC} = -2 \ln L + 2 \text{パラメータ数}
\end{split}\]</div>
<p>AICが小さいほど良いモデル。</p>
<p>尤度は高めたいが、パラメータを増やすとペナルティ。</p>

</section>
<section>
<h2 id="ほかの情報量基準">ほかの情報量基準</h2>
<ul>
<li>BIC</li>
<li>WAIC</li>
<li>WBIC</li>
<li>尤度比検定</li>
</ul>

</section>
<section>
<h2 id="モデル選択">モデル選択</h2>
<p>「正しい」ものを選ぶわけではない。</p>
<blockquote>
<p>All models are wrong, but some are useful. &mdash; George E. P. Box</p>
</blockquote>
<p>じゃあどんなものが useful か？</p>

</section>
<section>
<h2 id="現実的な注意">現実的な注意</h2>
<ul>
<li>多重共線性(マルチコ)</li>
<li>値を変換する。e.g., log</li>
<li>割り算した値を使わない。</li>
</ul>

</section>
<section>
<h2 id="交互作用">交互作用</h2>
<p>🔰 statsmodelsで交互作用ありモデルを作ってみる
</section>
<section>
<h2 id="過分散">過分散</h2>
<p>ポアソン分布なら平均が決まると分散も決まる。</p>
<p>平均値から考えるよりも分散が大きい場合にどうするか。</p>

</section>
<section>
<h2 id="一般化線形混合モデル-glmm">一般化線形混合モデル GLMM</h2>

</section>
<section>
<h2 id="一般化加法モデル-gam">一般化加法モデル GAM</h2>

</section>
<section>
<h2 id="pythonでglm">PythonでGLM</h2>
<dl>
<dt><a href="https://www.statsmodels.org">statsmodels</a></dt>
<dd>統計モデリング寄り</dd>
<dd>AICやp値などの指標も適宜計算してくれるので楽</dd>
<dt><a href="https://scikit-learn.org">scikit-learn</a></dt>
<dd>機械学習寄り</dd>
<dd>回帰以外のさまざまな手法も統一的な書き方で使える</dd>
</dl>

</section>
<section>
<h2 id="次">次</h2>
<a href="4-bayesian.html" rel="next" class="readmore">
4. 階層ベイズモデル
</a>

</section>
</div>
</div>
<script src="/slides/lib/reveal.js/reveal.js"></script>
<script src="/slides/lib/reveal.js/plugin/notes.js"></script>
<script>
Reveal.initialize({
  width: 960,
  height: 720,
  margin: 0,
  controls: true,
  controlsLayout: 'bottom-right',
  controlsTutorial: false,
  controlsBackArrows: 'faded',
  progress: false,
  slideNumber: 'c/t',
  showSlideNumber: 'all',
  hashOneBasedIndex: true,
  hash: true,
  history: false,
  keyboard: true,
  overview: true,
  center: false,
  touch: true,
  loop: false,
  rtl: false,
  navigationMode: 'linear',
  shuffle: false,
  fragments: true,
  fragmentInURL: true,
  embedded: false,
  help: true,
  showNotes: false,
  autoPlayMedia: null,
  preloadIframes: null,
  mouseWheel: false,
  previewLinks: false,
  transition: 'none',
  transitionSpeed: 'fast',
  backgroundTransition: 'none',
  pdfMaxPagesPerSlide: 1,
  pdfSeparateFragments: false,
  viewDistance: 2,
  plugins: [ RevealNotes ]
});
</script>
<script>
{
const reload_all_img = function() {
  const imgs = document.getElementsByTagName("img");
  for (let i = 0; i < imgs.length; ++i) {
    const src = imgs[i].src;
    imgs[i].src += "?q";
    imgs[i].src = src;
  }
};
const reload_src_element = function(ev) {
  const original_src = ev.srcElement.src;
  ev.srcElement.src += "?q";
  ev.srcElement.src = original_src;
};
const reload_src = function(ev) {
  if (ev.shiftKey || ev.metaKey || ev.altKey) {
    reload_all_img();
  } else {
    reload_src_element(ev);
  }
};
const img_elements = document.getElementsByTagName("img");
for (let i = 0; i < img_elements.length; ++i) {
  img_elements[i].onclick = reload_src;
}
};
</script>
</body>
</html>
