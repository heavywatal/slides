+++
url = "tmd2022/6-practice.html"
title = "6. å®Ÿè·µ â€” Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’ 2022"
linktitle = "å®Ÿè·µ: ç¾å®Ÿã®å•é¡Œã«å¯¾å‡¦ã—ã¦ã¿ã‚‹"
date = 2022-10-08T14:40:00+09:00
type = "reveal"
draft = false
+++

<link rel="stylesheet" href="style.css">

# [Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’2022](.)

<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki, PhD)
</div>

<div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡ ç‰¹ä»»åŠ©æ•™<br>
(Graduate School of Life Sciences, Tohoku University)
</div>

<ol>
<li><a href="1-introduction.html">å…¥é–€1: å‰å‡¦ç†ã¨ã¯ã€‚Rã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã€‚Rã®åŸºæœ¬ã€‚</a>
<li><a href="2-visualization.html">å…¥é–€2: ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã®é‡è¦æ€§ã¨æ–¹æ³•ã€‚</a>
<li><a href="3-structure1.html">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‡¦ç†1: æŠ½å‡ºã€é›†ç´„ãªã©ã€‚</a>
<li><a href="4-structure2.html">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‡¦ç†2: çµåˆã€å¤‰å½¢ãªã©ã€‚</a>
<li><a href="5-content.html">ãƒ‡ãƒ¼ã‚¿å†…å®¹ã®å‡¦ç†: æ•°å€¤ã€æ–‡å­—åˆ—ã€æ—¥æ™‚ãªã©ã€‚</a>
<li class="current-deck"><a href="6-practice.html">å®Ÿè·µ: ç¾å®Ÿã®å•é¡Œã«å¯¾å‡¦ã—ã¦ã¿ã‚‹ã€‚</a>
</ol>

<div class="footnote">
2022-10-08 æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§å­¦ M&Dã‚¿ãƒ¯ãƒ¼ æƒ…å ±æ¤œç´¢å®¤1<br>
<a href="https://heavywatal.github.io/slides/tmd2022/">https://heavywatal.github.io/slides/tmd2022/</a>
</div>

```{r setup-global, include=FALSE, code=readLines("setup.R"), message = FALSE}
```

```{r setup-local, include = FALSE}
knitr::opts_chunk$set(cache = FALSE)
```

---
## æœ€çµ‚å›ã®ãŠå“æ›¸ã

-   ğŸ”° 1é€±ç›®ã®èª²é¡Œ
    - 3â€“5äººãšã¤ã®ç­ã«åˆ†ã‹ã‚Œã€ç”»é¢å…±æœ‰ã—ã¤ã¤è¨è«–
    - ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ ã«æˆ»ã‚Šã€å„ç­ä»£è¡¨ãŒè§£ç­”ãƒ»æ„Ÿæƒ³ã‚’ç™ºè¡¨
-   ğŸ”° 2é€±ç›®ã®èª²é¡Œ
    - åŒæ§˜ã«ã€‚æ™‚é–“ãŒç„¡ã‘ã‚Œã°è¨è«–çœç•¥ã€‚
-   ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§å®Ÿæ¼” + è³ªç–‘å¿œç­”


---
## ğŸ”° 1é€±ç›®ã®èª²é¡Œ

<iframe width="400" height="300" src="./2-visualization.html#/52"></iframe>
<iframe width="400" height="300" src="./2-visualization.html#/53"></iframe>

---
## ğŸ”° 2é€±ç›®ã®èª²é¡Œ

<iframe width="400" height="300" src="./4-structure2.html#/31"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/32"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/35"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/36"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/37"></iframe>


---
## ğŸ”° 3æ—¥ç›®ã®èª²é¡Œ1: å¥½ããªãƒ‡ãƒ¼ã‚¿ã‚’ã„ã˜ãã‚Šå€’ã—ã¦ã¿ã‚ˆã†

- è‡ªåˆ†ãŒã“ã‚Œã‹ã‚‰è§£æã—ãŸã„ãƒ‡ãƒ¼ã‚¿ (ã‚‚ã—æ‰‹å…ƒã«ã‚ã‚Œã°)
- ä½•ã‹é©å½“ãªãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã€‚ä¾‹ãˆã°:
    - [e-Stat](https://www.e-stat.go.jp/): æ”¿åºœçµ±è¨ˆã®ç·åˆçª“å£
    - [data.go.jp ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã‚µã‚¤ãƒˆ](https://www.data.go.jp/data/dataset?res_format=CSV): ä¸­å¤®çœåº
    - [BODIKã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã‚µã‚¤ãƒˆ](https://odcs.bodik.jp/): åœ°æ–¹è‡ªæ²»ä½“
    - [æ°—è±¡åº](https://www.data.jma.go.jp/gmd/risk/obsdl/index.php)
    - [DATA.GOV](https://www.data.gov/): U.S. Governmentâ€™s open data
- (è‹¦è‚‰ã®ç­–) Rã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä»˜å±ã®ãƒ‡ãƒ¼ã‚¿
    - `diamonds`, `starwars`, `mpg`, etc. See `data()`

ç™ºè¡¨ãƒ»ãƒ¬ãƒãƒ¼ãƒˆã®æ¡ä»¶
: æœ€ä½1æšã®å›³ã¨ã€ãã“ã«è‡³ã‚‹å‰å‡¦ç†ï¼‹å¯è¦–åŒ–ã®ã‚³ãƒ¼ãƒ‰ã€‚
: ã‚°ãƒ©ãƒ•ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹ã“ã¨ã‚’ä¸€è¨€ã€‚

---
## å®Ÿæ¼”: [ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿](https://odcs.bodik.jp/131105/)

[ç”ºä¸åˆ¥ãƒ»å¹´é½¢åˆ¥ãƒ»ç”·å¥³åˆ¥äººå£...](https://data.bodik.jp/organization/968e265c-d998-4475-8abf-7e8a53f81595?res_format=CSV&groups=gr_0200)
ã®æœ€æ–°CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€èª­ã¿è¾¼ã¿

```{r meguro_read, echo = -1}
if (!fs::file_exists("131105_population_20211001.csv")) {
  infile = "https://data.bodik.jp/dataset/98331303-9277-4266-bac6-a637ab5e47a5/resource/8019010f-a2b1-4313-bcd8-45ade27d2a3d/download/131105_population_20211001.csv"
  raw_meguro = readr::read_csv(infile)
  readr::write_csv(raw_meguro, fs::path_file(infile), na = "")
}
infile = "131105_population_20211001.csv"
raw_meguro = readr::read_csv(infile)
print(raw_meguro)
```

---
## å®Ÿæ¼”: ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿

ggplotã—ãŸããªã‚‹å½¢ã«å¤‰å½¢ã€‚1è¡Œãšã¤çµŒéã‚’ç¢ºèªã—ã‚ˆã†ã€‚

```{r meguro_tidy, cache = FALSE}
tidy_meguro = raw_meguro %>%
  select("åœ°åŸŸå", matches("ã®.+æ€§$")) %>%
  rename(place = åœ°åŸŸå) %>%
  mutate(place = str_remove(place, "\\Sä¸ç›®")) %>%
  group_by(place) %>%
  summarize(across(everything(), sum)) %>%
  ungroup() %>%
  pivot_longer(!place, names_to = "category", values_to = "count") %>%
  separate(category, c("age", "sex"), sep = "ã®") %>%
  mutate(age = as.integer(str_extract(age, "^\\d+"))) %>%
  filter(!is.na(age)) %>%
  print()
```

---
## å®Ÿæ¼”: ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿

ä½œå›³ã—ã¦ã¿ã‚‹

```{r meguro_plot, fig.height = 4.5, fig.width = 10}
ggplot(tidy_meguro) +
  aes(age, count) +
  geom_col(aes(fill = sex)) +
  facet_wrap(vars(place), nrow = 3L) +
  theme_bw(base_family = "HiraginoSans-W3") # æ—¥æœ¬èªã¯é¬¼é–€
```

---
## å®Ÿæ¼”: [e-Stat å›½å‹¢èª¿æŸ»2015](https://www.e-stat.go.jp/gis/statmap-search?page=1&type=1&toukeiCode=00200521) (å®®åŸçœŒ)

æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒå¤ã„ã€‚åˆ—åãŒ2è¡Œã«ã¾ãŸãŒã£ã¦ã‚‹ã€‚æ•°å€¤ã®åˆ—ã«å¤‰ãªæ–‡å­—ã€‚

```{r estat_read, echo = -1}
options(readr.show_col_types = FALSE)
infile = "tblT000849C04.txt"
sjis = locale(encoding = "SJIS")
# readr::read_csv(infile, locale = sjis)
miyagi_L = readr::read_csv(infile, locale = sjis, col_select = seq(1, 7)) %>%
  dplyr::slice(-1)
miyagi_R = readr::read_csv(infile, locale = sjis, col_select = -seq(1, 7), skip = 1L, na = c("-", "X"), name_repair = "minimal")
raw_miyagi = bind_cols(miyagi_L, miyagi_R) %>% print()
```

---
## å®Ÿæ¼”: e-Stat å›½å‹¢èª¿æŸ»2015 (å®®åŸçœŒ)

ã¾ã ç½ ãŒãŸãã•ã‚“: åˆ—åã®é ­ã«ã‚¹ãƒšãƒ¼ã‚¹ã€‚å…¨è§’æ•°å­—ã€‚å¤‰ãªåŒºåˆ†ã€‚

```{r estat_tidy}
tidy_miyagi = raw_miyagi %>%
  dplyr::filter(HYOSYO == 1) %>%
  dplyr::select(CITYNAME, matches("[ç”·å¥³].+[æ­³ä¸Š]$")) %>%
  tidyr::pivot_longer(!CITYNAME, names_to = "category", values_to = "count") %>%
  dplyr::mutate(category = str_trim(category)) %>%
  tidyr::separate(category, c("sex", "age"), 1) %>%
  dplyr::mutate(age = stringi::stri_trans_nfkc(age)) %>%
  tidyr::separate(age, c("lower", "upper"), "ã€œ", fill = "right") %>%
  dplyr::mutate(lower = parse_number(lower), upper = parse_number(upper)) %>%
  dplyr::filter((upper - lower) < 5 | lower == 75) %>%
  dplyr::rename(age = lower) %>%
  print()
```

---
## å®Ÿæ¼”: e-Stat å›½å‹¢èª¿æŸ»2015 (å®®åŸçœŒ)

```{r estat_factor, include = FALSE}
total_miyagi = tidy_miyagi %>%
  dplyr::count(CITYNAME, wt = count, name = "count") %>%
  dplyr::arrange(desc(count))
tidy_miyagi = tidy_miyagi %>%
  dplyr::mutate(CITYNAME = factor(CITYNAME, levels = total_miyagi$CITYNAME))
```

```{r estat_plot, fig.height = 6, fig.width = 11}
ggplot(tidy_miyagi) +
  aes(age, count) +
  geom_col(aes(fill = sex)) +
  facet_wrap(vars(CITYNAME), ncol = 8L) +
  theme_minimal(base_family = "HiraginoSans-W3", base_size = 14)
```

---
## Reference

R for Data Science --- Hadley Wickham and Garrett Grolemund
: <https://r4ds.had.co.nz/>,
  [Paperback](https://amzn.to/2tbRmVc),
  [æ—¥æœ¬èªç‰ˆæ›¸ç±](https://amzn.to/2yyFRKt)

[å‰å‡¦ç†å¤§å…¨ --- æœ¬æ©‹æ™ºå…‰](https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b)<br>
[Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®RStudio[å®Ÿè·µ]å…¥é–€ (å®‡å®™èˆ¹æœ¬) --- æ¾æ‘ã‚‰](https://amzn.to/2Yy5LND)

Official documents:
: [tidyverse](https://www.tidyverse.org/),
  [ggplot2](https://ggplot2.tidyverse.org/),
  [dplyr](https://dplyr.tidyverse.org/),
  [tidyr](https://tidyr.tidyverse.org/),
  [stringr](https://stringr.tidyverse.org/),
  [readr](https://readr.tidyverse.org/)

Older versions
: ã€Œ[Rã«ã‚„ã‚‰ã›ã¦æ¥½ã—ã‚ˆã† â€” ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¨ä¸‹ã”ã—ã‚‰ãˆ](https://heavywatal.github.io/slides/nagoya2018/)ã€
   å²©åµœèˆª 2018
: ã€ŒRã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨ã€çŸ³å·ç”±å¸Œ 2019 åå¤å±‹å¤§å­¦
: ã€Œ[Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’](https://heavywatal.github.io/slides/tmd2020/)ã€
   å²©åµœèˆª 2020 æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§
: ã€Œ[Rã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨](https://comicalcommet.github.io/r-training-2022/)ã€
   çŸ³å·ç”±å¸Œ 2022 åå¤å±‹å¤§å­¦

<a href="./" class="readmore">
ç›®æ¬¡ã«æˆ»ã‚‹
</a>
