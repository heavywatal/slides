<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>5. Stanã§GLM â€” çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022</title>
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="5. Stanã§GLM â€” çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/tokiomarine2022/5-stan-glm.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks â€” Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<link rel="stylesheet" href="/lib/katex/katex.min.css">
<script defer src="/lib/katex/katex.min.js"></script>
<script defer src="/lib/katex/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "\\[", right: "\\]", display: true},
      {left: "$", right: "$", display: false}
    ]
  });
});
</script>
<style>
.katex {
  font-size: 1.12em;
}

.katex-display > .katex {
  text-align: left;
  padding-left: 2rem;
}
</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-V60H2JH0G6', { 'anonymize_ip': false });
}
</script>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<script defer src="/slides/lib/reveal.js/reveal.js"></script>
<script defer src="/slides/lib/reveal.js/plugin/notes/notes.js"></script>
<script defer src="/slides/lib/reveal.js/plugin/search/search.js"></script>
<script defer src="/slides/lib/reveal-initialize.js"></script>
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<link rel="stylesheet" href="/slides/css/style-reveal.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css">
<h1 id="çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«–-dshc-2022"><a href=".">çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022</a></h1>
<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki, PhD)
</div>
<div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡ ç‰¹ä»»åŠ©æ•™<br>
(Graduate School of Life Sciences, Tohoku University)
</div>
<ol>
<li><a href="1-introduction.html">å°å…¥</a>
<li><a href="2-stats-model.html">çµ±è¨ˆãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬: ç¢ºç‡åˆ†å¸ƒã€å°¤åº¦</a>
<li><a href="3-glm.html">ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã€æ··åˆãƒ¢ãƒ‡ãƒ«</a>
<li><a href="4-bayesian.html">ãƒ™ã‚¤ã‚ºæ¨å®šã¨MCMC</a>
<li class="current-deck"><a href="5-stan-glm.html">Stanã§GLM</a>
<li><a href="6-stan-hbm.html">Stanã§éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«</a>
</ol>
<div class="footnote">
2022-08-24 æ±äº¬æµ·ä¸Š Data Science Hill Climb
<a href="https://heavywatal.github.io/slides/tokiomarine2022/">https://heavywatal.github.io/slides/tokiomarine2022/</a>
</div>

</section>
<section>
<h2 id="stan">Stan</h2>
<a href="https://mc-stan.org/">
<img src="/slides/image/stan/logo_name.png" width="120" align="right">
</a>
<ul>
<li>Stanè¨€èªã§<strong>ãƒ¢ãƒ‡ãƒ«ã‚’æŸ”è»Ÿã«è¨˜è¿°</strong>ã§ãã‚‹ã€‚</li>
<li>C++ã§æ›¸ã‹ã‚Œã¦ã„ã¦é«˜é€Ÿã«å‹•ä½œã€‚</li>
<li>Rã‚„Pythonãªã©ã‹ã‚‰å‘¼ã³å‡ºã—ã¦ä½¿ã†ã®ãŒä¾¿åˆ©ã€‚</li>
</ul>
<p>å‰å›ã€å›å¸°ã§ã¯ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šã‚’ã‚„ã£ãŸã€‚</p>
<hr>
<p>æ¬¡ã«ã€å›å¸°åˆ†æã‚’Stanã§ã‚„ã£ã¦ã¿ã‚‹ã€‚</p>

</section>
<section>
<h2 id="ç›´ç·šå›å¸°ã™ã‚‹stanã‚³ãƒ¼ãƒ‰ã®ä¾‹">ç›´ç·šå›å¸°ã™ã‚‹Stanã‚³ãƒ¼ãƒ‰ã®ä¾‹</h2>
<p><code>slope * x</code> ã®ã‚ˆã†ãªãƒ™ã‚¯ãƒˆãƒ«æ¼”ç®—ãŒã§ãã‚‹ã€‚</p>
<pre tabindex="0"><code>data {
  int&lt;lower=0&gt; N;
  vector&lt;lower=0&gt;[N] x;
  vector[N] y;
}

parameters {
  real intercept;
  real slope;
  real&lt;lower=0&gt; sigma;
}

model {
  y ~ normal(intercept + slope * x, sigma);
}
</code></pre>
</section>
<section>
<h2 id="å¤‰æ•°ã®å‹-vector-vs-array">å¤‰æ•°ã®å‹: <code>vector</code> vs <code>array</code></h2>
<p><code>vector</code>, <code>row_vector</code>, <code>matrix</code> ã¯å®Ÿæ•° <code>real</code> ã®ã¿ã§ã€è¡Œåˆ—æ¼”ç®—ã§ãã‚‹:</p>
<pre tabindex="0"><code class="language-stan" data-lang="stan">real x;
vector[3] v;
row_vector[3] r;
matrix[3, 3] m;

x * v  // vector[3]
r * v  // real
v * r  // matrix[3, 3]
m * v  // vector[3]
m * m  // matrix[3, 3]
m[1]   // row_vector[3]
</code></pre><p><code>array</code> ã«å‹ã®åˆ¶ç´„ã¯ç„¡ã„ãŒã€è¡Œåˆ—æ¼”ç®—ã¯ã§ããªã„ã®ã§è‡ªåŠ›forãƒ«ãƒ¼ãƒ—:</p>
<pre tabindex="0"><code class="language-stan" data-lang="stan">array[3] int a;
array[3] int b;
for (i in 1:3) {
  b[i] = 2 * a[i] + 1
}
</code></pre>
</section>
<section>
<h2 id="å¤‰æ•°ã‚’ã†ã¾ãä½¿ã£ã¦å¯èª­æ€§ã‚¢ãƒƒãƒ—">å¤‰æ•°ã‚’ã†ã¾ãä½¿ã£ã¦å¯èª­æ€§ã‚¢ãƒƒãƒ—</h2>
<p>é€”ä¸­è¨ˆç®—ã«åå‰ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ãƒ¢ãƒ‡ãƒ«ãŒèª­ã¿ã‚„ã™ããªã‚‹:</p>
<pre tabindex="0"><code class="language-stan" data-lang="stan">model {
  vector[N] mu = intercept + slope * x;
  y ~ normal(mu, sigma);
}
</code></pre><p><code>transformed parameters</code> ã«æ›¸ãã¨<br>
<code>parameters</code> ã¨åŒæ§˜ã«MCMCã‚µãƒ³ãƒ—ãƒ«ãŒè¨˜éŒ²ã•ã‚Œã‚‹:</p>
<pre tabindex="0"><code class="language-stan" data-lang="stan">transformed parameters {
  vector[N] mu = intercept + slope * x;
}

model {
  y ~ normal(mu, sigma);
}
</code></pre><p>ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ã¯è‰¯ããªã‚‹ãŒã€çµæœã®é–²è¦§ã¯ã¡ã‚‡ã£ã¨ã‚„ã‚Šã¥ã‚‰ããªã‚‹ã€‚</p>

</section>
<section>
<h2 id="ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®äº‹å‰åˆ†å¸ƒã‚’æ˜ç¤ºçš„ã«è¨­å®šã§ãã‚‹">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®äº‹å‰åˆ†å¸ƒã‚’æ˜ç¤ºçš„ã«è¨­å®šã§ãã‚‹</h2>
<p>ãŒã€çœç•¥ã—ã¦ã‚‚StanãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã†ã¾ãã‚„ã£ã¦ãã‚Œã‚‹ã€‚<br>
ãã®ã›ã„ã§åæŸãŒæ‚ªã„ã‹ã‚‚ã€ã¨ãªã£ã¦ã‹ã‚‰è€ƒãˆã¦ã‚‚é…ããªã„ã€‚</p>
<pre tabindex="0"><code class="language-stan" data-lang="stan">parameters {
  real intercept;
  real slope;
  real&lt;lower=0&gt; sigma;
}

model {
  y ~ normal(intercept + slope * x, sigma);
  intercept ~ normal(0, 100);
  slope ~ normal(0, 100);
  sigma ~ student_t(3, 0, 10);
}
</code></pre>
</section>
<section>
<h2 id="äº‹å‰åˆ†å¸ƒã®é¸åˆ¥">äº‹å‰åˆ†å¸ƒã®é¸åˆ¥</h2>
<ol>
<li>
<p>ã¨ã‚Šã‚ãˆãš<strong>ç„¡æƒ…å ±äº‹å‰åˆ†å¸ƒ</strong> $[-\infty, \infty]$ã€‚Stanã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€‚</p>
</li>
<li>
<p>åæŸãŒæ‚ªã‹ã£ãŸã‚‰<strong>å¼±æƒ…å ±äº‹å‰åˆ†å¸ƒ</strong>ã‚’è©¦ã™ã€‚<br>
äº‹å¾Œåˆ†å¸ƒã‚’æ›´æ–°ã—ã¦ã„ã£ãŸã¨ã<strong>äº‹å‰åˆ†å¸ƒã£ã½ã•ãŒæ®‹ã‚‰ãªã„</strong>ã®ãŒè‰¯ã„ã€‚</p>
<ul>
<li>å–ã‚Šã†ã‚‹å€¤ã‚’é€ƒã™ã‚ˆã†ãªç‹­ã™ãã‚‹åˆ†å¸ƒã¯ãƒ€ãƒ¡ã€‚</li>
<li>ç‹­ã™ãã‚‹ã‚ˆã‚Šã¯ãƒã‚·ã ãŒã€åºƒã™ãã¦ã‚‚è‰¯ããªã„ã€‚</li>
<li>ä¸€æ§˜åˆ†å¸ƒ $[a, b]$ ã¯ä¸€è¦‹ç„¡æƒ…å ±ã£ã½ãã¦è‰¯ã•ãã†ã ãŒã€<br>
äº‹å¾Œåˆ†å¸ƒã«è£¾é‡ãŒæ®‹ã£ãŸã‚Šçµ¶å£ãŒã§ããŸã‚Šã—ãŒã¡ãªã®ã§å¾®å¦™ã€‚</li>
</ul>
<p>ãŠã™ã™ã‚: <a href="https://mc-stan.org/docs/functions-reference/student-t-distribution.html"><strong>Student&rsquo;s tåˆ†å¸ƒ</strong></a>
or <a href="https://mc-stan.org/docs/functions-reference/normal-distribution.html"><strong>æ­£è¦åˆ†å¸ƒ</strong></a></p>
</li>
</ol>
<p><cite><a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations</a></cite></p>

</section>
<section>
<h2 id="stanãŠã™ã™ã‚å¼±æƒ…å ±äº‹å‰åˆ†å¸ƒ-students-tåˆ†å¸ƒ">StanãŠã™ã™ã‚å¼±æƒ…å ±äº‹å‰åˆ†å¸ƒ: Student&rsquo;s tåˆ†å¸ƒ</h2>
<p>Student&rsquo;s $t(\nu=\nu_0, \mu = 0, \sigma = \sigma_0)$</p>
<ul>
<li>è‡ªç”±åº¦ $3 \le \nu_0 \le 7 $ ã§é©å½“ã«å›ºå®šã€‚
<ul>
<li>$\nu = 1$ ã§ã‚³ãƒ¼ã‚·ãƒ¼åˆ†å¸ƒã€‚è£¾é‡ãŒåºƒã™ãã¦è‰¯ããªã„ã‚‰ã—ã„ã€‚</li>
<li>$\nu \to \infty$ ã§<strong>æ­£è¦åˆ†å¸ƒ</strong>ã€‚ã ã„ãŸã„ã“ã‚Œã§ã„ã„ã‚‰ã—ã„ã€‚</li>
</ul>
</li>
<li>ã‚¹ã‚±ãƒ¼ãƒ« $\sigma$: ã€Œæ¨å®šã—ãŸã„å€¤ã¯$[-\sigma_0, \sigma_0]$ã«åã¾ã‚‹ã ã‚ã†ã€ã¨ã„ã†å€¤ã€‚</li>
</ul>
<p><img src="figure/student_t-1.png" alt="plot of chunk student_t"></p>

</section>
<section>
<h2 id="mcmcã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ã£ã¦ãƒ™ã‚¤ã‚ºç¢ºä¿¡åŒºé–“ã‚’ä½œå›³">MCMCã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ã£ã¦ãƒ™ã‚¤ã‚ºç¢ºä¿¡åŒºé–“ã‚’ä½œå›³</h2>
<pre tabindex="0"><code class="language-stan" data-lang="stan">data {
  // ...
  int&lt;lower=0&gt; N_tilde
  vector[N_tilde] x_tilde;
}
// ...
generated quantities {
  array[N_tilde] real y_tilde = normal_rng(intercept + slope * x_tilde, sigma);
}
</code></pre><p><img src="figure/stan-lm-credible-1.png" alt="plot of chunk stan-lm-credible"></p>
</section>
<section>
<h2 id="-stanã§ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«">ğŸ”° Stanã§ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«</h2>
<p>ğŸ”°
<a href="5-stan-glm.ipynb"><code>5-stan-glm.ipynb</code></a>
ã‚’é–‹ã„ã¦å®Ÿè¡Œã—ã¦ã„ã“ã†ã€‚</p>
<div class="column-container">
  <div class="column" style="flex-shrink: 2.0;">
<ul>
<li>
<p>ç›´ç·šå›å¸°</p>
</li>
<li>
<p>ãƒã‚¢ã‚½ãƒ³å›å¸°</p>
</li>
<li>
<p>ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°</p>
</li>
<li>
<p>é‡å›å¸°</p>
</li>
<li>
<p>åˆ†æ•£åˆ†æ</p>
</li>
<li>
<p>å…±åˆ†æ•£åˆ†æ</p>
</div>
<div class="column" style="flex-shrink: 1.0;">
</li>
</ul>
<figure>
<img height=160 src="figure/lm-bad-1.png">
<img height=160 src="figure/glm-poisson-1.png">
<img height=160 src="figure/glm-logistic-1.png"><br>
<img height=160 src="figure/multiple-regression-1.png"><br>
<img height=160 src="figure/glm-anova-1.png">
<img height=160 src="figure/glm-ancova-1.png">
</figure>
  </div>
</div>

</section>
<section>
<h2 id="-stanã§penguinsã®å›å¸°åˆ†æã‚’ã—ã¦ã¿ã‚ˆã†">ğŸ”° Stanã§penguinsã®å›å¸°åˆ†æã‚’ã—ã¦ã¿ã‚ˆã†</h2>
<a href="https://allisonhorst.github.io/palmerpenguins/">
<cite>https://allisonhorst.github.io/palmerpenguins/</cite><br>
<img src="/slides/image/rstats/lter_penguins.png" width="45%">
<img src="/slides/image/rstats/culmen_depth.png" width="45%">
</a>
<img src="figure/penguins-interaction-1.png" height="300">
</section>
<section>
<h2 id="-stanã§penguinsã®å›å¸°åˆ†æã‚’ã—ã¦ã¿ã‚ˆã†">ğŸ”° Stanã§penguinsã®å›å¸°åˆ†æã‚’ã—ã¦ã¿ã‚ˆã†</h2>
<a href="https://allisonhorst.github.io/palmerpenguins/">
<cite>https://allisonhorst.github.io/palmerpenguins/</cite><br>
<img src="/slides/image/rstats/lter_penguins.png" width="45%">
<img src="/slides/image/rstats/culmen_depth.png" width="45%">
</a>
<p><code>Stan does not support NA</code> ã¨æ€’ã‚‰ã‚Œã‚‹ã®ã§æ¬ æå€¤ã‚’å–ã‚Šé™¤ã„ã¦ãŠã:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">penguins</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_rdataset</span><span class="p">(</span><span class="s2">&#34;penguins&#34;</span><span class="p">,</span> <span class="s2">&#34;palmerpenguins&#34;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">penguins_dropna</span> <span class="o">=</span> <span class="n">penguins</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2>
<ul>
<li><a href="https://amzn.to/33suMIZ">ãƒ‡ãƒ¼ã‚¿è§£æã®ãŸã‚ã®çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°å…¥é–€</a> ä¹…ä¿æ‹“å¼¥ 2012</li>
<li><a href="https://amzn.to/3uwx7Pb">Stanã¨Rã§ãƒ™ã‚¤ã‚ºçµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°</a> æ¾æµ¦å¥å¤ªéƒ 2016</li>
<li><a href="https://amzn.to/3o1eCzP">Rã¨Stanã§ã¯ã˜ã‚ã‚‹ ãƒ™ã‚¤ã‚ºçµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ†æå…¥é–€</a> é¦¬å ´çœŸå“‰ 2019</li>
<li><a href="https://amzn.to/3uCxTKo">ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã®æ•°ç†ãƒ¢ãƒ‡ãƒ«å…¥é–€</a> æ±Ÿå´è²´è£• 2020</li>
<li><a href="https://amzn.to/3uznzCK">åˆ†æè€…ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è§£é‡ˆå­¦å…¥é–€</a> æ±Ÿå´è²´è£• 2020</li>
<li><a href="https://amzn.to/3ty80Kv">çµ±è¨ˆå­¦ã‚’å“²å­¦ã™ã‚‹</a> å¤§å¡šæ·³ 2020</li>
</ul>
<a href="6-stan-hbm.html" rel="next" class="readmore">
6. Stanã§éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«
</a>

</section>
</div>
</div>
</body>
</html>
