<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>6. Stanã§éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ« â€” çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022</title>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<link rel="stylesheet" href="/slides/css/theme-reveal.css">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="6. Stanã§éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ« â€” çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/tokiomarine2022/6-stan-hbm.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks â€” Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="stylesheet" href="/lib/katex/katex.min.css">
<script defer src="/lib/katex/katex.min.js"></script>
<script defer src="/lib/katex/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "\\[", right: "\\]", display: true},
      {left: "$", right: "$", display: false}
    ]
  });
});
</script>
<style>
.katex {
  font-size: 1.12em;
}

.katex-display > .katex {
  text-align: left;
  padding-left: 2rem;
}
</style>

<script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-V60H2JH0G6', { 'anonymize_ip': false });
}
</script>

</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css">
<h1 id="çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«–-dshc-2022"><a href=".">çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022</a></h1>
<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki, PhD)
</div>
<div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡ ç‰¹ä»»åŠ©æ•™<br>
(Graduate School of Life Sciences, Tohoku University)
</div>
<ol>
<li><a href="1-introduction.html">å°å…¥</a>
<li><a href="2-stats-model.html">çµ±è¨ˆãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬: ç¢ºç‡åˆ†å¸ƒã€å°¤åº¦</a>
<li><a href="3-glm.html">ä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã€æ··åˆãƒ¢ãƒ‡ãƒ«</a>
<li><a href="4-bayesian.html">ãƒ™ã‚¤ã‚ºæ¨å®šã¨MCMC</a>
<li><a href="5-stan-glm.html">Stanã§GLM</a>
<li class="current-deck"><a href="6-stan-hbm.html">Stanã§éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«</a>
</ol>
<div class="footnote">
2022-08-24 æ±äº¬æµ·ä¸Š Data Science Hill Climb
<a href="https://heavywatal.github.io/slides/tokiomarine2022/">https://heavywatal.github.io/slides/tokiomarine2022/</a>
</div>

</section>
<section>
<h2 id="glmmã§ç™»å ´ã—ãŸå€‹ä½“å·®ã‚’éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã§">GLMMã§ç™»å ´ã—ãŸå€‹ä½“å·®ã‚’éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã§</h2>
<figure>
<a href="https://kuboweb.github.io/-kubo/ce/LinksGlm.html">
<img src="../tokiomarine2021/image/kubo-p2.png" width="100%">
<figcaption class="url">ä¹…ä¿ã•ã‚“ https://kuboweb.github.io/-kubo/ce/LinksGlm.html</figcaption>
</a>
</figure>

</section>
<section>
<h2 id="glmmã§ç™»å ´ã—ãŸå€‹ä½“å·®ã‚’éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã§">GLMMã§ç™»å ´ã—ãŸå€‹ä½“å·®ã‚’éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã§</h2>
<p>æ¤ç‰©100å€‹ä½“ã‹ã‚‰8å€‹ãšã¤ç¨®å­ã‚’å–ã£ã¦æ¤ãˆãŸã‚‰å…¨ä½“ã§åŠåˆ†ã¡ã‚‡ã„ç™ºèŠ½ã€‚<br>
è¦ª1å€‹ä½“ã‚ãŸã‚Šã®ç”Ÿå­˜æ•°ã¯<span style="color: #3366ff;">n=8ã®äºŒé …åˆ†å¸ƒ</span>ã«ãªã‚‹ã¯ãšã ã‘ã©ã€<br>
æ¥µç«¯ãªå€¤(å…¨éƒ¨æ­»äº¡ã€å…¨éƒ¨ç”Ÿå­˜)ãŒå¤šã‹ã£ãŸã€‚å€‹ä½“å·®ï¼Ÿ</p>
<img src="figure/overdispersion-1.png" alt="plot of chunk overdispersion">
</section>
<section>
<h2 id="éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å›³">éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å›³</h2>
<p>äº‹å‰åˆ†å¸ƒã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã€ã•ã‚‰ã«äº‹å‰åˆ†å¸ƒã‚’è¨­å®šã™ã‚‹ã®ã§éšå±¤ãƒ™ã‚¤ã‚º</p>
<figure>
<img src="../tokiomarine2021/hbm.drawio.svg">
</figure>

</section>
<section>
<h2 id="ã•ã£ãã®å›³ã‚’stanè¨€èªã§è¨˜è¿°ã™ã‚‹ã¨">ã•ã£ãã®å›³ã‚’Stanè¨€èªã§è¨˜è¿°ã™ã‚‹ã¨</h2>
<p><code>10</code> ã¨ã‹ <code>3</code> ã¨ã‹ã€ã‚¨ã‚¤ãƒ¤ã£ã¨æ±ºã‚ã¦ã‚‹ã‚„ã¤ãŒè¶…ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€‚</p>
<pre tabindex="0"><code class="language-{.stan" data-lang="{.stan">data {
  int&lt;lower=0&gt; N;
  array[N] int&lt;lower=0&gt; y;
}

parameters {
  real a;           // mean ability
  vector[N] r;      // individual difference
  real&lt;lower=0&gt; s;  // sd of r
}

transformed parameters {
  vector[N] p = inv_logit(a + r);
}

model {
  y ~ binomial(8, p);
  a ~ normal(0, 10);
  r ~ normal(0, s);
  s ~ student_t(3, 0, 1);
}
</code></pre>
</section>
<section>
<h2 id="å¤‰é‡åŠ¹æœãŒå…¥ã£ãŸæ¨å®šçµæœ">å¤‰é‡åŠ¹æœãŒå…¥ã£ãŸæ¨å®šçµæœ</h2>
<pre tabindex="0"><code>Running MCMC with 4 chains, at most 6 in parallel...

Chain 1 finished in 0.4 seconds.
Chain 2 finished in 0.4 seconds.
Chain 3 finished in 0.4 seconds.
Chain 4 finished in 0.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.4 seconds.
Total execution time: 0.5 seconds.
</code></pre><pre tabindex="0"><code> variable    mean  median   sd  mad      q5     q95 rhat ess_bulk ess_tail
     lp__ -455.89 -455.53 9.32 9.31 -472.22 -440.97 1.00      840     1614
     a       0.26    0.25 0.31 0.32   -0.25    0.78 1.00      759     1530
     r[1]   -0.23   -0.23 0.78 0.75   -1.53    1.09 1.00     3297     2636
     r[2]    1.73    1.67 1.05 1.03    0.16    3.54 1.00     4425     2188
     r[3]    1.74    1.68 1.06 1.02    0.13    3.63 1.00     4100     2308
     r[4]   -3.74   -3.51 1.62 1.51   -6.65   -1.53 1.00     3645     2302
     r[5]   -2.19   -2.11 1.04 0.97   -4.02   -0.63 1.00     3815     2762
     r[6]   -2.21   -2.13 1.07 1.03   -4.08   -0.59 1.00     4072     2888
     r[7]    0.92    0.88 0.85 0.84   -0.39    2.37 1.00     3410     2892
     r[8]   -2.20   -2.10 1.07 1.03   -4.06   -0.63 1.00     3295     2457

 # showing 10 of 203 rows (change via &#39;max_rows&#39; argument or &#39;cmdstanr_max_rows&#39; option)
</code></pre>
</section>
<section>
<h2 id="æŠœç²‹ã—ã¦ä½œå›³æ‚ªããªã„">æŠœç²‹ã—ã¦ä½œå›³ã€‚æ‚ªããªã„ã€‚</h2>
<p>ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã®çœŸã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ã¯ $a = 0.5,~s = 3.0$ ã ã£ãŸã€‚</p>
<pre tabindex="0"><code>Warning: The following arguments were unrecognized and ignored: bins
</code></pre><pre tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre><p><img src="figure/stan-glmm-1.png" alt="plot of chunk stan-glmm"></p>

</section>
<section>
<h2 id="-éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã®ç·´ç¿’å•é¡Œ">ğŸ”° éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã®ç·´ç¿’å•é¡Œ</h2>
<p><a href="6-stan-hbm.ipynb"><code>6-stan-hbm.ipynb</code></a>
ã‚’Jupyterã§é–‹ãã€ã‚¹ãƒ©ã‚¤ãƒ‰èª¬æ˜ã«æ²¿ã£ã¦å®Ÿè¡Œã—ã¦ã„ã“ã†ã€‚</p>
<!-- TODO: æ™‚é–“ãŒä½™ã£ãŸå ´åˆã®ç·´ç¿’å•é¡Œ -->
</section>
<section>
<h2 id="éç·šå½¢å›å¸°ã®ä¾‹-ãƒ‡ãƒ¼ã‚¿">éç·šå½¢å›å¸°ã®ä¾‹: ãƒ‡ãƒ¼ã‚¿</h2>
<p>åˆºæ¿€å¼·åº¦xã«å¯¾ã™ã‚‹å¿œç­”å¼·åº¦yã‚’20å€‹ä½“èª¿æŸ»ã€‚<br>
éå¯¾ç§°ãªã²ã¨å±±ã€‚å¿œç­”å¤‰æ•°ã‚‚èª¬æ˜å¤‰æ•°ã‚‚æ­£ã®å€¤ã€‚</p>
<div>\[\begin{split}
y = ae ^ {-bx} - ce ^ {-dx}
\end{split}\]</div>
<p><img src="figure/non-linear-1.png" alt="plot of chunk non-linear"></p>

</section>
<section>
<h2 id="éç·šå½¢å›å¸°ã®ä¾‹-stanã‚³ãƒ¼ãƒ‰">éç·šå½¢å›å¸°ã®ä¾‹: Stanã‚³ãƒ¼ãƒ‰</h2>
<pre tabindex="0"><code class="language-stan" data-lang="stan">data {
  int&lt;lower=1&gt; N;
  vector[N] x;
  vector[N] y;
  int id[N];
  int&lt;lower=1&gt; Ninds;
}

parameters {
  real&lt;lower=0&gt; a;
  real&lt;lower=0&gt; d;
  real&lt;lower=0,upper=a&gt; c;
  real&lt;lower=0,upper=d&gt; b;
  real shape;
  vector[Ninds] intercept;
}

model {
  vector[N] mu = a * exp(-b * x) - (a - c) * exp(-d * x) + intercept[id];
  y ~ gamma(shape, shape ./ mu);
  a ~ normal(0, 100);
  b ~ normal(0, 100);
  c ~ normal(0, 100);
  d ~ normal(0, 100);
  shape ~ normal(0, 100);
  intercept ~ normal(0, 0.005);
}
</code></pre>
</section>
<section>
<h2 id="éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã®ã»ã‹ã®å¿œç”¨å…ˆ">éšå±¤ãƒ™ã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«ã®ã»ã‹ã®å¿œç”¨å…ˆ</h2>
<ul>
<li>æ™‚ç³»åˆ—ãƒ¢ãƒ‡ãƒ« (çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«)</li>
<li>ç©ºé–“æ§‹é€ ã®ã‚ã‚‹ãƒ¢ãƒ‡ãƒ« (e.g., CARãƒ¢ãƒ‡ãƒ«)</li>
<li>æ¬ æå€¤ã®è£œå®Œ</li>
</ul>

</section>
<section>
<h2 id="ãƒ™ã‚¤ã‚ºæ¨å®šã¾ã¨ã‚">ãƒ™ã‚¤ã‚ºæ¨å®šã¾ã¨ã‚</h2>
<ul>
<li>æ¡ä»¶ä»˜ãç¢ºç‡ $\text{Prob}(B \mid A)$ ã®ç†è§£ãŒå¤§äº‹ã€‚
<ul>
<li>äº‹å¾Œåˆ†å¸ƒ $\propto$ å°¤åº¦ â¨‰ äº‹å‰åˆ†å¸ƒ</li>
<li>ç¢ºä¿¡åº¦åˆã„ã‚’ãƒ‡ãƒ¼ã‚¿ã§æ›´æ–°ã—ã¦ã„ãã€‚</li>
</ul>
</li>
<li>æ¨å®šçµæœã¯åˆ†å¸ƒãã®ã‚‚ã®ã€‚
<ul>
<li>ãã“ã‹ã‚‰ç‚¹æ¨å®šã‚‚åŒºé–“æ¨å®šã‚‚å¯èƒ½ã€‚</li>
</ul>
</li>
<li>è§£æçš„ã«è§£ã‘ãªã„å•é¡Œã¯è¨ˆç®—æ©Ÿã«ä¹±æ•°ã‚’æŒ¯ã‚‰ã›ã¦è§£ãã€‚
<ul>
<li>ç†è«–ãƒ»æŠ€è¡“ã®é€²æ­©ãŒç›®è¦šã¾ã—ã„ã€‚</li>
</ul>
</li>
</ul>

</section>
<section>
<h2 id="å›å¸°åˆ†æãµã‚Šã‹ãˆã‚Š">å›å¸°åˆ†æãµã‚Šã‹ãˆã‚Š</h2>
<p>ã‚ˆã‚ŠæŸ”è»Ÿã«ãƒ¢ãƒ‡ãƒ«ã‚’è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚è¨ˆç®—æ–¹æ³•ã‚‚å¤‰åŒ–ã€‚</p>
<figure>
<a href="https://kuboweb.github.io/-kubo/ce/LinksGlm.html">
<img src="../tokiomarine2021/image/kubo-p2.png" width="100%">
<figcaption class="url">ä¹…ä¿ã•ã‚“ https://kuboweb.github.io/-kubo/ce/LinksGlm.html</figcaption>
</a>
</figure>

</section>
<section>
<h2 id="å…¨ä½“ã¾ã¨ã‚">å…¨ä½“ã¾ã¨ã‚</h2>
<ul>
<li>çµ±è¨ˆã¨ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã†ã¾ãã¾ã¨ã‚ã€ãã‚Œã«åŸºã¥ã„ã¦æ¨è«–ã™ã‚‹ãŸã‚ã®æ‰‹æ³•ã€‚</li>
<li>ãƒ¢ãƒ‡ãƒ«ã«ã¯<strong>ç†è§£å¿—å‘</strong>ã¨<strong>å¿œç”¨å¿—å‘</strong>ãŒã‚ã‚Šã€çµ±è¨ˆãƒ¢ãƒ‡ãƒ«ã¯å‰è€…å¯„ã‚Šã€‚
<ul>
<li>ã©ã¡ã‚‰ã‚‚å¤šå°‘ã¯åˆ†ã‹ã£ãŸä¸Šã§ä½¿ã„åˆ†ã‘ãŸã„ã€‚</li>
<li>ã©ã£ã¡ã«ã—ã‚çœŸã®æ­£ã—ã„ä½•ã‹ã§ã¯ãªã„ã€‚</li>
</ul>
</li>
<li><strong>ç¢ºç‡åˆ†å¸ƒ</strong>ã¨ãã®èƒŒå¾Œã«ã‚ã‚‹<strong>ç¢ºç‡éç¨‹</strong>ã®ç†è§£ãŒé‡è¦ã€‚
<ul>
<li>ä¹±æ•°ç”Ÿæˆâ†’ä½œå›³ã‚’ç¹°ã‚Šè¿”ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ´ã‚‚ã†ã€‚</li>
<li>MCMCã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã‚‚äº‹å¾Œåˆ†å¸ƒã‹ã‚‰ã®ä¹±æ•°ç”Ÿæˆã€‚</li>
</ul>
</li>
</ul>

</section>
<section>
<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2>
<ul>
<li><a href="https://amzn.to/33suMIZ">ãƒ‡ãƒ¼ã‚¿è§£æã®ãŸã‚ã®çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°å…¥é–€</a> ä¹…ä¿æ‹“å¼¥ 2012</li>
<li><a href="https://amzn.to/3uwx7Pb">Stanã¨Rã§ãƒ™ã‚¤ã‚ºçµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°</a> æ¾æµ¦å¥å¤ªéƒ 2016</li>
<li><a href="https://amzn.to/3o1eCzP">Rã¨Stanã§ã¯ã˜ã‚ã‚‹ ãƒ™ã‚¤ã‚ºçµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ†æå…¥é–€</a> é¦¬å ´çœŸå“‰ 2019</li>
<li><a href="https://amzn.to/3uCxTKo">ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã®æ•°ç†ãƒ¢ãƒ‡ãƒ«å…¥é–€</a> æ±Ÿå´è²´è£• 2020</li>
<li><a href="https://amzn.to/3uznzCK">åˆ†æè€…ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è§£é‡ˆå­¦å…¥é–€</a> æ±Ÿå´è²´è£• 2020</li>
<li><a href="https://amzn.to/3ty80Kv">çµ±è¨ˆå­¦ã‚’å“²å­¦ã™ã‚‹</a> å¤§å¡šæ·³ 2020</li>
</ul>
<a href="." class="readmore">
ç›®æ¬¡ã«æˆ»ã‚‹
</a>

</section>
</div>
</div>
<script src="/slides/lib/reveal.js/reveal.js"></script>
<script src="/slides/lib/reveal.js/plugin/notes.js"></script>
<script>
Reveal.initialize({
  width: 960,
  height: 720,
  margin: 0,
  controls: true,
  controlsLayout: 'bottom-right',
  controlsTutorial: false,
  controlsBackArrows: 'faded',
  progress: false,
  slideNumber: 'c/t',
  showSlideNumber: 'all',
  hashOneBasedIndex: true,
  hash: true,
  history: false,
  keyboard: true,
  overview: true,
  center: false,
  touch: true,
  loop: false,
  rtl: false,
  navigationMode: 'linear',
  shuffle: false,
  fragments: true,
  fragmentInURL: true,
  embedded: false,
  help: true,
  showNotes: false,
  autoPlayMedia: null,
  preloadIframes: null,
  mouseWheel: false,
  previewLinks: false,
  transition: 'none',
  transitionSpeed: 'fast',
  backgroundTransition: 'none',
  pdfMaxPagesPerSlide: 1,
  pdfSeparateFragments: false,
  viewDistance: 2,
  plugins: [ RevealNotes ]
});
</script>
<script>
{
const reload_all_img = function() {
  const imgs = document.getElementsByTagName("img");
  for (let i = 0; i < imgs.length; ++i) {
    const src = imgs[i].src;
    imgs[i].src += "?q";
    imgs[i].src = src;
  }
};
const reload_src_element = function(ev) {
  const original_src = ev.srcElement.src;
  ev.srcElement.src += "?q";
  ev.srcElement.src = original_src;
};
const reload_src = function(ev) {
  if (ev.shiftKey || ev.metaKey || ev.altKey) {
    reload_all_img();
  } else {
    reload_src_element(ev);
  }
};
const img_elements = document.getElementsByTagName("img");
for (let i = 0; i < img_elements.length; ++i) {
  img_elements[i].onclick = reload_src;
}
};
</script>
</body>
</html>
