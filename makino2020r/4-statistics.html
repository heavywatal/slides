<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>Statistical analysis with R — Hands-on R Lecture for Makino Lab</title>
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="Statistical analysis with R — Hands-on R Lecture for Makino Lab">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/makino2020r/4-statistics.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-V60H2JH0G6');
</script>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<script type="module">
import { Reveal } from "/slides/lib/reveal.js/reveal.js";
</script>
<style>
html { font-size: 160%; }
</style>
<link rel="stylesheet" href="/slides/lib/katex/katex.min.css">
<script type="module" src="/slides/lib/katex/katex.min.js"></script>
<link rel="stylesheet" href="/slides/lib/iconify.css">
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<link rel="stylesheet" href="/slides/css/style-reveal.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css">
<h1 id="hands-on-introduction-to-r-2020"><a href=".">Hands-on Introduction to R 2020</a></h1>
<div class="author">
岩嵜 航 (Watal M. Iwasaki)
</div>
<div class="affiliation">
東北大学 生命科学研究科 進化ゲノミクス分野
</div>
<ol start="0">
<li><a href="0-why-r.html">Why do we use R?</a>
<li><a href="1-basic-r.html">R basics</a>
<li><a href="2-ggplot.html">Visualization with R</a>
<li><a href="3-tidy-data.html">Tidying and transforming data with R</a>
<li class="current-deck"><a href="4-statistics.html">Statistical analysis with R</a>
</ol>
<div class="footnote">
資料作成協力: 石川由希 (名古屋大学 理学研究科 脳回路構造学 講師)<br>
2020-06-03
</div>

</section>
<section>
<h2 id="todays-topic">Today&rsquo;s topic</h2>
<ul>
<li><strike>Theoretical background of statistical analysis</strike></li>
<li>How to perform statistical analysis with R</li>
</ul>
<p><br><br>
Launch RStudio, and load <code>tidyverse</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="relationship-between-cty-燃費--displ-排気量">Relationship between <code>cty</code> (燃費) &amp; <code>displ</code> (排気量)?</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span>
</span></span></code></pre></div><p><img src="figure/plot-displ-cty-1.png" alt="plot of chunk plot-displ-cty"></p>
</section>
<section>
<h2 id="basic-form">Basic form</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Get the result as an object</span>
</span></span><span class="line"><span class="cl"><span class="n">formula</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">~</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl"><span class="n">model_object</span> <span class="o">=</span> <span class="nf">model_function</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">MYDATA</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># View its summary</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">model_object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get the estimated coefficients</span>
</span></span><span class="line"><span class="cl"><span class="nf">coef</span><span class="p">(</span><span class="n">model_object</span><span class="p">)</span>
</span></span></code></pre></div><p>where</p>
<ul>
<li><code>DATA</code>: data.frame, e.g., <code>iris</code>, <code>diamonds</code>, <strong><code>mpg</code></strong></li>
<li><code>Y</code>: response variable (a column in <code>DATA</code>), e.g., <strong><code>cty</code></strong></li>
<li><code>X</code>: explanatory variable (a column in <code>DATA</code>), e.g., <strong><code>displ</code></strong></li>
</ul>
</section>
<section>
<h2 id="general-linear-model-一般線形モデル">General Linear Model (一般線形モデル)</h2>
<p>Estimates the coefficients (係数) and intercept (切片).<br></p>
<p>$\text{cty} = - 2.63 \times \text{displ} + 25.99$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Call:
## lm(formula = cty ~ displ, data = mpg)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.3109 -1.4695 -0.2566  1.1087 14.0064 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  25.9915     0.4821   53.91   &lt;2e-16 ***
## displ        -2.6305     0.1302  -20.20   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.567 on 232 degrees of freedom
## Multiple R-squared:  0.6376,	Adjusted R-squared:  0.6361 
## F-statistic: 408.2 on 1 and 232 DF,  p-value: &lt; 2.2e-16
</code></pre>
</section>
<section>
<h2 id="general-linear-model-一般線形モデル">General Linear Model (一般線形モデル)</h2>
<p>Estimates the coefficients (係数) and intercept (切片).<br></p>
<p>$\text{cty} = - 2.63 \times \text{displ} + 25.99$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="nf">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="n">[[1]]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nf">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="n">[[2]]</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;blue&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/lm-abline-1.png" alt="plot of chunk lm-abline"></p>

</section>
<section>
<h2 id="general-linear-model-一般線形モデル">General Linear Model (一般線形モデル)</h2>
<p>Estimates the coefficients (係数) and intercept (切片).<br></p>
<p>$\text{cty} = - 2.63 \times \text{displ} + 25.99$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Y</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;blue&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/lm-predict-1.png" alt="plot of chunk lm-predict"></p>

</section>
<section>
<h2 id="general-linear-model-一般線形モデル">General Linear Model (一般線形モデル)</h2>
<p>Estimates the coefficients (係数) and intercept (切片).<br></p>
<p>$\text{cty} = - 2.63 \times \text{displ} + 25.99$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stat_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">lm</span><span class="p">,</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">y</span> <span class="o">~</span> <span class="n">x</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/lm-smooth-1.png" alt="plot of chunk lm-smooth"></p>

</section>
<section>
<h2 id="generalized-linear-model-一般化線形モデル">General<u>ized</u> Linear Model (一般<u>化</u>線形モデル)</h2>
<div>\[\begin{aligned}
\text{link}(Y) &= c_0 + c_1 x_1 + c_2 x_2 + \ldots + \epsilon \\
\epsilon &\sim \text{error}(\ldots)
\end{aligned}\]</div>
<ul>
<li><code>formula</code>: linear predictor (線形予測子), e.g., <code>cty ~ displ</code></li>
<li><code>family</code>: error structure (誤差構造), e.g., <code>gaussian</code>, <code>poisson</code>, <code>Gamma</code></li>
<li><code>link</code>: link function (リンク関数), e.g., <code>&quot;identity&quot;</code>, <code>&quot;log&quot;</code>, <code>&quot;inverse&quot;</code></li>
</ul>
<p>LM is a special case of GLM:<br>
<code>glm(..., family = gaussian(&quot;identity&quot;))</code></p>
</section>
<section>
<h2 id="generalized-linear-model-一般化線形モデル">General<u>ized</u> Linear Model (一般<u>化</u>線形モデル)</h2>
<p>$\log(\text{cty}) = -0.0155 \times \text{displ} + 3.344 + \epsilon$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="nf">Gamma</span><span class="p">(</span><span class="n">link</span> <span class="o">=</span> <span class="s">&#34;log&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Call:
## glm(formula = cty ~ displ, family = Gamma(link = &#34;log&#34;), data = mpg)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.40399  -0.08744  -0.01253   0.07447   0.55328  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.344162   0.027644  120.97   &lt;2e-16 ***
## displ       -0.155497   0.007464  -20.83   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Gamma family taken to be 0.02166931)
## 
##     Null deviance: 14.4350  on 233  degrees of freedom
## Residual deviance:  4.8065  on 232  degrees of freedom
## AIC: 1069.3
## 
## Number of Fisher Scoring iterations: 5
</code></pre>
</section>
<section>
<h2 id="generalized-linear-model-一般化線形モデル">General<u>ized</u> Linear Model (一般<u>化</u>線形モデル)</h2>
<p>$\log(\text{cty}) = -0.0155 \times \text{displ} + 3.344 + \epsilon$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="nf">exp</span><span class="p">(</span><span class="nf">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">))),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;blue&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/glm-gamma-log-plot-1.png" alt="plot of chunk glm-gamma-log-plot"></p>

</section>
<section>
<h2 id="generalized-linear-model-一般化線形モデル">General<u>ized</u> Linear Model (一般<u>化</u>線形モデル)</h2>
<p>$(\text{cty})^{-1} = 0.010 \times \text{displ} + 0.027 + \epsilon$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="nf">Gamma</span><span class="p">(</span><span class="n">link</span> <span class="o">=</span> <span class="s">&#34;inverse&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Call:
## glm(formula = cty ~ displ, family = Gamma(link = &#34;inverse&#34;), 
##     data = mpg)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.38558  -0.08389  -0.01432   0.06985   0.51518  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.026528   0.001471   18.04   &lt;2e-16 ***
## displ       0.010207   0.000461   22.14   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Gamma family taken to be 0.01922307)
## 
##     Null deviance: 14.4350  on 233  degrees of freedom
## Residual deviance:  4.3425  on 232  degrees of freedom
## AIC: 1045.5
## 
## Number of Fisher Scoring iterations: 4
</code></pre>
</section>
<section>
<h2 id="generalized-linear-model-一般化線形モデル">General<u>ized</u> Linear Model (一般<u>化</u>線形モデル)</h2>
<p>$(\text{cty})^{-1} = 0.010 \times \text{displ} + 0.027 + \epsilon$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="m">1</span> <span class="o">/</span> <span class="nf">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;blue&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/glm-gamma-inverse-plot-1.png" alt="plot of chunk glm-gamma-inverse-plot"></p>

</section>
<section>
<h2 id="non-linear-least-square-非線形最小二乗法">Non-linear Least-Square (非線形最小二乗法)</h2>
<p>$\text{cty} = {28.7} / {\text{displ}} + 7.33$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">nls</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">k</span> <span class="o">/</span> <span class="n">displ</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="m">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Formula: cty ~ k/displ + b
## 
## Parameters:
##   Estimate Std. Error t value Pr(&gt;|t|)    
## k  28.7243     1.2000   23.94   &lt;2e-16 ***
## b   7.3309     0.4253   17.24   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.29 on 232 degrees of freedom
## 
## Number of iterations to convergence: 1 
## Achieved convergence tolerance: 7.471e-09
</code></pre>
</section>
<section>
<h2 id="non-linear-least-square-非線形最小二乗法">Non-linear Least-Square (非線形最小二乗法)</h2>
<p>$\text{cty} = {28.7} / {\text{displ}} + 7.33$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">cty</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;blue&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/nls-plot-1.png" alt="plot of chunk nls-plot"></p>

</section>
<section>
<h2 id="model-comparison">Model comparison</h2>
<p>There are many statistics, e.g., AIC, BIC, WAIC, etc.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit1</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="c1">#family = gaussian(&#34;identity&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">fit2</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="nf">Gamma</span><span class="p">(</span><span class="n">link</span> <span class="o">=</span> <span class="s">&#34;log&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">fit3</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="nf">Gamma</span><span class="p">(</span><span class="n">link</span> <span class="o">=</span> <span class="s">&#34;inverse&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">fit4</span> <span class="o">=</span> <span class="nf">nls</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">k</span> <span class="o">/</span> <span class="n">displ</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="m">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">AIC</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span> <span class="n">fit2</span><span class="p">,</span> <span class="n">fit3</span><span class="p">,</span> <span class="n">fit4</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>##      df      AIC
## fit1  3 1109.336
## fit2  3 1069.301
## fit3  3 1045.469
## fit4  3 1055.754
</code></pre>
</section>
<section>
<h2 id="model-comparison">Model comparison</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">full_model</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">cty</span> <span class="o">~</span> <span class="n">displ</span> <span class="o">+</span> <span class="n">cyl</span> <span class="o">+</span> <span class="n">drv</span> <span class="o">+</span> <span class="n">class</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="nf">Gamma</span><span class="p">(</span><span class="n">link</span> <span class="o">=</span> <span class="s">&#34;inverse&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">stepAIC</span><span class="p">(</span><span class="n">full_model</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Start:  AIC=943.41
## cty ~ displ + cyl + drv + class
## 
##         Df Deviance    AIC
## &lt;none&gt;       2.6029 943.41
## - displ  1   2.6322 943.90
## - drv    2   2.7778 954.27
## - cyl    1   2.9533 971.19
## - class  6   3.1371 976.80
## 
## Call:  glm(formula = cty ~ displ + cyl + drv + class, family = Gamma(link = &#34;inverse&#34;), 
##     data = mpg)
## 
## Coefficients:
##     (Intercept)            displ              cyl             drvf  
##        0.018435         0.002071         0.004419        -0.005448  
##            drvr     classcompact     classmidsize     classminivan  
##       -0.001596         0.010735         0.011227         0.017691  
##     classpickup  classsubcompact         classsuv  
##        0.019051         0.008377         0.016891  
## 
## Degrees of Freedom: 233 Total (i.e. Null);  223 Residual
## Null Deviance:	    14.43 
## Residual Deviance: 2.603 	AIC: 943.4
</code></pre>
</section>
<section>
<h2 id="tidymodels-meta-package"><code>tidymodels</code> meta-package</h2>
<p>For modeling and statistical analysis that share the underlying design philosophy, grammar, and data structures of the tidyverse.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;tidymodels&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidymodels</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li><a href="https://broom.tidyverse.org/"><code>broom</code></a></li>
<li><a href="https://dplyr.tidyverse.org"><code>dplyr</code></a></li>
<li><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a></li>
<li><a href="https://infer.netlify.com/"><code>infer</code></a></li>
<li><a href="https://purrr.tidyverse.org"><code>purrr</code></a></li>
<li><a href="https://tidymodels.github.io/recipes/"><code>recipes</code></a></li>
<li><a href="https://tidymodels.github.io/rsample/"><code>rsample</code></a></li>
<li><a href="https://tibble.tidyverse.org"><code>tibble</code></a></li>
<li><a href="https://tidymodels.github.io/yardstick/"><code>yardstick</code></a></li>
</ul>
</section>
<section>
<h2 id="broom-package"><code>broom</code> package</h2>
<p>Transfroms the messy output of R stats functions to tidy data.frames.</p>
<p><a href="https://broom.tidyverse.org/articles/available-methods.html">Available methods</a></p>

</section>
<section>
<h2 id="extract-results-from-fit">Extract results from <code>fit</code></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">Sepal.Width</span> <span class="o">~</span> <span class="n">Petal.Length</span> <span class="o">+</span> <span class="n">Petal.Width</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">iris</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Call:
## lm(formula = Sepal.Width ~ Petal.Length + Petal.Width, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.06198 -0.23389  0.01982  0.20580  1.13488 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.58705    0.09373  38.272  &lt; 2e-16 ***
## Petal.Length -0.25714    0.06691  -3.843  0.00018 ***
## Petal.Width   0.36404    0.15496   2.349  0.02014 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3893 on 147 degrees of freedom
## Multiple R-squared:  0.2131,	Adjusted R-squared:  0.2024 
## F-statistic:  19.9 on 2 and 147 DF,  p-value: 2.238e-08
</code></pre>
</section>
<section>
<h2 id="extract-results-from-fit">Extract results from <code>fit</code></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">Sepal.Width</span> <span class="o">~</span> <span class="n">Petal.Length</span> <span class="o">+</span> <span class="n">Petal.Width</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">iris</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">tidy</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## # A tibble: 3 x 5
##   term         estimate std.error statistic  p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)     3.59     0.0937     38.3  2.51e-78
## 2 Petal.Length   -0.257    0.0669     -3.84 1.80e- 4
## 3 Petal.Width     0.364    0.155       2.35 2.01e- 2
</code></pre>
</section>
<section>
<h2 id="tests-仮説検定">Tests 仮説検定</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">chisq.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">fisher.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">kruskal.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">ks.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">t.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">var.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">wilcox.test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># etc.</span>
</span></span></code></pre></div><p>See <a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/00Index.html"><code>stats</code> package</a> for more details.</p>
</section>
<section>
<h2 id="probability-distributions-確率分布">Probability distributions 確率分布</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 確率密度関数 (PDF)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dnorm</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1.96</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.39894228 0.05844094
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 累積分布関数 (CDF)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pnorm</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1.96</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.5000000 0.9750021
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 累積分布関数の逆関数</span>
</span></span><span class="line"><span class="cl"><span class="nf">qnorm</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="m">0.975</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.000000 1.959964
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 乱数生成</span>
</span></span><span class="line"><span class="cl"><span class="nf">rnorm</span><span class="p">(</span><span class="m">4</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] -0.2561510  0.5834819  0.4735194 -1.8780212
</code></pre>
</section>
<section>
<h2 id="計算機の限界に注意">計算機の限界に注意</h2>
<p><code>1 - pnorm(...)</code>や<code>log(pnorm(...))</code>のほうが直感的に分かりやすいので、
<code>lower.tail = FALSE</code>や<code>log.p = TRUE</code>は不要なようにも思われるが、
これらの引数で内部処理させたほうが浮動小数点型の限界付近での計算が正確。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># complementary</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> <span class="o">-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>                  <span class="c1"># 0</span>
</span></span><span class="line"><span class="cl"><span class="nf">pnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">lower.tail</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>  <span class="c1"># 7.619853e-24</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># log</span>
</span></span><span class="line"><span class="cl"><span class="nf">log</span><span class="p">(</span><span class="nf">pnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>                 <span class="c1"># 0</span>
</span></span><span class="line"><span class="cl"><span class="nf">pnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">log.p</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>        <span class="c1"># -7.619853e-24</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="discrete-離散">Discrete 離散</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">_binom</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_geom</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_hyper</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_nbinom</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_pois</span><span class="p">(</span><span class="n">lambda</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_signrank</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_wilcox</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="continuous-連続">Continuous 連続</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">_beta</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_cauchy</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_chisq</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_exp</span><span class="p">(</span><span class="n">rate</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_f</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_gamma</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">rate</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="m">1</span> <span class="o">/</span> <span class="n">rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_lnorm</span><span class="p">(</span><span class="n">meanlog</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">sdlog</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_logis</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_norm</span><span class="p">(</span><span class="n">mean</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_t</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_unif</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">_weibull</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="reference">Reference</h2>
<p><a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/00Index.html"><code>stats</code> package</a></p>
<p><a href="https://github.com/tidymodels/tidymodels"><code>tidymodels</code></a></p>
<p><a href="https://broom.tidyverse.org/"><code>broom</code></a></p>
<p><a href="http://caret.r-forge.r-project.org/"><code>caret</code> package</a>
for machine learning</p>
<p><a href="https://mc-stan.org/rstan/"><code>stan</code> package</a>
for Bayesian modeling and inference.</p>
<a href="./" class="readmore">
目次に戻る
</a>

</section>
<section>
<h2 id="牧野研輪読会-補遺">牧野研輪読会 補遺</h2>
<p><a href="https://amzn.to/2TpZFJv">&ldquo;RとStanではじめる ベイズ統計モデリングによるデータ分析入門&rdquo;</a>
第2部 第1&ndash;3章</p>
</section>
<section>
<h2 id="ts-time-series-時系列型"><code>ts</code>: time series (時系列型)</h2>
<p><span style="float: right">2.1.13</span></p>
<p><code>vector</code> with labels and print format.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">timeser</span> <span class="o">=</span> <span class="nf">ts</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2020</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> <span class="n">freq</span> <span class="o">=</span> <span class="m">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">timeser</span>
</span></span></code></pre></div><pre tabindex="0"><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 2020                   A   B   C   D   E   F   G   H
## 2021   I   J   K   L   M   N   O   P   Q   R   S   T
## 2022   U   V   W   X   Y   Z
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">is</span><span class="p">(</span><span class="n">timeser</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] &#34;ts&#34;        &#34;structure&#34; &#34;oldClass&#34;  &#34;vector&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">is.character</span><span class="p">(</span><span class="n">timeser</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] TRUE
</code></pre>
</section>
<section>
<h2 id="random-number-generator-乱数生成器">Random Number Generator (乱数生成器)</h2>
<p><span style="float: right">2.1.15</span></p>
<p><code>r</code> + 分布の名前 + <code>(length, parameters, ...)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">24601</span><span class="p">)</span>  <span class="c1"># 乱数シードをセット</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 平均50、標準偏差10の正規分布から5個生成</span>
</span></span><span class="line"><span class="cl"><span class="nf">rnorm</span><span class="p">(</span><span class="m">5L</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="m">50</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 47.43849 55.83482 54.73519 31.21979 47.25679
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># もう1回実行すると違う結果</span>
</span></span><span class="line"><span class="cl"><span class="nf">rnorm</span><span class="p">(</span><span class="m">5L</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="m">50</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 43.63798 52.56991 47.42713 37.70879 17.77750
</code></pre><dl>
<dt>疑似乱数</dt>
<dd>内部状態に依存して<strong>決定論的に</strong>生成される数列。</dd>
<dd><strong>乱数シード</strong>は、内部状態を指定する「復活の呪文🏰」</dd>
</dl>

</section>
<section>
<h2 id="random-number-generator-乱数生成器">Random Number Generator (乱数生成器)</h2>
<p><span style="float: right">2.1.15</span></p>
<p>内部状態が同じなら、生成される乱数も同じ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">24601</span><span class="p">)</span>  <span class="c1"># 内部状態をリセット</span>
</span></span><span class="line"><span class="cl"><span class="nf">rnorm</span><span class="p">(</span><span class="m">5L</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># 生成するときに内部状態が変化するけど</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] -0.2561510  0.5834819  0.4735194 -1.8780212 -0.2743209
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">24601</span><span class="p">)</span>  <span class="c1"># 内部状態をリセット</span>
</span></span><span class="line"><span class="cl"><span class="nf">rnorm</span><span class="p">(</span><span class="m">5L</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># 同じ結果</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] -0.2561510  0.5834819  0.4735194 -1.8780212 -0.2743209
</code></pre><p>シミュレーションや解析に再現性を求める場合は設定必須。<br>
(どんなシードでも同じ結論になる、が理想ではあるけど)</p>
<p>「ほしい結果が出るような乱数シードを探す」
とかやっちゃ<strong>ダメ絶対‼️</strong></p>

</section>
<section>
<h2 id="for-loop">For-loop</h2>
<p><span style="float: right">2.1.16</span></p>
<p>Rではほぼ使わないけど、この教科書では使いたいらしい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kr">for</span> <span class="p">(</span><span class="n">i</span> <span class="kr">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 1
## [1] 2
## [1] 3
</code></pre>
</section>
<section>
<h2 id="histogram">Histogram</h2>
<p><span style="float: right">2.2.2</span></p>
<p>連続値をいくつかのbinに区切って数えたもの</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="m">40L</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/histogram-1.png" alt="plot of chunk histogram"></p>

</section>
<section>
<h2 id="kernel-density-estimation-カーネル密度推定">Kernel Density Estimation (カーネル密度推定)</h2>
<p><span style="float: right">2.2.3</span></p>
<p>ヒストグラムを正規分布で滑らかにしたもの</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_rug</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_density</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_density</span><span class="p">(</span><span class="n">adjust</span> <span class="o">=</span> <span class="m">1</span> <span class="o">/</span> <span class="m">4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;red&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_density</span><span class="p">(</span><span class="n">adjust</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;blue&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/kde-1.png" alt="plot of chunk kde"></p>

</section>
<section>
<h2 id="summary-statistics-要約統計量">Summary Statistics (要約統計量)</h2>
<p><span style="float: right">2.2.4, 5</span></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 平均値: 普通の算術平均。tailに引っ張られる。</span>
</span></span><span class="line"><span class="cl"><span class="nf">mean</span><span class="p">(</span><span class="n">diamonds[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 3932.8
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 中央値: 順位で真ん中にある値。</span>
</span></span><span class="line"><span class="cl"><span class="nf">median</span><span class="p">(</span><span class="n">diamonds[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 2401
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 四分位点: 上位・下位25%にある値。</span>
</span></span><span class="line"><span class="cl"><span class="nf">quantile</span><span class="p">(</span><span class="n">diamonds[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span> <span class="m">0.75</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>##     25%     75% 
##  950.00 5324.25
</code></pre>
</section>
<section>
<h2 id="correlation-相関">Correlation (相関)</h2>
<p><span style="float: right">2.2.6</span></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Covariance (共分散) &gt; 0 なら、</span>
</span></span><span class="line"><span class="cl"><span class="c1"># carat が大きくなるほど price も大きくなる</span>
</span></span><span class="line"><span class="cl"><span class="nf">cov</span><span class="p">(</span><span class="n">diamonds[[</span><span class="s">&#34;carat&#34;</span><span class="n">]]</span><span class="p">,</span> <span class="n">diamonds[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 1742.765
</code></pre><p>↑この値だけ見てもその度合いは想像しにくいので、<br>
値が [-1, 1] になるように正規化したものが相関係数↓</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">cor</span><span class="p">(</span><span class="n">diamonds[[</span><span class="s">&#34;carat&#34;</span><span class="n">]]</span><span class="p">,</span> <span class="n">diamonds[[</span><span class="s">&#34;price&#34;</span><span class="n">]]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 0.9215913
</code></pre><p>結構強い相関だな。</p>

</section>
<section>
<h2 id="autocorrelation-自己相関">Autocorrelation (自己相関)</h2>
<p><span style="float: right">2.2.7</span></p>
<p>時系列データにおいて、n時点前の値との相関を取ったもの。<br>
1次の自己相関 = 1時点前との相関</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ac</span> <span class="o">=</span> <span class="nf">acf</span><span class="p">(</span><span class="n">Nile</span><span class="p">,</span> <span class="n">lag.max</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">ac</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="n">acf</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_col</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">n.breaks</span> <span class="o">=</span> <span class="m">10L</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/acf-1.png" alt="plot of chunk acf"></p>

</section>
</div>
</div>
</body>
</html>
