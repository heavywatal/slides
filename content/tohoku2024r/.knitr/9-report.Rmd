```{r, setup-common}
#| file: "setup.R"
#| echo: false
#| results: "asis"
```
```{r, setup-local}
#| include: false
#| cache: false
knitr::knit_exit()
```

---
## 最終日のお品書き

- 13:00 ここまでのおさらい、レポートについて、など
- 13:10 **班で打ち合わせ 40分**
- 13:50 1週目(**発表5分 + 質疑応答3分**) x 8班
- 15:00 休憩、雑談 20分
- 15:20 2週目(**発表5分 + 質疑応答3分**) x 8班
- 16:30 講評: 牧野能士教授
- 解散、質疑応答


---
## Rコードの実行結果をとっておきたい

スクリプト.Rさえ保存しておけばいつでも実行できるけど... **面倒**

`ggsave()` で画像を書き出しておけるけど... **どのコードの結果か分からない**

→ **スクリプトと実行結果を一緒に見渡せる形式**が欲しい。

```{r, hello}
#| results: "hold"
#| fig.show: "hold"
#| fig.height: 3.5
#| fig.width: 5
3 * 14
ggplot(mpg) + aes(displ, hwy) + geom_point(aes(color = drv))
```


---
## Quarto Document として研究ノートを作る

<a href="https://quarto.org/">
<img src="/_img/hex-stickers/quarto.webp" width="160" align="right">
</a>

プログラミングからレポート作成まで一元管理できて楽ちん。

- 本文とRコードを含むテキストファイル.qmdを作る。
- HTML, PDFなどリッチな形式に変換して読む。
  - コードだけでなく実行結果の**図**や**表**も埋め込める。

<hr>

<a href="https://rmarkdown.rstudio.com/">
<img src="/_img/hex-stickers/rmarkdown.webp" width="160" align="right">
</a>

Quarto Markdown (`.qmd`)
: **Markdown**亜種。RやPythonのコードと図表を埋め込める。
: Quarto登場前にほぼR専用だった `.Rmd` と使い勝手は同じ。

Markdown (`.md`)
: 最もよく普及している**軽量マークアップ言語**のひとつ。
: 微妙に異なる方言がある。qmdで使うのは Pandoc Markdown 。

(どんなものが作れるのか
[作成例ギャラリー](https://quarto.org/docs/gallery/)
を見てみよう。)

---
## マークアップ言語

文書の構造や視覚的修飾を記述するための言語。<br>
e.g., **HTML**+CSS, XML, LaTeX

```html
<h3>見出し3</h3>
<p>ここは段落。
<em>強調(italic)</em>、
<strong>強い強調(bold)</strong>、
<a href="https://www.lifesci.tohoku.ac.jp/">リンク</a>とか。
</p>
```

<div style="border: solid 1px #888888; padding: 0 4px;">
<h3>見出し3</h3>
<p>ここは段落。
<em>強調(italic)</em>、
<strong>強い強調(bold)</strong>、
<a href="https://www.lifesci.tohoku.ac.jp/">リンク</a>とか。
</p>
</div>

表現力豊かで強力だが人間が読み書きするには複雑すぎ、機械寄り。

(好きなウェブサイトのHTMLソースコードを見てみよう。)


---
## 軽量マークアップ言語

**マークアップ言語**の中でも人間が読み書きしやすいもの。<br>
e.g., **Markdown**, reStructuredText, 各種Wiki記法など

```md
### 見出し3

ここは段落。
*強調(italic)*、
**強い強調(bold)**、
[リンク](https://www.lifesci.tohoku.ac.jp/)とか。
```

<div style="border: solid 1px #888888; padding: 0 4px;">
<h3>見出し3</h3>
<p>ここは段落。
<em>強調(italic)</em>、
<strong>強い強調(bold)</strong>、
<a href="https://www.lifesci.tohoku.ac.jp/">リンク</a>とか。
</p>
</div>


---
## Quartoする環境は既に整っているはず

```{r, versions}
#| include: false
R_version = paste(R.version$major, R.version$minor, sep = ".")
pkg_versions = installed.packages()[, "Version"]
RStudio_version = system2("/Applications/RStudio.app/Contents/MacOS/RStudio", "--version", stdout = TRUE)
# quarto_version = system2("quarto", "--version", stdout = TRUE)
```

- **R (≥ `r R_version`)**: 最新版 – 0.1 くらいまでが許容範囲
- **RStudio (≥ `r RStudio_version`)**: Quarto CLI を同梱
- **tidyverse (≥ `r pkg_versions["tidyverse"]`)**: 次の2つを自動インストール
  - rmarkdown (≥ `r pkg_versions["rmarkdown"]`)
  - knitr (≥ `r pkg_versions["knitr"]`)

(示してあるバージョンは最低要件ではなく私の現在の環境の)

<hr>

- [Quarto CLI](https://quarto.org/docs/get-started/):
  最新版を求めるなら手動で入れる。
- [`install.packages("quarto")`](https://github.com/quarto-dev/quarto-r):
  多くの人には不要。
  Quarto CLIをRコマンドで呼べるようにするだけ。
- [pandoc](https://pandoc.org/): Quarto CLI に同梱。
  手動で最新版を入れてもRStudio+Quartoがそれを使うかは不明。

---
## Markdown記法で書いてみよう

1. RStudio > New File > Markdown File
   <img src="/slides/image/rstudio/new-markdown.png" width="60%">
1. ["markdown 記法"で検索](https://duckduckgo.com/?q=markdown+syntax)して何か書く。
   最低限、次の概念を含むように:
   - 見出し1, 2, 3
   - コードブロック、インラインコード
   - 箇条書き (番号あり・なし)
1. <kbd>Preview</kbd>ボタンで確認

---
## Quarto Document を作ってみよう

RStudio > New File > Quarto Document...<br>
(DocumentとHTMLを選択し、)タイトルと著者を埋めて、OK。

<img src="/slides/image/rstudio/new-quarto-document.png" width="100%">

---
## 普通のmdには無いqmdの特徴

ヘッダー (フロントマター)
: 最上部の `---` で挟まれた部分。
  文書全体に関わるメタデータを入力。
: オプションは出力形式によって異なる。
  e.g., [`html`](https://quarto.org/docs/output-formats/html-basics.html)

R code chunk
: `` ```{r} `` のように始まるコードブロック。
: コードの実行結果を最終産物に埋め込める。
: [オプションがいろいろある](https://quarto.org/docs/computations/execution-options.html)。e.g.,
  - `echo: false`: コードを非表示。結果は表示。
  - `eval: false`: コードを実行せず表示だけ。
  - `include: false`: コードも結果も表示せず、実行だけする。
  - `fig.width: 7`, `fig.height: 7`: 図の大きさを制御。

まあ細かいことは必要になってから調べるとして...

---
## qmdをHTMLに変換してみよう

左のqmdを "→Render" すると右のができる。手順は次スライド。

<div>
<img src="/slides/image/rstudio/quarto-viewer.png" width="100%">
</div>

---
## qmdをHTMLに変換してみよう

1. ソースコードに名前をつけて保存 <kbd>command</kbd><kbd>s</kbd><br>
   e.g., `report.qmd`
1. ⚙️ ボタンから "Preview in Viewer Pane" を選択。
1. "→Render" を押す。
   - 埋め込まれたRコードが実行される。
   - 実行結果を含むMarkdownが作られる。
   - MarkdownからHTMLに変換される。 e.g., `report.html`
   - プレビューが自動的に開く。
1. 編集 → 保存 → Render を繰り返して作り込む。


---
## レポートの体裁の例

左のようなqmdを作ってRenderし、右のようなHTMLファイルを提出。

<div>
<img src="../tohoku2023r/image/report-example.webp" width="90%"></img>
</div>


---
## 🔰 レポート (締切: 2024-05-13)

- 課題: 講義資料の🔰若葉マークすべて。
- 様式: Quarto Markdownで書き、Render済みHTMLを提出。
  - 1日分で1ファイル、それぞれClassroomトピックに提出。計4つ。
  - `{ID}-{name}-day{d}.html`, e.g., `C0SB0000-iwasaki-day2.html`
  - `embed-resources: true` で画像などを埋め込んだ独立HTML。
- 評価ポイント
  - エラーも警告も無くコードが走る。
  - 文書の構造や図が視覚的に見やすく整理されている。
  - 半年後の自分が読んでわかるような `# 親切コメント`。
- 手抜きポイント
  - 生物学的な意義があるか、みたいなのはほぼ不問。


---
## Lightning Talk (LT)

発表者として
: 短い持ち時間で言いたいことを言う。
: うまく情報を絞って整理する必要がある。

聴衆として
: 自分が理解していない部分を探す。
: 必ず**1つは質問するつもり**で聞く。できれば実際にする。

<br>
<hr>

<p><aside style="color: #999999;">受講生から質問が出なければTAがする。</aside></p>


---
## 🔰 レポートについては初日後半の資料を参照

<iframe width="1200" height="900" src="./2-visualization.html#/64"></iframe>


---
## 🔰 最終日のレポートに書いてほしいこと追加

この講義を改善するためのコメントをひとつ以上。

- ここがわかりにくかった。
- ここで躓いた。
- ここがツラすぎた。
- ここは良かった。

褒めても貶しても加点・減点しません。<br>
後輩たちのために、忌憚なき意見をよろしくお願いします。


---
## この実習でやったこと

✅ 生物学研究にはデータとモデルが必須だと認識

✅ 再現可能な解析を楽にやりたい気持ちになる

✅ 必要な方法を調べ、実践する力をつける

✅ データ解析の基本に触れる

⬜ Rで困ったときに参照できるレポートが手元に残る

<br>
個々の方法は覚えなくても大丈夫！<br>
<strong>忘れては調べ、を何度も繰り返しながら染み込ませていこう。</strong>

今はまだ完全に飲み込めなくても、
**班員と協力して**レポートを提出しよう。

<a href="." class="readmore">
目次に戻る
</a>
