+++
url = "tmd2020/6-practice.html"
title = "6. å®Ÿè·µ â€” Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’ 2020"
linktitle = "å®Ÿè·µ: ç¾å®Ÿã®å•é¡Œã«å¯¾å‡¦ã—ã¦ã¿ã‚‹"
date = 2020-10-17T14:40:00+09:00
type = "reveal"
draft = false
+++


# [Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’2020](.)

<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki, PhD)
</div>

<div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡ ç‰¹ä»»åŠ©æ•™<br>
(Graduate School of Life Sciences, Tohoku University)
</div>

<ol>
<li><a href="1-introduction.html">å…¥é–€1: å‰å‡¦ç†ã¨ã¯ã€‚Rã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã€‚Rã®åŸºæœ¬ã€‚</a>
<li><a href="2-visualization.html">å…¥é–€2: ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã®é‡è¦æ€§ã¨æ–¹æ³•ã€‚</a>
<li><a href="3-structure1.html">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‡¦ç†1: æŠ½å‡ºã€é›†ç´„ãªã©ã€‚</a>
<li><a href="4-structure2.html">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‡¦ç†2: çµåˆã€å¤‰å½¢ãªã©ã€‚</a>
<li><a href="5-content.html">ãƒ‡ãƒ¼ã‚¿å†…å®¹ã®å‡¦ç†: æ•°å€¤ã€æ–‡å­—åˆ—ã€æ—¥æ™‚ãªã©ã€‚</a>
<li class="current-deck"><a href="6-practice.html">å®Ÿè·µ: ç¾å®Ÿã®å•é¡Œã«å¯¾å‡¦ã—ã¦ã¿ã‚‹ã€‚</a>
</ol>

<div class="footnote">
2020-10-17 æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§å­¦ M&Dã‚¿ãƒ¯ãƒ¼ æƒ…å ±æ¤œç´¢å®¤1
<a href="https://heavywatal.github.io/slides/tmd2020/">https://heavywatal.github.io/slides/tmd2020/</a>
</div>





---
## æœ€çµ‚å›: å®Ÿè·µã—ã¦ã¿ã‚ˆã†

1. ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ç’°å¢ƒã®æ•´å‚™
1. ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã€èª­ã¿è¾¼ã¿
1. æ¢ç´¢çš„ãƒ‡ãƒ¼ã‚¿è§£æ
    - **å‰å‡¦ç†ã€åŠ å·¥** (åœ°å‘³ã€‚æ„å¤–ã¨é‡ã„) ğŸ‘ˆæœ¬å®Ÿç¿’ã®ä¸»é¡Œ
    - å¯è¦–åŒ–ã€ä»®èª¬ç”Ÿæˆ (æ´¾æ‰‹ï¼ã ã„ã˜ï¼)
    - çµ±è¨ˆè§£æã€ä»®èª¬æ¤œè¨¼ (ã¿ã‚“ãªå‹‰å¼·ã—ãŸãŒã‚‹)
1. å ±å‘Šã€ç™ºè¡¨

<figure>
<a href="https://r4ds.had.co.nz/introduction.html">
<img src="/slides/image/r4ds/data-science.png">
<figcaption class="url">https://r4ds.had.co.nz/introduction.html</figcaption>
</a>
</figure>


---
## å¥½ããªãƒ‡ãƒ¼ã‚¿ã‚’ã„ã˜ãã‚Šå€’ã—ã¦ã¿ã‚ˆã†

- è‡ªåˆ†ãŒã“ã‚Œã‹ã‚‰è§£æã—ãŸã„ãƒ‡ãƒ¼ã‚¿ (ã‚‚ã—æ‰‹å…ƒã«ã‚ã‚Œã°)
- Rã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä»˜å±ã®ãƒ‡ãƒ¼ã‚¿ (ã®ã†ã¡tidyã˜ã‚ƒãªã„ã‚‚ã®)
    - `VADeath`, `anscombe`, `economics`
- ä½•ã‹é©å½“ãªãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
    - [data.go.jp](https://www.data.go.jp/data/dataset?res_format=CSV): ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã‚µã‚¤ãƒˆ
    - [IT DASHBOARD](https://www.itdashboard.go.jp/Statistics/opendata): å†…é–£å®˜æˆ¿
    - [e-Stat](https://www.e-stat.go.jp/): æ”¿åºœçµ±è¨ˆã®ç·åˆçª“å£
    - [DATA.GOV](https://www.data.gov/): U.S. Governmentâ€™s open data
    - [æ°—è±¡åº](https://www.data.jma.go.jp/gmd/risk/obsdl/index.php)
    - [ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿](https://www.city.meguro.tokyo.jp/gyosei/hirakareta/opendata/opendata.html):
      ã€Œåœ°åŸŸãƒ»å¹´é½¢åˆ¥äººå£ã€ã¨ã‹ã„ã„æ„Ÿã˜
- ã€Œã“ã†ã—ãŸã„ã€ã€Œã†ã¾ãã„ã‹ãªã„ã€ã€Œã‚‚ã£ã¨ã„ã˜ã‚‹ã¨ã—ãŸã‚‰ã€
  ãªã©æ°—è»½ã«è³ªå•ã—ã¦ãã ã•ã„

---
## å®Ÿæ¼”: ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿

ã€Œåœ°åŸŸãƒ»å¹´é½¢åˆ¥äººå£ã€CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€èª­ã¿è¾¼ã‚€


```r
# infile = http://www.city.meguro.tokyo.jp/opendata/131105_population_20170401.csv
infile = "131105_population_20170401.csv"
raw_df = readr::read_csv(infile)
print(raw_df)
```

```
   éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰åˆã¯å¸‚åŒºç”ºæ‘ã‚³ãƒ¼ãƒ‰ åœ°åŸŸã‚³ãƒ¼ãƒ‰ éƒ½é“åºœçœŒå å¸‚åŒºç”ºæ‘å èª¿æŸ»å¹´æœˆæ—¥       åœ°åŸŸå ç·äººå£  ç”·æ€§  å¥³æ€§ 0-4æ­³ã®ç”·æ€§ 0-4æ­³ã®å¥³æ€§ 5-9æ­³ã®ç”·æ€§ 5-9æ­³ã®å¥³æ€§ 10-14æ­³ã®ç”·æ€§ 10-14æ­³ã®å¥³æ€§ 15-19æ­³ã®ç”·æ€§ 15-19æ­³ã®å¥³æ€§ 20-24æ­³ã®ç”·æ€§ 20-24æ­³ã®å¥³æ€§ 25-29æ­³ã®ç”·æ€§ 25-29æ­³ã®å¥³æ€§ 30-34æ­³ã®ç”·æ€§ 30-34æ­³ã®å¥³æ€§ 35-39æ­³ã®ç”·æ€§ 35-39æ­³ã®å¥³æ€§ 40-44æ­³ã®ç”·æ€§ 40-44æ­³ã®å¥³æ€§ 45-49æ­³ã®ç”·æ€§ 45-49æ­³ã®å¥³æ€§ 50-54æ­³ã®ç”·æ€§ 50-54æ­³ã®å¥³æ€§ 55-59æ­³ã®ç”·æ€§ 55-59æ­³ã®å¥³æ€§ 60-64æ­³ã®ç”·æ€§ 60-64æ­³ã®å¥³æ€§ 65-69æ­³ã®ç”·æ€§ 65-69æ­³ã®å¥³æ€§ 70-74æ­³ã®ç”·æ€§ 70-74æ­³ã®å¥³æ€§ 75-79æ­³ã®ç”·æ€§ 75-79æ­³ã®å¥³æ€§ 80-84æ­³ã®ç”·æ€§ 80-84æ­³ã®å¥³æ€§ 85æ­³ã®ç”·æ€§ä»¥ä¸Š 85æ­³ã®å¥³æ€§ä»¥ä¸Š ä¸è©³è€…ã®ç”·æ€§ ä¸è©³è€…ã®å¥³æ€§ ä¸–å¸¯æ•°  å‚™è€ƒ
                              <dbl>      <dbl>      <chr>      <chr>     <date>        <chr>  <dbl> <dbl> <dbl>       <dbl>       <dbl>       <dbl>       <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>         <dbl>          <dbl>          <dbl>        <dbl>        <dbl>  <dbl> <lgl>
 1                           131105        111     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01   é§’å ´ä¸€ä¸ç›®   3995  2027  1968          65          63          85          68            52            51            70            63           156           109           231           160           215           169           202           157           170           175           165           149           114           123            78           105            80            99           126           122            66           107            63            74            48            67             41            107            0            0   2421    NA
 2                           131105        112     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01   é§’å ´äºŒä¸ç›®    557   267   290           6           8           7           7            13            10             9             9            16            17            31            19            21            20            21            16            26            19            17            25            18            20            16            16            11            12            15            25            15            16             8            11            10            19              7             21            0            0    337    NA
 3                           131105        113     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01   é§’å ´ä¸‰ä¸ç›®    779   403   376          15          11          14          12            16            10            18            11            26            15            28            18            28            15            34            26            35            34            28            43            34            27            21            26            24            24            24            29            20            25            13            18            13            15             12             17            0            0    415    NA
 4                           131105        114     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01   é§’å ´å››ä¸ç›®   1537   736   801          23          35          35          28            31            29            47            35           101            89            70            62            49            47            52            65            43            68            54            68            55            64            34            41            32            34            35            46            26            31            23            19            16            19             10             21            0            0    876    NA
--                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
85                           131105        364     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01   å…«é›²å››ä¸ç›®   2104   969  1135          56          47          52          47            38            35            34            40            57            54            50            74            56            76            80           104            99           109            73            92            81            83            48            66            43            57            68            67            54            47            24            37            35            42             21             58            0            0    965    NA
86                           131105        365     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01   å…«é›²äº”ä¸ç›®   2818  1354  1464          82          53          83          75            65            64            65            61            85            55            90            87            92           103           112           133           117           146           115           128           103           110            84            99            63            73            76            59            37            64            32            47            34            46             19             61            0            0   1316    NA
87                           131105        371     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01 æ±ãŒä¸˜ä¸€ä¸ç›®   4439  2049  2390         104          90         100          83           108            93            94           124           108           120           131           155           165           186           169           186           190           193           164           195           144           193           130           137           104           109           115           136            81            87            53            81            44            79             45            143            0            0   2193    NA
88                           131105        372     æ±äº¬éƒ½     ç›®é»’åŒº 2017-04-01 æ±ãŒä¸˜äºŒä¸ç›®   2974  1292  1682          66          63          63          41            47            51            57            37            65           191           138           235           134           174           113           131            93           126            99           126           101           104            77            83            54            56            46            79            44            48            43            39            22            41             30             57            0            0   1667    NA
```

---
## å®Ÿæ¼”: ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿

ggplotã—ãŸããªã‚‹å½¢ã«å¤‰å½¢


```r
tidy_df = raw_df %>%
  select("åœ°åŸŸå", matches("ã®.+æ€§$")) %>%
  rename(place = åœ°åŸŸå) %>%
  mutate(place = str_replace(place, "\\Sä¸ç›®", "")) %>%
  group_by(place) %>%
  summarize(across(everything(), sum)) %>%
  ungroup() %>%
  pivot_longer(-place, names_to = "category") %>%
  separate(category, c("age", "sex"), sep = "ã®") %>%
  filter(str_detect(age, "\\d")) %>%
  mutate(age = parse_number(age)) %>%
  print()
```

```
    place   age   sex value
    <chr> <dbl> <chr> <dbl>
  1  ä¸‰ç”°     0  ç”·æ€§   105
  2  ä¸‰ç”°     0  å¥³æ€§   102
  3  ä¸‰ç”°     5  ç”·æ€§    80
  4  ä¸‰ç”°     5  å¥³æ€§    69
 --                        
915  é·¹ç•ª    75  ç”·æ€§   143
916  é·¹ç•ª    75  å¥³æ€§   204
917  é·¹ç•ª    80  ç”·æ€§   107
918  é·¹ç•ª    80  å¥³æ€§   179
```

---
## å®Ÿæ¼”: ç›®é»’åŒºã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿

ä½œå›³ã—ã¦ã¿ã‚‹


```r
tidy_df %>%
  ggplot(aes(age, value)) +
  geom_col(aes(fill = sex)) +
  facet_wrap(~ place, nrow = 3L) +
  theme_bw(base_family = "HiraginoSans-W3")
```

![plot of chunk meguro_plot](figure/meguro_plot-1.png)


---
## Reference

R for Data Science --- Hadley Wickham and Garrett Grolemund
: <https://r4ds.had.co.nz/>,
  [Paperback](https://amzn.to/2tbRmVc),
  [æ—¥æœ¬èªç‰ˆæ›¸ç±](https://amzn.to/2yyFRKt)

[å‰å‡¦ç†å¤§å…¨ --- æœ¬æ©‹æ™ºå…‰](https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b)<br>
[Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®RStudio[å®Ÿè·µ]å…¥é–€ (å®‡å®™æœ¬) --- æ¾æ‘ã‚‰](https://amzn.to/3eBprm5)

Official documents:
: [tidyverse](https://www.tidyverse.org/),
  [ggplot2](https://ggplot2.tidyverse.org/),
  [dplyr](https://dplyr.tidyverse.org/),
  [tidyr](https://tidyr.tidyverse.org/),
  [readr](https://readr.tidyverse.org/),
  [tibble](https://tibble.tidyverse.org/),
  [stringr](https://stringr.tidyverse.org/),

Older versions
: ã€Œ[Rã«ã‚„ã‚‰ã›ã¦æ¥½ã—ã‚ˆã† â€” ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¨ä¸‹ã”ã—ã‚‰ãˆ](https://heavywatal.github.io/slides/nagoya2018/)ã€
   å²©åµœèˆª 2018
: ã€ŒRã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨ã€çŸ³å·ç”±å¸Œ 2019 åå¤å±‹å¤§å­¦
: ã€Œ[Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’](https://heavywatal.github.io/slides/tmd2019/)ã€
   å²©åµœèˆª 2019 æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§

<a href="./" class="readmore">
ç›®æ¬¡ã«æˆ»ã‚‹
</a>
