```{r, setup-common}
#| file: "setup.R"
#| echo: false
#| results: "asis"
```
```{r, setup-local}
#| include: false
#| cache: false
if (dir.exists(knitr::opts_chunk$get("cache.path"))) knitr::dep_auto()
```


---
## æœ€çµ‚å›ã®ãŠå“æ›¸ã

-   ğŸ”° 1é€±ç›®ã®èª²é¡Œ
    - 3â€“5äººãšã¤ã®ç­ã«åˆ†ã‹ã‚Œã€ç”»é¢å…±æœ‰ã—ã¤ã¤è¨è«–
    - ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ ã«æˆ»ã‚Šã€å„ç­ä»£è¡¨ãŒè§£ç­”ãƒ»æ„Ÿæƒ³ã‚’ç™ºè¡¨
-   ğŸ”° 2é€±ç›®ã®èª²é¡Œ
    - åŒæ§˜ã«ã€‚æ™‚é–“ãŒç„¡ã‘ã‚Œã°è¨è«–çœç•¥ã€‚
-   ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§å®Ÿæ¼” + è³ªç–‘å¿œç­”


---
## ğŸ”° 1é€±ç›®ã®èª²é¡Œ

<iframe width="400" height="300" src="./2-visualization.html#/53"></iframe>
<iframe width="400" height="300" src="./2-visualization.html#/54"></iframe>

---
## ğŸ”° 2é€±ç›®ã®èª²é¡Œ

<iframe width="400" height="300" src="./4-structure2.html#/32"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/33"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/35"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/36"></iframe>
<iframe width="400" height="300" src="./4-structure2.html#/37"></iframe>


---
## ğŸ”° 3æ—¥ç›®ã®èª²é¡Œ1: å¥½ããªãƒ‡ãƒ¼ã‚¿ã‚’ã„ã˜ãã‚Šå€’ã—ã¦ã¿ã‚ˆã†

- è‡ªåˆ†ãŒã“ã‚Œã‹ã‚‰è§£æã—ãŸã„ãƒ‡ãƒ¼ã‚¿ (ã‚‚ã—æ‰‹å…ƒã«ã‚ã‚Œã°)
- ä½•ã‹é©å½“ãªãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã€‚ä¾‹ãˆã°:
    - [e-Stat](https://www.e-stat.go.jp/): æ”¿åºœçµ±è¨ˆã®ç·åˆçª“å£
    - [data.go.jp ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã‚µã‚¤ãƒˆ](https://www.data.go.jp/data/dataset?res_format=CSV): ä¸­å¤®çœåº
    - [BODIKã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã‚µã‚¤ãƒˆ](https://odcs.bodik.jp/): åœ°æ–¹è‡ªæ²»ä½“
    - [æ°—è±¡åº](https://www.data.jma.go.jp/gmd/risk/obsdl/index.php)
    - [DATA.GOV](https://www.data.gov/): U.S. Governmentâ€™s open data
- (è‹¦è‚‰ã®ç­–) Rã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä»˜å±ã®ãƒ‡ãƒ¼ã‚¿
    - `diamonds`, `starwars`, `mpg`, etc. See `data()`

---
## å®Ÿæ¼”: [e-Stat å›½å‹¢èª¿æŸ»](https://www.e-stat.go.jp/gis/statmap-search?page=1&type=1&toukeiCode=00200521) CSV

2020å¹´ â†’ å°åœ°åŸŸ â†’ å¹´é½¢ï¼ˆï¼•æ­³éšç´šã€ï¼”åŒºåˆ†ï¼‰åˆ¥ã€ç”·å¥³åˆ¥äººå£ â†’ å®®åŸçœŒ

ã†ã¾ãã™ã‚Œã°æ¬¡ã®ã‚ˆã†ãªäººå£ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã‚’æã‘ã‚‹ã¯ãšã®ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒ...

<img `r src_alt_fig_chunk("estat-plot")`>

---
## ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å…¥æ‰‹ã§ãã¦ã‚‚ç°¡å˜ã«ã¯èª­ã¿è¾¼ã‚ãªã„

åˆæ‰‹ã‚¨ãƒ©ãƒ¼:
```{r, estat-read-error}
#| error: true
infile = "tblT001082C04.txt"
readr::read_csv(infile)
```

RStudioã§ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦é–‹ã„ã¦ã¿ã‚‹ã¨æ–‡å­—åŒ–ã‘:

```{r, estat-as-text}
#| echo: false
readLines(infile, 5L) |> t() |> t() |>
  prmatrix(rowlab = rep("", 5), collab = "", quote = FALSE)
```

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ "File â†’ **Reopen with Encoding...**" ã‚’é¸æŠã€‚<br>
ãŸã„ã¦ã„ã€å¤ã„æ—¥æœ¬èªãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚ŠãŒã¡ãª**SHIFT-JIS**ãŒæ­£è§£ã€‚<br>
(ã‚‚ã£ã¨å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰EUC-JPã¨ã‹ã®å ´åˆã‚‚ã‚ã‚‹ã€‚)

---
## æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦èª­ã¿è¾¼ã¿

ã‚ˆãè¦‹ã‚‹ã¨ã€8åˆ—ç›®ä»¥é™ã®åˆ—åãŒ2è¡Œã«ã¾ãŸãŒã£ã¦ã„ã‚‹:
```{r, estat-sjis}
sjis = readr::locale(encoding = "SHIFT-JIS")
readr::read_csv(infile, locale = sjis)
```

---
## å·¦å´ã¨å³å´ã‚’åˆ†ã‘ã¦èª­ã¿ã€ãã‚Œãã‚Œå‰Šã£ã¦ã‹ã‚‰bind

ãªã‚“ã‹æ•°å€¤ã®åˆ—ã®ã¯ãšãªã®ã« `-` ã¨ã„ã†æ–‡å­—ãŒæ··ã˜ã£ã¦ã„ã‚‹ã€‚(ä¸­ã«ã¯ `X` ã‚‚):
```{r, estat-lr}
dfL = readr::read_csv(infile, locale = sjis, col_select = seq(1, 7)) |>
  dplyr::slice(-1)
dfR = readr::read_csv(infile, locale = sjis, col_select = -seq(1, 7),
  skip = 1L)
raw_miyagi = dplyr::bind_cols(dfL, dfR) |> print()
```

---
## æ•°å€¤ã®ã¯ãšã®åˆ—ã«æ··ã˜ã‚‹ `-` ã¨ `X` ã‚’ `NA` æ‰±ã„

ã“ã‚Œã§ã‚ˆã†ã‚„ãã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã€‚ã€‚ã€‚
```{r, estat-lr-na}
dfL = readr::read_csv(infile, locale = sjis, col_select = seq(1, 7)) |>
  dplyr::slice(-1)
dfR = readr::read_csv(infile, locale = sjis, col_select = -seq(1, 7),
  skip = 1L, na = c("-", "X"))
raw_miyagi = dplyr::bind_cols(dfL, dfR) |> print()
```

<!-- dfR = readr::read_csv(infile, locale = sjis, col_select = -seq(1, 7),
  skip = 1L, na = c("-", "X"), name_repair = "minimal") -->

---
## ã‚ã¨ã¯dplyrã¨tidyrã§ãŠæƒé™¤

ã¾ã ç½ ã¯ãŸãã•ã‚“: åˆ—åã®é ­ã«ã‚¹ãƒšãƒ¼ã‚¹ã€‚å…¨è§’æ•°å­—ã€‚å¤‰ãªåŒºåˆ†ã€‚

```{r, estat-tidy}
tidy_miyagi = raw_miyagi |>
  dplyr::rename_with(stringr::str_trim) |>
  dplyr::filter(HYOSYO == 1) |>
  dplyr::select(CITYNAME, matches("[ç”·å¥³].+æ­³")) |>
  tidyr::pivot_longer(!CITYNAME, names_to = "category", values_to = "count") |>
  tidyr::separate(category, c("sex", "age"), 1) |>
  dplyr::mutate(age = stringi::stri_trans_nfkc(age)) |>
  tidyr::separate(age, c("lower", "upper"), "ã€œ", fill = "right") |>
  dplyr::mutate(lower = readr::parse_number(lower),
                upper = readr::parse_number(upper)) |>
  dplyr::filter((upper - lower) < 5 | lower == 75) |>
  dplyr::mutate(age = (lower + upper) / 2) |>
  print()
```

---
## ã“ã“ã¾ã§ãã‚Œã°ä½œå›³ã¯ç°¡å˜

```{r, estat-factor}
#| include: false
total_miyagi = tidy_miyagi |>
  dplyr::count(CITYNAME, wt = count, name = "count") |>
  dplyr::arrange(desc(count))
tidy_miyagi = tidy_miyagi |>
  dplyr::mutate(CITYNAME = factor(CITYNAME, levels = total_miyagi$CITYNAME))
```

```{r, estat-plot}
#| fig.height: 5.5
#| fig.width: 12
tidy_miyagi |>
  dplyr::mutate(count = ifelse(sex == "ç”·", -1, 1) * count) |>
  ggplot() +
  geom_col(aes(age, count, fill = sex)) +
  facet_wrap(vars(CITYNAME), nrow = 4L) +
  coord_flip() + theme_minimal(base_size = 15)
```

---
## å‚è€ƒ

R for Data Science --- Hadley Wickham and Garrett Grolemund
: <https://r4ds.had.co.nz/>,
  [Paperback](https://amzn.to/2tbRmVc),
  [æ—¥æœ¬èªç‰ˆæ›¸ç±](https://amzn.to/2yyFRKt)

[å‰å‡¦ç†å¤§å…¨ --- æœ¬æ©‹æ™ºå…‰](https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b)<br>
[Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®RStudio[å®Ÿè·µ]å…¥é–€ (å®‡å®™èˆ¹æœ¬) --- æ¾æ‘ã‚‰](https://amzn.to/2Yy5LND)

Official documents:
: [tidyverse](https://www.tidyverse.org/),
  [ggplot2](https://ggplot2.tidyverse.org/),
  [dplyr](https://dplyr.tidyverse.org/),
  [tidyr](https://tidyr.tidyverse.org/),
  [stringr](https://stringr.tidyverse.org/),
  [readr](https://readr.tidyverse.org/)

Older versions
: ã€Œ[Rã«ã‚„ã‚‰ã›ã¦æ¥½ã—ã‚ˆã† â€” ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¨ä¸‹ã”ã—ã‚‰ãˆ](https://heavywatal.github.io/slides/nagoya2018/)ã€
   å²©åµœèˆª 2018
: ã€ŒRã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨ã€çŸ³å·ç”±å¸Œ 2019 åå¤å±‹å¤§å­¦
: ã€Œ[Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’](https://heavywatal.github.io/slides/tmd2020/)ã€
   å²©åµœèˆª 2020 æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§
: ã€Œ[Rã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨](https://comicalcommet.github.io/r-training-2022/)ã€
   çŸ³å·ç”±å¸Œ 2022 åå¤å±‹å¤§å­¦

<a href="." class="readmore">
ç›®æ¬¡ã«æˆ»ã‚‹
</a>
