+++
url = "tmd2019/3-content.html"
title = "3. ãƒ‡ãƒ¼ã‚¿å†…å®¹ã®å‡¦ç† â€” Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’ 2019"
linktitle = "ãƒ‡ãƒ¼ã‚¿å†…å®¹ã®å‡¦ç†: æ•°å€¤ã€æ–‡å­—åˆ—ã€æ—¥æ™‚ãªã©"
date = 2019-12-28T13:00:00+09:00
type = "reveal"
draft = false
+++

# [Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’](.)

<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki, PhD)
</div>

<div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡ ç‰¹ä»»åŠ©æ•™<br>
(Graduate School of Life Sciences, Tohoku University)
</div>

<ol>
<li><a href="1-introduction.html">å…¥é–€: å‰å‡¦ç†ã¨ã¯ã€‚Rã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã€‚Rã®åŸºæœ¬</a>
<li><a href="2-structure.html">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‡¦ç†: æŠ½å‡ºã€é›†ç´„ã€çµåˆã€å¤‰å½¢ãªã©</a>
<li class="current-deck"><a href="3-content.html">ãƒ‡ãƒ¼ã‚¿å†…å®¹ã®å‡¦ç†: æ•°å€¤ã€æ–‡å­—åˆ—ã€æ—¥æ™‚ãªã©</a>
<li><a href="4-practice.html">å®Ÿè·µ: ç¾å®Ÿã®å•é¡Œã«å¯¾å‡¦ã—ã¦ã¿ã‚‹</a>
</ol>

<div class="footnote">
2019-12-28 æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§å­¦ M&Dã‚¿ãƒ¯ãƒ¼ æƒ…å ±æ¤œç´¢å®¤1
</div>

```{r setup-global, include=FALSE, code=readLines("setup.R")}
```

```{r setup-local, include=FALSE}
library(ggplot2)
library(tibble)
library(dplyr)
library(tidyr)
library(readr)
library(stringr)
library(forcats)
library(lubridate)
iris = tibble::as_tibble(iris)
```

---
## Rä½œæ¥­ã‚’å†é–‹ã™ã‚‹

- å‰å›ä½œã£ãŸ `***.Rproj` ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦RStudioèµ·å‹•ã€‚<br>
  ã‚‚ã—ãã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–°è¦ä½œæˆã€‚
- Rã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ–°è¦ä½œæˆã€åå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€‚
- `getwd()`: ç¾åœ¨åœ°ã‚’ç¢ºèªã€‚
- `library()`: ä½¿ã„ãŸã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€ã€‚

```r
getwd()
# install.packages("tidyverse")
library(tidyverse)
```

---
## å‰å‡¦ç†ã¯å¤§ãã2ã¤ã«åˆ†ã‘ã‚‰ã‚Œã‚‹

- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å¯¾è±¡ã¨ã™ã‚‹å‡¦ç† (<a href="2-structure.html">å‰å›ã®ä¸»é¡Œ</a>)
    - ä½¿ã„ãŸã„éƒ¨åˆ†ã ã‘æŠ½å‡º --- `select()`, `filter()`
    - ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ç‰¹å¾´ã‚’è¦ç´„ --- `group_by()`, `summarize()`
    - å¤§ãã„é †ã«ä¸¦ã¹æ›¿ãˆ --- `arrange()`
    - ç•°ãªã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã®çµåˆ --- `*_join()`
    - å¤‰å½¢: ç¸¦é•· â†” æ¨ªåºƒ --- `pivot_longer()`, `pivot_wider()`
- **ãƒ‡ãƒ¼ã‚¿å†…å®¹ã‚’å¯¾è±¡ã¨ã™ã‚‹å‡¦ç†** (ğŸ‘ˆä»Šå›ã®ä¸»é¡Œ)
    - æ•°å€¤ã‚’å¤‰æ›ã™ã‚‹ (e.g., å¯¾æ•°ã€åº§æ¨™ç³»)
    - å¤‰æ›: é€£ç¶šå¤‰æ•° â†” ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•° â†” ãƒ€ãƒŸãƒ¼å¤‰æ•°
    - æ¬ æå€¤ `NA` ã«å¯¾å‡¦
    - æ–‡å­—åˆ—ã‹ã‚‰æ•°å€¤ã‚„æ—¥æ™‚ã‚’æŠœãå‡ºã™


---
## å¤‰æ•°/ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹ (å…ˆé€±ã®ãŠã•ã‚‰ã„)

- `NULL`: ç©ºã£ã½
- **vector: åŸºæœ¬å‹ã€‚ä¸€æ¬¡å…ƒã®é…åˆ—ã€‚** (ğŸ‘ˆä»Šå›ã®ä¸»å½¹)
    - logical: è«–ç†å€¤ (`TRUE` or `FALSE`)
    - numeric: æ•°å€¤ (æ•´æ•° `42L` or å®Ÿæ•° `3.1416`)
    - character: æ–‡å­—åˆ— (`"a string"`)
    - factor: å› å­ (æ–‡å­—åˆ—ã£ã½ã„ã‘ã©å¾®å¦™ã«é•ã†)
    - â†‘ãã‚Œãã‚Œã«æ¬ æå€¤ `NA` ã‚‚å®šç¾©ã•ã‚Œã¦ã‚‹
- matrix: äºŒæ¬¡å…ƒã®è¡Œåˆ—ã€‚vectoråŒæ§˜ã€å…¨è¦ç´ ãŒåŒã˜å‹ã€‚
- list: ç•°ãªã‚‹å‹ã§ã‚‚è©°ã‚è¾¼ã‚ã‚‹å¤ªã£è…¹ãƒ™ã‚¯ãƒˆãƒ«ã€‚
- data.frame: åŒã˜é•·ã•ã®ãƒ™ã‚¯ãƒˆãƒ«ã‚’ä¸¦ã¹ãŸé•·æ–¹å½¢ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚é‡è¦ã€‚<br>
  **tibble** ã¨ã‹ **tbl_df** ã¨å‘¼ã°ã‚Œã‚‹äºœç¨®ã‚‚ã‚ã‚‹ã‘ã©ã»ã¼åŒã˜ã€‚

---
## vector: ä¸€æ¬¡å…ƒã®é…åˆ— (å…ˆé€±ã®ãŠã•ã‚‰ã„)

1å€‹ã®å€¤ã§ã‚‚ãƒ™ã‚¯ãƒˆãƒ«æ‰±ã„ã€‚<br>
ãƒ™ã‚¯ãƒˆãƒ«ã®å„è¦ç´ ã«ä¸€æ°—ã«è¨ˆç®—ã‚’é©ç”¨ã§ãã‚‹ã€‚

```{r vector}
x = c(1, 2, 9)  # é•·ã•3ã®æ•°å€¤ãƒ™ã‚¯ãƒˆãƒ«
x + x           # åŒã˜é•·ã•åŒå£«ã®è¨ˆç®—
y = 10          # é•·ã•1ã®æ•°å€¤ãƒ™ã‚¯ãƒˆãƒ«
x + y           # é•·ã•3 + é•·ã•1 = é•·ã•3 (ãã‚Œãã‚Œè¶³ã—ç®—)
sqrt(x)         # square root
```

---
## data.frameã¯åˆ—vectorã®é›†ã¾ã‚Š

<a href="https://tibble.tidyverse.org/">
<img src="/_img/hex-stickers/tibble.webp" width="120" align="right">
</a>

å†…å®¹ã‚’å¤‰æ›´ã™ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚‹ã€‚<br>
`diamonds[["price"]]` ã‚’ãƒ‰ãƒ«ã‹ã‚‰å††ã«å¤‰æ›ã™ã‚‹ä¾‹:

```{r mutate}
dia = diamonds    # åˆ¥åã‚³ãƒ”ãƒ¼

# dollaræ¼”ç®—å­ã§æŒ‡å®š
dia$price = 109.58 * dia$price

# åå‰ã‚’æ–‡å­—åˆ—ã§æŒ‡å®š
dia[["price"]] = 109.58 * dia[["price"]]

# dplyr::mutate with pipe
dia = diamonds %>%
  mutate(price = 109.58 * price)
```

1ç™ºãªã‚‰ã©ã‚Œã§ã‚‚ã„ã„ã€‚æµã‚Œä½œæ¥­ã«ã¯ `mutate()` ãŒä¾¿åˆ©ã€‚


---
## æ•°å€¤: numericå‹

æ™®é€šã¯å€ç²¾åº¦æµ®å‹•å°æ•°ç‚¹å‹ `double` ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹:

```{r numeric}
answer = 42
typeof(answer)
```

æ˜ç¤ºçš„ã«å¤‰æ›ã—ãŸã‚Šæœ«å°¾ã«Lã‚’ä»˜ã‘ã‚‹ã“ã¨ã§æ•´æ•°æ‰±ã„ã‚‚ã§ãã‚‹:

```{r integer}
typeof(as.integer(answer))
whoami = 24601L
typeof(whoami)
```

---
## æ§˜ã€…ãªæ•°å­¦é–¢æ•°

ãƒ™ã‚¯ãƒˆãƒ«ã‚’å—ã‘å–ã‚Šã€ãã‚Œãã‚Œã®è¦ç´ ã«é©ç”¨

```{r math}
x = c(1, 2, 3)
sqrt(x)
log(x)
log10(x)
exp(x)
```

<small style="display: block; text-align: right;"><https://stat.ethz.ch/R-manual/R-patched/library/base/html/00Index.html></small>

---
## æ­£è¦åŒ– (z-score normalization)

å¹³å‡=0ã€æ¨™æº–åå·®=1ã€ã«ãªã‚‹ã‚ˆã†ã«:

```{r z-score}
result = diamonds %>%
  mutate(depth = scale(depth)) %>%
  print()
```

`depth = (depth - mean(depth)) / sd(depth)` ã¨åŒã˜ã€‚


---
## æ­£è¦åŒ– (min-max normalization)

æœ€å°=0ã€æœ€å¤§=1ã€ã«ãªã‚‹ã‚ˆã†ã«:

```{r min-max}
result = diamonds %>%
  mutate(depth = (depth - min(depth)) / (max(depth) - min(depth))) %>%
  print()
```

å¤–ã‚Œå€¤ã®å½±éŸ¿ã‚’å¤§ããå—ã‘ã‚‹ã“ã¨ã«æ³¨æ„ã€‚


---
## å¤–ã‚Œå€¤ã®é™¤å»

å¹³å‡å€¤ã‹ã‚‰æ¨™æº–åå·®ã®3å€ä»¥ä¸Šé›¢ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’å–ã‚Šé™¤ãä¾‹:

```{r outlier}
result = diamonds %>%
  filter(abs(depth - mean(depth)) / sd(depth) < 3) %>%
  print()
```

å”¯ä¸€ã®æ–¹æ³•ã§ã¯ãªã„ã—ã€ãã‚‚ãã‚‚ã‚„ã‚‹ã¹ãã‹ã©ã†ã‹ã‚‚è¦æ¤œè¨


---
## æ¬ æå€¤ã®é™¤å» `tidyr::drop_na()`

(æŒ‡å®šã—ãŸåˆ—ã«) `NA` ãŒå«ã¾ã‚Œã¦ã‚‹è¡Œã‚’å‰Šé™¤ã™ã‚‹ã€‚

```{r drop_na}
df = tibble(x = c(1, 2, NA), y = c("a", NA, "b"))
df %>% drop_na()
```

å•: `starwars` ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§è©¦ã—ã¦ã¿ã‚ˆã†

```{r starwars-drop, echo=FALSE}
starwars
```

---
## æ¬ æå€¤ã®è£œå®Œ `tidyr::replace_na()`

æ¬ æå€¤ `NA` ã‚’ä»»æ„ã®å€¤ã§ç½®ãæ›ãˆã‚‹ã€‚

```{r replace_na}
df = tibble(x = c(1, 2, NA), y = c("a", NA, "b"))
df %>% replace_na(list(x = 0, y = "unknown"))
```

å•: `starwars` ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§è©¦ã—ã¦ã¿ã‚ˆã†


---
## æ¬ æå€¤ã®è£œå®Œ `dplyr::coalesce()`

å…ˆã«æŒ‡å®šã—ãŸåˆ—ãŒ `NA` ãªã‚‰æ¬¡ã®åˆ—ã®å€¤ã‚’æ¡ç”¨:

```{r coalesce}
y = c(1, 2, NA, NA, 5)
z = c(NA, NA, 3, 4, 5)
coalesce(y, z)
```

å‹ãŒç•°ãªã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹:
```{r coalesce-type}
df = tibble(x = c(1, 2, NA), y = c("a", NA, "b"))
df %>%
  mutate(z = coalesce(x, y))
```

å•: `starwars` ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§è©¦ã—ã¦ã¿ã‚ˆã†


---
## æ¬ æå€¤ã¨ã¿ãªã™ `dplyr::na_if()`

ç‰¹å®šã®å€¤ã‚’ `NA` ã«ç½®ãæ›ãˆã‚‹:

```{r na_if}
df %>%
  mutate(x = na_if(x, 1), y = na_if(y, "a"))
```

å•: `starwars` ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§è©¦ã—ã¦ã¿ã‚ˆã†



---
## æ–‡å­—åˆ—

ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€ã€‚ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚‚ä½¿ãˆã‚‹ã€‚

```{r string}
x = "This is a string"
y = 'If I want to include a "quote" inside a string, I use single quotes'
```

é–‰ã˜ãã³ã‚Œã‚‹ã¨å¤‰ãªçŠ¶æ…‹ã«ãªã‚‹ã®ã§ã€è½ã¡ç€ã„ã¦ <kbd>esc</kbd> or <kbd>ctrl</kbd><kbd>c</kbd>

```
> "This is a string without a closing quote
+
+
+ HELP I'M STUCK
```

<small style="display: block; text-align: right;"><https://r4ds.had.co.nz/strings.html></small>

---
## Rå‚™ãˆä»˜ã‘ã®æ–‡å­—åˆ—æ©Ÿèƒ½ã¯ä½¿ã„ã«ãã„

-   ä½•ã‚’ã‚„ã‚‹é–¢æ•°ãªã®ã‹åå‰ã‹ã‚‰åˆ†ã‹ã‚Šã«ãã„<br>
    `grep`, `grepl`, `regexpr`, `gregexpr`, `regexec`<br>
    `sub`, `gsub`, `substr`, `substring`
-   ç¬¬ä¸€å¼•æ•°ã¯å¯¾è±¡æ–‡å­—åˆ—ï¼Ÿæ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼Ÿé–¢æ•°ã”ã¨ã«é•ã†ã€‚
-   `NA` ã«å¯¾ã™ã‚‹æŒ™å‹•ãŒå¾®å¦™


---
## stringr --- æ–‡å­—åˆ—å‡¦ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

<a href="https://stringr.tidyverse.org/">
<img src="/_img/hex-stickers/stringr.webp" width="120" align="right">
</a>

-   tidyverseã®ä¸€éƒ¨
-   ä½•ã‚’ã‚„ã‚‹é–¢æ•°ãªã®ã‹åå‰ã‹ã‚‰åˆ†ã‹ã‚Šã‚„ã™ã„
-   å¯¾è±¡æ–‡å­—åˆ—ãŒä¸€è²«ã—ã¦ç¬¬ä¸€å¼•æ•°ã§ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒäºŒç•ªç›®
-   å¼•æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å„è¦ç´ ã®åå‰ã‚„ä½ç½®ã‚’ä¿æŒã™ã‚‹
    -   é•·ã•ã‚¼ãƒ­ã®å…¥åŠ›ã‹ã‚‰ã¯é•·ã•ã‚¼ãƒ­ã®å‡ºåŠ›
    -   å…¥åŠ›ã« `NA` ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯å¯¾å¿œã™ã‚‹å‡ºåŠ›ã‚‚ `NA`
-   [ICUæ­£è¦è¡¨ç¾](http://userguide.icu-project.org/strings/regexp) ã®ä»•æ§˜ãŒæ˜ç¢º
-   [ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ](https://github.com/rstudio/cheatsheets/raw/master/strings.pdf)


---
## æ–‡å­—åˆ—åŸºæœ¬æ“ä½œ

```{r str_length}
fruit4 = head(fruit, 4L) %>% print()
str_length(fruit4)            # é•·ã•
str_sub(fruit4, 2, 4)         # éƒ¨åˆ†åˆ—
str_c(1:4, " ", fruit4, "!")  # çµåˆ
```


---
## ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã€æ­£è¦è¡¨ç¾

å˜ç´”ãªä¸€è‡´ã ã‘ã˜ã‚ƒãªãã€ã„ã‚ã‚“ãªæ¡ä»¶ã§ãƒãƒƒãƒãƒ³ã‚°ã§ãã‚‹:

```{r pattern}
# aã§å§‹ã¾ã‚‹
str_subset(fruit, "^a")

# rã§çµ‚ã‚ã‚‹
str_subset(fruit, "r$")

# è‹±æ•°å­—3-4æ–‡å­—
str_subset(fruit, "^\\w{3,4}$")
```


---
## æ­£è¦è¡¨ç¾: ã‚ˆãä½¿ã†ç‰¹æ®Šæ–‡å­—

| ãƒ¡ã‚¿æ–‡å­— | æ„å‘³ | &emsp;&emsp;&emsp; | æ¼”ç®—å­ | æ„å‘³ |
| ---- | ---- | --- | ---- | ---- |
| `\d` | æ•°å­—   | | `?`  | 0å›ã‹1å› |
| `\s` | ç©ºç™½   | | `*`  | 0å›ä»¥ä¸Šç¹°ã‚Šè¿”ã— |
| `\w` | è‹±æ•°å­— | | `+`  | 1å›ä»¥ä¸Šç¹°ã‚Šè¿”ã— |
| `.`  | ä½•ã§ã‚‚ | | `{n,m}` | nå›ä»¥ä¸Šmå›ä»¥ä¸‹ |
| `^`  | è¡Œé ­   | | `XXX(?=YYY)`  | YYYã«å…ˆç«‹ã¤XXX |
| `$`  | è¡Œæœ«   | | `(?<=YYY)XXX`  | YYYã«ç¶šãXXX |

Ræ–‡å­—åˆ—ã§ã¯ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’é‡ã­ã‚‹å¿…è¦ãŒã‚ã‚‹, e.g., `"\\d"`.<br>
`\D`, `\S`, `W` ã®ã‚ˆã†ã«å¤§æ–‡å­—ã«ã™ã‚‹ã¨åè»¢ã€‚

<small style="display: block; text-align: right;"><http://userguide.icu-project.org/strings/regexp></small>

å•: `str_subset(fruit, "PATTERN")` ã‚’ã„ã‚ã„ã‚è©¦ã—ã¦ã¿ã‚ˆã†


---
## æ¤œå‡º `str_detect()`

ãƒãƒƒãƒã™ã‚‹ã‹ã©ã†ã‹ `TRUE`/`FALSE` ã‚’è¿”ã™ã€‚
```{r str_detect}
fruit4 = head(fruit, 4L)
str_detect(fruit4, "^a")
```

å•: `starwars` ã® `name` åˆ—ã§ `filter()` ã—ã¦ã¿ã‚ˆã†

```{r starwars-detect, echo=FALSE}
starwars
```

---
## æŠ½å‡º `str_extract()`

ãƒãƒƒãƒã—ãŸéƒ¨åˆ†æ–‡å­—åˆ—ã‚’å–ã‚Šå‡ºã™ã€‚ã—ãªã‹ã£ãŸè¦ç´ ã«ã¯ `NA`ã€‚
```{r str_extract}
fruit4 = head(fruit, 4L)
str_extract(fruit4, "^a..")
```

å•: `diamonds` ã® `clarity` åˆ—ã‹ã‚‰æ•°å­—ã‚’å–ã‚Šé™¤ã„ã¦ã¿ã‚ˆã†

```{r diamonds-extract, echo=FALSE}
diamonds
```


---
## ç½®æ› `str_replace()`

ã‚«ãƒƒã‚³ `()` ã§å›²ã‚“ã ãƒãƒƒãƒãƒ³ã‚°ã¯å¾Œã§å‚ç…§ã§ãã‚‹:
```{r str_replace}
fruit4 = head(fruit, 4L)
str_replace(fruit4, "..$", "!!")
str_replace(fruit4, "(..)$", "!!\\1")
```

å•: `starwars` ã® `name` åˆ—ã®æ•°å­—ã‚’å…¨éƒ¨ã‚¼ãƒ­ã«ã—ã¦ã¿ã‚ˆã†

```{r starwars-replace, echo=FALSE}
starwars
```


---
## å½¢å¼ã‚’å¤‰ãˆã‚‹ãƒ»æ•´ãˆã‚‹

```{r upperlower}
fruit4 = head(fruit, 4L)
str_to_upper(fruit4)              # å¤§æ–‡å­—ã«
str_pad(fruit4, 8, "left", "_")   # å¹…ã‚’åŸ‹ã‚ã‚‹
```

[`stringi`](http://www.gagolewski.com/software/stringi/) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã•ã‚‰ã«å¤šæ©Ÿèƒ½
```{r stringi}
stringi::stri_trans_nfkc("ï½¶ï¾€ï½¶ï¾…")  # åŠè§’ã‚«ãƒŠã‚’å…¨è§’ã«
```

---
## æ–‡å­—åˆ—ã‹ã‚‰åˆ¥ã®å‹ã«

<a href="https://readr.tidyverse.org/">
<img src="/_img/hex-stickers/readr.webp" width="120" align="right">
</a>

ã“ã‚Œã¯stringrã§ã¯ãªãreadrã®æ‹…å½“:

```{r parse-character}
parse_number(c("p = 0.02 *", "N_A = 6e23"))
parse_double(c("0.02", "6e23"))   # ç•°ç‰©ã«ã¯è­¦å‘Š
parse_logical(c("1", "true", "0", "false"))
parse_date("2019-12-27")
```

---
## å› å­å‹ `factor`

ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’æ‰±ã†ãŸã‚ã®å‹ã€‚æ–‡å­—åˆ—ã£ã½ã„ã‘ã©ä¸­èº«ã¯æ•°ã€‚

```{r iris}
iris = tibble::as_tibble(iris) %>% print()
levels(iris[["Species"]])
```

<small><https://r4ds.had.co.nz/factors.html></small>


---
## å› å­å‹ `factor`: æ–‡å­—åˆ—ã¨ã®é•ã„1

å–ã‚Šã†ã‚‹å€¤ (levels) ãŒæ—¢çŸ¥ã€‚

typoãŒã‚ã‚‹ã¨ `NA` æ‰±ã„ã€‚

```{r factor}
month_levels = c(
  "Jan", "Feb", "Mar", "Apr", "May", "Jun",
  "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
)
x2 = c("Dec", "Apr", "Jam", "Mar")
factor(x2, levels = month_levels)
```

---
## å› å­å‹ `factor`: æ–‡å­—åˆ—ã¨ã®é•ã„2

é †åºãŒã‚ã‚‹ã€‚

æ–‡å­—åˆ—ã‚’ã‚½ãƒ¼ãƒˆã™ã‚‹ã¨å½“ç„¶ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ãªã‚‹ã‘ã©ã€<br>
å› å­å‹ã«ã¯ãã†ã˜ã‚ƒãªã„é †åºã‚’æŒãŸã›ã‚‰ã‚Œã‚‹:

```{r sort}
x1 = c("Dec", "Apr", "Jan", "Mar")
sort(x1)
y1 = factor(x1, levels = month_levels)
as.integer(y1)
```


---
## å› å­å‹ `factor`: é †åºã®æƒ…å ±ã¯ä½œå›³ã§ç”Ÿãã‚‹

æ–‡å­—åˆ—ãªã‚‰ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã€å› å­å‹ãªã‚‰ä»»æ„æŒ‡å®šå¯èƒ½ã€‚<br>
é »åº¦é †ã«ã™ã‚‹ä¾‹:

```{r fct_infreq, fig.height = 4}
diamonds %>%
  mutate(color = fct_infreq(color)) %>%
  ggplot(aes(x = color)) +
  geom_bar() + coord_flip()
```

---
## tidyverse ã®å› å­å‹æ‹…å½“ã¯ forcats

<a href="https://forcats.tidyverse.org/">
<img src="/_img/hex-stickers/forcats.webp" width="120" align="right">
</a>

- `fct_reorder()`: åˆ¥ã®å¤‰æ•°ã«å¿œã˜ã¦é †åºã‚’ä¸¦ã¹æ›¿ãˆ
- `fct_infreq()`: é »åº¦ã«å¿œã˜ã¦é †åºã‚’ä¸¦ã¹æ›¿ãˆ
- `fct_relevel()`: ã™ã¹ã¦æ‰‹å‹•ã§å†è¨­å®š
- `fct_lump()`: å°‘ãªã™ãã‚‹ã‚«ãƒ†ã‚´ãƒªã‚’"ãã®ä»–"ã¨ã—ã¦ã¾ã¨ã‚ã‚‹


---
## ãƒ€ãƒŸãƒ¼å¤‰æ•°ã«å¤‰æ›

ã‚¤ãƒã‚¼ãƒ­ã®å€¤ã‚’æŒãŸã›ã¦æ¨ªåºƒã«å¤‰å½¢ã™ã‚‹ã®ã¨ç­‰ä¾¡ã€‚

```{r dummy}
iris %>%
  rowid_to_column() %>% select(-starts_with("Sepal")) %>%
  mutate(value = 1L) %>%
  pivot_wider(names_from = Species, values_from = value, values_fill = c(value = 0L))
```

å•: ã“ã‚Œã®é€†å‘ãã‚’ã‚„ã£ã¦ã¿ã‚ˆã†


---
## æ—¥æ™‚å‹: POSIXct, POSIXlt

- POSIXct: ã‚¨ãƒãƒƒã‚¯ã‹ã‚‰ã®çµŒéç§’æ•°ã€‚æ¯”è¼ƒã‚„å·®åˆ†ãªã©ã‚’å–ã‚Šã‚„ã™ã„ã€‚
- POSIXlt: list(å¹´, æœˆ, æ—¥, æ™‚, åˆ†, ç§’)ã€‚å˜ä½ã”ã¨ã«æŠœãå‡ºã—ã‚„ã™ã„ã€‚

```{r datetime}
now = "2019-12-27 13:00:00"
ct = as.POSIXct(now)
unclass(ct)
lt = as.POSIXlt(now)
unclass(lt) %>% as_tibble()
```

ç´ ã®Rã§ã‚‚æ‰±ãˆã‚‹ã‘ã© lubridate ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã¨ã‚‚ã£ã¨æ¥½ã«ã€‚

---
## lubridate --- æ—¥æ™‚å‹å‡¦ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

<a href="https://lubridate.tidyverse.org/">
<img src="/_img/hex-stickers/lubridate.webp" width="120" align="right">
</a>

æ—¥æ™‚å‹ã¸ã®å¤‰æ›:
```{r lubridate-parse}
today = ymd(20191227)
ymd(c("20191227", "2019-12-27", "19/12/27"))
```

æ—¥æ™‚å‹ã‹ã‚‰å˜ä½ã”ã¨ã«å€¤ã‚’å–å¾—:
```{r lubridate-get}
month(today)
wday(today, label = TRUE)
```

[ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ](https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf)

---
## æœ¬æ—¥å‰åŠã®ã¾ã¨ã‚

- vectorã«ã¯å‹ãŒã‚ã‚‹: æ–‡å­—åˆ—ã€æ•°å€¤ã€å› å­ã€æ—¥æ™‚ã€etc.
- å¤§æ¦‚ã®æ“ä½œã¯vectorå…¨ä½“ã«ä¸€æ‹¬é©ç”¨
- æ–‡å­—åˆ—ã‚’æ‰±ã†ã«ã¯ [stringr](https://stringr.tidyverse.org/)
    - æ­£è¦è¡¨ç¾ã¯å¼·åŠ›ãƒ»æ±ç”¨çš„
- å› å­ã‚’æ‰±ã†ã«ã¯ [forcats](https://forcats.tidyverse.org/)
    - çŸ¥ã£ã¦ãŠãã¨ä½œå›³ã§æœ‰åˆ©
- æ—¥æ™‚ã‚’æ‰±ã†ã«ã¯ [lubridate](https://lubridate.tidyverse.org/)

å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ.pdfã‚’æ‰‹å…ƒã«æŒã£ã¦ãŠãã¨ä¾¿åˆ©ã€‚

---
## Reference

R for Data Science --- Hadley Wickham & Garrett Grolemund
: [Website](https://r4ds.had.co.nz/), [Book](https://amzn.to/2tbRmVc)
: [æ—¥æœ¬èªç‰ˆæ›¸ç±(Rã§ã¯ã˜ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹)](https://amzn.to/2yyFRKt)

[Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®RStudio[å®Ÿè·µ]å…¥é–€](https://amzn.to/2Q8GlhE) --- æ¾æ‘å„ªå“‰ã»ã‹<br>
[å‰å‡¦ç†å¤§å…¨](https://amzn.to/2PFe4jF) --- æœ¬æ©‹æ™ºå…‰

éå»ã®è¬›ç¾©è³‡æ–™
: ã€Œ[Rã«ã‚„ã‚‰ã›ã¦æ¥½ã—ã‚ˆã† â€” ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¨ä¸‹ã”ã—ã‚‰ãˆ](https://heavywatal.github.io/slides/nagoya2018/)ã€
   å²©åµœèˆª 2018
: ã€ŒRã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨ã€çŸ³å·ç”±å¸Œ 2019 åå¤å±‹å¤§å­¦
: ã€Œ[Hands-on R Lecture for Makino Lab](https://heavywatal.github.io/slides/makino2019r/)ã€
   å²©åµœèˆª 2019 æ±åŒ—å¤§å­¦

Official documents:
: [tidyverse](https://www.tidyverse.org/),
  [dplyr](https://dplyr.tidyverse.org/),
  [tidyr](https://tidyr.tidyverse.org/),
  [tibble](https://tibble.tidyverse.org/),
  [readr](https://readr.tidyverse.org/),
  [stringr](https://stringr.tidyverse.org/),
  [forcats](https://forcats.tidyverse.org/)
  [lubridate](https://lubridate.tidyverse.org/)

<a href="4-practice.html" rel="next" class="readmore">
4. å®Ÿè·µ: ç¾å®Ÿã®å•é¡Œã«å¯¾å‡¦ã—ã¦ã¿ã‚‹
</a>
