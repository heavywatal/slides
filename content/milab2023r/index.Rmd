+++
title = "Rãƒ‡ãƒ¼ã‚¿è§£æå…¥é–€å…¥é–€2023 â€” MILAB Rè¬›ç¿’ä¼š"
linktitle = "Rãƒ‡ãƒ¼ã‚¿è§£æå…¥é–€å…¥é–€2023"
date = 2023-02-24T18:00:00+09:00
type = "reveal"
draft = false
+++

# [Rãƒ‡ãƒ¼ã‚¿è§£æå…¥é–€å…¥é–€2023](.)

<!--
ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã«é–¢ã™ã‚‹æ›¸ç±ã®å‡ºç‰ˆã¯å¹´ã€…å¢—ãˆã¦ãŠã‚Šã€
ç„¡å„Ÿã§åˆ©ç”¨å¯èƒ½ãªæƒ…å ±ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã‚ã¡ã“ã¡ã«æ•£ã‚‰ã°ã£ã¦ã„ã¾ã™ã€‚
ã¨ã¯è¨€ãˆã€åˆå­¦è€…ã«ã¨ã£ã¦ã¯ãã†ã—ãŸæƒ…å ±ã«è¾¿ã‚Šç€ãç€ãã“ã¨ã•ãˆã‚‚å›°é›£ã ã£ãŸã‚Šã€
ãã‚Œã‚‰ã‚’èª­ã¿è§£ããŸã‚ã®å‰æçŸ¥è­˜ãŒç„¡ãã¦è‹¦åŠ´ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã—ã‚‡ã†ã€‚
æœ¬è¬›æ¼”ã¯ã“ã†ã—ãŸéšœå£ã‚’å–ã‚Šé™¤ãã€è‡ªå­¦è‡ªç¿’ã®åŠ©ã‘ã¨ãªã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚
å…·ä½“çš„ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿è§£æã®å…¨ä½“åƒã‚„å¯è¦–åŒ–ã®æ„ç¾©ã‚’æ•´ç†ã—ã€
Rã‚’ä½¿ã£ã¦ã‚ˆã‚Šæ¥½ã«ã‚ˆã‚Šæ­£ã—ãã‚„ã£ã¦ã„ããŸã‚ã®tipsã‚’ã”ç´¹ä»‹ã™ã‚‹äºˆå®šã§ã™ã€‚
-->

<div class="author">
å²©åµœ èˆª (Watal M. Iwasaki, PhD)
</div><div class="affiliation">
æ±åŒ—å¤§å­¦ ç”Ÿå‘½ç§‘å­¦ç ”ç©¶ç§‘ é€²åŒ–ã‚²ãƒãƒŸã‚¯ã‚¹åˆ†é‡ ç‰¹ä»»åŠ©æ•™<br>
(Graduate School of Life Sciences, Tohoku University)
</div>

<div class="footnote">
2023-02-24 MILAB Rè¬›ç¿’ä¼š<br>
<a href="https://heavywatal.github.io/slides/milab2023r/">https://heavywatal.github.io/slides/milab2023r/</a>
</div>

å³ä¸‹ã®çŸ¢å°ã‚„ <kbd>â†</kbd><kbd>â†’</kbd>ã‚­ãƒ¼ã§ç§»å‹•ã§ãã¾ã™ã€‚

```{r setup-global, include=FALSE, message = NA}
set.seed(24601)
knitr::opts_chunk$set(comment = NA)
knitr::opts_chunk$set(dev = "ragg_png")
knitr::opts_chunk$set(fig.retina = 120 / 72)  # change dpi without affecting out.width/height
knitr::opts_chunk$set(fig.process = wtl::oxipng)
options(
  devtools.install.args = c("--no-multiarch", "--no-test-load"),
  repos = c(CRAN = "https://cloud.r-project.org/"),
  menu.graphics = FALSE,
  mc.cores = parallel::detectCores(),
  wtl.printdf.summarize = FALSE,
  pillar.print_max = 8L,
  tibble.print_max = 8L,
  width = 9999L,
  cli.width = 60L,
  dplyr.summarise.inform = FALSE,
  readr.num_columns = 0L,
  readr.show_progress = FALSE,
  readr.show_col_types = FALSE,
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis",
  ggplot2.discrete.colour = as.vector(grDevices::palette.colors(palette = "Okabe-Ito")[-1]),
  ggplot2.discrete.fill = as.vector(grDevices::palette.colors(palette = "Okabe-Ito")[-1])
)
tidyverse_msg = utils::capture.output(library(tidyverse), type = "message")
registerS3method("print", "tbl", wtl::printdf)
registerS3method("print", "tbl_df", wtl::printdf)
```

```{r setup-local, include=FALSE}
knitr::opts_chunk$set(cache = TRUE)
```

---
## å²©åµœ èˆª = Watal M. Iwasaki.&nbsp; Call me METALğŸ¤˜

<img src="/slides-draft/image/profile/google-map.png" height="580" align="right">

Born and raised in Sendai

PhD in Life Sciences, Tohoku University
: Evolutionary theory of complexity and diversity in biological systems. ğŸ–¥

Postdoc in SOKENDAI, Hayama
: Evolution of diversity within a tumor/cancer. ğŸ¥
: Population genetics of Pacific bluefin tuna. ğŸŸ
: Speciation of transposons. ğŸ§¬

<img src="/slides-draft/image/profile/bicycle.jpg" height="220" align="right" style="transform: translate(-10px, 0px);">

Asst. Prof. in Tohoku University
: Genomics of Rice ğŸŒ¾ğŸš, etc.

Likes
: ğŸº Beer, Sake, Whisky, Cooking
: â™¬ Heavy Metal, Classical, Folk


---
## æœ¬æ—¥ã®ãŠã—ãªãŒã

> ä¸€æ™‚é–“ç¨‹åº¦ã®ã‚»ãƒŸãƒŠãƒ¼å½¢å¼ã§ã€<br>
> ãƒ‡ãƒ¼ã‚¿è§£æã€å¯è¦–åŒ–ã®æ„ç¾©ã€å“²å­¦çš„ãªã¨ã“ã‚ã®<br>
> ãŠè©±ã‚’èã„ã¦ã¿ãŸã„ã§ã™ã€‚<br>
> â€”â€”æ–°äº•ç”°ã•ã‚“

<small><s>ï¼ˆãªã‚“ã¨ã„ã†ç„¡èŒ¶æŒ¯ã‚Š...ï¼‰</s></small>
è²´é‡ãªæ©Ÿä¼šã‚’ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

90åˆ†6â€“8ã‚³ãƒã®è¬›ç¾©ã‹ã‚‰ã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆ
: ç§‘å­¦ç ”ç©¶ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿è§£æã¨ãƒ¢ãƒ‡ãƒ«
: ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã®é‡è¦æ€§
: ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
: Rä½¿ç”¨ä¸Šã®åŸºæœ¬çš„ãªå¿ƒæ§‹ãˆ


---
## ç§‘å­¦ã®å–¶ã¿ = å·¨äººã®è‚©ã«ç«‹ã¤

<figure style="position: absolute; top: 32px; right: 40px;">
<a href="https://en.wikipedia.org/wiki/Standing_on_the_shoulders_of_giants">
<img src="/slides/image/free/Orion_aveugle_cherchant_le_soleil.jpg" width="240">
<figcaption class="url">
https://en.wikipedia.org/wiki/<br>Standing_on_the_shoulders_of_giants
</figcaption>
</a>
</figure>

å…ˆäººãŸã¡ã®ç©ã¿é‡ã­ã«åŸºã¥ã„ã¦ã€æ–°ã—ã„ç™ºè¦‹ã‚’ã™ã‚‹ã€‚<br>
**Reproducible Research (å†ç¾å¯èƒ½ãªç ”ç©¶)**<br>
ãŒå·¨äººã‚’å¤§ããã™ã‚‹ã€‚

è¨˜éŒ²ã‚’æ®‹ã™ã“ã¨ã¯ä½•ã‚ˆã‚Šé‡è¦
: å®Ÿé¨“ã‚„é‡å¤–è¦³å¯Ÿã§ã¯äº›ç´°ãªã“ã¨ã‚‚æ¼ã‚‰ã•ãšè¨˜éŒ²ã€‚
: ç”Ÿãƒ‡ãƒ¼ã‚¿ã¯ä½•é‡ã«ã‚‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€‚

ãƒ‡ãƒ¼ã‚¿æ•´ç†ãƒ»è§£æãƒ»ä½œå›³ã‚‚ä¸å¯æ¬ ã€ã ã‘ã©...
: å†ç¾ä¸èƒ½ã®è·äººæŠ€ã§åˆ‡ã‚ŠæŠœã‘ã¡ã‚ƒã†äººã‚‚å¤šã„ã€‚
: ã‚³ãƒ”ãƒšã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠã€é…è‰²ã¨é…ç½®ã‚’å¾®èª¿æ•´...

ç–‘ç¾©ãŒç”Ÿã˜ãŸã‚‰...ï¼Ÿ åˆ¥ã®äººãŒãã®ç ”ç©¶ã‚’ç™ºå±•ã•ã›ãŸã„ã¨ã...ï¼Ÿ
: âœ…ã€Œèª°ã§ã‚‚ç¢ºå®Ÿã«å†ç¾ã§ãã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒã“ã¡ã‚‰ã§ã™ã€
: ğŸ’©ã€Œã‚ã‚Šã¾ãã™ï¼ã€

---
## ãƒã‚¦ã‚¹æ“ä½œã¨ã‚³ãƒ”ãƒšã‚’é§†ä½¿ã—ãŸè·äººæŠ€ã¯å†ç¾ä¸å¯èƒ½

ã¡ã‚ƒã‚“ã¨åˆã£ã¦ã‚‹ã®ã‹ãª... ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚¿ãƒ–ã‚‚ãŸãã•ã‚“...

<figure style="position: relative;">
<img src="/slides/image/messy/dir-z.png" class="screenshot" height="550"
     style="position: absolute; z-index: 100;">
<img src="/slides/image/messy/file-z-book1.png" class="screenshot" height="480"
     style="position: absolute; left: 250px; top: 50px;">
<img src="/slides/image/messy/file-z-z-behavior-z1e.png" class="screenshot" height="480"
     style="position: absolute; left: 30px; top: 20px; z-index: 200;">
<img src="/slides/image/messy/file-z-z-behavior-z1p.png" class="screenshot" height="480"
     style="position: absolute; left: 260px; top: 40px; z-index: 300;">
</figure>

---
## ç ”ç©¶ã®åŸºæœ¬ãƒ—ãƒ­ã‚»ã‚¹

1. èª²é¡Œã‚’è¦‹ã¤ã‘ã‚‹ã€ä»®èª¬ã‚’ç«‹ã¦ã‚‹
1. å®Ÿé¨“ğŸ§«ãƒ»è¦³å¯ŸğŸ”¬ãƒ»æ–‡çŒ®ğŸ“šãªã©ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’é›†ã‚ã‚‹
1. **ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ãƒ»è§£æã—ã¦ä»®èª¬ã‚’æ¤œè¨¼ã™ã‚‹**
1. **çµæœã‚’å ±å‘Šã™ã‚‹**ã€1ã«æˆ»ã‚‹

<br>

- å®Ÿé¨“ã‚„è¦³å¯Ÿã¯ç ”ç©¶ã®åŠåˆ†ãã‚‰ã„ã€‚
- æ®‹ã‚ŠåŠåˆ†ã¯ãƒ‡ãƒ¼ã‚¿ã®æ•´ç†ãƒ»è§£æãƒ»å ±å‘Šã€‚<br>
  â†’ ã—ã‹ã—è»½è¦–ã•ã‚ŒãŒã¡ã€‚ã“ã“ã‚’**ã¡ã‚ƒã‚“ã¨ã€ã§ã‚‚æ¥½ã«**ã‚„ã‚ŠãŸã„ã€‚


---
## ãƒ‡ãƒ¼ã‚¿è§£æã£ã¦å¿…è¦ï¼Ÿ ç”Ÿãƒ‡ãƒ¼ã‚¿ã“ãè‡³é«˜ã§ã¯ï¼Ÿ

ç”Ÿã®ã¾ã¾ã§ã¯è¤‡é›‘éãã€æƒ…å ±å¤šã™ãã€ä½•ã‚‚ã‚ã‹ã‚‰ãªã„ã€‚

```{r diamonds}
print(ggplot2::diamonds)
```

ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰53,940å€‹ã«ã¤ã„ã¦10é …ç›®ã®å€¤ã‚’æŒã¤ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

---
## è¦ç´„çµ±è¨ˆé‡ã‚’è¦‹ã¦ã¿ã‚ˆã†

å„åˆ—ã®**å¹³å‡**ã¨ã‹**æ¨™æº–åå·®**ã¨ã‹:

```{r summary-diamonds, echo = FALSE}
dia_cols = c("carat", "depth", "table", "price")
diamonds %>%
  dplyr::summarize(across(all_of(dia_cols), list(mean = mean, sd = sd, max = max))) %>%
  tidyr::pivot_longer(everything(), names_to = c(".value", "stat"), names_sep = "_") %>%
  dplyr::mutate(across(where(is.numeric), round, digits = 2))
```

å¤§ãã• `carat` ã¨ä¾¡æ ¼ `price` ã®**ç›¸é–¢ä¿‚æ•°**ã¯ã‹ãªã‚Šé«˜ã„:
```{r cov-diamonds, echo = FALSE}
diamonds %>%
  dplyr::select(all_of(dia_cols)) %>%
  scale() %>%
  cov() %>%
  wtl::printmat("%.2f", upper = FALSE)
```

**ç”Ÿã®ã¾ã¾ã‚ˆã‚Šã¯æŠŠæ¡ã—ã‚„ã™ã„**ã‹ã‚‚ã€‚


---
## åˆ†å¸ƒã‚’ç‰¹å¾´ã¥ã‘ã‚‹ä»£è¡¨å€¤ central tendency

<div class="column-container">
  <div class="column" style="flex-shrink: 1.6;">

å¹³å‡å€¤ mean
: å’Œã‚’è¦³å¯Ÿæ•°ã§å‰²ã‚‹

ä¸­å¤®å€¤ median
: é †ã«ä¸¦ã¹ã¦çœŸã‚“ä¸­

æœ€é »å€¤ mode
: æœ€ã‚‚é »åº¦ãŒé«˜ã„å€¤

  </div>
  <div class="column">
  <a href="https://www.mhlw.go.jp/toukei/list/20-21.html">
  <img src="../tohoku2022r/image/hist-income-japan-2019.png" width="100%" style="">
  <figcaption><cite>æ‰€å¾—é‡‘é¡éšç´šåˆ¥ä¸–å¸¯æ•°ã®é »åº¦åˆ†å¸ƒ åšç”ŸåŠ´åƒçœ å›½æ°‘ç”Ÿæ´»åŸºç¤èª¿æŸ» 2019</cite></figcaption>
  </a>
  </div>
</div>

ç›®çš„ã‚„çŠ¶æ³ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘ã‚ˆã†ã€‚

å¤–ã‚Œå€¤ã«å¯¾ã™ã‚‹å¿œç­”
: ã‚‚ã—ç·è³‡ç”£é¡20å…†å††ã®å¤§å¯Œè±ªãŒé³¥å–çœŒã«å¼•ã£è¶Šã—ã¦ããŸã‚‰<br>
  â†’ çœŒæ°‘ã®**å¹³å‡**è³‡ç”£ã¯4000ä¸‡å††ä¸Šæ˜‡ã€‚**ä¸­å¤®å€¤**ãƒ»**æœ€é »å€¤**ã¯ã»ã¼ãã®ã¾ã¾ã€‚

---
## ã°ã‚‰ã¤ãã‚’æ‰ãˆã‚‹è¨˜è¿°çµ±è¨ˆé‡

åˆ†æ•£ variance
: å¹³å‡å€¤ã‹ã‚‰ã®å·®ã®è‡ªä¹—ã®å¹³å‡ã€‚ $\frac 1 n \sum _i ^n (X_i - \bar X)^2$
: ã“ã‚Œã®å¹³æ–¹æ ¹ãŒ**æ¨™æº–åå·® (standard deviation)**ã€‚

Percentile, Quantile (å››åˆ†ä½)
: å°ã•ã„é †ã«ãªã‚‰ã¹ã¦ä¸Šä½ä½•%ã«ã‚ã‚‹ã‹ã€‚
: ä¸­å¤®å€¤ = 50th percentile = ç¬¬äºŒå››åˆ†ä½(Q2)

```{r quantile, fig.width = 10, fig.height = 4, echo = FALSE}
df = tibble::tibble(x = rnorm(200)) %>%
  dplyr::filter(abs(x) < 2) %>%
  dplyr::mutate(x = x + 3)
dfq = df %>% summarize(
  min = min(x),
  Q1 = quantile(x, 0.25),
  Q2 = quantile(x, 0.50),
  Q3 = quantile(x, 0.75),
  max = max(x)
) %>%
  tidyr::pivot_longer(everything(), values_to = "x") %>%
  dplyr::mutate(percent = paste0(c(0, 25, 50, 75, 100), "%"))
p_hist = ggplot(df) + aes(x) + geom_histogram(bins = 30) +
  theme_void(base_size = 18)
p_box = ggplot(df) + aes(x) +
  geom_boxplot() +
  geom_rug(length = unit(0.06, "npc"), alpha = 0.7) +
  geom_point(data = dfq, aes(y = -0.6), shape = 17, size = 4) +
  geom_text(data = dfq, aes(y = -0.75, label = name), size = 5) +
  geom_text(data = dfq, aes(y = -0.95, label = percent), size = 5) +
  coord_cartesian(ylim = c(-1.2, 0.4)) +
  theme_void(base_size = 18)
cowplot::plot_grid(p_hist, p_box, ncol = 1L)
```


---
## 2ã¤ã®é‡ã®é–¢ä¿‚æ€§: å¤§å°ã®æ¯”è¼ƒ

ã°ã‚‰ã¤ãã®åº¦åˆã„ã‚‚åŠ å‘³ã—ã¦åˆ¤æ–­ã™ã‚‹ã€‚

<div class="column-container" style="padding-left: 10px;">
<div class="column" style="flex-shrink: 1.1;">
è¦³æ¸¬å€¤1ã¤ã ã‘ã€‚<br>
ãŸã¾ãŸã¾ã‹ã‚‚ã€‚
</div>
<div class="column" style="flex-shrink: 1;">
ã°ã‚‰ã¤ãå¤§ãã„ã€‚<br>
BãŒé«˜ã„ã®ã‚‚ãŸã¾ãŸã¾?
</div>
<div class="column" style="flex-shrink: 1;">
ã°ã‚‰ã¤ãå°ã•ã„ã€‚<br>
Aã¨Bã«ã¯å·®ãŒã‚ã‚Šãã†ã€‚
</div>
</div>

```{r comparison, fig.width = 11, fig.height = 4, echo = FALSE}
n = 20
df1 = tibble::tibble(x = c("A", "B"), y = c(42, 51))
df2 = dplyr::bind_rows(
  tibble::tibble(x = "A", y = runif(n, 42 - 20, 42 + 20)),
  tibble::tibble(x = "B", y = runif(n, 51 - 20, 51 + 20)))
df3 = dplyr::bind_rows(
  tibble::tibble(x = "A", y = rnorm(n, 42, 1)),
  tibble::tibble(x = "B", y = rnorm(n, 51, 1)))
.lim = c(0, max(df2$y, df3$y))
.th = list(coord_cartesian(ylim = .lim),
  theme_classic(base_size = 20),
  theme(legend.position = "none", axis.title = element_blank()))

p1 = ggplot(df1) + aes(x, y, fill = x) +
  geom_col() +
  .th
p2 = ggplot(df2) + aes(x, y, color = x) +
  geom_jitter(height = 0, width = 0.2, shape = 16, size = 3, alpha = 0.66) +
  .th
cowplot::plot_grid(p1, p2, p2 %+% df3, nrow = 1)
```

ã€Œã“ã‚“ãªã“ã¨ãŒãŸã¾ãŸã¾èµ·ã“ã‚‹ç¢ºç‡ã¯ã™ã”ãä½ã„ã§ã™ï¼ã€<br>
ã‚’ã¡ã‚ƒã‚“ã¨ç¤ºã™æ‰‹ç¶šããŒ**çµ±è¨ˆçš„ä»®èª¬æ¤œå®š**ã€‚

---
## è¨˜è¿°çµ±è¨ˆé‡ã«é ¼ã‚Šã™ããšåˆ†å¸ƒã‚’å¯è¦–åŒ–ã™ã‚‹

åŒã˜ãƒ‡ãƒ¼ã‚¿ã§ã‚‚è¦‹ã›æ–¹ã§å°è±¡ãƒ»æƒ…å ±é‡ãŒå¤‰ã‚ã‚‹ã€‚

```{r visualize-distribution, echo = FALSE, fig.width = 9, fig.height = 6}
df = mpg |> dplyr::mutate(y = hwy)
df_mean = df |> dplyr::summarize(y = mean(y))
p0 = ggplot(df) + aes(y = y) +
  theme_classic() +
  theme(axis.title = element_blank(), axis.text.x = element_blank(), axis.ticks = element_blank())

ylim = c(0, max(df$y))
coord_y = coord_cartesian(ylim = ylim)
coord_one = coord_cartesian(ylim = ylim, xlim = c(-1, 1))

pcol = p0 + aes(x = 0) +
  geom_col(data = df_mean, fill = "#999999") +
  stat_summary(fun.data = wtl::mean_sd, geom = "linerange")

cowplot::plot_grid(nrow = 2L,
  pcol + coord_one,
  p0 + geom_boxplot() + coord_one,
  p0 + geom_density(fill = "#999999", color = NA) + coord_y,
  p0 + geom_histogram(fill = "#999999", bins = 30L) + coord_y,
  p0 + geom_jitter(aes(x = 0), height = 0, shape = 16, alpha = 0.3, stroke = 0) + coord_one,
  p0 + geom_violin(aes(x = 0), fill = "#999999", color = NA) + coord_one,
  p0 + geom_dotplot(aes(x = 0), binaxis = "y", binwidth = 1, stackratio = 0.8, stroke = 0, alpha = 0.66, stackdir = "center") + coord_y,
  p0 + geom_dotplot(aes(x = 0), binaxis = "y", binwidth = 1, stackratio = 0.8, stroke = 0, alpha = 0.66) + coord_y
)
```


---
## ä»£è¡¨å€¤ã°ã‹ã‚Šè¦‹ã¦å¯è¦–åŒ–ã‚’æ€ ã‚‹ã¨æ§‹é€ ã‚’è¦‹é€ƒã™

<figure style="position: relative;">
<a href="https://www.autodesk.com/research/publications/same-stats-different-graphs">
<img src="/slides/image/rstats/datasaurus.png" width="800">
<figcaption class="url">https://www.autodesk.com/research/publications/same-stats-different-graphs</figcaption>
</a>
<img src="/slides/image/rstats/DataDino-600x455.gif" width="180"
     style="position: absolute; left: 0; top: 0; z-index: 255;">
</figure>


---
## ä½œå›³ã—ã¦ã¿ã‚‹ã¨å…¨ä½“åƒãƒ»æ§‹é€ ãŒè¦‹ã‚„ã™ã„

æƒ…å ±ã‚’ã†ã¾ãçµã£ã¦æ•´ç† â†’ **ç›´æ„Ÿçš„ã«ã‚ã‹ã‚‹**ã€ä»®èª¬ç”Ÿæˆ

```{r simplify-diamonds, echo = FALSE, fig.height = 6, fig.width = 7}
diamonds %>%
  dplyr::filter(clarity %in% c("I1", "SI2", "IF")) %>%
  ggplot(aes(carat, price, color = clarity)) +
  geom_point(alpha = 0.4, size = 3) +
  scale_color_viridis_d(
    guide = guide_legend(reverse = TRUE, override.aes = list(alpha = 1))
  ) +
  labs(title = "Diamonds") +
  theme_bw(base_size = 22) +
  theme(panel.grid.minor = element_blank())
```

`carat` ãŒå¤§ãã„ã»ã© `price` ã‚‚é«˜ã„ã‚‰ã—ã„ã€‚<br>
ãã®åº¦åˆã„ã¯ `clarity` ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã‚‰ã—ã„ã€‚

---
## çµ±è¨ˆã¨ã¯

ãƒ‡ãƒ¼ã‚¿ã‚’ã†ã¾ãã¾ã¨ã‚ã€ãã‚Œã«åŸºã¥ã„ã¦æ¨è«–ã™ã‚‹ãŸã‚ã®æ‰‹æ³•ã€‚

- **è¨˜è¿°çµ±è¨ˆ**: ãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã‚’è¦ç´„ã™ã‚‹
    - è¦ç´„çµ±è¨ˆé‡ (e.g., å¹³å‡ã€æ¨™æº–åå·®ã€etc.)
    - ä½œå›³ã€ä½œè¡¨
- **æ¨æ¸¬çµ±è¨ˆ**: ãƒ‡ãƒ¼ã‚¿ã®èƒŒå¾Œã«ã‚ã‚‹æ¯é›†å›£ãƒ»ç”Ÿæˆéç¨‹ã‚’è€ƒãˆã‚‹
    - æ•°ç†ãƒ¢ãƒ‡ãƒ«
    - ç¢ºç‡åˆ†å¸ƒ
    - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(æ¯æ•°)

ã€Œã‚°ãƒ©ãƒ•ã‚’çœºã‚ã¦ãªã‚“ã¨ãªãåˆ†ã‹ã‚‹ã€ä»¥ä¸Šã®åˆ†æã«ã¯**ãƒ¢ãƒ‡ãƒ«**ãŒå¿…è¦

---
## ãƒ¢ãƒ‡ãƒ«ã¨ã¯

å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ã‚’å˜ç´”åŒ–ãƒ»ç†æƒ³åŒ–ã—ã¦æ‰±ã„ã‚„ã™ãã—ãŸã‚‚ã®

Mathematical Model æ•°ç†ãƒ¢ãƒ‡ãƒ«<img src="../tokiomarine2021/image/hill-equation.png" width="150" align="right" style="margin: 0 -5px;">
: æ•°å­¦çš„ãªæ–¹ç¨‹å¼ã¨ã—ã¦è¨˜è¿°ã•ã‚Œã‚‹ã‚‚ã®ã€‚
: e.g., Lotka-Volterra eq., <span style="color: #888;">Hill eq.</span>
: <br>

Computational Model æ•°å€¤è¨ˆç®—ãƒ¢ãƒ‡ãƒ«<img src="/slides/image/tumopp/Chex_Lconst.gif" width="140" align="right">
: æ•°å€¤è¨ˆç®—ã®æ‰‹ç¶šãã¨ã—ã¦è¨˜è¿°ã•ã‚Œã‚‹ã‚‚ã®ã€‚
: e.g., Schellingâ€™s Segregation Model, <span style="color: #888;"><em>tumopp</em></span>
: <br>

Concrete Model å…·è±¡ãƒ¢ãƒ‡ãƒ«<img src="../tokiomarine2021/image/weisberg-sfbay.jpg" width="260" align="right">
: å…·ä½“çš„ãªäº‹ç‰©ã§ä½œã‚‰ã‚Œã‚‹ã‚‚ã®ã€‚
: e.g., San Francisco Bay-Delta Model

<cite>
Weisberg 2012 "Simulation and Similarity" (ç§‘å­¦ã¨ãƒ¢ãƒ‡ãƒ«)
</cite>

???
æ•°ç†ãƒ¢ãƒ‡ãƒ«ãŒæ±ºå®šè«–çš„ã€æ•°å€¤è¨ˆç®—ãŒç¢ºç‡è«–çš„ã€ã«ãªã‚‹å ´åˆãŒå¤šã„ã‘ã©å¿…ãšã—ã‚‚ãã†ã§ã¯ãªã„ã€‚
è§£æçš„ã«è§£ãã“ã¨ã‚’è«¦ã‚ã¦è¨ˆç®—æ©Ÿã«ã‚„ã‚‰ã›ã‚‹ã¨ã„ã†ç‚¹ã§å®Ÿè£…æ–¹æ³•ã¯ç•°ãªã‚‹ãŒã€
æ•°ç†çš„ã«è¨˜è¿°ã—ã¦è§£é‡ˆã™ã‚‹ã¨ã„ã†å¤§æ ã§ã¯åŒã˜ã¨ã¿ãªã—ãŸã»ã†ãŒã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

ãƒ—ãƒ©ãƒ¢ãƒ‡ãƒ«: è»Šã‚„é£›è¡Œæ©Ÿã®é‡ã•ãƒ»æè³ªã¯ç„¡è¦–ã—ã¦è‰²ã‚„å½¢ã‚’æ¨¡å€£
<img src="../lifesci2020seminar/image/schelling-segregation.gif" width="160" align="right" style="margin: -20px -15px; height: 160px; object-fit: cover;">

---
## ã‚¦ã‚§ãƒƒãƒˆãªå®Ÿé¨“ã‚‚ãƒ¢ãƒ‡ãƒ«ã®ä¸€ç¨®ã¨è¦‹ãªã›ã‚‹

å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ã‚’å˜ç´”åŒ–ãƒ»ç†æƒ³åŒ–ã—ã¦æ‰±ã„ã‚„ã™ãã—ãŸã‚‚ã®<br>
â†’ è‡ªç„¶ã§ã¯ã‚ã‚Šãˆãªã„çŠ¶æ³ã«ã—ã¦ã§ã‚‚ã€è¦‹ãŸã„é–¢ä¿‚ã‚’è¦‹ã‚‹<br>
â†’ ã€ŒXã‚’å¤‰ãˆã‚Œã°YãŒå¤‰ã‚ã‚‹ã€ã¨ã„ã†**é‚„å…ƒçš„ãªç†è§£ã®1ã‚¹ãƒ†ãƒƒãƒ—**

- ãƒã‚¤ã‚ºã‚’ãªã‚‹ã¹ãé™¤å»
  - æ „é¤Šã‚„æ¸©åº¦ãªã©ã€**ç’°å¢ƒã‚’æƒãˆã‚‹**
  - è¿‘è¦ªäº¤é…ã‚’ç¹°ã‚Šè¿”ã—ã¦ç´”ç³»ã‚’ä½œã‚Šã€**éºä¼çš„èƒŒæ™¯ã‚’æƒãˆã‚‹**
- èˆˆå‘³ã®ã‚ã‚‹è¦å› ã®ã¿å¤‰ãˆã¦ã€è¡¨ç¾å‹ã®é•ã„ã‚’è©•ä¾¡
  - éºä¼å­1ã¤2ã¤ã ã‘æ”¹å¤‰
  - æŠ•ä¸ã™ã‚‹è–¬å‰¤ã®ç¨®é¡ãƒ»é‡ã‚’å¤‰ãˆã¦ã¿ã‚‹
  - æ „é¤Šå¡©ã®æ¿ƒåº¦ã¨å…‰ã®å¼·ã•ã‚’å¤‰ãˆã¦ã¿ã‚‹

ãƒ‰ãƒ©ã‚¤ã®ç†è«–ç ”ç©¶è€…ã‚’æŒ‡ã—ã¦ã€Œãƒ¢ãƒ‡ãƒ«å±‹ã€ã¨å‘¼ã³ãŒã¡ã ãŒã€<br>
åºƒã„æ„å‘³ã§ã¯ç”Ÿç‰©å­¦è€…ã¿ã‚“ãªã€Œãƒ¢ãƒ‡ãƒ«å±‹ã€ã€‚


---
## ãƒ‡ãƒ¼ã‚¿ç§‘å­¦ã«ãŠã‘ã‚‹æ•°ç†ãƒ¢ãƒ‡ãƒ«

ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚’ã†ã¾ãçœŸä¼¼ã§ããã†ãªä»®å®šã®æ•°å¼è¡¨ç¾ã€‚<br>
&nbsp;

<figure>
<img src="../tokiomarine2021/math-model.drawio.svg"><br>
<figcaption><cite>ã€Œãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã®æ•°ç†ãƒ¢ãƒ‡ãƒ«å…¥é–€ã€æ±Ÿå´è²´è£• 2020 ã‚ˆã‚Šæ”¹å¤‰</cite></figcaption>
</figure>


???

ç¢ºç‡ãƒ¢ãƒ‡ãƒ«: æ±ºå®šè«–çš„ãªãƒ¢ãƒ‡ãƒ«ã˜ã‚ƒãªãã¦ç¢ºç‡è«–çš„ãªã‚†ã‚‰ãã‚’å°å…¥ã—ãŸã‚‚ã®ã€‚
ãŸã ã—ã€å¤§å¡šæ·³ã•ã‚“ã®å®šç¾©ã¯ç•°ãªã‚‹ã€‚
å¸°ç´æ¨è«–ã‚’å¯èƒ½ã«ã™ã‚‹æ çµ„ã¿ã¨ã—ã¦è‡ªç„¶ã®æ–‰ä¸€æ€§(ãƒ’ãƒ¥ãƒ¼ãƒ )ã‚’ä»®å®šã—ãŸä¸Šã§ã€
ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹çœŸã®ç¾è±¡ã‚’ç¢ºç‡ç”¨èªã§è¨˜è¿°ã—ãŸã‚‚ã®ãŒç¢ºç‡ãƒ¢ãƒ‡ãƒ«ã ã€ã¨ã„ã†æ„Ÿã˜ã€‚
ãã“ã‹ã‚‰ã•ã‚‰ã«å¼·ã„ä»®å®šã¨ã—ã¦ãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯ãªç¢ºç‡åˆ†å¸ƒã‚’ç”Ÿæˆå…ƒã¨ã—ãŸã®ãŒçµ±è¨ˆãƒ¢ãƒ‡ãƒ«ã€‚

---
## ãƒ‡ãƒ¼ã‚¿ç§‘å­¦ã«ãŠã‘ã‚‹æ•°ç†ãƒ¢ãƒ‡ãƒ«

ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚’ã†ã¾ãçœŸä¼¼ã§ããã†ãªä»®å®šã®æ•°å¼è¡¨ç¾ã€‚<br>
e.g., å¤§ãã„ã»ã©é«˜ãå£²ã‚Œã‚‹: $\text{price} = A \times \text{carat} + B + \epsilon$

```{r lm-diamonds, echo = FALSE, fig.height = 5, fig.width = 6}
diamonds %>%
  dplyr::filter(clarity %in% c("I1", "SI2", "IF")) %>%
  ggplot(aes(carat, price)) +
  geom_point(alpha = 0.3, size = 3) +
  stat_smooth(formula = y ~ x, method = lm, se = FALSE) +
  coord_cartesian(ylim = c(0, 20000)) +
  labs(title = "Diamonds") +
  theme_classic(base_size = 22)
```

ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®ä¾¡æ ¼ã¯ã“ã†ã„ã†æ•°å¼ã§ãŠã‚ˆãè¡¨ã›ã‚‹ã€ã¨ã„ã†ç†è§£<br>
â†’ ãƒ¢ãƒ‡ãƒ«ã‚’ã•ã‚‰ã«æ”¹è‰¯ã—ã¦ã„ãã€ç†è§£ã®ç²¾åº¦ã‚’ä¸Šã’ã‚‰ã‚Œã‚‹ã‹ã‚‚


---
## ãƒ‡ãƒ¼ã‚¿è§£æã®ãŠãŠã¾ã‹ãªæµã‚Œ

1. ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ç’°å¢ƒã®æ•´å‚™
1. ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã€èª­ã¿è¾¼ã¿
1. æ¢ç´¢çš„ãƒ‡ãƒ¼ã‚¿è§£æ
    - **å‰å‡¦ç†ã€åŠ å·¥** (åŠ´åŠ›ã®8å‰²ã¯ã“ã“ã¨ã„ã†èª¬ã‚‚)
    - å¯è¦–åŒ–ã€ä»®èª¬ç”Ÿæˆ (ã¾ãšã“ã“ã‚’ç›®æŒ‡ã™ï¼)
    - çµ±è¨ˆè§£æã€ä»®èª¬æ¤œè¨¼ (ã¿ã‚“ãªé‡è¦–ã—ãŒã¡)
1. å ±å‘Šã€ç™ºè¡¨

<figure>
<a href="https://r4ds.had.co.nz/introduction.html">
<img src="/slides/image/r4ds/data-science.png">
<figcaption class="url">https://r4ds.had.co.nz/introduction.html</figcaption>
</a>
</figure>


---
## æ©Ÿæ¢°å‡¦ç†ã—ã‚„ã™ã„å½¢ vs äººãŒèª­ã¿æ›¸ãã—ã‚„ã™ã„å½¢

ä½œå›³ã‚„è§£æã«ä½¿ãˆã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¯ã»ã¼æ±ºã¾ã£ã¦ã‚‹
: `ggplot(data, ...)`, `glm(..., data, ...)`, ...

å‡ºç™ºç‚¹ã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã•ã¾ã–ã¾
: å®Ÿé¨“ãƒãƒ¼ãƒˆã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒ¼ãƒˆã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€...

> Happy families are all alike;<br>
> every unhappy family is unhappy in its own way<br>
> --- Leo Tolstoy "Anna Karenina"

> tidy datasets are all alike,<br>
> but every messy dataset is messy in its own way<br>
> --- Hadley Wickham


---
## æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data &nbsp; vs &nbsp; é›‘ç„¶ãƒ‡ãƒ¼ã‚¿ messy data

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1.png" height="550" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1.png" width="300" style="transform: translate(-14px, 0);">
    <div style="position: absolute; top: 440px;">
    ç¸¦1åˆ—ã¯1ã¤ã®å¤‰æ•°<br>
    æ¨ª1è¡Œã¯1ã¤ã®è¦³æ¸¬<br>
    1ã‚»ãƒ«ã¯1ã¤ã®å€¤<br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>

---
## æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data &nbsp; vs &nbsp; é›‘ç„¶ãƒ‡ãƒ¼ã‚¿ messy data

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1-var.png" height="580" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1-var.png" width="420" style="transform: translate(-36px, -10px);">
    <div style="position: absolute; top: 440px;">
    <strong>ç¸¦1åˆ—ã¯1ã¤ã®å¤‰æ•°</strong><br>
    æ¨ª1è¡Œã¯1ã¤ã®è¦³æ¸¬<br>
    1ã‚»ãƒ«ã¯1ã¤ã®å€¤<br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>

---
## æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data &nbsp; vs &nbsp; é›‘ç„¶ãƒ‡ãƒ¼ã‚¿ messy data

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1-obs.png" height="530" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1-obs.png" width="300" style="transform: translate(-24px, 0);">
    <div style="position: absolute; top: 440px;">
    ç¸¦1åˆ—ã¯1ã¤ã®å¤‰æ•°<br>
    <strong>æ¨ª1è¡Œã¯1ã¤ã®è¦³æ¸¬</strong><br>
    1ã‚»ãƒ«ã¯1ã¤ã®å€¤<br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>

---
## æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data &nbsp; vs &nbsp; é›‘ç„¶ãƒ‡ãƒ¼ã‚¿ messy data

<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1-obs.png" height="530" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1-val.png" width="300" style="transform: translate(-14px, 4px);">
    <div style="position: absolute; top: 440px;">
    ç¸¦1åˆ—ã¯1ã¤ã®å¤‰æ•°<br>
    æ¨ª1è¡Œã¯1ã¤ã®è¦³æ¸¬<br>
    <strong>1ã‚»ãƒ«ã¯1ã¤ã®å€¤</strong><br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
è¥¿åŸå²æšã€Œæ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ã€https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>


---
## æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data &nbsp; â‰ˆ &nbsp; ggplot ã—ãŸããªã‚‹å½¢

- **ç¸¦1åˆ—**ã¯1ã¤ã®**å¤‰æ•°**
- **æ¨ª1è¡Œ**ã¯1ã¤ã®**è¦³æ¸¬**
- **1ã‚»ãƒ«**ã¯1ã¤ã®**å€¤**

<cite style="display: block; text-align: right;">
<a class="url" href="https://r4ds.had.co.nz/tidy-data.html">https://r4ds.had.co.nz/tidy-data.html</a>
</cite>

```{r tidy_example}
print(ggplot2::diamonds)
```


---
## æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ tidy data &nbsp; â‰ˆ &nbsp; ggplot ã—ãŸããªã‚‹å½¢

xè»¸ã€yè»¸ã€è‰²åˆ†ã‘ã€ãƒ‘ãƒãƒ«åˆ†ã‘ãªã©ã‚’åˆ—ã®åå‰ã§æŒ‡å®šã—ã¦ç°¡å˜ä½œå›³:

```{r tidy-data-benefit, fig.height = 6, fig.width = 9}
ggplot(diamonds) + aes(x = carat, y = price) +
  geom_point(mapping = aes(color = color, size = clarity)) +
  facet_wrap(vars(cut))
```

---
## å‰å‡¦ç†: ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ä¸‹ã”ã—ã‚‰ãˆã—ã¦é£Ÿã¹ã‚„ã™ã„å½¢ã«

```{r messy_example}
print(VADeaths)
```

â†“ ä¸‹ã”ã—ã‚‰ãˆ: ä½œå›³ãƒ»è§£æã§ä½¿ã„ã‚„ã™ã„æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã«

```{r tidy_vadeaths, echo=FALSE}
VADeaths %>%
  as.data.frame() %>%
  rownames_to_column("age") %>%
  pivot_longer(!age, names_to = c("region", "sex"), names_sep = " ", values_to = "death") %>%
  separate(age, c("lbound", "ubound"), convert = TRUE)
```


---
## å‰å‡¦ç†ã¯å¤§ãã2ã¤ã«åˆ†ã‘ã‚‰ã‚Œã‚‹

<div style="float: right;">
<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="120">
</a><br>
<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="120">
</a><br>
<a href="https://stringr.tidyverse.org/">
<img src="/_img/hex-stickers/stringr.webp" width="120">
</a>
</div>

- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å¯¾è±¡ã¨ã™ã‚‹å‡¦ç†
    - ä½¿ã„ãŸã„éƒ¨åˆ†ã ã‘æŠ½å‡º
    - ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ç‰¹å¾´ã‚’è¦ç´„
    - ä½•ã‹ã®é †ã«ä¸¦ã¹æ›¿ãˆ
    - ç•°ãªã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã®çµåˆ
    - å¤‰å½¢: ç¸¦é•· â†” æ¨ªåºƒ
- ãƒ‡ãƒ¼ã‚¿å†…å®¹ã‚’å¯¾è±¡ã¨ã™ã‚‹å‡¦ç†
    - æ•°å€¤ã®å¤‰æ›: å¯¾æ•°ã€æ­£è¦åŒ–
    - å¤–ã‚Œå€¤ãƒ»æ¬ æå€¤ã¸ã®å¯¾å‡¦
    - å‹å¤‰æ›: é€£ç¶šå¤‰æ•°ã€ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã€æŒ‡ç¤ºå¤‰æ•°ã€å› å­ã€æ—¥æ™‚
    - æ–‡å­—åˆ—å‡¦ç†: æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ

<cite style="display: block; text-align: right;"><a href="https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b">
æœ¬æ©‹æ™ºå…‰ã€Œå‰å‡¦ç†å¤§å…¨ã€
</a></cite>


---
## R package

ä¾¿åˆ©ãªé–¢æ•°ã‚„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãªã©ã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ãŸã‚‚ã®ã€‚

Standard Packages
: Rã®æ¨™æº–æ©Ÿèƒ½ã€‚ä½•ã‚‚ã—ãªãã¦ã‚‚ä½¿ç”¨å¯èƒ½

Contributed Packages
: æœ‰å¿—ã«ã‚ˆã‚Šé–‹ç™ºã•ã‚Œã€
  [CRAN](https://cran.rstudio.com/web/packages/index.html)
  ã«ã¾ã¨ã‚ã¦å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã€‚
: è¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ä½¿ã†å‰ã«èª­ã¿è¾¼ã‚€ãŠã¾ã˜ãªã„ãŒå¿…è¦ã€‚

```r
install.packages("readr")  # ä¸€åº¦ã‚„ã‚Œã°OK
library(readr)             # èª­ã¿è¾¼ã¿ã¯Rã‚’èµ·å‹•ã™ã‚‹ãŸã³ã«å¿…è¦
update.packages()          # ãŸã¾ã«ã¯æ›´æ–°ã—ã‚ˆã†
```

ç´ ã®Rã‚‚è¦šãˆãã£ã¦ãªã„ã®ã«ã„ããªã‚Šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼Ÿ
: å¤§ä¸ˆå¤«ã€‚èª°ã‚‚è¦šãˆãã£ã¦ãªã„ã€‚
: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã‚ãªã„Rä½œæ¥­ = ç«ã‚‚ãƒŠã‚¤ãƒ•ã‚‚ä½¿ã‚ãªã„æ–™ç†

---
## tidyverse

<a href="https://www.tidyverse.org/">
<img src="/slides/image/rstats/hex-badges8.png" width="300" align="right">
</a>

Rã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ‰‹ã«æ‰±ã†ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç¾¤

```r
install.packages("tidyverse")
library(tidyverse)
# é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¸€æŒ™ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹
```

- çµ±ä¸€çš„ãªä½¿ã„å‹æ‰‹
- æš—é»™ã®å‡¦ç†ã‚’ãªã‚‹ã¹ãã—ãªã„å®‰å…¨è¨­è¨ˆ
- ã‚·ãƒ³ãƒ—ãƒ«ãªé–¢æ•°ã‚’ç¹‹ã’ã¦ä½¿ã†ãƒ‡ã‚¶ã‚¤ãƒ³

<figure>
<a href="https://r4ds.had.co.nz/introduction.html">
<img src="/slides/image/r4ds/data-science.png">
<figcaption class="url">https://r4ds.had.co.nz/introduction.html</figcaption>
</a>
</figure>

---
## tidyverse

<a href="https://www.tidyverse.org/">
<img src="/slides/image/rstats/hex-badges8.png" width="300" align="right">
</a>

Rã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ‰‹ã«æ‰±ã†ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç¾¤

```r
install.packages("tidyverse")
library(tidyverse)
# é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¸€æŒ™ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹
```

```{r tidyverse-messasge, echo = FALSE, cache = FALSE}
cat(tidyverse_msg, sep = "\n")
```

`Conflicts âŒ` ã¨ã‹è¡¨ç¤ºã•ã‚Œã¦ä¸å®‰ã ã‘ã© â†‘ ã“ã‚Œã¯å¤§ä¸ˆå¤«ãªã‚„ã¤


---
## dplyr --- data.frameã®é«˜é€Ÿå‡¦ç†æ‹…å½“

<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="120" align="right">
</a>

ã‚·ãƒ³ãƒ—ãƒ«ãªé–¢æ•°ãŒãŸãã•ã‚“ã€‚ç¹‹ã’ã¦ä½¿ã† (piping)

æŠ½å‡º
: åˆ—: `select()`,
: è¡Œ: `filter()`, `distinct()`, `slice()`

è¦ç´„ãƒ»é›†è¨ˆ
: `group_by()`, `summarize()`, `count()`

ä¸¦ã¹æ›¿ãˆ
: `arrange()`, `relocate()`

åˆ—ã®è¿½åŠ ãƒ»å¤‰æ›´
: `mutate()`, `rename()`

çµåˆ
: è¡Œæ–¹å‘: `bind_rows()`
: åˆ—æ–¹å‘: `left_join()`, `inner_join()`, `full_join()`

---
## dplyr ä½¿ç”¨ä¾‹

å°ã•ãªé–¢æ•°ã‚’ç¹‹ã’ã¦ä½¿ã†æµã‚Œä½œæ¥­:
```{r dplyr-example}
result = diamonds |>              # ç”Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‡ºç™ºã—ã¦
  select(carat, cut, price) |>    # åˆ—ã‚’æŠ½å‡ºã—ã¦
  filter(carat > 1) |>            # è¡Œã‚’æŠ½å‡ºã—ã¦
  group_by(cut) |>                # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦
  summarize(mean(price)) |>       # å¹³å‡ã‚’è¨ˆç®—
  print()                         # è¡¨ç¤ºã—ã¦ã¿ã‚‹
```

ã“ã®è¦‹æ…£ã‚Œã¬è¨˜å· `|>` ã¯ä½•ï¼Ÿ<br>
(`select()` ãªã©å€‹ã€…ã®é–¢æ•°ã«ã¯ä»Šæ—¥ã¯è§¦ã‚Œã¾ã›ã‚“)

---
## Pipe operator (ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­) `|>`

ãƒ‘ã‚¤ãƒ—ã®å·¦å´ã®å¤‰æ•°ã‚’ã€å³å´ã®é–¢æ•°ã®ç¬¬ä¸€å¼•æ•°ã«ã­ã˜è¾¼ã‚€:
```r
diamonds |> filter(carat > 1)
filter(diamonds, carat > 1)     # ã“ã‚Œã¨åŒã˜

# å‰å‡¦ç†ã®æµã‚Œä½œæ¥­ã«ä¾¿åˆ©:
diamonds |> filter(carat > 1) |> select(carat, price) |> ...
potatos |> cut() |> fry() |> season("salt") |> eat()
```

ğŸ”° ãƒ‘ã‚¤ãƒ—ã‚’ä½¿ã‚ãªã„å½¢ã«æ›¸ãæ›ãˆã€å‡ºåŠ›ã‚’ç¢ºèªã—ã‚ˆã†:
```{r letters}
seq(1, 6) |> sum()
letters |> toupper() |> head(3)
```

[è§£ç­”ä¾‹]
```r
sum(seq(1, 6))
head(toupper(letters), 3)
```

---
## ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ `|>` ã‚’ä½¿ã‚ãªã„æ–¹æ³•

ğŸ˜ ä¸€æ™‚å¤‰æ•°ã‚’ã‚¤ãƒã‚¤ãƒä½œã‚‹:
```{r pipe-tmp-var}
tmp1 = select(diamonds, carat, cut, price)   # åˆ—ã‚’æŠ½å‡ºã—ã¦
tmp2 = filter(tmp1, carat > 1)               # è¡Œã‚’æŠ½å‡ºã—ã¦
tmp3 = group_by(tmp2, cut)                   # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦
result = summarize(tmp3, mean(price))        # å¹³å‡ã‚’è¨ˆç®—
```

ğŸ˜ åŒã˜åå‰ã‚’ä½¿ã„å›ã™:
```{r pipe-recursive-assign}
result = select(diamonds, carat, cut, price) # åˆ—ã‚’æŠ½å‡ºã—ã¦
result = filter(result, carat > 1)           # è¡Œã‚’æŠ½å‡ºã—ã¦
result = group_by(result, cut)               # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦
result = summarize(result, mean(price))      # å¹³å‡ã‚’è¨ˆç®—
```

ã©ã¡ã‚‰ã‚‚æ‚ªããªã„ã€‚
ä½•åº¦ã‚‚å¤‰æ•°åã‚’å…¥åŠ›ã™ã‚‹ã®ãŒã‚„ã‚„å†—é•·ã€‚


---
## ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ `|>` ã‚’ä½¿ã‚ãªã„æ–¹æ³•

ğŸ˜« ä¸€æ™‚å¤‰æ•°ã‚’ä½¿ã‚ãšã«:
```{r pipe-nest}
result = summarize(                    # å¹³å‡ã‚’è¨ˆç®—
    group_by(                            # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦
      filter(                              # è¡Œã‚’æŠ½å‡ºã—ã¦
        select(diamonds, carat, cut, price), # åˆ—ã‚’æŠ½å‡ºã—ã¦
        carat > 1),                        # è¡Œã‚’æŠ½å‡ºã—ã¦
      cut),                              # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦
    mean(price))                       # å¹³å‡ã‚’è¨ˆç®—
```

ğŸ¤ª æ”¹è¡Œã•ãˆã›ãšã«:
```{r pipe-oneliner}
result = summarize(group_by(filter(select(diamonds, carat, cut, price), carat > 1), cut), mean(price))
```

è«–ç†ã®æµã‚Œã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æµã‚ŒãŒåˆã‚ãšã€ç›®ãŒè¡Œã£ãŸã‚Šæ¥ãŸã‚Šã€‚<br>
ã•ã£ãã®ã»ã†ãŒãœã‚“ãœã‚“ãƒã‚·ã€‚

---
## ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ `|>` ã‚’ä½¿ãŠã†

ğŸ˜ æ…£ã‚Œã‚Œã°ã€è«–ç†ã®æµã‚Œã‚’è¿½ã„ã‚„ã™ã„:
```{r eg-pipe}
result = diamonds |>
  select(carat, cut, price) |>    # åˆ—ã‚’æŠ½å‡ºã—ã¦
  filter(carat > 1) |>            # è¡Œã‚’æŠ½å‡ºã—ã¦
  group_by(cut) |>                # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦
  summarize(mean(price)) |>       # å¹³å‡ã‚’è¨ˆç®—
  print()                         # è¡¨ç¤ºã—ã¦ã¿ã‚‹
```

tidyverseãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç¾¤ã¯ã“ã†ã„ã†ä½¿ã„æ–¹ã‚’ã—ã‚„ã™ã„è¨­è¨ˆã€‚<br>
ä½¿ã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚ã‘ã§ã¯ãªã„ãŒã€èª­ã‚ãŸã»ã†ãŒã„ã„ã€‚

<div style="font-size: 0.8em; color: #888888;">

R < 4.2 ã¾ã§ã‚ˆãä½¿ã‚ã‚Œã¦ã„ãŸ `%>%` ã‚‚ã»ã¼åŒã˜ã€‚

</div>

---
## tidyr --- data.frameã®å¤‰å½¢ãƒ»æ•´å½¢æ‹…å½“

<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="120" align="right">
</a>

æ¨ªåºƒã‹ã‚‰ç¸¦é•·ã«
: `pivot_longer()`, <del><code>gather()</code></del>

ç¸¦é•·ã‹ã‚‰æ¨ªåºƒã«
: `pivot_wider()`, <del><code>spread()</code></del>

åˆ—ã‚’åˆ†é›¢ã€çµåˆ
: `separate()`, `unite()`

å…¥ã‚Œå­æ§‹é€ ã‚’ã¤ãã‚‹ã€è§£æ¶ˆã™ã‚‹
: `nest()`, `unnest()`

*etc.*

- ã“ã†ã„ã†å¤‰å½¢ãªã—ã§ãã®ã¾ã¾ä½¿ãˆã‚‹ãƒ‡ãƒ¼ã‚¿ã¯æ¿€ãƒ¬ã‚¢
- ã‚¨ã‚¯ã‚»ãƒ«ã§ãƒãƒãƒãƒã‚„ã‚‰ãšã€tidyrã§æ‰‹ç¶šãã‚’è¨˜è¿°ã—ã‚ˆã†
- ã¡ã‚‡ã£ã¨ãƒãƒ¼ãƒ‰ãƒ«ã¯é«˜ã„ã‘ã©ã€ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã¨**å¼·ã„**ğŸ’ª


---
## `pivot_longer()` æ¨ªåºƒã‹ã‚‰ç¸¦é•·ã«

è¤‡æ•°åˆ—ã«ã¾ãŸãŒã‚‹å€¤ã‚’1åˆ—ã«ã™ã‚‹ã€‚<br>
ãã®ãƒ©ãƒ™ãƒ«ã‚‚åˆã‚ã›ã¦ç§»å‹•ã€‚

<figure>
<a href="https://r4ds.had.co.nz/tidy-data.html#longer">
<img src="/slides/image/cheatsheet/tidyr-pivot_longer.png" width="600">
<br>
<figcaption class="url">https://r4ds.had.co.nz/tidy-data.html#longer</figcaption>
</a>
</figure>

```r
table4a
pivot_longer(table4a, 2:3, names_to = "year", values_to = "cases")
```

---
## `pivot_wider()` ç¸¦é•·ã‹ã‚‰æ¨ªåºƒã«

1åˆ—ã«åã¾ã£ã¦ã„ãŸå€¤ã‚’è¤‡æ•°åˆ—ã®è¡Œåˆ—ã«å¤‰æ›ã€‚<br>
ãã®ãƒ©ãƒ™ãƒ«ã‚’åˆ—ã®åå‰ã«ã™ã‚‹ã€‚

<figure>
<a href="https://r4ds.had.co.nz/tidy-data.html#wider">
<img src="/slides/image/cheatsheet/tidyr-pivot_wider.png" width="560">
<br>
<figcaption class="url">https://r4ds.had.co.nz/tidy-data.html#wider</figcaption>
</a>
</figure>

```r
pivot_wider(table2, names_from = type, values_from = count)
```


---
## ggplot2

<a href="https://ggplot2.tidyverse.org/">
<img src="/_img/hex-stickers/ggplot2.webp" width="120" align="right">
</a>

- tidyverseãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç¾¤ã®ã²ã¨ã¤
- "The <strong><u>G</u></strong>rammer of <strong><u>G</u></strong>raphics" ã¨ã„ã†ä½“ç³»ã«åŸºã¥ãè¨­è¨ˆ
- å˜ã«ã„ã‚ã‚“ãªã‚°ãƒ©ãƒ•ã‚’ã€Œæã‘ã‚‹ã€ã ã‘ã˜ã‚ƒãªã<br>
  **ä¸€è²«æ€§ã®ã‚ã‚‹æ–‡æ³•ã§åˆç†çš„ã«æã‘ã‚‹**

<figure>
<!--
<a href="https://www.amazon.co.jp/dp/B00HWUVHXK/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=d63d3627df82c09b0bb5ca8f47ee19cc&language=ja_JP" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00HWUVHXK&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22&language=ja_JP" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&language=ja_JP&l=li3&o=9&a=B00HWUVHXK" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<img src="/slides/image/nagoya/iris.png" width="24%">
<img src="/slides/image/nagoya/binhex.png" width="24%">
<img src="/slides/image/nagoya/faithful.png" width="24%">
-->
<img src="/slides/image/tumopp/paper/Fig1.png" height="200">
<img src="/slides/image/tumopp/param-p.png" height="200">
<img src="/slides/image/tumopp/param-k.png" height="200"><br>
<img src="/slides/image/tumopp/paper/Fig3.png" height="100">
<img src="/slides/image/tumopp/Cmoore_Lconst.gif" height="100">
<img src="/slides/image/tumopp/Cmoore_Llinear.gif" height="100">
<img src="/slides/image/tumopp/Cmoore_Lstep.gif" height="100">
<img src="/slides/image/tumopp/Chex_Lconst.gif" height="100">
<img src="/slides/image/tumopp/Chex_Llinear.gif" height="100">
<img src="/slides/image/tumopp/Chex_Lstep.gif" height="100">
<figcaption class="url">Iwasaki and Innan (2017)</figcaption>
</figure>

---
## ã„ããªã‚Šggplot2ã‹ã‚‰ä½¿ã„å§‹ã‚ã¦ã‚‚å¤§ä¸ˆå¤«

Ræ¨™æº–ã®ã‚„ã¤ã¨ã¯æ ¹æœ¬çš„ã«é•ã†ã‚·ã‚¹ãƒ†ãƒ ã§ä½œå›³ã™ã‚‹ã€‚

<figure>
<img src="/slides/image/rstats/r-graphics.svg">
<figcaption><cite>ã€ŒRã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã€Murrellè‘— ä¹…ä¿è¨³ ã‚ˆã‚Šæ”¹å¤‰</cite></figcaption>
</figure>

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

<img src="/slides/image/rstats/ggplot-layers.png" height = "600">

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus1, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds)             # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
# aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
# geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
# facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
# stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
# coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
# theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus2, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price)         # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
# geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
# facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
# stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
# coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
# theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus3, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
  geom_point()                      # æ•£å¸ƒå›³ã‚’æã
# facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
# stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
# coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
# theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus4, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
  geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
  facet_wrap(vars(clarity))         # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
# stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
# coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
# theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus5, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
  geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
  facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
  stat_smooth(method = lm)          # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
# coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
# theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus6, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
  geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
  facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
  stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
  coord_cartesian(ylim = c(0, 2e4))   # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
# theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus7, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
  geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
  facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
  stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
  coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
  theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## åŸºæœ¬çš„ãªä½¿ã„æ–¹: æŒ‡ç¤ºã‚’ `+` ã§é‡ã­ã¦ã„ã

```{r ggplot-plus8, fig.show="hold", fig.height=5, fig.width=7, message=FALSE}
ggplot(data = diamonds) +           # diamondsãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒ³ãƒã‚¹æº–å‚™
  aes(x = carat, y = price) +       # carat,priceåˆ—ã‚’x,yè»¸ã«mapping
  geom_point() +                    # æ•£å¸ƒå›³ã‚’æã
# facet_wrap(vars(clarity)) +       # clarityåˆ—ã«å¿œã˜ã¦ãƒ‘ãƒãƒ«åˆ†å‰²
# stat_smooth(method = lm) +        # ç›´ç·šå›å¸°ã‚’è¿½åŠ 
# coord_cartesian(ylim = c(0, 2e4)) + # yè»¸ã®è¡¨ç¤ºç¯„å›²ã‚’ç‹­ã
  theme_classic(base_size = 20)     # ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ†ãƒ¼ãƒã§
```

---
## å›³ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å–ã£ã¦ãŠã‘ã‚‹

```{r ggplot-object, fig.show="hold", fig.height=5, fig.width=6}
p1 = ggplot(data = diamonds)
p2 = p1 + aes(x = carat, y = price)
p3 = p2 + geom_point()
p4 = p3 + facet_wrap(vars(clarity))
print(p3)
```


---
## ãƒ•ã‚¡ã‚¤ãƒ«åã‚‚ã‚µã‚¤ã‚ºã‚‚å†ç¾å¯èƒ½ãªä½œå›³

`width`ã‚„`height`ãŒå°ã•ã„ã»ã©ã€æ–‡å­—ãƒ»ç‚¹ãƒ»ç·šãŒç›¸å¯¾çš„ã«å¤§ãã

```r
# 7inch x 300dpi = 2100pxå››æ–¹ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
ggsave("dia1.png", p3) # width = 7, height = 7, dpi = 300
# 4     x 300    = 1200  å…¨ä½“7/4å€ã‚ºãƒ¼ãƒ 
ggsave("dia2.png", p3, width = 4, height = 4) # dpi = 300
# 2     x 600    = 1200  å…¨ä½“ã‚’ã•ã‚‰ã«2å€ã‚ºãƒ¼ãƒ 
ggsave("dia3.png", p3, width = 2, height = 2, dpi = 600)
# 4     x 300    = 1200  ãƒ†ãƒ¼ãƒã‚’ä½¿ã£ã¦æ–‡å­—ã ã‘æ‹¡å¤§
ggsave("dia4.png", p3 + theme_bw(base_size = 22), width = 4, height = 4)
```

<figure>
<img src="../sendair2/image/dia1.png" width="24%">
<img src="../sendair2/image/dia2.png" width="24%">
<img src="../sendair2/image/dia3.png" width="24%">
<img src="../sendair2/image/dia4.png" width="24%">
</figure>


---
## è«–æ–‡ã®Figureã¿ãŸã„ã«ä¸¦ã¹ã‚‹ã®ã‚‚Rã§

åˆ¥ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
([cowplot](https://wilkelab.org/cowplot/)
ã‚„
[patchwork](https://patchwork.data-imaginist.com/))
ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦

```{r cowplot, fig.height=5.5, fig.width=6}
pAB = cowplot::plot_grid(p3, p3, labels = c("A", "B"), nrow = 1L)
cowplot::plot_grid(pAB, p3, labels = c("", "C"), ncol = 1L)
```


---
## Rã¨æ¥ã™ã‚‹ä¸Šã§ã®å¿ƒæ§‹ãˆ

<figure>
<img src="/slides/image/free/akusyu_uchuujin.png" height="200">
</figure>

ã‚¨ãƒ©ãƒ¼æ–‡ã‚’æã‚Œãªã„
: ç†Ÿç·´ãƒ—ãƒ­ã‚°ãƒ©ãƒã§ã‚‚é »ç¹ã«ã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã™ã€‚
: ã‚¨ãƒ©ãƒ¼ã¯Rã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚**æ„å›³ã‚’èª­ã¿å–ã£ã¦ä¿®æ­£**ã—ã‚ˆã†ã€‚
: ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®çµŒé¨“å€¤ â‰ˆ ã‚¨ãƒ©ãƒ¼è§£æ±ºã®çµŒé¨“å€¤

å›°ã£ãŸã‚‰ã‚¦ã‚§ãƒ–æ¤œç´¢
: ã‚ãªãŸã®å•é¡Œã¯å…¨ä¸–ç•Œã®Rãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«é€šã£ãŸé“ã€‚
: æ—¥æœ¬èªã§ã€è‹±èªã§ã€ã‚¨ãƒ©ãƒ¼æ–‡ãã®ã‚‚ã®ã§æ¤œç´¢ã™ã‚Œã°è§£æ±ºç­–ã«å½“ãŸã‚‹ã€‚


---
## ç–‘å•ã‚„ã‚¨ãƒ©ãƒ¼ã®è§£æ±ºæ–¹æ³•

- ã‚¨ãƒ©ãƒ¼ã®ã»ã¨ã‚“ã©ã¯å‡¡ãƒŸã‚¹ç”±æ¥ã€‚ã‚ˆãç¢ºèªã—ã‚ˆã†ã€‚
    - ã‚¨ãƒ©ãƒ¼æ–‡ã‚’ã¡ã‚ƒã‚“ã¨èª­ã‚€: `No such file or directory`
    - [ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼é›† (çŸ³å·ç”±å¸Œã•ã‚“@åå¤å±‹å¤§)](https://comicalcommet.github.io/r-training-2022/R_training_2022_7.html)
      ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
    - å¤‰æ•°ã®ä¸­èº«ã‚’ç¢ºã‹ã‚ã‚‹: `str(iris)`, `attributes(iris)`
- ã‚¨ãƒ©ãƒ¼æ–‡ã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ã‚³ãƒ”ãƒšã—ã¦ã‚¦ã‚§ãƒ–æ¤œç´¢<br>
  â†’ [StackOverflow](https://stackoverflow.com/questions/tagged/r)
  ã‚„å€‹äººã‚µã‚¤ãƒˆã«è§£æ±ºç­–
- Slack <iconify-icon icon="mdi:slack"></iconify-icon>
  [r-wakalang](https://github.com/tokyor/r-wakalang)
  ã§è³ªå•ã‚’æŠ•ç¨¿ã™ã‚‹ã€‚<br>
  (è³ªå•ã«é£¢ãˆãŸå„ªã—ã„ãƒ¯ãƒ‹ãŒå¤šæ•°ç”Ÿæ¯ ğŸ‘€ &nbsp; ğŸ‘€ &nbsp; ğŸ‘€ &nbsp; ğŸ‘€)
- çŠ¶æ³å†ç¾ã§ãã‚‹å°ã•ãªä¾‹
  [(reprex)](https://reprex.tidyverse.org/)
  ã‚’æ·»ãˆã‚‹ã¨å›ç­”ã‚’å¾—ã‚„ã™ã„ã€‚<br>
  (ã“ã‚Œã‚’æº–å‚™ã—ã¦ã‚‹ã†ã¡ã«å•é¡ŒãŒåˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚Œã¦è‡ªå·±è§£æ±ºã—ãŸã‚Š)
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã¡ã‚ƒã‚“ã¨èª­ã‚€
- R(Studio)å†…ã®ãƒ˜ãƒ«ãƒ—ã‚’èª­ã‚€: `?sum`, `help.start()`


---
## ã¾ã¨ã‚

âœ… ç ”ç©¶ã¯ãƒ‰ãƒ©ã‚¤ã§ã‚‚ã‚¦ã‚§ãƒƒãƒˆã§ã‚‚åºƒã„æ„å‘³ã§ã¯ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

âœ… ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚ŒãŸã‚‰ã¾ãšå¯è¦–åŒ–

âœ… ãã®ãŸã‚ã«å‰å‡¦ç†ã—ã¦æ•´ç„¶ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚‹

âœ… R + tidyverse ãŒè§£æå…¨ä½“ã‚’å†ç¾å¯èƒ½ãªå½¢ã§å¼·åŠ›ã‚µãƒãƒ¼ãƒˆ

âœ… ã‚¨ãƒ©ãƒ¼ã‚’è½ã¡ç€ã„ã¦èª­ã¿ã€ãƒ€ãƒ¡ãªã‚‰ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«æŠ•ã’ã‚‹


---
## Reference

Other versions
: ã€Œ[Rã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†å®Ÿç¿’](/slides/tmd2022/)ã€
  æ±äº¬åŒ»ç§‘æ­¯ç§‘å¤§ [ãƒ‡ãƒ¼ã‚¿é–¢é€£äººæè‚²æˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ](https://ds.tmdu.org/) (2022-09)
: ã€Œ[çµ±è¨ˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ¦‚è«– DSHC 2022](/slides/tokiomarine2022/)ã€
  æ±äº¬æµ·ä¸Š [Data Science Hill Climb](https://tokiomarine-dshc.com/) (2022-08)
: ã€Œ[é€²åŒ–å­¦å®Ÿç¿’2022](/slides/tohoku2022r/)ã€
  æ±åŒ—å¤§å­¦ ç†å­¦éƒ¨ç”Ÿç‰©å­¦ç§‘ (2022-04)
: ã€Œ[Rã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ã¨å¿œç”¨](https://comicalcommet.github.io/r-training-2022/)ã€
   çŸ³å·ç”±å¸Œ 2022 åå¤å±‹å¤§å­¦

R for Data Science --- Hadley Wickham et al.
: <https://r4ds.hadley.nz>
  [Paperback](https://amzn.to/4cpL6w8),
  [æ—¥æœ¬èªç‰ˆæ›¸ç±(Rã§ã¯ã˜ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹)](https://amzn.to/2yyFRKt)

- [åˆ†æè€…ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è§£é‡ˆå­¦å…¥é–€](https://amzn.to/3uznzCK) æ±Ÿå´è²´è£• 2020
- [ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã®æ•°ç†ãƒ¢ãƒ‡ãƒ«å…¥é–€](https://amzn.to/3uCxTKo) æ±Ÿå´è²´è£• 2020
- [ç§‘å­¦ã¨ãƒ¢ãƒ‡ãƒ«---ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å“²å­¦ å…¥é–€](https://amzn.to/2Q0f6JQ) Michael Weisberg 2017<br>
  (åŸè‘—: [Simulation and Similarity](https://amzn.to/3bdvhuI) 2013)
