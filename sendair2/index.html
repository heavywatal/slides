<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>Rでデータを可視化する — Sendai.R #2 初心者セッション</title>
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="Rでデータを可視化する — Sendai.R #2 初心者セッション">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/sendair2/">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-V60H2JH0G6');
</script>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<script type="module">
import { Reveal } from "/slides/lib/reveal.js/reveal.js";
</script>
<link rel="stylesheet" href="/slides/lib/katex/katex.min.css">
<script src="/slides/lib/katex/katex.min.js"></script>
<script src="/slides/lib/iconify.js"></script>
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<link rel="stylesheet" href="/slides/css/style-reveal.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<h1 id="rでデータを可視化する">Rでデータを可視化する</h1>
<div class="author">
岩嵜 航 (Watal M. Iwasaki, PhD)
</div>
<div class="affiliation">
東北大学 生命科学研究科 進化ゲノミクス分野 特任助教<br>
</div>
<p>資料作成協力:<br>
石川由希 (名古屋大学 理学研究科 脳回路構造学 講師)</p>
<div class="footnote">
2019-09-27
<a href="https://sendair.connpass.com/event/137548/">
Sendai.R #2 初心者セッション
</a>
</div>
</section>
<section>
<h2 id="who-am-i">Who am I?</h2>
<img src="/slides/image/profile/google-map.png" height="580" align="right">
Watal M. Iwasaki = 岩嵜 航<br>
https://heavywatal.github.io/
<dl>
<dt>PhD in Life Sciences, Tohoku University, Sendai</dt>
<dd>Evolutionary theory of complexity and diversity in biological systems.</dd>
<dt>Postdoc in SOKENDAI, Hayama</dt>
<dd>Evolution of diversity within a tumor/cancer.</dd>
<dd>Population genetics of Pacific bluefin tuna. 🐟</dd>
</dl>
<img src="/slides/image/profile/bicycle.jpg" height="220" align="right" style="transform: translate(-10px, 0px);">
Asst. Prof. in Tohoku University
: Genomics of Rice 🍚, etc.
<dl>
<dt>Likes</dt>
<dd>🍺 Beer, Sake, Whisky, Cooking</dd>
<dd>♬ Heavy Metal, Classical, Folk</dd>
</dl>

</section>
<section>
<h2 id="生データは情報が多すぎ">生データは情報が多すぎ</h2>
<p>関係性も何も見えない</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
    3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
   --                                                                  
53937  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
53939  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre><p>ダイヤモンド53,490個について10項目の値を持つ <code>data.frame</code></p>

</section>
<section>
<h2 id="要約統計量平均とか分散とかを見てみる">要約統計量(平均とか分散とか)を見てみる</h2>
<p>まあ何となく分かった気になる</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dplyr</span><span class="o">::</span><span class="nf">summarize_if</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">is.numeric</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat   depth    table  price        x        y        z
      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 0.7979397 61.7494 57.45718 3932.8 5.731157 5.734526 3.538734
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dplyr</span><span class="o">::</span><span class="nf">summarize_if</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">is.numeric</span><span class="p">,</span> <span class="n">sd</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat    depth    table   price        x        y         z
      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 0.4740112 1.432621 2.234491 3989.44 1.121761 1.142135 0.7056988
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>     carat               cut        color        clarity          depth           table           price             x                y                z         
 Min.   :0.2000   Fair     : 1610   D: 6775   SI1    :13065   Min.   :43.00   Min.   :43.00   Min.   :  326   Min.   : 0.000   Min.   : 0.000   Min.   : 0.000  
 1st Qu.:0.4000   Good     : 4906   E: 9797   VS2    :12258   1st Qu.:61.00   1st Qu.:56.00   1st Qu.:  950   1st Qu.: 4.710   1st Qu.: 4.720   1st Qu.: 2.910  
 Median :0.7000   Very Good:12082   F: 9542   SI2    : 9194   Median :61.80   Median :57.00   Median : 2401   Median : 5.700   Median : 5.710   Median : 3.530  
 Mean   :0.7979   Premium  :13791   G:11292   VS1    : 8171   Mean   :61.75   Mean   :57.46   Mean   : 3933   Mean   : 5.731   Mean   : 5.735   Mean   : 3.539  
 3rd Qu.:1.0400   Ideal    :21551   H: 8304   VVS2   : 5066   3rd Qu.:62.50   3rd Qu.:59.00   3rd Qu.: 5324   3rd Qu.: 6.540   3rd Qu.: 6.540   3rd Qu.: 4.040  
 Max.   :5.0100                     I: 5422   VVS1   : 3655   Max.   :79.00   Max.   :95.00   Max.   :18823   Max.   :10.740   Max.   :58.900   Max.   :31.800  
                                    J: 2808   (Other): 2531                                                                                                     
</code></pre>
</section>
<section>
<h2 id="平均値ばかり見て可視化を怠ると構造を見逃す">平均値ばかり見て可視化を怠ると構造を見逃す</h2>
<figure style="position: relative;">
<a href="https://www.autodeskresearch.com/publications/samestats">
<img src="/slides/image/rstats/datasaurus.png" width="800">
<figcaption class="url">https://www.autodeskresearch.com/publications/samestats/</figcaption>
</a>
<img src="/slides/image/rstats/DataDino-600x455.gif" width="180"
     style="position: absolute; left: 0; top: 0; z-index: 255;">
</figure>
</section>
<section>
<h2 id="データ可視化の重要性">データ可視化の重要性</h2>
<p>情報の整理 → <strong>正しい解析・新しい発見</strong></p>
<p><img src="figure/simplify-diamonds-1.png" alt="plot of chunk simplify-diamonds"></p>

</section>
<section>
<h2 id="データ可視化の重要性">データ可視化の重要性</h2>
<p>情報の整理 → <strong>正しい解析・新しい発見</strong></p>
<figure>
<a href="https://r4ds.had.co.nz/explore-intro.html">
<img src="/slides/image/r4ds/data-science-explore.png">
<figcaption class="url">https://r4ds.had.co.nz/explore-intro.html</figcaption>
</a>
</figure>
<figure style="margin-bottom: 32px;">
<a href="https://tsutawarudesign.com/">
<img src="/slides/image/tsutawaru/hajimeni-04.svg" width="570" style="margin: -24px -32px -32px -24px;">
<figcaption class="url">https://tsutawarudesign.com/</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="そうは言ってもセンスでしょ--no">そうは言ってもセンスでしょ? &mdash; NO!</h2>
<figure style="float: right; width: 450px; margin: 1rem 0;">
<a href="https://tsutawarudesign.com/">
<img src="/slides/image/tsutawaru/title-13.svg" style="margin: 0 -20px 0 0;">
<img src="/slides/image/tsutawaru/hajimeni-03.svg" style="margin: 0 -20px 0 0;">
<figcaption class="url">https://tsutawarudesign.com/</figcaption>
</a>
</figure>
<p>ある程度は<strong>テクニック</strong>であり<strong>教養</strong>。<br>
デザインの基本的なルールを<br>
知りさえすれば誰でも上達する。<br></p>
<p><a href="https://www.amazon.co.jp/dp/4774183210/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=7417ab2bc75a7c64806c3d6c0468b45c&language=ja_JP" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4774183210&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22&language=ja_JP" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&language=ja_JP&l=li3&o=9&a=4774183210" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

</section>
<section>
<h2 id="見せ方の吟味もrでやると捗るよ">見せ方の吟味もRでやると捗るよ</h2>
<p>平均値の差？ ばらつきの様子？ 軸はゼロから始まる？</p>
<p><img src="figure/iris-compare-1.png" alt="plot of chunk iris-compare"></p>

</section>
<section>
<h2 id="こんな感じの図もrでラクラク描けるよ">こんな感じの図もRでラクラク描けるよ</h2>
<figure>
<img src="/slides/image/tumopp/paper/Fig1.png" height="200">
<img src="/slides/image/tumopp/neighborhood.png" height="200">
<img src="/slides/image/tumopp/param-p.png" height="200">
<img src="/slides/image/tumopp/paper/Fig3.png" height="200">
<img src="/slides/image/tumopp/param-k.png" height="200">
<img src="/slides/image/tumopp/driver.gif" height="200"><br>
<img src="/slides/image/tumopp/Cmoore_Lconst.gif" height="100">
<img src="/slides/image/tumopp/Cmoore_Llinear.gif" height="100">
<img src="/slides/image/tumopp/Cmoore_Lstep.gif" height="100">
<img src="/slides/image/tumopp/Chex_Lconst.gif" height="100">
<img src="/slides/image/tumopp/Chex_Llinear.gif" height="100">
<img src="/slides/image/tumopp/Chex_Lstep.gif" height="100">
<figcaption class="url">Iwasaki and Innan (2017)</figcaption>
</figure>
</section>
<section>
<h2 id="本セッションの目標">本セッションの目標</h2>
<h3 id="データはまず可視化してみなきゃ-済"><strike>データはまず可視化してみなきゃ</strike> (済)</h3>
<h3 id="あれもこれもrでやれそうだな">あれもこれもRでやれそうだな</h3>
<h3 id="やりたくなったらこのへんを調べればいいんだな">やりたくなったらこのへんを調べればいいんだな</h3>
<br>
この3点さえ押さえれば、具体的なやり方は覚えなくても大丈夫
<p>この発表スライドもオンラインで読める
<br>
<a href="https://heavywatal.github.io/slides/">https://heavywatal.github.io/slides/</a></p>
</section>
<section>
<h2 id="目次-rでデータを可視化する">目次: Rでデータを可視化する</h2>
<ul>
<li><strike>データ可視化の意義</strike> (済)</li>
<li><strike>Rでやるメリット</strike> (済)</li>
<li>Rの基本おさらい</li>
<li>R標準のplot、パッケージのggplot2</li>
<li>ggplot2の基本的な使い方</li>
<li>多変量データの俯瞰も手軽に</li>
<li>画像ファイル出力も微調整もプログラミングで</li>
</ul>
<figure>
<img src="/slides/image/nagoya/bicycle-gear.png" height="250">
<img src="/slides/image/nagoya/bicycle-speed.png" height="250">
</figure>
</section>
<section>
<h2 id="rとは">Rとは</h2>
<p>統計解析と作図の機能が充実したプログラミング言語</p>
<figure style="float: right;">
<a href="https://cran.r-project.org/">
<img src="/slides/image/rstats/Rlogo.svg" height="200">
<figcaption class="url">https://cran.r-project.org/</figcaption>
</a>
</figure>
<dl>
<dt>クロスプラットフォーム</dt>
<dd>Linux, Mac, Windowsで動く。</dd>
<dt>オープンソース</dt>
<dd>永久に無償で、すべての機能を使える。</dd>
<dd>集合知によって常に進化している。</dd>
<dt>コミュニティ</dt>
<dd>相談できる人や参考になるウェブサイトがたくさん見つかる。</dd>
</dl>
<p>ほかのプログラミング言語でも似たようなことができる。<br>
例えばPythonもいいよ。</p>

</section>
<section>
<h2 id="r環境のインストール">R環境のインストール</h2>
<dl>
<dt>R本体</dt>
<dd>コマンドを解釈して実行するコア部分</dd>
<dd>よく使われる関数なども標準パッケージとして同梱</dd>
<dd><a href="https://cran.rstudio.com/">https://cran.rstudio.com/</a> からダウンロードしてインストール</dd>
<dt>RStudio Desktop</dt>
<dd>Rをより快適に使うための総合開発環境(IDE)</dd>
<dd>必須ではないけど、結構みんな使ってるらしい</dd>
<dd><a href="https://www.rstudio.com/">https://www.rstudio.com/</a> からダウンロードしてインストール</dd>
</dl>
<img src="/slides/image/rstudio/rstudio-300x260.png">
</section>
<section>
<h2 id="rスクリプトに書いてからコンソールで実行">Rスクリプトに書いてから、コンソールで実行</h2>
<p>File → New File → R script</p>
<img src="/slides/image/rstudio/script-console.png" width="100%">
</section>
<section>
<h2 id="rスクリプトに書いてからコンソールで実行">Rスクリプトに書いてから、コンソールで実行</h2>
<p>File → New File → R script</p>
<img src="/slides/image/rstudio/newfile.png" width="100%">
</section>
<section>
<h2 id="rと接する上での心構え">Rと接する上での心構え</h2>
<dl>
<dt>エラーを恐れない</dt>
<dd>熟練プログラマーでもよくエラーを発生させる。</dd>
<dd>エラー文はRからのメッセージなので、よく読んで意図を汲み取ろう。</dd>
<dt>困ったらググる</dt>
<dd>その困りごとは、全世界のRユーザーの誰かが通った道。</dd>
<dd>日本語で、英語で、エラー文そのままで、検索してみよう。</dd>
<dd>それでも分からなかったら <a href="https://github.com/tokyor/r-wakalang">r-wakalang</a> で相談しよう。</dd>
</dl>
<figure style="float: right; margin: 0;">
<img src="/slides/image/rstats/error.png" height="300">
</figure>
<dl>
<dt>コード入力はコピペが早い</dt>
<dd>見つけたコードはまずコピペして使ってみよう。</dd>
<dd>動くようなら自分のデータに合わせて改変しよう。</dd>
<dd>(ただし、ライセンスには注意&hellip;)</dd>
</dl>

</section>
<section>
<h2 id="dataframe-長方形のテーブル重要">data.frame: 長方形のテーブル。重要。</h2>
<p><code>iris</code> はアヤメ属3種150個体に関する測定データ。<br>
Rに最初から入ってて、例としてよく使われる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;     &lt;fct&gt;
  1          5.1         3.5          1.4         0.2    setosa
  2          4.9         3.0          1.4         0.2    setosa
  3          4.7         3.2          1.3         0.2    setosa
  4          4.6         3.1          1.5         0.2    setosa
 --                                                            
147          6.3         2.5          5.0         1.9 virginica
148          6.5         3.0          5.2         2.0 virginica
149          6.2         3.4          5.4         2.3 virginica
150          5.9         3.0          5.1         1.8 virginica
</code></pre><p>長さ150の数値ベクトル4本と因子ベクトル1本。</p>

</section>
<section>
<h2 id="r標準のグラフィックス">R標準のグラフィックス</h2>
<p>描けるっちゃ描けるけど。カスタマイズしていくのは難しい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Length</span><span class="p">,</span> <span class="n">iris</span><span class="o">$</span><span class="n">Sepal.Width</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/plot-1.png" alt="plot of chunk plot"></p>
<p>きれいなグラフを簡単に描けるパッケージを使いたい。</p>

</section>
<section>
<h2 id="r標準のグラフィックス">R標準のグラフィックス</h2>
<p>描けるっちゃ描けるけど。カスタマイズしていくのは難しい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">hist</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Petal.Length</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/hist-1.png" alt="plot of chunk hist"></p>
<p>きれいなグラフを簡単に描けるパッケージを使いたい。</p>

</section>
<section>
<h2 id="r標準のグラフィックス">R標準のグラフィックス</h2>
<p>描けるっちゃ描けるけど。カスタマイズしていくのは難しい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">boxplot</span><span class="p">(</span><span class="n">Petal.Width</span> <span class="o">~</span> <span class="n">Species</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">iris</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/boxplot-1.png" alt="plot of chunk boxplot"></p>
<p>きれいなグラフを簡単に描けるパッケージを使いたい。</p>

</section>
<section>
<h2 id="パッケージ">パッケージ</h2>
<p>便利な関数やデータセットなどをひとまとめにしたもの。</p>
<dl>
<dt>Standard Packages</dt>
<dd>Rの標準機能。何もしなくても使用可能。</dd>
<dt>Contributed Packages</dt>
<dd>有志により開発され、
<a href="https://cran.rstudio.com/web/packages/index.html">CRAN</a>
にまとめて公開されている。</dd>
<dd>要インストール。使う前に読み込むおまじないが必要。</dd>
</dl>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;ggplot2&#34;</span><span class="p">)</span>  <span class="c1"># 一度やればOK</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>             <span class="c1"># 読み込みはRを起動するたびに必要</span>
</span></span><span class="line"><span class="cl"><span class="nf">update.packages</span><span class="p">()</span>            <span class="c1"># たまには更新しよう</span>
</span></span></code></pre></div><dl>
<dt>素のRも覚えきってないのにいきなりパッケージ？</dt>
<dd>大丈夫。誰も覚えきってない。</dd>
<dd>パッケージを使わないR作業 = 火もナイフも使わない料理</dd>
</dl>
</section>
<section>
<h2 id="tidyverse">tidyverse</h2>
<a href="https://www.tidyverse.org/">
<img src="/slides/image/rstats/hex-badges.png" width="260" align="right">
</a>
<p>Rでデータを上手に扱うためのパッケージ群</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;tidyverse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 関連パッケージが一挙に読み込まれる</span>
</span></span></code></pre></div><ul>
<li>統一的な使い勝手</li>
<li>暗黙の処理をなるべくしない安全設計</li>
<li>シンプルな関数を繋げて使うデザイン</li>
</ul>
<figure>
<a href="https://r4ds.had.co.nz/introduction.html">
<img src="/slides/image/r4ds/data-science.png">
<figcaption class="url">https://r4ds.had.co.nz/introduction.html</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="ggplot2とは">ggplot2とは</h2>
<a href="https://ggplot2.tidyverse.org/">
<img src="/_img/hex-stickers/ggplot2.webp" width="120" align="right">
</a>
<ul>
<li>tidyverseパッケージ群のひとつ</li>
<li>&ldquo;The <strong>G</strong>rammer of <strong>G</strong>raphics&rdquo; という体系に基づく設計</li>
<li>単にいろんなグラフを「描ける」だけじゃなく<br>
<strong>一貫性のある文法で合理的に描ける</strong></li>
</ul>
<figure>
<a href="https://www.amazon.co.jp/Grammar-Graphics-Statistics-Computing/dp/0387245448/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=2d44a24b81394d310843bd982fdadf98" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=0387245448&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=0387245448" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<img src="/slides/image/nagoya/iris.png" width="24%">
<img src="/slides/image/nagoya/binhex.png" width="24%">
<img src="/slides/image/nagoya/faithful.png" width="24%">
</figure>
</section>
<section>
<h2 id="r標準のプロットとは根本的に違う">R標準のプロットとは根本的に違う</h2>
<p>いきなりggplot2から使い始めても大丈夫。</p>
<img src="/slides/image/rstats/r-graphics.svg">
</section>
<section>
<h2 id="基本的な使い方-指示を--していく">基本的な使い方: 指示を <code>+</code> していく</h2>
<ul>
<li><code>ggplot()</code> このデータでよろしく</li>
<li><code>geom_*()</code> 点や線をよろしく</li>
<li><code>theme_*()</code> 軸とか背景の見た目をよろしく</li>
</ul>
<figure>
<a href="https://mrunadon.github.io/概要をおさえてggplot2を使いこなすチュートリアルとコード集/">
<img src="image/mrunadon-ggplot2.png">
<figcaption class="url">https://mrunadon.github.io/概要をおさえてggplot2を使いこなすチュートリアルとコード集/</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="基本的な使い方-指示を--していく">基本的な使い方: 指示を <code>+</code> していく</h2>
<ul>
<li><code>ggplot()</code> このデータでよろしく</li>
<li><code>geom_*()</code> 点や線をよろしく</li>
<li><code>theme_*()</code> 軸とか背景の見た目をよろしく</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span>               <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl"><span class="c1"># geom_histogram(aes(x = carat)) +    # x軸caratのヒストグラムで</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)       # クラシックなテーマで</span>
</span></span></code></pre></div><p><img src="figure/ggplot-plus0-1.png" alt="plot of chunk ggplot-plus0"></p>
</section>
<section>
<h2 id="基本的な使い方-指示を--していく">基本的な使い方: 指示を <code>+</code> していく</h2>
<ul>
<li><code>ggplot()</code> このデータでよろしく</li>
<li><code>geom_*()</code> 点や線をよろしく</li>
<li><code>theme_*()</code> 軸とか背景の見た目をよろしく</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>             <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">))</span>      <span class="c1"># x軸caratのヒストグラムで</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)       # クラシックなテーマで</span>
</span></span></code></pre></div><p><img src="figure/ggplot-plus1-1.png" alt="plot of chunk ggplot-plus1"></p>
</section>
<section>
<h2 id="基本的な使い方-指示を--していく">基本的な使い方: 指示を <code>+</code> していく</h2>
<ul>
<li><code>ggplot()</code> このデータでよろしく</li>
<li><code>geom_*()</code> 点や線をよろしく</li>
<li><code>theme_*()</code> 軸とか背景の見た目をよろしく</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>             <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">))</span> <span class="o">+</span>    <span class="c1"># x軸caratのヒストグラムで</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_classic</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">20</span><span class="p">)</span>       <span class="c1"># クラシックなテーマで</span>
</span></span></code></pre></div><p><img src="figure/ggplot-plus2-1.png" alt="plot of chunk ggplot-plus2"></p>
</section>
<section>
<h2 id="よくあるエラー">よくあるエラー</h2>
<p>パッケージ名は ggplot2、関数名は <code>ggplot</code>:</p>
<pre tabindex="0"><code>&gt; ggplot2(data = diamonds)
Error in ggplot2(data = diamonds) : could not find function &#34;ggplot2&#34;
</code></pre><p>関数名は合ってるはずなのに&hellip;</p>
<pre tabindex="0"><code>&gt; ggplot(data = diamonds)
Error in ggplot(data = diamonds) : could not find function &#34;ggplot&#34;
</code></pre><p>パッケージ読み込みは新しくRを起動するたびに必要:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="途中経過を取っておける">途中経過を取っておける</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p0</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Helvetica&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p3</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">+</span> <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span> <span class="n">clarity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/ggplot-object-1.png" alt="plot of chunk ggplot-object"></p>
<p><code>p0</code> とか <code>p1</code> あとで使うよ</p>

</section>
<section>
<h2 id="ggplot-に渡すのは整然データ-tidy-data"><code>ggplot()</code> に渡すのは整然データ tidy data</h2>
<ul>
<li>1行は1つの観測</li>
<li>1列は1つの変数</li>
<li>1セルは1つの値</li>
<li>この列をX軸、この列をY軸、この列で色わけ、と指定できる！</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
    3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
   --                                                                  
53937  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
53939  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre><p>参考:<br>
<code>data(package = &quot;ggplot2&quot;)</code><br>
<a href="https://r4ds.had.co.nz/tidy-data.html">https://r4ds.had.co.nz/tidy-data.html</a><br>
<a href="https://speakerdeck.com/fnshr/zheng-ran-detatutenani">https://speakerdeck.com/fnshr/zheng-ran-detatutenani</a><br></p>
</section>
<section>
<h2 id="aesthetic-mapping-でデータと見せ方を紐付け">Aesthetic mapping でデータと見せ方を紐付け</h2>
<p><code>aes()</code> の中で列名を指定する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p0</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">clarity</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="figure/aes-map-1.png" alt="plot of chunk aes-map"></p>

</section>
<section>
<h2 id="データによらず一律で見せ方を変える">データによらず一律で見せ方を変える</h2>
<p><code>aes()</code> の外で値を指定する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p0</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;darkorange&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">6</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/aes-nomap-1.png" alt="plot of chunk aes-nomap"></p>

</section>
<section>
<h2 id="色パレットの変更-scale_colour_">色パレットの変更 <code>scale_colour_*()</code></h2>
<p>個々の色を自分で決めず、既存のパレットを利用するのが吉。<br>
e.g., <a href="https://colorbrewer2.org/#type=diverging&amp;scheme=Spectral&amp;n=5">ColorBrewer</a>,
<a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis</a>
(色覚多様性の対策にも有効)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">#pQ+ scale_colour_brewer(palette = &#34;Spectral&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">pQ</span> <span class="o">+</span> <span class="nf">scale_colour_viridis_c</span><span class="p">(</span><span class="n">option</span> <span class="o">=</span> <span class="s">&#34;magma&#34;</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="m">-1</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/quakes-1.png" alt="plot of chunk quakes"></p>

</section>
<section>
<h2 id="値に応じて切り分けて表示-1変数facet">値に応じて切り分けて表示 (1変数facet)</h2>
<p>ggplotの真骨頂！
これをR標準グラフィックスでやるのは結構たいへん。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span> <span class="n">clarity</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="m">4L</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/facet-wrap-1.png" alt="plot of chunk facet-wrap"></p>

</section>
<section>
<h2 id="値に応じて切り分けて表示-2変数facet">値に応じて切り分けて表示 (≥2変数facet)</h2>
<p>ggplotの真骨頂！
これをR標準グラフィックスでやるのは結構たいへん。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">facet_grid</span><span class="p">(</span><span class="n">cut</span> <span class="o">~</span> <span class="n">clarity</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/facet-grid-1.png" alt="plot of chunk facet-grid"></p>

</section>
<section>
<h2 id="多変量データの俯瞰に便利">多変量データの俯瞰に便利</h2>
<p><img src="figure/facet-diamonds-1.png" alt="plot of chunk facet-diamonds"></p>
</section>
<section>
<h2 id="値を変えず座標軸を変える-scale_-coord_">値を変えず座標軸を変える <code>scale_*</code>, <code>coord_*</code></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">carat</span><span class="p">,</span> <span class="n">price</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="m">0.25</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_x_log10</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_y_log10</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span> <span class="o">*</span> <span class="m">1000</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">800</span><span class="p">,</span> <span class="m">12000</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Diamonds&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Size (carat)&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;Price (USD)&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/scale-axis-1.png" alt="plot of chunk scale-axis"></p>
</section>
<section>
<h2 id="データと関係ない部分の見た目を調整-theme">データと関係ない部分の見た目を調整 <code>theme</code></h2>
<p><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">既存の <code>theme_*()</code></a>
をベースに、<code>theme()</code> 関数で微調整。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">panel.background</span> <span class="o">=</span> <span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;khaki&#34;</span><span class="p">),</span> <span class="c1"># 箱</span>
</span></span><span class="line"><span class="cl">  <span class="n">panel.grid.major</span> <span class="o">=</span> <span class="nf">element_line</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;red&#34;</span><span class="p">),</span> <span class="c1"># 線</span>
</span></span><span class="line"><span class="cl">  <span class="n">axis.title</span>       <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">32</span><span class="p">),</span>      <span class="c1"># 文字</span>
</span></span><span class="line"><span class="cl">  <span class="n">axis.text</span>        <span class="o">=</span> <span class="nf">element_blank</span><span class="p">()</span>               <span class="c1"># 消す</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/theme-1.png" alt="plot of chunk theme"></p>

</section>
<section>
<h2 id="論文のfigureみたいに並べる">論文のFigureみたいに並べる</h2>
<p>別のパッケージ
(<a href="https://cran.r-project.org/package=cowplot">cowplot</a>
や
<a href="https://github.com/thomasp85/patchwork">patchwork</a>)
の助けを借りて</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">pAB</span> <span class="o">=</span> <span class="n">cowplot</span><span class="o">::</span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">),</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">1L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cowplot</span><span class="o">::</span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">pAB</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1L</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/cowplot-1.png" alt="plot of chunk cowplot"></p>

</section>
<section>
<h2 id="ファイル名もサイズも再現可能な作図">ファイル名もサイズも再現可能な作図</h2>
<p><code>width</code>や<code>height</code>が小さいほど、文字・点・線が相対的に大きく</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 7inch x 300dpi = 2100px四方 (デフォルト)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia1.png&#34;</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span> <span class="c1"># width = 7, height = 7, dpi = 300</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4     x 300    = 1200  全体7/4倍ズーム</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia2.png&#34;</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span> <span class="c1"># dpi = 300</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2     x 600    = 1200  全体をさらに2倍ズーム</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia3.png&#34;</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="m">600</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4     x 300    = 1200  テーマを使って文字だけ拡大</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia4.png&#34;</span><span class="p">,</span> <span class="n">p1</span> <span class="o">+</span> <span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">22</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></span></code></pre></div><figure>
<img src="image/dia1.png" width="24%">
<img src="image/dia2.png" width="24%">
<img src="image/dia3.png" width="24%">
<img src="image/dia4.png" width="24%">
</figure>
</section>
<section>
<h2 id="他にどんな種類の-geom_-が使える">他にどんな種類の <code>geom_*()</code> が使える？</h2>
<p>なんでもある。
<a href="https://ggplot2.tidyverse.org/reference/index.html">公式サイト</a>を見に行こう。</p>
<figure>
<img src="/slides/image/rstats/ggplot2-reference-geoms.png" width="80%">
</figure>
</section>
<section>
<figure style="margin: 0;">
<a href="https://ggplot2.tidyverse.org/">
<img src="/slides/image/rstats/data-visualization-2.1-4789.jpg" width="100%">
<figcaption class="url">https://ggplot2.tidyverse.org/</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="微調整してくと最終的に長いコードになるね">微調整してくと最終的に長いコードになるね&hellip;</h2>
<p>うん。でもすべての点について後から確認できるし、使い回せる！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_boxplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">cut</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cut</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_classic</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">15</span><span class="p">,</span> <span class="n">base_family</span> <span class="o">=</span> <span class="s">&#34;Helvetica&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">6</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Diamonds&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Size (carat)&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;Price (USD)&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.title.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">axis.title.y</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">axis.text.y</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">axis.line.x</span> <span class="o">=</span> <span class="nf">element_line</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">axis.line.y</span> <span class="o">=</span> <span class="nf">element_line</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">axis.ticks.length</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="s">&#34;pt&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">panel.background</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">panel.grid.major</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">plot.margin</span> <span class="o">=</span> <span class="n">grid</span><span class="o">::</span><span class="nf">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">),</span> <span class="s">&#34;lines&#34;</span><span class="p">))</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="発展的な内容">発展的な内容</h2>
<dl>
<dt>ggplot2を<a href="https://exts.ggplot2.tidyverse.org/">さらに拡張するパッケージも続々</a></dt>
<dd>アニメーション gganimate</dd>
<dd>ラベル付け ggrepel</dd>
<dd>グラフ/ネットワーク ggraph</dd>
<dd>系統樹 ggtree</dd>
</dl>
<img src="/slides/image/tumopp/driver.gif" align="right" height="200">
<dl>
<dt>もちろん地図とかも描ける</dt>
<dd><a href="https://www.google.co.jp/search?q=ggplot+%E5%9C%B0%E5%9B%B3">OK, Google. &ldquo;ggplot 地図&rdquo;</a></dd>
<dt>ggplot2は3Dが苦手</dt>
<dd>本当に3Dが必要? 色分けやファセットで足りない?</dd>
<dd>別のパッケージ(rgl, plotly)でやる。</dd>
</dl>

</section>
<section>
<h2 id="疑問やエラーの解決方法">疑問やエラーの解決方法</h2>
<ul>
<li>RStudio内にヘルプを表示: <code>?sum</code>, <code>help.start()</code></li>
<li>変数の構造を確かめる: <code>str(iris)</code>, <code>attributes(iris)</code></li>
<li>エラー文をちゃんと読む: <code>No such file or directory</code></li>
<li>パッケージの公式ドキュメントをちゃんと読む</li>
<li>パッケージ名やエラー文をコピペしてウェブ検索<br>
→ <a href="https://stackoverflow.com/questions/tagged/r">StackOverflow</a>
や個人サイトに解決策</li>
<li>身近な経験者に訊く</li>
<li>Slackの
<a href="https://github.com/tokyor/r-wakalang">r-wakalang</a>
で質問を投稿する。<br>
内容によってチャンネルを選ぶ: <code>#r_beginners</code>, <code>#ggplot2</code></li>
<li>状況を再現できる小さな例
<a href="https://reprex.tidyverse.org/">(reprex)</a>
を添えて質問すると回答を得やすい。</li>
</ul>

</section>
<section>
<h2 id="参考">参考</h2>
<dl>
<dt>講義資料</dt>
<dd>「<a href="https://heavywatal.github.io/slides/nagoya2018/">Rにやらせて楽しよう — データの可視化と下ごしらえ</a>」
岩嵜航 2018</dd>
<dd>「Rを用いたデータ解析の基礎と応用」石川由希 2019 名古屋大学</dd>
<dt>R for Data Science &mdash; Hadley Wickham and Garrett Grolemund</dt>
<dd><a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a></dd>
<dd><a href="https://amzn.to/2tbRmVc">英語版書籍</a></dd>
<dd><a href="https://amzn.to/2yyFRKt">日本語版書籍(Rではじめるデータサイエンス)</a></dd>
<dt>ggplot2公式ドキュメント</dt>
<dd><a href="https://ggplot2.tidyverse.org/">https://ggplot2.tidyverse.org/</a></dd>
</dl>

</section>
<section>
<h2 id="まとめ">まとめ</h2>
<dl>
<dt>データを持ったらまずは可視化</dt>
<dd>要約統計量ばかり見てると大事なものを見逃す</dd>
<dt>こんなグラフを描きたいな</dt>
<dd>だいたい何でもggplot2でできるよ。</dd>
<dt>どうやるんだっけ</dt>
<dd>たす <code>p = ggplot(data) + geom_*() + scale_*() + theme_*()</code></dd>
<dd>保存 <code>ggsave(&quot;fig1.png&quot;, p, width=4, height=3, dpi=300)</code></dd>
<dd>忘れるたびに調べる。徐々に身につく。</dd>
<dt>ちゃんと描こうと思うと結構な量のプログラムになるね&hellip;</dt>
<dd>そうだけど、一度書いたら後で使い回せるよ。</dd>
</dl>

</section>
</div>
</div>
</body>
</html>
