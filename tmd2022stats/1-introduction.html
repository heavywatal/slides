<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>1. 導入、直線回帰 — 統計モデリング実習 2022 TMDU</title>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<script defer src="/slides/lib/reveal.js/reveal.js"></script>
<script defer src="/slides/lib/reveal.js/plugin/notes.js"></script>
<script defer src="/slides/lib/reveal-initialize.js"></script>
<link rel="stylesheet" href="/slides/css/theme-reveal.css">
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="1. 導入、直線回帰 — 統計モデリング実習 2022 TMDU">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/tmd2022stats/1-introduction.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<link rel="stylesheet" href="/lib/katex/katex.min.css">
<script defer src="/lib/katex/katex.min.js"></script>
<script defer src="/lib/katex/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "\\[", right: "\\]", display: true},
      {left: "$", right: "$", display: false}
    ]
  });
});
</script>
<style>
.katex {
  font-size: 1.12em;
}

.katex-display > .katex {
  text-align: left;
  padding-left: 2rem;
}
</style>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-V60H2JH0G6', { 'anonymize_ip': false });
}
</script>

</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css">
<div class="titlepage">
<h1 id="統計モデリング実習-2022-tmdu"><a href=".">統計モデリング実習 2022 TMDU</a></h1>
<div class="author">
岩嵜 航 (Watal M. Iwasaki, PhD)
</div><div class="affiliation">
東北大学 生命科学研究科 進化ゲノミクス分野 特任助教<br>
(Graduate School of Life Sciences, Tohoku University)
</div>
<ol>
<li class="current-deck"><a href="1-introduction.html">導入、直線回帰</a>
<li><a href="2-distribution.html">確率分布、擬似乱数生成</a>
<li><a href="3-likelihood.html">尤度、最尤推定</a>
<li><a href="4-glm.html">一般化線形モデル (GLM)</a>
<li><a href="5-glmm.html">個体差、一般化線形混合モデル (GLMM)</a>
<li><a href="6-bayesian.html">ベイズの定理、事後分布、MCMC</a>
<li><a href="7-stan.html">StanでGLM</a>
<li><a href="8-hbm.html">階層ベイズモデル (HBM)</a>
</ol>
<div class="footnote">
2023-03-11 東京医科歯科大学
<a href="https://heavywatal.github.io/slides/tmd2022stats/">https://heavywatal.github.io/slides/tmd2022stats/</a>
</div>
</div><!-- .titlepage -->
</section>
<section>
<h2 id="データを使ってやりたいこと">データを使ってやりたいこと</h2>
<ul>
<li>現象を<strong>理解</strong>したい</li>
<li>将来を<strong>予測</strong>したい</li>
<li>ものを<strong>分類・判別</strong>したい</li>
<li>挙動を<strong>制御</strong>したい</li>
<li>新しい何かを<strong>生成</strong>したい</li>
</ul>
<p>そのために解析は必要？
未加工の生データこそ宝？
</section>
<section>
<h2 id="データ解析って必要-生データ見ればいいべ">データ解析って必要？ 生データ見ればいいべ？</h2>
<p>往々にして複雑過ぎ、情報多すぎ、そのままでは手に負えない</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">ggplot2</span><span class="o">::</span><span class="n">diamonds</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table price    x    y    z
    1  0.23     Ideal     E     SI2  61.5    55   326 3.95 3.98 2.43
    2  0.21   Premium     E     SI1  59.8    61   326 3.89 3.84 2.31
    3  0.23      Good     E     VS1  56.9    65   327 4.05 4.07 2.31
    4  0.29   Premium     I     VS2  62.4    58   334 4.20 4.23 2.63
   --                                                               
53937  0.72      Good     D     SI1  63.1    55  2757 5.69 5.75 3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757 5.66 5.68 3.56
53939  0.86   Premium     H     SI2  61.0    58  2757 6.15 6.12 3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757 5.83 5.87 3.64
</code></pre><p>ダイヤモンド53,940個について10項目の値を持つデータセット</p>

</section>
<section>
<h2 id="要約統計量を見てみよう">要約統計量を見てみよう</h2>
<p>各列の<strong>平均</strong>とか<strong>標準偏差</strong>とか:</p>
<pre tabindex="0"><code>  stat carat depth table    price
1 mean  0.80 61.75 57.46  3932.80
2   sd  0.47  1.43  2.23  3989.44
3  max  5.01 79.00 95.00 18823.00
4  min  0.20 43.00 43.00   326.00
</code></pre><p>大きさ <code>carat</code> と価格 <code>price</code> の<strong>相関係数</strong>はかなり高い:</p>
<pre tabindex="0"><code>      carat depth table price
carat  1.00                  
depth  0.03  1.00            
table  0.18 -0.30  1.00      
price  0.92 -0.01  0.13  1.00
</code></pre><hr>
<p><strong>生のままよりは把握しやすい</strong>かも。</p>

</section>
<section>
<h2 id="分布を特徴づける代表値-central-tendency">分布を特徴づける代表値 central tendency</h2>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.6;">
<dl>
<dt>平均値 mean</dt>
<dd>和を観察数で割る</dd>
<dt>中央値 median</dt>
<dd>順に並べて真ん中</dd>
<dt>最頻値 mode</dt>
<dd>最も頻度が高い値
</div>
<div class="column">
<a href="https://www.mhlw.go.jp/toukei/list/20-21.html">
<img src="../tohoku2022r/image/hist-income-japan-2019.png" width="100%" style="">
<figcaption><cite>所得金額階級別世帯数の頻度分布 厚生労働省 国民生活基礎調査 2019</cite></figcaption>
</a>
</div>
</dd>
</dl>
</div>
<p>目的や状況に応じて使い分けよう。</p>
<dl>
<dt>外れ値に対する応答</dt>
<dd>もし総資産額20兆円の大富豪が鳥取県に引っ越してきたら<br>
→ 県民の<strong>平均</strong>資産は4000万円上昇。<strong>中央値</strong>・<strong>最頻値</strong>はほぼそのまま。</dd>
</dl>

</section>
<section>
<h2 id="ばらつきを捉える記述統計量">ばらつきを捉える記述統計量</h2>
<dl>
<dt>分散 variance</dt>
<dd>平均値からの差の自乗の平均。 $\frac 1 n \sum _i ^n (X_i - \bar X)^2$</dd>
<dd>これの平方根が<strong>標準偏差 (standard deviation)</strong>。</dd>
<dt>Percentile, Quantile (四分位)</dt>
<dd>小さい順にならべて上位何%にあるか。</dd>
<dd>中央値 = 50th percentile = 第二四分位(Q2)</dd>
</dl>
<img src="./figure/quantile-1.png" alt="plot of chunk quantile" width="720" />
</section>
<section>
<h2 id="ばらつきの様子は大小の判断にも重要">ばらつきの様子は大小の判断にも重要</h2>
<div class="column-container" style="padding-left: 10px;">
<div class="column" style="flex-shrink: 1.1;">
観測値1つずつ。<br>
たまたまかも。
</div>
<div class="column" style="flex-shrink: 1;">
ばらつき大きい。<br>
Bが高いのもたまたま?
</div>
<div class="column" style="flex-shrink: 1;">
ばらつき小さい。<br>
AとBには差がありそう。
</div>
</div>
<img src="./figure/comparison-1.png" alt="plot of chunk comparison" width="792" />
<p>「こんなことがたまたま起こる確率はすごく低いです！」<br>
をちゃんと示す手続きが<strong>統計的仮説検定</strong>。
</section>
<section>
<h2 id="記述統計量に頼りすぎず分布を可視化する">記述統計量に頼りすぎず分布を可視化する</h2>
<p>同じデータでも見せ方で印象・情報量が変わる。</p>
<img src="./figure/visualize-distribution-1.png" alt="plot of chunk visualize-distribution" width="648" />
</section>
<section>
<h2 id="代表値ばかり見て可視化を怠ると構造を見逃す">代表値ばかり見て可視化を怠ると構造を見逃す</h2>
<figure style="position: relative;">
<a href="https://www.autodesk.com/research/publications/same-stats-different-graphs">
<img src="/slides/image/rstats/datasaurus.png" width="800">
<figcaption class="url">https://www.autodesk.com/research/publications/same-stats-different-graphs</figcaption>
</a>
<img src="/slides/image/rstats/DataDino-600x455.gif" width="180"
     style="position: absolute; left: 0; top: 0; z-index: 255;">
</figure>

</section>
<section>
<h2 id="データ可視化は理解の第一歩">データ可視化は理解の第一歩</h2>
<p>情報をうまく絞って整理 → <strong>直感的にわかる</strong></p>
<img src="./figure/simplify-diamonds-1.png" alt="plot of chunk simplify-diamonds" width="504" />
<p><code>carat</code> が大きいほど <code>price</code> も高いらしい。<br>
その度合いは <code>clarity</code> によって異なるらしい。</p>

</section>
<section>
<h2 id="統計とは">統計とは</h2>
<p>データをうまくまとめ、それに基づいて推論するための手法。</p>
<ul>
<li><strong>記述統計</strong>: データそのものを要約する
<ul>
<li>要約統計量 (e.g., 平均、標準偏差、etc.)</li>
<li>作図、作表</li>
</ul>
</li>
<li><strong>推測統計</strong>: データの背後にある母集団・生成過程を考える
<ul>
<li>数理モデル</li>
<li>確率分布</li>
<li>パラメータ(母数)</li>
</ul>
</li>
</ul>
<p>「グラフを眺めてなんとなく分かる」以上の分析には<strong>モデル</strong>が必要</p>

</section>
<section>
<h2 id="モデルとは">モデルとは</h2>
<p>対象システムを単純化・理想化して扱いやすくしたもの</p>
<dl>
<dt>Mathematical Model 数理モデル<img src="../tokiomarine2021/image/hill-equation.png" width="150" align="right" style="margin: 0 -5px;"></dt>
<dd>数学的な方程式として記述されるもの。</dd>
<dd>e.g., Lotka-Volterra eq., <span style="color: #888;">Hill eq.</span></dd>
<dd><br>
</dd>
<dt>Computational Model 数値計算モデル<img src="/slides/image/tumopp/Chex_Lconst.gif" width="140" align="right"></dt>
<dd>数値計算の手続きとして記述されるもの。</dd>
<dd>e.g., Schelling’s Segregation Model, <span style="color: #888;"><em>tumopp</em></span></dd>
<dd><br>
</dd>
<dt>Concrete Model 具象モデル<img src="../tokiomarine2021/image/weisberg-sfbay.jpg" width="260" align="right"></dt>
<dd>具体的な事物で作られるもの。</dd>
<dd>e.g., San Francisco Bay-Delta Model</dd>
</dl>
<cite>
Weisberg 2012 "Simulation and Similarity" (科学とモデル)
</cite>

</section>
<section>
<h2 id="データ科学における数理モデル">データ科学における数理モデル</h2>
<p>データ生成をうまく真似できそうな仮定の数式表現。<br>
 </p>
<figure>
<img src="../tokiomarine2021/math-model.drawio.svg"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>

</section>
<section>
<h2 id="データ科学における数理モデル">データ科学における数理モデル</h2>
<p>データ生成をうまく真似できそうな仮定の数式表現。<br>
e.g., 大きいほど高く売れる: $\text{price} = A \times \text{carat} + B + \epsilon$</p>
<img src="./figure/lm-diamonds-1.png" alt="plot of chunk lm-diamonds" width="432" />
<p>新しく採れたダイヤモンドの価格予想とかにも使える。</p>
<p>このように「YをXの関数として表す」ようなモデルを<strong>回帰</strong>と呼ぶ。</p>

</section>
<section>
<h2 id="本講義の主題-回帰">本講義の主題: 回帰</h2>
<p>単純な直線あてはめから出発し、ちょっとずつ統計モデリング。</p>
<figure>
<a href="https://kuboweb.github.io/-kubo/ce/LinksGlm.html">
<img src="../tokiomarine2021/image/kubo-p2.png" width="100%">
<figcaption class="url">久保さん https://kuboweb.github.io/-kubo/ce/LinksGlm.html</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="何でもかんでも直線あてはめではよろしくない">何でもかんでも直線あてはめではよろしくない</h2>
<img src="./figure/glm-better-1.png" alt="plot of chunk glm-better" width="720" />
<ul>
<li>観察データは常に<strong>正の値</strong>なのに予測が負に突入してない？</li>
<li><strong>縦軸は整数</strong>。しかもの<strong>ばらつき</strong>が横軸に応じて変化？</li>
<li><strong>データに合わせた統計モデルを使うとマシ</strong></li>
</ul>

</section>
<section>
<h2 id="回帰は教師あり機械学習の一種とも言える">回帰は教師あり機械学習の一種とも言える</h2>
<figure>
<img src="../tokiomarine2021/regression-in-ml.drawio.svg">
</figure>
<p>でも統計モデリングはいわゆる“機械学習”とは違う気もする&hellip;?
</section>
<section>
<h2 id="モデリングにおける2つのアプローチ">モデリングにおける2つのアプローチ</h2>
<figure>
<img src="../tokiomarine2021/model-approaches.drawio.svg"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>
</section>
<section>
<h2 id="どっちも知っておいて使い分けたい">どっちも知っておいて使い分けたい</h2>
<table>
<thead>
<tr>
<th>項目</th>
<th>統計モデリング</th>
<th>近年の機械学習</th>
</tr>
</thead>
<tbody>
<tr>
<td>モデル構造</td>
<td>単純化したい</td>
<td>性能のためなら複雑化</td>
</tr>
<tr>
<td>モデル解釈</td>
<td><strong>ここが強み</strong></td>
<td>難しい。重視しない。途上。</td>
</tr>
<tr>
<td>予測・生成</td>
<td>うまくすれば頑健</td>
<td><strong>主目的</strong>。強力。高精度</td>
</tr>
<tr>
<td>データ量</td>
<td>少なくてもそれなり</td>
<td>大量に必要</td>
</tr>
<tr>
<td>計算量</td>
<td>場合による</td>
<td>場合による</td>
</tr>
<tr>
<td>例</td>
<td>一般化線形モデル<br>階層ベイズモデル</td>
<td>ランダムフォレスト<br>ニューラルネットワーク</td>
</tr>
</tbody>
</table>
<p>教科書的には概ねこんな感じとして、実際の仕事ではどうだろう？
</section>
<section>
<h2 id="現役データサイエンティスト2人に聞きました">現役データサイエンティスト2人に聞きました</h2>
<ul>
<li>統計モデルはデータ加工など事前の手続きが多め。<br>
機械学習は事前の決定が少ないので楽ちん。</li>
<li>「要因の効果はどれくらい？」<br>
意思決定をするのは結局人間。物事を分かった上で判断したい。<br>
<strong>実務の人への説明</strong>や<strong>意思決定</strong>の場面で解析の解釈性が重要。<br></li>
<li><strong>仮説があるなら</strong>、それに基づいて統計モデリング。<br>
何もないところからまず機械学習で要因抽出・仮説生成するのもあり。</li>
<li>統計モデル縛り・実行環境縛りなどの案件もある。</li>
<li>分析方針を決める立場の上級職になるつもりなら統計モデルも必要。</li>
</ul>
<p>協力: <a href="https://twitter.com/kato_kohaku"><code>@kato_kohaku</code></a>さん、<a href="https://twitter.com/teuder"><code>@teuder</code></a>さん
</section>
<section>
<h2 id="理想的じゃなくてもしばしば有用な回帰">理想的じゃなくてもしばしば有用な回帰</h2>
<figure>
<a href="https://twitter.com/takehikohayashi/status/1408338198795669507">
<img src="../tokiomarine2021/image/takehikohayashi-1408338198795669507.jpeg" width="100%">
<figcaption class="url">@takehikohayashi Jun 25, 2021</figcaption>
</a>
</figure>

</section>
<section>
<h2 id="本講義のお品書き">本講義のお品書き</h2>
<figure style="float: right;">
<a href="https://kuboweb.github.io/-kubo/ce/IwanamiBook.html">
<img src="../tokiomarine2021/image/kubo-book.jpg" width="300" alt="データ解析のための統計モデリング入門 久保拓弥 2012">
</a>
</figure>
<p>久保先生の&quot;緑本&quot;こと<br>
「データ解析のための統計モデリング入門」<br>
をベースに回帰分析の概要を紹介。</p>
<ol>
<li>イントロ 👈 いまここ</li>
<li>Rの基礎を駆け足で</li>
<li>統計モデルの基本
<ul>
<li>直線回帰</li>
<li>確率変数・<strong>確率分布</strong> 👈 本日後半の主役</li>
<li>尤度・最尤推定</li>
</ul>
</li>
<li>一般化線形モデル、混合モデル</li>
<li>ベイズ統計、階層ベイズモデル</li>
</ol>
<!-- 回帰のキモは**線ではなく分布** -->

</section>
<section>
<h2 id="rとは">Rとは</h2>
<p>統計解析と作図の機能が充実したプログラミング言語・環境</p>
<figure style="float: right;">
<a href="https://cran.r-project.org/">
<img src="/slides/image/rstats/Rlogo.svg" height="200">
<figcaption class="url">https://cran.r-project.org/</figcaption>
</a>
</figure>
<dl>
<dt>クロスプラットフォーム</dt>
<dd>Linux, Mac, Windows で動く</dd>
<dt>オープンソース</dt>
<dd>永久に無償で、すべての機能を使える。</dd>
<dd>集合知によって常に進化している。</dd>
<dt>コミュニティ</dt>
<dd>相談できる人や参考になるウェブサイトがたくさん見つかる。</dd>
</dl>
<p>他のプログラミング言語でもいいよ:
<a href="https://www.python.org/">Python</a>とか<a href="https://julialang.org/">Julia</a>とか。</p>

</section>
<section>
<h2 id="r環境のセットアップ">R環境のセットアップ</h2>
<dl>
<dt><a href="https://cran.r-project.org/">R本体</a></dt>
<dd>コマンドを解釈して実行するコア部分。</dd>
<dd>よく使われる関数なども標準パッケージとして同梱。</dd>
<dt><a href="https://posit.co/download/rstudio-desktop/">RStudio Desktop</a></dt>
<dd>Rをより快適に使うための総合開発環境 (IDE)</dd>
<dd>必須じゃないけど便利なので結構みんな使ってる。</dd>
<dd>ライバルは <a href="https://code.visualstudio.com/">VSCode</a> + <a href="https://marketplace.visualstudio.com/items?itemName=REditorSupport.r">R Extention</a>
<small>(私はこちらを使用)</small></dd>
</dl>
<img src="/slides/image/rstudio/rstudio-300x260.png">
</section>
<section>
<h2 id="rstudioを起動してconsoleで対話しよう">RStudioを起動してConsoleで対話しよう</h2>
<p><strong>Workspace (Environment)</strong> = 一時オブジェクトの集まり</p>
<img src="/slides/image/rstudio/console.png" class="screenshot" width="90%">
</section>
<section>
<h2 id="毎回まっさらなワークスペースで始める設定">毎回まっさらなワークスペースで始める設定</h2>
<p><img height=22 width=22 src="https://cdn.simpleicons.org/apple"> RStudio → Preferences   <kbd>command</kbd><kbd>,</kbd><br>
<img height=22 width=22 src="https://cdn.simpleicons.org/windows"> Tools → Global options</p>
<p>&ldquo;Restore &hellip;&rdquo; の<strong>チェックを外し</strong>て、 &ldquo;Save &hellip;&rdquo; の<strong>Never</strong>を選択</p>
<figure style="margin: 0;">
<a href="https://r4ds.had.co.nz/workflow-projects.html">
<img src="/slides/image/rstudio/preferences-workspace.png"
     style="object-fit: cover; object-position: top; height: 420px;">
<figcaption class="url">https://r4ds.had.co.nz/workflow-projects.html</figcaption>
</a>
</figure>

</section>
<section>
<h2 id="project-を新規作成する">&ldquo;Project&rdquo; を新規作成する</h2>
<p>File → New Project&hellip; → New Directory → New Project →<br>
→ Directory name: <code>r-training-2022</code><br>
→ as subdirectory of: <code>~/project</code> or <code>C:/Users/yourname/project</code></p>
<p><img src="/slides/image/rstudio/create-new-project.png" class="screenshot" width="90%"
style="object-fit: cover; object-position: top; height: 420px;"></p>
<p>📁 ディレクトリ ＝ フォルダ。 <code>~/</code> = ホームディレクトリ</p>

</section>
<section>
<h2 id="rスクリプトに書いてから実行">Rスクリプトに書いてから実行</h2>
<p>File → New File → R script</p>
<img src="/slides/image/rstudio/newfile.png" width="100%">
</section>
<section>
<h2 id="rスクリプトに書いてから実行">Rスクリプトに書いてから実行</h2>
<p>File → New File → R script</p>
<img src="/slides/image/rstudio/script-console.png" width="100%">
</section>
<section>
<h2 id="rスクリプトに書いてから実行">Rスクリプトに書いてから実行</h2>
<p>Select text with <kbd>shift</kbd><kbd>←</kbd><kbd>↓</kbd><kbd>↑</kbd><kbd>→</kbd><br>
Execute them with <kbd>ctrl</kbd><kbd>return</kbd></p>
<img src="/slides/image/rstudio/101.png" width="100%">
</section>
<section>
<h2 id="rスクリプトを保存する">Rスクリプトを保存する</h2>
<ul>
<li>手順
<ul>
<li>File → Save <kbd>command</kbd><kbd>s</kbd></li>
<li>ファイル名: <code>hello.R</code></li>
<li>場所: さっき作ったプロジェクト内 (デフォルトでそうなるはず)</li>
</ul>
</li>
<li><strong>スクリプトを書いたら消さずに保存すること！</strong>
<ul>
<li>書いたスクリプトは財産</li>
<li>保存しておけばまた使い回せる</li>
</ul>
</li>
</ul>
<p>🔰 いろんな四則演算を試して <code>hello.R</code> に保存してみよう。<br>
e.g., <code>1 + 2 + 3</code>, <code>3 * 7 * 2</code>, <code>4 / 2</code>, <code>4 / 3</code>, etc.
</section>
<section>
<h2 id="プロジェクトにファイルが溜まっていく">プロジェクト📁にファイルが溜まっていく</h2>
<p>スクリプト、データ、結果を分けて整理する例:</p>
<pre tabindex="0"><code>r-training-2022/           # プロジェクトの最上階
├── r-training-2022.Rproj  # これダブルクリックでRStudioを起動
├── hello.R
├── transform.R            # データ整理・変形のスクリプト
├── visualize.R            # 作図のスクリプト
├── data/                  # 元データを置くところ
│   ├── iris.tsv
│   └── diamonds.xlsx
└── output/                # 結果の出力先
    ├── iris-petal.png
    └── iris-summary.tsv
</code></pre><p>プロジェクト最上階を作業ディレクトリとし、<br>
ファイル読み書きの基準にする。(後で詳しく)</p>
<p>ほんの一例です。好きな構造に決めてください。</p>

</section>
<section>
<h2 id="rと接する上での心構え">Rと接する上での心構え</h2>
<figure>
<img src="/slides/image/free/akusyu_uchuujin.png" height="200">
</figure>
<dl>
<dt>エラー文を恐れない</dt>
<dd>熟練プログラマでも頻繁にエラーを起こす。</dd>
<dd>エラーはRからのメッセージ。<strong>意図を読み取って修正</strong>しよう。</dd>
<dd>プログラミングの経験値 ≈ エラー解決の経験値</dd>
<dt>困ったらウェブ検索</dt>
<dd>あなたの問題は全世界のRユーザーが既に通った道。</dd>
<dd>日本語で、英語で、エラー文そのもので検索すれば解決策に当たる。</dd>
</dl>

</section>
<section>
<h2 id="この実習の取り組み方">この実習の取り組み方</h2>
<p>とにかく手を動かして体感しよう！</p>
<ol>
<li>
<p>こういう枠が出てきたら、自分のRスクリプトに<strong>コピペして保存</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p><strong>実行してコンソールを確認</strong>。思ったとおりの出力？<br>
<code>Error</code> や <code>Warning</code> があったらよく読んで対処する。<br>
(無視していい <code>Warning</code> もたまーにあるけど)</p>
</li>
<li>
<p>🔰若葉マークの練習問題があれば解いてみる。<br>
そこまでのコードの<strong>コピペ＋改変</strong>でできるはず。</p>
</li>
</ol>
<p>疑問・困りごとがある場合は<strong>気軽にChat欄に</strong>書き込んでください。</p>

</section>
<section>
<h2 id="変数オブジェクトを作ってみよう">変数/オブジェクトを作ってみよう</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="m">2</span>        <span class="c1"># Create x</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span>            <span class="c1"># What&#39;s in x?</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 2
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="m">5</span>        <span class="c1"># Create y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span>            <span class="c1"># What&#39;s in y?</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 5
</code></pre><p>Rでは代入演算子として矢印 <code>&lt;-</code> も使えるけど私は <code>=</code> 推奨。<br>
<code>#</code> 記号より右はRに無視される。コメントを書くのに便利。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 7
</code></pre><p>🔰 <code>x</code> と <code>y</code> の引き算、掛け算、割り算をやってみよう</p>

</section>
<section>
<h2 id="基本的な演算">基本的な演算</h2>
<p><code>+</code> とか <code>*</code> のような演算子(operator)を変数の間に置く。<br></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="m">10</span> <span class="o">+</span> <span class="m">3</span>    <span class="c1"># addition</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="o">-</span> <span class="m">3</span>    <span class="c1"># subtraction</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="o">*</span> <span class="m">3</span>    <span class="c1"># multiplication</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="o">/</span> <span class="m">3</span>    <span class="c1"># division</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="o">%/%</span> <span class="m">3</span>  <span class="c1"># integer division</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="o">%%</span> <span class="m">3</span>   <span class="c1"># modulus 剰余</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="o">**</span> <span class="m">3</span>   <span class="c1"># exponent 10^3</span>
</span></span></code></pre></div><p>🔰 コピペして結果を確認してみよう。</p>

</section>
<section>
<h2 id="関数-function">関数 (function)</h2>
<p>変数を受け取って、何か仕事して、返す命令セット</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>  <span class="c1"># 1と3を渡すとvectorが返ってくる</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1 2 3
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>         <span class="c1"># vectorを渡すと足し算が返ってくる</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 6
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">square</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">something</span><span class="p">)</span> <span class="p">{</span>  <span class="c1"># 自分の関数を定義</span>
</span></span><span class="line"><span class="cl">  <span class="n">something</span> <span class="o">**</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                       <span class="c1"># 使ってみる</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1 4 9
</code></pre><p>🔰 自分の関数を何か作ってみよう。
e.g., 2倍にする関数 <code>twice</code></p>

</section>
<section>
<h2 id="変数オブジェクトを作ってみよう-part-2">変数/オブジェクトを作ってみよう Part 2</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="m">42</span>       <span class="c1"># Create x</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span>            <span class="c1"># What&#39;s in x?</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 42
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="s">&#34;24601&#34;</span>  <span class="c1"># Create y</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span>            <span class="c1"># What&#39;s in y?</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;24601&#34;
</code></pre><p>この <code>x</code> と <code>y</code> を足そうとするとエラーになる。なぜ？</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>        <span class="c1"># Error! Why?</span>
</span></span></code></pre></div><pre tabindex="0"><code>Error in x + y: non-numeric argument to binary operator
</code></pre>
</section>
<section>
<h2 id="変数オブジェクトの型">変数/オブジェクトの型</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;numeric&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">is.numeric</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] TRUE
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">is.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] FALSE
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;42&#34;
</code></pre><p>🔰 さっき作った <code>y</code> にも同じ関数を適用してみよう。</p>

</section>
<section>
<h2 id="変数オブジェクトの型">変数/オブジェクトの型</h2>
<ul>
<li><code>vector</code>: 基本型。一次元の配列。
<ul>
<li><code>logical</code>: 論理値 (<code>TRUE</code> or <code>FALSE</code>)</li>
<li><code>numeric</code>: 数値 (整数 <code>42L</code> or 実数 <code>3.1416</code>)</li>
<li><code>character</code>: 文字列 (<code>&quot;a string&quot;</code>)</li>
<li><code>factor</code>: 因子 (文字列っぽいけど微妙に違う)</li>
</ul>
</li>
<li><code>array</code>: 多次元配列。<code>vector</code>同様、全要素が同じ型。
<ul>
<li><code>matrix</code>: 行列 = 二次元の配列。</li>
</ul>
</li>
<li><code>list</code>: 異なる型でも詰め込める太っ腹ベクトル。</li>
<li><strong><code>data.frame</code>: 同じ長さのベクトルを並べた長方形のテーブル。重要。</strong> <br>
<strong><code>tibble</code></strong> とか <strong><code>tbl_df</code></strong> と呼ばれる亜種もあるけどほぼ同じ。</li>
</ul>

</section>
<section>
<h2 id="vector-一次元の配列">vector: 一次元の配列</h2>
<p>1個の値でもベクトル扱い。<br>
同じ長さ(または長さ1)の相手との計算が得意。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span>  <span class="c1"># 長さ3の数値ベクトル</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>           <span class="c1"># 同じ長さ同士の計算</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  2  4 18
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="m">10</span>          <span class="c1"># 長さ1の数値ベクトル</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>           <span class="c1"># 長さ3 + 長さ1 = 長さ3 (それぞれ足し算)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 11 12 19
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;</span> <span class="m">5</span>           <span class="c1"># 5より小さいか</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  TRUE  TRUE FALSE
</code></pre><p>🔰 この <code>x, y</code> を使っていろいろな演算を試してみよう</p>

</section>
<section>
<h2 id="vectorから部分的に抜き出す">vectorから部分的に抜き出す</h2>
<p><code>[]</code> を使う。番号は1から始まる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kc">letters</span>
</span></span></code></pre></div><pre tabindex="0"><code> [1] &#34;a&#34; &#34;b&#34; &#34;c&#34; &#34;d&#34; &#34;e&#34; &#34;f&#34; &#34;g&#34; &#34;h&#34; &#34;i&#34; &#34;j&#34; &#34;k&#34; &#34;l&#34; &#34;m&#34; &#34;n&#34; &#34;o&#34; &#34;p&#34; &#34;q&#34; &#34;r&#34; &#34;s&#34; &#34;t&#34; &#34;u&#34; &#34;v&#34; &#34;w&#34; &#34;x&#34; &#34;y&#34; &#34;z&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kc">letters</span><span class="n">[3]</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;c&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kc">letters</span><span class="nf">[seq</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span><span class="n">]</span>       <span class="c1"># 4 5 6</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;d&#34; &#34;e&#34; &#34;f&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kc">letters</span><span class="nf">[seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">26</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">4</span><span class="n">]</span>  <span class="c1"># TRUE TRUE TRUE FALSE FALSE ...</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;a&#34; &#34;b&#34; &#34;c&#34;
</code></pre>
</section>
<section>
<h2 id="vectorを渡した結果は関数によって異なる">vectorを渡した結果は関数によって異なる</h2>
<p>各要素に適用するもの:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="c1"># square root</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1.000000 1.414214 3.000000
</code></pre><p>全要素を集約した値を返すもの:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">z</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">z</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 12
</code></pre><p>🔰 <code>log()</code>, <code>exp()</code>, <code>length()</code>, <code>max()</code>, <code>mean()</code>
にvectorを渡してみよう。</p>

</section>
<section>
<h2 id="matrix-二次元の配列-行列">matrix: 二次元の配列 (行列)</h2>
<p>1本のvectorを折り曲げて長方形にしたもの。<br>
中身は全て同じ型。機械学習とか画像処理とかで使う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">v</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>              <span class="c1"># c(1, 2, 3, 4, 5, 6, 7, 8)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span>    <span class="c1"># 2行に畳む。列ごとに詰める</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span>
</span></span></code></pre></div><pre tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    3    5    7
[2,]    2    4    6    8
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">byrow</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># 行ごとに詰める</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span>
</span></span></code></pre></div><pre tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    2    3    4
[2,]    5    6    7    8
</code></pre><p>🔰 結果を確認してみよう: <code>x + y</code>, <code>dim(x)</code>, <code>nrow(x)</code>, <code>ncol(x)</code>.</p>

</section>
<section>
<h2 id="行-row-列-column-の憶え方">行 (row), 列 (column) の憶え方</h2>
<div class="column-container">
  <div class="column">
    <figure>
    <a href="https://commons.wikimedia.org/wiki/File:2012_Super_GT_Sugo_starting_grid.jpg">
    <img src="/slides/image/free/front-row.jpg" height="480">
    <figcaption class="url">https://commons.wikimedia.org/wiki/File:2012_Super_GT_Sugo_starting_grid.jpg</figcaption>
    </a>
    </figure>
  </div>
  <div class="column">
    <figure>
    <a href="https://en.wikipedia.org/wiki/Rhodes">
    <img src="/slides/image/free/apollon-columns.jpg" height="480">
    <figcaption class="url">https://en.wikipedia.org/wiki/Rhodes</figcaption>
    </a>
    </figure>
  </div>
</div>

</section>
<section>
<h2 id="dataframe-長方形のテーブル-重要">data.frame: 長方形のテーブル (重要!)</h2>
<p>同じ長さの列vectorを複数束ねた長方形の表。<br>
e.g., 長さ150の数値ベクトル4本と因子ベクトル1本:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
  1          5.1         3.5          1.4         0.2    setosa
  2          4.9         3.0          1.4         0.2    setosa
  3          4.7         3.2          1.3         0.2    setosa
  4          4.6         3.1          1.5         0.2    setosa
 --                                                            
147          6.3         2.5          5.0         1.9 virginica
148          6.5         3.0          5.2         2.0 virginica
149          6.2         3.4          5.4         2.3 virginica
150          5.9         3.0          5.1         1.8 virginica
</code></pre><p><code>iris</code> はアヤメ属3種150個体に関する測定データ。<br>
Rに最初から入ってて、例としてよく使われる。</p>

</section>
<section>
<h2 id="dataframeを眺める">data.frameを眺める</h2>
<p>概要を掴む:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>   <span class="c1"># 先頭だけ見てみる。末尾は tail()</span>
</span></span><span class="line"><span class="cl"><span class="nf">nrow</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>      <span class="c1"># 行数: Number of ROWs</span>
</span></span><span class="line"><span class="cl"><span class="nf">ncol</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>      <span class="c1"># 列数: Number of COLumns</span>
</span></span><span class="line"><span class="cl"><span class="nf">names</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>     <span class="c1"># 列名</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>   <span class="c1"># 要約</span>
</span></span><span class="line"><span class="cl"><span class="nf">View</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>      <span class="c1"># RStudioで閲覧</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">str</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>       <span class="c1"># 構造が分かる形で表示</span>
</span></span></code></pre></div><pre tabindex="0"><code>tibble [150 × 5] (S3: tbl_df/tbl/data.frame)
 $ Sepal.Length: num [1:150] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal.Width : num [1:150] 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
 $ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Species     : Factor w/ 3 levels &#34;setosa&#34;,&#34;versicolor&#34;,..: 1 1 1 1 1 1 1 1 1 1 ...
</code></pre><p>🔰 ほかのデータもいろいろ見てみよう。
e.g., <code>mtcars</code>, <code>quakes</code>, <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html"><code>data()</code></a></p>

</section>
<section>
<h2 id="dataframeを眺める">data.frameを眺める</h2>
<p>部分的なdata.frameを取得する:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">iris[2</span><span class="p">,</span> <span class="n">]</span>                  <span class="c1"># 2行目</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[2</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="n">]</span>                <span class="c1"># 2行目から5行目まで</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="n">]</span>                <span class="c1"># 3-4列目</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[2</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="n">]</span>             <span class="c1"># 2-5行目, 3-4列目</span>
</span></span></code></pre></div><p>vectorとして取得する:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">iris[[3]]</span>                  <span class="c1"># 3列目</span>
</span></span><span class="line"><span class="cl"><span class="n">iris</span><span class="o">$</span><span class="n">Petal.Length</span>          <span class="c1"># Petal.Length列</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[[</span><span class="s">&#34;Petal.Length&#34;</span><span class="n">]]</span>     <span class="c1"># Petal.Length列</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[[</span><span class="s">&#34;Petal.Length&#34;</span><span class="n">]][2]</span>  <span class="c1"># Petal.Length列の2番目</span>
</span></span></code></pre></div><p>結果がdata.frameになるかvectorになるか微妙:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">iris[</span><span class="p">,</span> <span class="m">3</span><span class="n">]</span>                  <span class="c1"># 3列目</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[</span><span class="p">,</span> <span class="s">&#34;Petal.Length&#34;</span><span class="n">]</span>     <span class="c1"># Petal.Length列</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[2</span><span class="p">,</span> <span class="m">3</span><span class="n">]</span>                 <span class="c1"># 2行目3列目</span>
</span></span><span class="line"><span class="cl"><span class="n">iris[2</span><span class="p">,</span> <span class="s">&#34;Petal.Length&#34;</span><span class="n">]</span>    <span class="c1"># 2行目Petal.Length列</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="dataframeの新規作成">data.frameの新規作成</h2>
<p>同じ長さの <strong>列(column) vector</strong> を結合して作る:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mydata</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">mydata</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>  x y
1 1 A
2 2 B
3 3 C
</code></pre><p>🔰 次のようなdata.frameを作って <code>theDF</code> と名付けよう:</p>
<pre tabindex="0"><code> i s
24 x
25 y
26 z
</code></pre><p>ヒント: <code>c()</code> 無しでクリアすることも可能。</p>

</section>
<section>
<h2 id="dataframeの読み書き">data.frameの読み書き</h2>
<ul>
<li>
<p>readxlパッケージを使えば <code>.xlsx</code> ファイルも読める、けど</p>
</li>
<li>
<p>カンマ区切り(CSV)とかタブ区切り(TSV)のテキストが無難。</p>
</li>
<li>
<p>ファイル名は<strong>作業ディレクトリ</strong>からの<strong>相対パス</strong>で指定。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;readr&#34;</span><span class="p">)</span> <span class="c1"># R標準の read.table() とかは難しいので</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>            <span class="c1"># パッケージのやつを使うよ</span>
</span></span><span class="line"><span class="cl"><span class="nf">write_tsv</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="s">&#34;data/iris.tsv&#34;</span><span class="p">)</span>   <span class="c1"># 書き出し</span>
</span></span><span class="line"><span class="cl"><span class="n">iris2</span> <span class="o">=</span> <span class="nf">read_tsv</span><span class="p">(</span><span class="s">&#34;data/iris.tsv&#34;</span><span class="p">)</span>  <span class="c1"># 読み込み</span>
</span></span></code></pre></div></li>
</ul>
<p>あれれー、エラーが出る？</p>
<pre tabindex="0"><code>Error: Cannot open file for writing:
* &#39;data/iris.tsv&#39;
</code></pre>
</section>
<section>
<h2 id="ファイル読み書きでありがちなエラー">ファイル読み書きでありがちなエラー</h2>
<ul>
<li>読みたいファイル名が間違っている。</li>
<li>読みたいファイルが作業ディレクトリとは違うところにある。</li>
<li>書き込み先のディレクトリが存在しない。→ 予め作っておこう</li>
</ul>
<p>冷静に、現在の作業ディレクトリとその中身を確認しよう:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">getwd</span><span class="p">()</span>               <span class="c1"># GET Working Directory</span>
</span></span><span class="line"><span class="cl"><span class="nf">list.files</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">)</span>       <span class="c1"># List files in &#34;.&#34; (here)</span>
</span></span><span class="line"><span class="cl"><span class="nf">list.files</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">)</span>    <span class="c1"># List files in &#34;./data&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">dir.create</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">)</span>    <span class="c1"># Create directory</span>
</span></span></code></pre></div><p><a href="https://comicalcommet.github.io/r-training-2021/R_training_2021_7.html">よくあるエラー集 (石川由希さん@名古屋大)</a>
を読んでおきましょう。</p>
<p>🔰 R組み込みデータや自作データを読み書きしてみよう。</p>

</section>
<section>
<h2 id="r-package">R package</h2>
<p>便利な関数やデータセットなどをひとまとめにしたもの。</p>
<dl>
<dt>Standard Packages</dt>
<dd>Rの標準機能。何もしなくても使用可能。</dd>
<dt>Contributed Packages</dt>
<dd>有志により開発され、
<a href="https://cran.rstudio.com/web/packages/">CRAN</a> や
<a href="https://www.bioconductor.org/">Bioconductor</a> に公開されている。</dd>
<dd>要インストール。使う前に読み込む。</dd>
</dl>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;readr&#34;</span><span class="p">)</span>  <span class="c1"># 一度やればOK</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>             <span class="c1"># 読み込みはRを起動するたびに必要</span>
</span></span><span class="line"><span class="cl"><span class="nf">update.packages</span><span class="p">()</span>          <span class="c1"># たまには更新しよう</span>
</span></span></code></pre></div><dl>
<dt>素のRも覚えきってないのにいきなりパッケージ？</dt>
<dd>大丈夫。誰も覚えきってない。</dd>
<dd>パッケージを使わないR作業 = 火もナイフも使わない料理</dd>
</dl>

</section>
<section>
<h2 id="tidyverse-データ科学のためのパッケージ群">tidyverse: データ科学のためのパッケージ群</h2>
<a href="https://www.tidyverse.org/">
<img src="/slides/image/rstats/hex-badges8.png" width="300" align="right">
</a>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;tidyverse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">conflicted</span><span class="p">)</span> <span class="c1"># 安全のおまじない</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>  <span class="c1"># 一挙に読み込み</span>
</span></span></code></pre></div><pre tabindex="0"><code>── Attaching core tidyverse packages ─────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.1     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.1     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
</code></pre><p>一貫したデザインでデータ解析の様々な工程をカバー</p>
<figure style="margin-block: 0;">
<a href="https://r4ds.had.co.nz/introduction.html">
<img src="/slides/image/r4ds/data-science.png">
<figcaption class="url">https://r4ds.had.co.nz/introduction.html</figcaption>
</a>
</figure>

</section>
<section>
<h2 id="ggplot2-tidyverseの可視化担当">ggplot2: tidyverseの可視化担当</h2>
<a href="https://ggplot2.tidyverse.org/">
<img src="/_img/hex-stickers/ggplot2.webp" width="120" align="right">
</a>
<ul>
<li>&ldquo;The <strong><u>G</u></strong>rammer of <strong><u>G</u></strong>raphics&rdquo; という体系に基づく設計</li>
<li>単にいろんなグラフを「描ける」だけじゃなく<br>
<strong>一貫性のある文法で合理的に描ける</strong></li>
</ul>
<figure>
<!--
<a href="https://www.amazon.co.jp/dp/B00HWUVHXK/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=d63d3627df82c09b0bb5ca8f47ee19cc&language=ja_JP" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00HWUVHXK&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22&language=ja_JP" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&language=ja_JP&l=li3&o=9&a=B00HWUVHXK" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<img src="/slides/image/nagoya/iris.png" width="24%">
<img src="/slides/image/nagoya/binhex.png" width="24%">
<img src="/slides/image/nagoya/faithful.png" width="24%">
-->
<img src="/slides/image/tumopp/paper/Fig1.png" height="200">
<img src="/slides/image/tumopp/param-p.png" height="200">
<img src="/slides/image/tumopp/param-k.png" height="200"><br>
<img src="/slides/image/tumopp/paper/Fig3.png" height="100">
<img src="/slides/image/tumopp/Cmoore_Lconst.gif" height="100">
<img src="/slides/image/tumopp/Cmoore_Llinear.gif" height="100">
<img src="/slides/image/tumopp/Cmoore_Lstep.gif" height="100">
<img src="/slides/image/tumopp/Chex_Lconst.gif" height="100">
<img src="/slides/image/tumopp/Chex_Llinear.gif" height="100">
<img src="/slides/image/tumopp/Chex_Lstep.gif" height="100">
<figcaption class="url">Iwasaki and Innan (2017)</figcaption>
</figure>
</section>
<section>
<h2 id="いきなりggplot2から使い始めても大丈夫">いきなりggplot2から使い始めても大丈夫</h2>
<p>R標準のやつとは根本的に違うシステムで作図する。</p>
<figure>
<img src="/slides/image/rstats/r-graphics.svg">
<figcaption><cite>「Rグラフィックス」Murrell著 久保訳 より改変</cite></figcaption>
</figure>
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<img src="/slides/image/rstats/ggplot-layers.png" height = "600">
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span>             <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl"><span class="c1"># aes(x = carat, y = price) +       # carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl"><span class="c1"># geom_point() +                    # 散布図を描く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># facet_wrap(vars(clarity)) +       # clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stat_smooth(method = lm) +        # 直線回帰を追加</span>
</span></span><span class="line"><span class="cl"><span class="c1"># coord_cartesian(ylim = c(0, 2e4)) + # y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)     # クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus1-1.png" alt="plot of chunk ggplot-plus1" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span>         <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl"><span class="c1"># geom_point() +                    # 散布図を描く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># facet_wrap(vars(clarity)) +       # clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stat_smooth(method = lm) +        # 直線回帰を追加</span>
</span></span><span class="line"><span class="cl"><span class="c1"># coord_cartesian(ylim = c(0, 2e4)) + # y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)     # クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus2-1.png" alt="plot of chunk ggplot-plus2" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>       <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span>                      <span class="c1"># 散布図を描く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># facet_wrap(vars(clarity)) +       # clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stat_smooth(method = lm) +        # 直線回帰を追加</span>
</span></span><span class="line"><span class="cl"><span class="c1"># coord_cartesian(ylim = c(0, 2e4)) + # y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)     # クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus3-1.png" alt="plot of chunk ggplot-plus3" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>       <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>                    <span class="c1"># 散布図を描く</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">clarity</span><span class="p">))</span>         <span class="c1"># clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stat_smooth(method = lm) +        # 直線回帰を追加</span>
</span></span><span class="line"><span class="cl"><span class="c1"># coord_cartesian(ylim = c(0, 2e4)) + # y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)     # クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus4-1.png" alt="plot of chunk ggplot-plus4" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>       <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>                    <span class="c1"># 散布図を描く</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">clarity</span><span class="p">))</span> <span class="o">+</span>       <span class="c1"># clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stat_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">lm</span><span class="p">)</span>          <span class="c1"># 直線回帰を追加</span>
</span></span><span class="line"><span class="cl"><span class="c1"># coord_cartesian(ylim = c(0, 2e4)) + # y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)     # クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus5-1.png" alt="plot of chunk ggplot-plus5" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>       <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>                    <span class="c1"># 散布図を描く</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">clarity</span><span class="p">))</span> <span class="o">+</span>       <span class="c1"># clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stat_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">lm</span><span class="p">)</span> <span class="o">+</span>        <span class="c1"># 直線回帰を追加</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">2e4</span><span class="p">))</span>   <span class="c1"># y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># theme_classic(base_size = 20)     # クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus6-1.png" alt="plot of chunk ggplot-plus6" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>       <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>                    <span class="c1"># 散布図を描く</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">clarity</span><span class="p">))</span> <span class="o">+</span>       <span class="c1"># clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stat_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">lm</span><span class="p">)</span> <span class="o">+</span>        <span class="c1"># 直線回帰を追加</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">2e4</span><span class="p">))</span> <span class="o">+</span> <span class="c1"># y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_classic</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">20</span><span class="p">)</span>     <span class="c1"># クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus7-1.png" alt="plot of chunk ggplot-plus7" width="504" />
</section>
<section>
<h2 id="基本的な使い方-指示を--で重ねていく">基本的な使い方: 指示を <code>+</code> で重ねていく</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># diamondsデータでキャンバス準備</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>       <span class="c1"># carat,price列をx,y軸にmapping</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>                    <span class="c1"># 散布図を描く</span>
</span></span><span class="line"><span class="cl"><span class="c1"># facet_wrap(vars(clarity)) +       # clarity列に応じてパネル分割</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stat_smooth(method = lm) +        # 直線回帰を追加</span>
</span></span><span class="line"><span class="cl"><span class="c1"># coord_cartesian(ylim = c(0, 2e4)) + # y軸の表示範囲を狭く</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_classic</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">20</span><span class="p">)</span>     <span class="c1"># クラシックなテーマで</span>
</span></span></code></pre></div><img src="./figure/ggplot-plus8-1.png" alt="plot of chunk ggplot-plus8" width="504" />
</section>
<section>
<h2 id="図をオブジェクトとして取っておける">図をオブジェクトとして取っておける</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p3</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p4</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">+</span> <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">clarity</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
</span></span></code></pre></div><img src="./figure/ggplot-object-1.png" alt="plot of chunk ggplot-object" width="432" />

</section>
<section>
<h2 id="ファイル名もサイズも再現可能な作図">ファイル名もサイズも再現可能な作図</h2>
<p><code>width</code>や<code>height</code>が小さいほど、文字・点・線が相対的に大きく</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 7inch x 300dpi = 2100px四方 (デフォルト)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia1.png&#34;</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="c1"># width = 7, height = 7, dpi = 300</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4     x 300    = 1200  全体7/4倍ズーム</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia2.png&#34;</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span> <span class="c1"># dpi = 300</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2     x 600    = 1200  全体をさらに2倍ズーム</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia3.png&#34;</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="m">600</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4     x 300    = 1200  テーマを使って文字だけ拡大</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;dia4.png&#34;</span><span class="p">,</span> <span class="n">p3</span> <span class="o">+</span> <span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">22</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></span></code></pre></div><figure>
<img src="../sendair2/image/dia1.png" width="24%">
<img src="../sendair2/image/dia2.png" width="24%">
<img src="../sendair2/image/dia3.png" width="24%">
<img src="../sendair2/image/dia4.png" width="24%">
</figure>

</section>
<section>
<h2 id="論文のfigureみたいに並べるのもrで">論文のFigureみたいに並べるのもRで</h2>
<p>別のパッケージ
(<a href="https://wilkelab.org/cowplot/">cowplot</a>
や
<a href="https://patchwork.data-imaginist.com/">patchwork</a>)
の助けを借りて</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">pAB</span> <span class="o">=</span> <span class="n">cowplot</span><span class="o">::</span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">),</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">1L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cowplot</span><span class="o">::</span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">pAB</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">),</span> <span class="n">ncol</span> <span class="o">=</span> <span class="m">1L</span><span class="p">)</span>
</span></span></code></pre></div><img src="./figure/cowplot-1.png" alt="plot of chunk cowplot" width="432" />

</section>
<section>
<h2 id="データ解析のおおまかな流れ">データ解析のおおまかな流れ</h2>
<ol>
<li>コンピュータ環境の整備</li>
<li>データの取得、読み込み</li>
<li>探索的データ解析
<ul>
<li><strong>前処理、加工</strong> (労力の8割はここという説も)</li>
<li>可視化、仮説生成 (まずここを目指す！)</li>
<li>統計解析、仮説検証 (みんな重視しがち)</li>
</ul>
</li>
<li>報告、発表</li>
</ol>
<figure>
<a href="https://r4ds.had.co.nz/introduction.html">
<img src="/slides/image/r4ds/data-science.png">
<figcaption class="url">https://r4ds.had.co.nz/introduction.html</figcaption>
</a>
</figure>

</section>
<section>
<h2 id="機械処理しやすい形-vs-人が読み書きしやすい形">機械処理しやすい形 vs 人が読み書きしやすい形</h2>
<dl>
<dt>作図や解析に使えるデータ形式はほぼ決まってる</dt>
<dd><code>ggplot(data, ...)</code>, <code>glm(..., data, ...)</code>, &hellip;</dd>
<dt>出発点となるデータはさまざま</dt>
<dd>実験ノート、フィールドノート、データベース、&hellip;</dd>
</dl>
<blockquote>
<p>Happy families are all alike;<br>
every unhappy family is unhappy in its own way<br>
&mdash; Leo Tolstoy &ldquo;Anna Karenina&rdquo;</p>
</blockquote>
<blockquote>
<p>tidy datasets are all alike,<br>
but every messy dataset is messy in its own way<br>
&mdash; Hadley Wickham</p>
</blockquote>

</section>
<section>
<h2 id="整然データ-tidy-data-nbsp-vs-nbsp-雑然データ-messy-data">整然データ tidy data   vs   雑然データ messy data</h2>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1.png" height="550" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1.png" width="300" style="transform: translate(-14px, 0);">
    <div style="position: absolute; top: 440px;">
    縦1列は1つの変数<br>
    横1行は1つの観測<br>
    1セルは1つの値<br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
西原史暁「整然データとは何か」https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>
</section>
<section>
<h2 id="整然データ-tidy-data-nbsp-vs-nbsp-雑然データ-messy-data">整然データ tidy data   vs   雑然データ messy data</h2>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1-var.png" height="580" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1-var.png" width="420" style="transform: translate(-36px, -10px);">
    <div style="position: absolute; top: 440px;">
    <strong>縦1列は1つの変数</strong><br>
    横1行は1つの観測<br>
    1セルは1つの値<br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
西原史暁「整然データとは何か」https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>
</section>
<section>
<h2 id="整然データ-tidy-data-nbsp-vs-nbsp-雑然データ-messy-data">整然データ tidy data   vs   雑然データ messy data</h2>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1-obs.png" height="530" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1-obs.png" width="300" style="transform: translate(-24px, 0);">
    <div style="position: absolute; top: 440px;">
    縦1列は1つの変数<br>
    <strong>横1行は1つの観測</strong><br>
    1セルは1つの値<br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
西原史暁「整然データとは何か」https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>
</section>
<section>
<h2 id="整然データ-tidy-data-nbsp-vs-nbsp-雑然データ-messy-data">整然データ tidy data   vs   雑然データ messy data</h2>
<div class="column-container">
  <div class="column" style="flex-shrink: 1.1;">
    <img src="/slides/image/fnshr/tidy-data-ex1-obs.png" height="530" style="vertical-align: top;">
  </div>
  <div class="column">
    <img src="/slides/image/fnshr/messy-data-ex1-val.png" width="300" style="transform: translate(-14px, 4px);">
    <div style="position: absolute; top: 440px;">
    縦1列は1つの変数<br>
    横1行は1つの観測<br>
    <strong>1セルは1つの値</strong><br>
    </div>
  </div>
</div>
<cite style="position: absolute; bottom: 18px; right: 24px;">
<a class="url" href="https://id.fnshr.info/2017/01/09/tidy-data-intro/">
西原史暁「整然データとは何か」https://id.fnshr.info/2017/01/09/tidy-data-intro/
</a>
</cite>

</section>
<section>
<h2 id="整然データ-tidy-data-nbsp--nbsp-ggplot-したくなる形">整然データ tidy data   ≈   ggplot したくなる形</h2>
<ul>
<li><strong>縦1列</strong>は1つの<strong>変数</strong></li>
<li><strong>横1行</strong>は1つの<strong>観測</strong></li>
<li><strong>1セル</strong>は1つの<strong>値</strong></li>
</ul>
<cite style="display: block; text-align: right;">
<a class="url" href="https://r4ds.had.co.nz/tidy-data.html">https://r4ds.had.co.nz/tidy-data.html</a>
</cite>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">ggplot2</span><span class="o">::</span><span class="n">diamonds</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table price    x    y    z
    1  0.23     Ideal     E     SI2  61.5    55   326 3.95 3.98 2.43
    2  0.21   Premium     E     SI1  59.8    61   326 3.89 3.84 2.31
    3  0.23      Good     E     VS1  56.9    65   327 4.05 4.07 2.31
    4  0.29   Premium     I     VS2  62.4    58   334 4.20 4.23 2.63
   --                                                               
53937  0.72      Good     D     SI1  63.1    55  2757 5.69 5.75 3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757 5.66 5.68 3.56
53939  0.86   Premium     H     SI2  61.0    58  2757 6.15 6.12 3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757 5.83 5.87 3.64
</code></pre>
</section>
<section>
<h2 id="整然データ-tidy-data-nbsp--nbsp-ggplot-したくなる形">整然データ tidy data   ≈   ggplot したくなる形</h2>
<p>x軸、y軸、色分け、パネル分けなどを列の名前で指定して簡単作図:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">carat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">price</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">clarity</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">cut</span><span class="p">))</span>
</span></span></code></pre></div><img src="./figure/tidy-data-benefit-1.png" alt="plot of chunk tidy-data-benefit" width="648" />
</section>
<section>
<h2 id="前処理-生データを下ごしらえして食べやすい形に">前処理: 生データを下ごしらえして食べやすい形に</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">VADeaths</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      Rural Male Rural Female Urban Male Urban Female
50-54       11.7          8.7       15.4          8.4
55-59       18.1         11.7       24.3         13.6
60-64       26.9         20.3       37.0         19.3
65-69       41.0         30.9       54.6         35.1
70-74       66.0         54.3       71.1         50.0
</code></pre><p>↓ 下ごしらえ: 作図・解析で使いやすい整然データに</p>
<pre tabindex="0"><code>   lbound ubound region    sex death
 1     50     54  Rural   Male  11.7
 2     50     54  Rural Female   8.7
 3     50     54  Urban   Male  15.4
 4     50     54  Urban Female   8.4
--                                  
17     70     74  Rural   Male  66.0
18     70     74  Rural Female  54.3
19     70     74  Urban   Male  71.1
20     70     74  Urban Female  50.0
</code></pre>
</section>
<section>
<h2 id="前処理は大きく2つに分けられる">前処理は大きく2つに分けられる</h2>
<div style="float: right;">
<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="120">
</a><br>
<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="120">
</a><br>
<a href="https://stringr.tidyverse.org/">
<img src="/_img/hex-stickers/stringr.webp" width="120">
</a>
</div>
<ul>
<li>データ構造を対象とする処理
<ul>
<li>使いたい部分だけ抽出</li>
<li>グループごとに特徴を要約</li>
<li>何かの順に並べ替え</li>
<li>異なるテーブルの結合</li>
<li>変形: 縦長 ↔ 横広</li>
</ul>
</li>
<li>データ内容を対象とする処理
<ul>
<li>数値の変換: 対数、正規化</li>
<li>外れ値・欠損値への対処</li>
<li>型変換: 連続変数、カテゴリカル変数、指示変数、因子、日時</li>
<li>文字列処理: 正規表現によるパターンマッチ</li>
</ul>
</li>
</ul>
<p><cite style="display: block; text-align: right;"><a href="https://www.amazon.co.jp/dp/4774196479/ref=as_li_ss_tl?ie=UTF8&linkCode=ll1&tag=heavywatal-22&linkId=8a3fd4e9a0c944b1b41242bbab8d147b">
本橋智光「前処理大全」
</a></cite>
</section>
<section>
<h2 id="dplyr-----dataframeの高速処理担当">dplyr &mdash; data.frameの高速処理担当</h2>
<a href="https://dplyr.tidyverse.org/">
<img src="/_img/hex-stickers/dplyr.webp" width="120" align="right">
</a>
<p>シンプルな関数がたくさん。繋げて使う (piping)</p>
<dl>
<dt>抽出</dt>
<dd>列: <code>select()</code>,</dd>
<dd>行: <code>filter()</code>, <code>distinct()</code>, <code>slice()</code></dd>
<dt>要約・集計</dt>
<dd><code>group_by()</code>, <code>summarize()</code>, <code>count()</code></dd>
<dt>並べ替え</dt>
<dd><code>arrange()</code>, <code>relocate()</code></dd>
<dt>列の追加・変更</dt>
<dd><code>mutate()</code>, <code>rename()</code></dd>
<dt>結合</dt>
<dd>行方向: <code>bind_rows()</code></dd>
<dd>列方向: <code>left_join()</code>, <code>inner_join()</code>, <code>full_join()</code></dd>
</dl>

</section>
<section>
<h2 id="dplyr-使用例">dplyr 使用例</h2>
<p>小さな関数を繋げて使う流れ作業:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>              <span class="c1"># 生データから出発して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">carat</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="o">|&gt;</span>    <span class="c1"># 列を抽出して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="o">|&gt;</span>            <span class="c1"># 行を抽出して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span> <span class="o">|&gt;</span>                <span class="c1"># グループ化して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarize</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="o">|&gt;</span>       <span class="c1"># 平均を計算</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">()</span>                         <span class="c1"># 表示してみる</span>
</span></span></code></pre></div><pre tabindex="0"><code>        cut mean(price)
1      Fair    7177.856
2      Good    7753.601
3 Very Good    8340.549
4   Premium    8487.249
5     Ideal    8674.227
</code></pre><p>この見慣れぬ記号 <code>|&gt;</code> は何？<br>
(<code>select()</code> など個々の関数には今日は触れません)</p>

</section>
<section>
<h2 id="pipe-operator-パイプ演算子-">Pipe operator (パイプ演算子) <code>|&gt;</code></h2>
<p>パイプの左側の変数を、右側の関数の第一引数にねじ込む:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">diamonds</span> <span class="o">|&gt;</span> <span class="nf">filter</span><span class="p">(</span><span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">filter</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span>     <span class="c1"># これと同じ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 前処理の流れ作業に便利:</span>
</span></span><span class="line"><span class="cl"><span class="n">diamonds</span> <span class="o">|&gt;</span> <span class="nf">filter</span><span class="p">(</span><span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">select</span><span class="p">(</span><span class="n">carat</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="kc">...</span>
</span></span><span class="line"><span class="cl"><span class="n">potatos</span> <span class="o">|&gt;</span> <span class="nf">cut</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nf">fry</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nf">season</span><span class="p">(</span><span class="s">&#34;salt&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">eat</span><span class="p">()</span>
</span></span></code></pre></div><p>🔰 パイプを使わない形に書き換え、出力を確認しよう:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">sum</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 21
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kc">letters</span> <span class="o">|&gt;</span> <span class="nf">toupper</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;A&#34; &#34;B&#34; &#34;C&#34;
</code></pre><p>[解答例]</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">sum</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="nf">toupper</span><span class="p">(</span><span class="kc">letters</span><span class="p">),</span> <span class="m">3</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="パイプ演算子--を使わない方法">パイプ演算子 <code>|&gt;</code> を使わない方法</h2>
<p>😐 一時変数をイチイチ作る:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tmp1</span> <span class="o">=</span> <span class="nf">select</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">carat</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>   <span class="c1"># 列を抽出して</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp2</span> <span class="o">=</span> <span class="nf">filter</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span>               <span class="c1"># 行を抽出して</span>
</span></span><span class="line"><span class="cl"><span class="n">tmp3</span> <span class="o">=</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>                   <span class="c1"># グループ化して</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>        <span class="c1"># 平均を計算</span>
</span></span></code></pre></div><p>😐 同じ名前を使い回す:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">select</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">carat</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="c1"># 列を抽出して</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">filter</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span>           <span class="c1"># 行を抽出して</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>               <span class="c1"># グループ化して</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>      <span class="c1"># 平均を計算</span>
</span></span></code></pre></div><p>どちらも悪くない。
何度も変数名を入力するのがやや冗長。</p>

</section>
<section>
<h2 id="パイプ演算子--を使わない方法">パイプ演算子 <code>|&gt;</code> を使わない方法</h2>
<p>😫 一時変数を使わずに:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">summarize</span><span class="p">(</span>                    <span class="c1"># 平均を計算</span>
</span></span><span class="line"><span class="cl">    <span class="nf">group_by</span><span class="p">(</span>                            <span class="c1"># グループ化して</span>
</span></span><span class="line"><span class="cl">      <span class="nf">filter</span><span class="p">(</span>                              <span class="c1"># 行を抽出して</span>
</span></span><span class="line"><span class="cl">        <span class="nf">select</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">carat</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">price</span><span class="p">),</span> <span class="c1"># 列を抽出して</span>
</span></span><span class="line"><span class="cl">        <span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">),</span>                        <span class="c1"># 行を抽出して</span>
</span></span><span class="line"><span class="cl">      <span class="n">cut</span><span class="p">),</span>                              <span class="c1"># グループ化して</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>                       <span class="c1"># 平均を計算</span>
</span></span></code></pre></div><p>🤪 改行さえせずに:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">summarize</span><span class="p">(</span><span class="nf">group_by</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">carat</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">price</span><span class="p">),</span> <span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">),</span> <span class="n">cut</span><span class="p">),</span> <span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>
</span></span></code></pre></div><p>論理の流れとプログラムの流れが合わず、目が行ったり来たり。<br>
さっきのほうがぜんぜんマシ。</p>

</section>
<section>
<h2 id="パイプ演算子--を使おう">パイプ演算子 <code>|&gt;</code> を使おう</h2>
<p>😁 慣れれば、論理の流れを追いやすい:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">diamonds</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">carat</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="o">|&gt;</span>    <span class="c1"># 列を抽出して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">carat</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="o">|&gt;</span>            <span class="c1"># 行を抽出して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span> <span class="o">|&gt;</span>                <span class="c1"># グループ化して</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarize</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="o">|&gt;</span>       <span class="c1"># 平均を計算</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">()</span>                         <span class="c1"># 表示してみる</span>
</span></span></code></pre></div><pre tabindex="0"><code>        cut mean(price)
1      Fair    7177.856
2      Good    7753.601
3 Very Good    8340.549
4   Premium    8487.249
5     Ideal    8674.227
</code></pre><p>tidyverseパッケージ群はこういう使い方をしやすい設計。<br>
使わなければならないわけではないが、読めたほうがいい。</p>
<div style="font-size: 0.8em; color: #888888;">
<p>R &lt; 4.2 までよく使われていた <code>%&gt;%</code> もほぼ同じ。</p>
</div>
</section>
<section>
<h2 id="tidyr-----dataframeの変形整形担当">tidyr &mdash; data.frameの変形・整形担当</h2>
<a href="https://tidyr.tidyverse.org/">
<img src="/_img/hex-stickers/tidyr.webp" width="120" align="right">
</a>
<dl>
<dt>横広から縦長に</dt>
<dd><code>pivot_longer()</code>, <del><code>gather()</code></del></dd>
<dt>縦長から横広に</dt>
<dd><code>pivot_wider()</code>, <del><code>spread()</code></del></dd>
<dt>列を分離、結合</dt>
<dd><code>separate()</code>, <code>unite()</code></dd>
<dt>入れ子構造をつくる、解消する</dt>
<dd><code>nest()</code>, <code>unnest()</code></dd>
</dl>
<p><em>etc.</em></p>
<ul>
<li>こういう変形なしでそのまま使えるデータは激レア</li>
<li>エクセルでポチポチやらず、tidyrで手続きを記述しよう</li>
<li>ちょっとハードルは高いけど、使えるようになると<strong>強い</strong>💪</li>
</ul>

</section>
<section>
<h2 id="pivot_longer-横広から縦長に"><code>pivot_longer()</code> 横広から縦長に</h2>
<p>複数列にまたがる値を1列にする。<br>
そのラベルも合わせて移動。</p>
<figure>
<a href="https://r4ds.had.co.nz/tidy-data.html#longer">
<img src="/slides/image/cheatsheet/tidyr-pivot_longer.png" width="600">
<br>
<figcaption class="url">https://r4ds.had.co.nz/tidy-data.html#longer</figcaption>
</a>
</figure>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">table4a</span>
</span></span><span class="line"><span class="cl"><span class="nf">pivot_longer</span><span class="p">(</span><span class="n">table4a</span><span class="p">,</span> <span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;year&#34;</span><span class="p">,</span> <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#34;cases&#34;</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="pivot_wider-縦長から横広に"><code>pivot_wider()</code> 縦長から横広に</h2>
<p>1列に収まっていた値を複数列の行列に変換。<br>
そのラベルを列の名前にする。</p>
<figure>
<a href="https://r4ds.had.co.nz/tidy-data.html#wider">
<img src="/slides/image/cheatsheet/tidyr-pivot_wider.png" width="560">
<br>
<figcaption class="url">https://r4ds.had.co.nz/tidy-data.html#wider</figcaption>
</a>
</figure>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">pivot_wider</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">names_from</span> <span class="o">=</span> <span class="n">type</span><span class="p">,</span> <span class="n">values_from</span> <span class="o">=</span> <span class="n">count</span><span class="p">)</span>
</span></span></code></pre></div>
</section>
<section>
<h2 id="rによるデータ前処理実習httpsheavywatalgithubioslidestmd2022は別の講義で"><a href="https://heavywatal.github.io/slides/tmd2022/">Rによるデータ前処理実習</a>は別の講義で</h2>
<p>2022年9月に開講。おそらくe-なんとかで視聴可能。</p>
<iframe width="100%" height="400" src="../tmd2022/"></iframe>
<p>2023年の開講は未定&hellip;?</p>

</section>
<section>
<h2 id="直線あてはめ-統計モデルの出発点">直線あてはめ: 統計モデルの出発点</h2>
<img src="figure/weight-lm-1.png" alt="plot of chunk weight-lm">
<ul>
<li>身長が高いほど体重も重い。いい感じ。</li>
</ul>
<p>(説明のために作った架空のデータ。今後もほぼそうです)
</section>
<section>
<h2 id="回帰モデルの2段階">回帰モデルの2段階</h2>
<ol>
<li>
<p>Define a <strong>family of models</strong>: だいたいどんな形か、式をたてる</p>
<ul>
<li>直線: $y = a_1 + a_2 x$</li>
<li>対数: $\log(y) = a_1 + a_2 x$</li>
<li>二次曲線: $y = a_1 + a_2 x^2$</li>
</ul>
</li>
<li>
<p>Generate a <strong>fitted model</strong>: データに合うようにパラメータを調整</p>
<ul>
<li>$y = 3x + 7$</li>
<li>$y = 9x^2$</li>
</ul>
</li>
</ol>
<p><a href="https://r4ds.had.co.nz/model-basics.html" class="url"><a href="https://r4ds.had.co.nz/model-basics.html">https://r4ds.had.co.nz/model-basics.html</a></a></p>

</section>
<section>
<h2 id="たぶん身長が高いほど体重も重い">たぶん身長が高いほど体重も重い</h2>
<p>なんとなく $y = a x + b$ でいい線が引けそう<br>
 </p>
<img src="./figure/weight-height-1.png" alt="plot of chunk weight-height" width="360" />
</section>
<section>
<h2 id="たぶん身長が高いほど体重も重い">たぶん身長が高いほど体重も重い</h2>
<p>なんとなく $y = a x + b$ でいい線が引けそう<br>
じゃあ傾き <em>a</em> と切片 <em>b</em>、どう決める？</p>
<img src="./figure/weight-lines-1.png" alt="plot of chunk weight-lines" width="360" />
</section>
<section>
<h2 id="最小二乗法-ordinary-least-square-ols">最小二乗法 (Ordinary Least Square: OLS)</h2>
<p>回帰直線からの<strong style="color: #3366ff">残差</strong>平方和(RSS)を最小化する。</p>
<img src="./figure/weight-residual-1.png" alt="plot of chunk weight-residual" width="720" />
</section>
<section>
<h2 id="残差平方和rssが最小となるパラメータを探せ">残差平方和(RSS)が最小となるパラメータを探せ</h2>
<p>ランダムに試してみて、上位のものを採用。<br>
この程度の試行回数では足りなそう。</p>
<img src="./figure/weight-goodlines-1.png" alt="plot of chunk weight-goodlines" width="720" />
</section>
<section>
<h2 id="残差平方和rssが最小となるパラメータを探せ">残差平方和(RSS)が最小となるパラメータを探せ</h2>
<p><strong>グリッドサーチ</strong>: パラメータ空間の一定範囲内を均等に試す。<br>
さっきのランダムよりはちょっとマシか。</p>
<img src="./figure/weight-grid-1.png" alt="plot of chunk weight-grid" width="720" />
<p>こうした<strong>最適化</strong>の手法はいろいろあるけど、ここでは扱わない。</p>

</section>
<section>
<h2 id="これくらいなら一瞬で計算してもらえる">これくらいなら一瞬で計算してもらえる</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">par_init</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">optim</span><span class="p">(</span><span class="n">par_init</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">rss_weight</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">$</span><span class="n">par</span>
</span></span></code></pre></div><pre tabindex="0"><code>intercept     slope 
-69.68394  78.53490 
</code></pre><img src="./figure/weight-lm-1.png" alt="plot of chunk weight-lm" width="266.4" />
<p>上記コードは最適化一般の書き方。<br>
回帰が目的なら次ページのようにするのが楽 →</p>

</section>
<section>
<h2 id="lm-で直線あてはめしてみる"><code>lm()</code> で直線あてはめしてみる</h2>
<p>架空のデータを作る(乱数生成については後述):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="m">50</span>
</span></span><span class="line"><span class="cl"><span class="n">df_weight</span> <span class="o">=</span> <span class="n">tibble</span><span class="o">::</span><span class="nf">tibble</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">height</span> <span class="o">=</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="m">1.70</span><span class="p">,</span> <span class="m">0.05</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">bmi</span> <span class="o">=</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="m">22</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">weight</span> <span class="o">=</span> <span class="n">bmi</span> <span class="o">*</span> <span class="p">(</span><span class="n">height</span><span class="o">**</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>データと関係式(<code>Y ~ X</code> の形)を <code>lm()</code> に渡して係数を読む:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_weight</span><span class="p">,</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">~</span> <span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>(Intercept)      height 
  -69.85222    78.63444 
</code></pre><p>せっかくなので作図もやってみる→</p>

</section>
<section>
<h2 id="lm-の結果をggplotする"><code>lm()</code> の結果をggplotする</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">modelr</span><span class="o">::</span><span class="nf">add_predictions</span><span class="p">(</span><span class="n">df_weight</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;response&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="m">2L</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>    height      bmi   weight     pred
1 1.718019 21.55500 63.62151 65.24322
2 1.782862 22.83775 72.59199 70.34213
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#3366ff&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="./figure/lm-ggplot-1.png" alt="plot of chunk lm-ggplot" width="216" />
</section>
<section>
<h2 id="-ほかのデータでも-lm-を試してみよう">🔰 ほかのデータでも <code>lm()</code> を試してみよう</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">hwy</span> <span class="o">~</span> <span class="n">displ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">coef</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>(Intercept)       displ 
  35.697651   -3.530589 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mpg_added</span> <span class="o">=</span> <span class="n">modelr</span><span class="o">::</span><span class="nf">add_predictions</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">fit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg_added</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#3366ff&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="./figure/lm-mpg-1.png" alt="plot of chunk lm-mpg" width="180" />
<p>🔰 <code>diamonds</code> などほかのデータでも <code>lm()</code> を試してみよう。</p>

</section>
<section>
<h2 id="疑問やエラーの解決方法">疑問やエラーの解決方法</h2>
<ul>
<li>エラーのほとんどは凡ミス由来。よく確認しよう。
<ul>
<li>エラー文をちゃんと読む: <code>No such file or directory</code></li>
<li><a href="https://comicalcommet.github.io/r-training-2022/R_training_2022_7.html">よくあるエラー集 (石川由希さん@名古屋大)</a>
をチェックする</li>
<li>変数の中身を確かめる: <code>str(iris)</code>, <code>attributes(iris)</code></li>
</ul>
</li>
<li>エラー文やパッケージ名をコピペしてウェブ検索<br>
→ <a href="https://stackoverflow.com/questions/tagged/r">StackOverflow</a>
や個人サイトに解決策</li>
<li>Slack <img height=22 width=22 src="https://cdn.simpleicons.org/slack">
<a href="https://github.com/tokyor/r-wakalang">r-wakalang</a>
で質問を投稿する。<br>
(質問に飢えた優しいワニが多数生息 👀   👀   👀   👀)</li>
<li>状況再現できる小さな例
<a href="https://reprex.tidyverse.org/">(reprex)</a>
を添えると回答を得やすい。<br>
(これを準備してるうちに問題が切り分けられて自己解決したり)</li>
<li>パッケージの公式ドキュメントをちゃんと読む</li>
<li>R(Studio)内のヘルプを読む: <code>?sum</code>, <code>help.start()</code></li>
</ul>

</section>
<section>
<h2 id="参考文献">参考文献</h2>
<dl>
<dt>R for Data Science &mdash; Hadley Wickham and Garrett Grolemund</dt>
<dd><a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>,
<a href="https://amzn.to/2tbRmVc">Book</a>,
<a href="https://amzn.to/2yyFRKt">日本語版書籍(Rではじめるデータサイエンス)</a></dd>
</dl>
<ul>
<li><a href="https://amzn.to/33suMIZ">データ解析のための統計モデリング入門</a> 久保拓弥 2012</li>
<li><a href="https://amzn.to/3uCxTKo">データ分析のための数理モデル入門</a> 江崎貴裕 2020</li>
<li><a href="https://amzn.to/3uznzCK">分析者のためのデータ解釈学入門</a> 江崎貴裕 2020</li>
</ul>
<dl>
<dt>Other versions</dt>
<dd>「<a href="/slides/tmd2022/">Rによるデータ前処理実習</a>」
東京医科歯科大 <a href="https://ds.tmdu.org/">データ関連人材育成プログラム</a> (2022-09)</dd>
<dd>「<a href="/slides/tokiomarine2022/">統計モデリング概論 DSHC 2022</a>」
東京海上 <a href="https://tokiomarine-dshc.com/">DSHC</a> (2022-08)</dd>
<dd>「<a href="/slides/tohoku2022r/">進化学実習2022</a>」
東北大学 理学部生物学科 (2022-04)</dd>
<dd>「<a href="https://comicalcommet.github.io/r-training-2022/">Rを用いたデータ解析の基礎と応用</a>」
石川由希 2022 名古屋大学</dd>
</dl>
<a href="2-distribution.html" rel="next" class="readmore">
2. 確率分布、擬似乱数生成
</a>

</section>
</div>
</div>
</body>
</html>
