<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>2. 確率分布、擬似乱数生成 — 統計モデリング実習 2022 TMDU</title>
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="2. 確率分布、擬似乱数生成 — 統計モデリング実習 2022 TMDU">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/tmd2022stats/2-distribution.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-V60H2JH0G6');
</script>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<script type="module">
import { Reveal } from "/slides/lib/reveal.js/reveal.js";
Reveal.configure({width: 1333, height: 1000});
</script>
<style>
html { font-size: 222%; }
</style>
<link rel="stylesheet" href="/slides/lib/katex/katex.min.css">
<script type="module" src="/slides/lib/katex/katex.min.js"></script>
<link rel="stylesheet" href="/slides/lib/iconify.css">
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<link rel="stylesheet" href="/slides/css/style-reveal.css">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<h1 id="統計モデリング実習-2022-tmdu"><a href=".">統計モデリング実習 2022 TMDU</a></h1>
<div class="author">
岩嵜 航 (Watal M. Iwasaki, PhD)
</div>
<div class="affiliation">
東北大学 生命科学研究科 進化ゲノミクス分野 特任助教<br>
(Graduate School of Life Sciences, Tohoku University)
</div>
<ol>
<li><a href="1-introduction.html">導入、直線回帰</a>
<li class="current-deck"><a href="2-distribution.html">確率分布、擬似乱数生成</a>
<li><a href="3-likelihood.html">尤度、最尤推定</a>
<li><a href="4-glm.html">一般化線形モデル (GLM)</a>
<li><a href="5-glmm.html">個体差、一般化線形混合モデル (GLMM)</a>
<li><a href="6-bayesian.html">ベイズの定理、事後分布、MCMC</a>
<li><a href="7-stan.html">StanでGLM</a>
<li><a href="8-hbm.html">階層ベイズモデル (HBM)</a>
</ol>
<div class="footnote">
2023-03-11 東京医科歯科大学<br>
<a href="https://heavywatal.github.io/slides/tmd2022stats/">https://heavywatal.github.io/slides/tmd2022stats/</a>
</div>

</section>
<section>
<h2 id="何でもかんでも直線あてはめではよろしくない">何でもかんでも直線あてはめではよろしくない</h2>
<p><img src="./figure/lm-bad-1.png" alt="plot of chunk lm-bad"></p>
<ul>
<li>観察データは常に<strong>正の値</strong>なのに予測が負に突入してない？</li>
<li><strong>縦軸は整数</strong>。しかもの<strong>ばらつき</strong>が横軸に応じて変化？</li>
</ul>
</section>
<section>
<h2 id="何でもかんでも直線あてはめではよろしくない">何でもかんでも直線あてはめではよろしくない</h2>
<p><img src="./figure/glm-better-1.png" alt="plot of chunk glm-better"></p>
<ul>
<li>観察データは常に<strong>正の値</strong>なのに予測が負に突入してない？</li>
<li><strong>縦軸は整数</strong>。しかもの<strong>ばらつき</strong>が横軸に応じて変化？</li>
<li><strong>データに合わせた統計モデルを使うとマシ</strong></li>
</ul>
</section>
<section>
<h2 id="ちょっとずつ線形モデルを発展させていく">ちょっとずつ線形モデルを発展させていく</h2>
<p><strong>線形モデル LM</strong> (単純な直線あてはめ)</p>
<p><span style="color: #888888;">    ↓ いろんな<span class="fragment highlight-blue custom bold">確率分布</span>を扱いたい</span></p>
<p><strong>一般化線形モデル GLM</strong></p>
<p><span style="color: #888888;">    ↓ 個体差などの変量効果を扱いたい</span></p>
<p><strong>一般化線形混合モデル GLMM</strong></p>
<p><span style="color: #888888;">    ↓ もっと自由なモデリングを！</span></p>
<p><strong>階層ベイズモデル HBM</strong></p>
<p><cite><a href="https://amzn.to/33suMIZ">データ解析のための統計モデリング入門</a> 久保拓弥 2012 より改変</cite></p>

</section>
<section>
<h2 id="確率分布">確率分布</h2>
<p>発生する事象(値)と頻度の関係。</p>
<p>手元のデータを数えて作るのが<strong>経験分布</strong><br>
e.g., サイコロを12回投げた結果、学生1000人の身長</p>
<p><img src="./figure/distribution-1.png" alt="plot of chunk distribution"></p>
<p>一方、少数のパラメータと数式で作るのが<strong>理論分布</strong>。<br>
(こちらを単に「確率分布」と呼ぶことが多い印象）</p>

</section>
<section>
<h2 id="確率変数xはパラメータthetaの確率分布fに従う">確率変数$X$はパラメータ$\theta$の確率分布$f$に従う&hellip;?</h2>
<p>$X \sim f(\theta)$</p>
<p>e.g.,<br>
コインを3枚投げたうち表の出る枚数 $X$ は<strong>二項分布に従う</strong>。<br>
$X \sim \text{Binomial}(n = 3, p = 0.5)$</p>
<div class="column-container">
  <div class="column" style="flex-shrink: 2.0;">
<p><img src="./figure/dbinom-1.png" alt="plot of chunk dbinom"></p>
  </div>
  <div class="column" style="padding-top: 10px;">
\[\begin{split}
\text{Prob}(X = k) &= \binom n k p^k (1 - p)^{n - k} \\
k &\in \{0, 1, 2, \ldots, n\}
\end{split}\]
  </div>
</div>
<p>一緒に実験してみよう。</p>

</section>
<section>
<h2 id="試行を繰り返して記録してみる">試行を繰り返して記録してみる</h2>
<p>コインを3枚投げたうち表の出た枚数 $X$</p>
<p>試行1: <strong>表</strong> 裏 <strong>表</strong> → $X = 2$<br>
試行2: 裏 裏 裏 → $X = 0$<br>
試行3: <strong>表</strong> 裏 裏 → $X = 1$ 続けて $2, 1, 3, 0, 2, \ldots$</p>
<p><img src="./figure/rbinom-1.png" alt="plot of chunk rbinom"></p>
<div style="text-align: right;">
試行回数を増やすほど<b>二項分布</b>の形に近づく。<br>
0と3はレア。1と2が3倍ほど出やすいらしい。
</div>
</section>
<section>
<h2 id="コイントスしなくても-x-らしきものを生成できる">コイントスしなくても $X$ らしきものを生成できる</h2>
<ul>
<li>コインを3枚投げたうち表の出る枚数 $X$</li>
<li>$n = 3, p = 0.5$ の二項分布からサンプルする乱数 $X$</li>
</ul>
<div class="column-container">
  <div class="column" style="flex-shrink: 2.0;">
<img src="figure/dbinom-1.png" alt="plot of chunk dbinom">
  </div>
  <div class="column" style="padding-top: 10px;">
$X \sim \text{Binomial}(n = 3, p = 0.5)$
<p>   ↓ サンプル</p>
<p>{2, 0, 1, 2, 1, 3, 0, 2, &hellip;}</p>
  </div>
</div>
<p>これらはとてもよく似ているので<br>
<strong>「コインをn枚投げたうち表の出る枚数は二項分布に従う」</strong><br>
みたいな言い方をする。逆に言うと<br>
<strong>「二項分布とはn回試行のうちの成功回数を確率変数とする分布」</strong><br>
のように理解できる。</p>

</section>
<section>
<h2 id="統計モデリングの一環とも捉えられる">統計モデリングの一環とも捉えられる</h2>
<p>コイン3枚投げを繰り返して得たデータ {2, 0, 1, 2, 1, 3, 0, 2, &hellip;}</p>
<p>   ↓ たった2つのパラメータで記述。情報を圧縮。</p>
<p>$n = 3, p = 0.5$ の二項分布で説明・再現できるぞ</p>
<figure>
<img src="../tokiomarine2021/math-model.drawio.svg" width="900"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>
<p>こういうふうに現象と対応した確率分布、ほかにもある？</p>

</section>
<section>
<h2 id="有名な確率分布それに従うもの">有名な確率分布、それに「従う」もの</h2>
<dl>
<dt>離散一様分布</dt>
<dd>コインの表裏、サイコロの出目1–6</dd>
<dt>幾何分布</dt>
<dd>成功率pの試行が初めて成功するまでの失敗回数</dd>
<dt>二項分布</dt>
<dd>成功率p、試行回数nのうちの成功回数</dd>
<dt>ポアソン分布</dt>
<dd>単位時間あたり平均$\lambda$回起こる事象の発生回数</dd>
<dt>ガンマ分布</dt>
<dd>ポアソン過程でk回起こるまでの待ち時間</dd>
<dd>(k = 1のとき<strong>指数分布</strong>と呼ばれる)</dd>
<dt>正規分布</dt>
<dd>確率変数の和、平均値</dd>
</dl>

</section>
<section>
<h2 id="離散一様分布">離散一様分布</h2>
<p>同じ確率で起こるn通りの事象のうちXが起こる確率</p>
<p>e.g., コインの表裏、サイコロの出目1–6</p>
<p><img src="./figure/dunif-1.png" alt="plot of chunk dunif"></p>
<p>🔰 一様分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="幾何分布-textgeomp">幾何分布 $~\text{Geom}(p)$</h2>
<p>成功率pの試行が初めて成功するまでの失敗回数</p>
<p>e.g., コイントスで表が出るまでに何回裏が出るか</p>
<p><img src="./figure/geometric-1.png" alt="plot of chunk geometric"></p>
<p>\[
\text{Prob}(X = k \mid p) = p (1 - p)^k
\]</p>
<p>「初めて成功するまでの試行回数」とする定義もある。</p>
<p>🔰 幾何分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="二項分布-textbinomialnp">二項分布 $~\text{Binomial}(n,~p)$</h2>
<p>確率$p$で当たるクジを$n$回引いてX回当たる確率。平均は$np$。</p>
<p><img src="./figure/dbinom-n-1.png" alt="plot of chunk dbinom-n"></p>
<p>\[
\text{Prob}(X = k \mid n,~p) = \binom n k p^k (1 - p)^{n - k}
\]</p>
<p>🔰 二項分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="ポアソン分布-textpoissonlambda">ポアソン分布 $~\text{Poisson}(\lambda)$</h2>
<p>平均$\lambda$で単位時間(空間)あたりに発生する事象の回数。</p>
<p>e.g., 1時間あたりのメッセージ受信件数、メッシュ区画内の生物個体数</p>
<p><img src="./figure/dpoisson-1.png" alt="plot of chunk dpoisson"></p>
<p>\[
\text{Prob}(X = k \mid \lambda) = \frac {\lambda^k e^{-\lambda}} {k!}
\]</p>
<p>二項分布の極限 $(\lambda = np;~n \to \infty;~p \to 0)$。<br>
めったに起きないことを何回も試行するような感じ。</p>

</section>
<section>
<h2 id="指数分布-textexplambda">指数分布 $~\text{Exp}(\lambda)$</h2>
<p>ポアソン過程の事象の発生間隔。平均は $1 / \lambda$ 。</p>
<p>e.g., メッセージの受信間隔、道路沿いに落ちてる手袋の間隔</p>
<p><img src="./figure/dexp-1.png" alt="plot of chunk dexp"></p>
<p>\[
\text{Prob}(x \mid \lambda) = \lambda e^{-\lambda x}
\]</p>
<p>幾何分布の連続値版。</p>
<p>🔰 ポアソン分布・指数分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="ガンマ分布-textgammaklambda">ガンマ分布 $~\text{Gamma}(k,~\lambda)$</h2>
<p>ポアソン過程の事象k回発生までの待ち時間</p>
<p>e.g., メッセージを2つ受信するまでの待ち時間</p>
<p><img src="./figure/dgamma-1.png" alt="plot of chunk dgamma"></p>
<p>\[
\text{Prob}(x \mid k,~\lambda) = \frac {\lambda^k x^{k - 1} e^{-\lambda x}} {\Gamma(k)}
\]</p>
<p>指数分布をkのぶん右に膨らませた感じ。<br>
shapeパラメータ $k = 1$ のとき指数分布と一致。</p>

</section>
<section>
<h2 id="正規分布-mathcalnmusigma">正規分布 $~\mathcal{N}(\mu,~\sigma)$</h2>
<p>平均 $\mu$、標準偏差 $\sigma$ の美しい分布。よく登場する。<br>
e.g., $\mu = 50, ~\sigma = 10$ (濃い灰色にデータの95%, 99%が含まれる):</p>
<p><img src="./figure/gaussian-1.png" alt="plot of chunk gaussian"></p>
<p>\[
\text{Prob}(x \mid \mu,~\sigma) = \frac 1 {\sqrt{2 \pi \sigma^2}} \exp \left(\frac {-(x - \mu)^2} {2\sigma^2} \right)
\]</p>

</section>
<section>
<h2 id="正規分布に近づくものがいろいろある">正規分布に近づくものがいろいろある</h2>
<p>標本平均の反復(<strong>中心極限定理</strong>);
e.g., 一様分布 [0, 100) から40サンプル</p>
<p><img src="./figure/central-limit-1.png" alt="plot of chunk central-limit"></p>
<p>大きい$n$の二項分布</p>
<p><img src="./figure/binom-normal-1.png" alt="plot of chunk binom-normal"></p>

</section>
<section>
<h2 id="正規分布に近づくものがいろいろある">正規分布に近づくものがいろいろある</h2>
<p>大きい$\lambda$のポアソン分布</p>
<p><img src="./figure/poisson-normal-1.png" alt="plot of chunk poisson-normal"></p>
<p>平均値固定なら$k$が大きくなるほど左右対称に尖るガンマ分布</p>
<p><img src="./figure/gamma-normal-1.png" alt="plot of chunk gamma-normal"></p>

</section>
<section>
<h2 id="有名な確率分布対応関係ふりかえり">有名な確率分布対応関係ふりかえり</h2>
<figure style="float: right;">
<img src="../tokiomarine2021/math-model.drawio.svg" width="420"><br>
</figure>
<dl>
<dt>離散一様分布</dt>
<dd>コインの表裏、サイコロの出目1–6</dd>
<dt>幾何分布</dt>
<dd>成功率pの試行が初めて成功するまでの失敗回数</dd>
<dt>二項分布</dt>
<dd>成功率p、試行回数nのうちの成功回数</dd>
<dt>ポアソン分布</dt>
<dd>単位時間あたり平均$\lambda$回起こる事象の発生回数</dd>
<dt>ガンマ分布</dt>
<dd>ポアソン過程でk回起こるまでの待ち時間</dd>
<dd>(k = 1のとき<strong>指数分布</strong>と呼ばれる)</dd>
<dt>正規分布</dt>
<dd>確率変数の和、平均値。使い勝手が良く、よく登場する。</dd>
</dl>

</section>
<section>
<h2 id="現実には確率分布に従わないことが多い">現実には、確率分布に「従わない」ことが多い</h2>
<p>植物100個体から8個ずつ種子を取って植えたら全体で半分ちょい発芽。<br>
親1個体あたりの生存数は<span style="color: #56B4E9;">n=8の二項分布</span>になるはずだけど、<br>
極端な値(全部死亡、全部生存)が多かった。</p>
<img src="figure/overdispersion-1.png" alt="plot of chunk overdispersion">
<p>「それはなぜ？」と考えて要因を探るのも統計モデリングの仕事。<br>
<strong>「普通はこれに従うはず」を理解してこそ</strong>できる思考。</p>

</section>
<section>
<h2 id="疑似乱数生成器-pseudo-random-number-generator">疑似乱数生成器 Pseudo Random Number Generator</h2>
<p>コンピューター上でランダム<strong>っぽい</strong>数値を出力する装置。<br>
実際には<strong>決定論的</strong>に計算されているので、<br>
シード(出発点)と呼び出し回数が同じなら出る数も同じになる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">runif</span><span class="p">(</span><span class="m">3L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.9148060 0.9370754 0.2861395</span>
</span></span><span class="line"><span class="cl"><span class="nf">runif</span><span class="p">(</span><span class="m">3L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.8304476 0.6417455 0.5190959</span>
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">runif</span><span class="p">(</span><span class="m">6L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.9148060 0.9370754 0.2861395 0.8304476 0.6417455 0.5190959</span>
</span></span></code></pre></div><p>シードに適当な固定値を与えておくことで再現性を保てる。<br>
ただし「このシードじゃないと良い結果が出ない」はダメ。</p>
<p>さまざまな「分布に従う」乱数を生成することもできる。</p>

</section>
<section>
<h2 id="いろんな乱数を生成可視化して感覚を掴もう">いろんな乱数を生成・可視化して感覚を掴もう</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">sample.int</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rgeom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="m">50</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_histogram</span><span class="p">()</span> <span class="c1"># for continuous values</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">()</span>       <span class="c1"># for discrete values</span>
</span></span></code></pre></div><p>🔰 小さい <code>n</code> から徐々に大きくして変化を確認しよう。</p>
<p>🔰 ほかのオプションもいろいろ変えて変化を確認しよう。</p>
<p>🔰 1%の当たりを狙って10連ガチャを回す人が100万人いたら、<br>
全部はずれ、1つ当たり、2つ当たり&hellip; の人はどれくらいいるか？</p>

</section>
<section>
<h2 id="いろいろ試した結果をとっておきたい">いろいろ試した結果をとっておきたい</h2>
<p>スクリプト.Rさえ保存しておけばいつでも実行できるけど&hellip; <strong>面倒</strong></p>
<p><code>ggsave()</code> で画像を書き出しておけるけど&hellip; <strong>どのコードの結果か分からない</strong></p>
<p>→ <strong>スクリプトと実行結果を一緒に見渡せる形式</strong>が欲しい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="m">3</span> <span class="o">*</span> <span class="m">14</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 42
</code></pre><p><img src="./figure/hello-1.png" alt="plot of chunk hello"></p>

</section>
<section>
<h2 id="quarto-document-として研究ノートを作る">Quarto Document として研究ノートを作る</h2>
<a href="https://quarto.org/">
<img src="/_img/hex-stickers/quarto.webp" width="160" align="right">
</a>
<p>プログラミングからレポート作成まで一元管理できて楽ちん。</p>
<ul>
<li>本文とRコードを含むテキストファイル.qmdを作る。</li>
<li>HTML, PDFなどリッチな形式に変換して読む。
<ul>
<li>コードだけでなく実行結果の<strong>図</strong>や<strong>表</strong>も埋め込める。</li>
</ul>
</li>
</ul>
<hr>
<a href="https://rmarkdown.rstudio.com/">
<img src="/_img/hex-stickers/rmarkdown.webp" width="160" align="right">
</a>
<dl>
<dt>Quarto Markdown (<code>.qmd</code>)</dt>
<dd>RやPythonのコードと図表を埋め込める<strong>Markdown</strong>亜種。</dd>
<dd>Quarto登場前にほぼR専用だった <code>.Rmd</code> と使い勝手は同じ。</dd>
<dt>Markdown (<code>.md</code>)</dt>
<dd>最もよく普及している<strong>軽量マークアップ言語</strong>のひとつ。</dd>
<dd>微妙に異なる方言がある。qmdで使うのは Pandoc Markdown 。</dd>
</dl>
<p>🔰 どんなものが作れるのか
<a href="https://quarto.org/docs/gallery/">作成例ギャラリー</a>
を見てみよう。</p>

</section>
<section>
<h2 id="マークアップ言語">マークアップ言語</h2>
<p>文書の構造や視覚的修飾を記述するための言語。<br>
e.g., <strong>HTML</strong>+CSS, XML, LaTeX</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>見出し3<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>ここは段落。
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>強調(italic)<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>、
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>強い強調(bold)<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>、
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://www.lifesci.tohoku.ac.jp/&#34;</span><span class="p">&gt;</span>リンク<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>とか。
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span></code></pre></div><div style="border: solid 1px #888888; padding: 0 4px;">
<h3>見出し3</h3>
<p>ここは段落。
<em>強調(italic)</em>、
<strong>強い強調(bold)</strong>、
<a href="https://www.lifesci.tohoku.ac.jp/">リンク</a>とか。
</p>
</div>
<p>表現力豊かで強力だが人間が読み書きするには複雑すぎ、機械寄り。</p>
<p>🔰 好きなウェブサイトのソースコード(HTML)を見てみよう。</p>

</section>
<section>
<h2 id="軽量マークアップ言語">軽量マークアップ言語</h2>
<p><strong>マークアップ言語</strong>の中でも人間が読み書きしやすいもの。<br>
e.g., <strong>Markdown</strong>, reStructuredText, 各種Wiki記法など</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-md" data-lang="md"><span class="line"><span class="cl"><span class="gu">### 見出し3
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>
</span></span><span class="line"><span class="cl">ここは段落。
</span></span><span class="line"><span class="cl"><span class="ge">*強調(italic)*</span>、
</span></span><span class="line"><span class="cl"><span class="gs">**強い強調(bold)**</span>、
</span></span><span class="line"><span class="cl">[<span class="nt">リンク</span>](<span class="na">https://www.lifesci.tohoku.ac.jp/</span>)とか。
</span></span></code></pre></div><div style="border: solid 1px #888888; padding: 0 4px;">
<h3>見出し3</h3>
<p>ここは段落。
<em>強調(italic)</em>、
<strong>強い強調(bold)</strong>、
<a href="https://www.lifesci.tohoku.ac.jp/">リンク</a>とか。
</p>
</div>

</section>
<section>
<h2 id="quartoする環境は既に整っているはず">Quartoする環境は既に整っているはず</h2>
<ul>
<li><strong>R (≥ 4.2.3)</strong>: 最新版 – 0.1 くらいまでが許容範囲</li>
<li><strong>RStudio (≥ 2023.03.0+386)</strong>: Quarto CLI を同梱</li>
<li><strong>tidyverse (≥ 2.0.0)</strong>: 次の2つを自動インストール
<ul>
<li>rmarkdown (≥ 2.21)</li>
<li>knitr (≥ 1.42)</li>
</ul>
</li>
</ul>
<p>(示してあるバージョンは最低要件ではなく私の現在の環境の)</p>
<hr>
<ul>
<li><a href="https://quarto.org/docs/get-started/">Quarto CLI</a>:
最新版を求めるなら手動で入れる。</li>
<li><a href="https://github.com/quarto-dev/quarto-r"><code>install.packages(&quot;quarto&quot;)</code></a>:
多くの人には不要。
Quarto CLIをRコマンドで呼べるようにするだけ。</li>
<li><a href="https://pandoc.org/">pandoc</a>: Quarto CLI に同梱。
手動で最新版を入れてもRStudio+Quartoがそれを使うかは不明。</li>
</ul>
</section>
<section>
<h2 id="markdown記法で書いてみよう">Markdown記法で書いてみよう</h2>
<ol>
<li>RStudio &gt; New File &gt; Markdown File
<img src="/slides/image/rstudio/new-markdown.png" width="60%"></li>
<li><a href="https://duckduckgo.com/?q=markdown+syntax">&ldquo;markdown 記法&quot;とかで検索</a>しつつ何か書く。
<ul>
<li>見出し1, 2, 3</li>
<li>箇条書き (番号あり・なし)</li>
<li>インラインコード、コードブロック</li>
</ul>
</li>
<li><kbd>Preview</kbd>ボタンで確認</li>
</ol>

</section>
<section>
<h2 id="quarto-document-を作ってみよう">Quarto Document を作ってみよう</h2>
<p>RStudio &gt; New File &gt; Quarto Document&hellip;<br>
(DocumentとHTMLを選択し、)タイトルと著者を埋めて、OK。</p>
<img src="/slides/image/rstudio/new-quarto-document.png" width="100%">
</section>
<section>
<h2 id="普通のmdには無いqmdの特徴">普通のmdには無いqmdの特徴</h2>
<dl>
<dt><strong>ヘッダー</strong></dt>
<dd>最上部の <code>---</code> で挟まれた部分。
文書全体に関わるメタデータを入力。</dd>
<dd>オプションは出力形式によって異なる。
e.g., <a href="https://quarto.org/docs/output-formats/html-basics.html"><code>html</code></a></dd>
<dt><strong>R code chunk</strong></dt>
<dd><code>```{r}</code> のように始まるブロック。</dd>
<dd>コードの実行結果を最終産物に埋め込める。</dd>
<dd><a href="https://quarto.org/docs/computations/execution-options.html">オプションがいろいろある</a>。e.g.,
<ul>
<li><code>echo: false</code>: コードを非表示。結果は表示。</li>
<li><code>eval: false</code>: コードを実行せず表示だけ。</li>
<li><code>include: false</code>: コードも結果も表示せず、実行だけする。</li>
<li><code>fig.width: 7, fig.height: 7</code>: 図の大きさを制御。</li>
</ul>
</dd>
</dl>
<p>まあ細かいことは必要になってから調べるとして&hellip;</p>
</section>
<section>
<h2 id="qmdをhtmlに変換してみよう">qmdをHTMLに変換してみよう</h2>
<div>
<img src="/slides/image/rstudio/quarto-viewer.png" width="100%">
</div>
</section>
<section>
<h2 id="qmdをhtmlに変換してみよう">qmdをHTMLに変換してみよう</h2>
<ol>
<li>ソースコードに名前をつけて保存 <kbd>command</kbd><kbd>s</kbd><br>
e.g., <code>report.qmd</code></li>
<li>⚙️ ボタンから &ldquo;Preview in Viewer Pane&rdquo; を選択。</li>
<li><kbd>→Render</kbd> を押す。
<ul>
<li>埋め込まれたRコードが実行される。</li>
<li>実行結果を含むMarkdownが作られる。</li>
<li>MarkdownからHTMLに変換される。 e.g., <code>report.html</code></li>
<li>プレビューが自動的に開く。</li>
</ul>
</li>
</ol>
<p>🔰 編集 → Render を繰り返して変化を確認しよう</p>
</section>
<section>
<h2 id="-疑似乱数生成をいろいろ試した研究ノートを作ろう">🔰 疑似乱数生成をいろいろ試した研究ノートを作ろう</h2>
<p>さっきはこんな汚いスクリプトだった:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">sample.int</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rgeom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="m">50</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_histogram</span><span class="p">()</span> <span class="c1"># for continuous values</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">()</span>       <span class="c1"># for discrete values</span>
</span></span></code></pre></div><ol>
<li>ひとつの分布につきひとつの図を描くqmdに書き換える。</li>
<li>コードチャンクを分けたり見出しを付けたりして整理する。</li>
<li>パラメータをいろいろ変えた結果も加えていく。</li>
</ol>
</section>
<section>
<h2 id="本講義のお品書き">本講義のお品書き</h2>
<figure style="float: right;">
<a href="https://kuboweb.github.io/-kubo/ce/IwanamiBook.html">
<img src="../tokiomarine2021/image/kubo-book.jpg" width="400" alt="データ解析のための統計モデリング入門 久保拓弥 2012">
</a>
</figure>
<p>久保先生の&quot;緑本&quot;こと<br>
「データ解析のための統計モデリング入門」<br>
をベースに回帰分析の概要を紹介。</p>
<ol>
<li>イントロ</li>
<li>Rの基礎を駆け足で</li>
<li>統計モデルの基本
<ul>
<li>直線回帰</li>
<li>確率変数・<strong>確率分布</strong> 👈 ここまで</li>
<li>尤度・最尤推定</li>
</ul>
</li>
<li>一般化線形モデル、混合モデル</li>
<li>ベイズ統計、階層ベイズモデル</li>
</ol>
<p>回帰のキモは<strong>線ではなく分布</strong></p>

</section>
<section>
<h2 id="参考文献">参考文献</h2>
<ul>
<li><a href="https://amzn.to/33suMIZ">データ解析のための統計モデリング入門</a> 久保拓弥 2012</li>
<li><a href="https://amzn.to/3uwx7Pb">StanとRでベイズ統計モデリング</a> 松浦健太郎 2016</li>
<li><a href="https://amzn.to/3o1eCzP">RとStanではじめる ベイズ統計モデリングによるデータ分析入門</a> 馬場真哉 2019</li>
<li><a href="https://amzn.to/3uCxTKo">データ分析のための数理モデル入門</a> 江崎貴裕 2020</li>
<li><a href="https://amzn.to/3uznzCK">分析者のためのデータ解釈学入門</a> 江崎貴裕 2020</li>
<li><a href="https://amzn.to/3ty80Kv">統計学を哲学する</a> 大塚淳 2020</li>
</ul>
<a href="3-likelihood.html" class="readmore">
3. 尤度、最尤推定
</a>

</section>
</div>
</div>
</body>
</html>
