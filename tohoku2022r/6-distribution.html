<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>6. 統計モデリング1: 確率分布、尤度 — 進化学実習 2022 牧野研</title>
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="6. 統計モデリング1: 確率分布、尤度 — 進化学実習 2022 牧野研">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/slides/tohoku2022r/6-distribution.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Slide decks — Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-V60H2JH0G6');
</script>
<link rel="stylesheet" href="/slides/lib/reveal.js/reveal.css">
<script type="module">
import { Reveal } from "/slides/lib/reveal.js/reveal.js";
</script>
<link rel="stylesheet" href="/slides/lib/katex/katex.min.css">
<script src="/slides/lib/katex/katex.min.js"></script>
<script src="/slides/lib/iconify.js"></script>
<script defer src="/slides/lib/reload-img-onclick.js"></script>
<link rel="stylesheet" href="/slides/css/style-reveal.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<link rel="stylesheet" href="style.css">
<h1 id="進化学実習-2022-牧野研"><a href=".">進化学実習 2022 牧野研</a></h1>
<h3 id="6-統計モデリング1-確率分布尤度">6. 統計モデリング1: 確率分布、尤度</h3>
<div class="author">
岩嵜航
</div>
<div class="affiliation">
東北大学 生命科学研究科 進化ゲノミクス分野 牧野研
</div>
<div class="footnote">
2022-04-11 東北大学 理学部生物学科 進化学実習
<a href="https://heavywatal.github.io/slides/tohoku2022r/">https://heavywatal.github.io/slides/tohoku2022r/</a>
</div>

</section>
<section>
<h2 id="データを使ってやりたいこと">データを使ってやりたいこと</h2>
<ul>
<li>現象を<strong>理解</strong>したい</li>
<li>将来を<strong>予測</strong>したい</li>
<li>ものを<strong>分類・判別</strong>したい</li>
<li>挙動を<strong>制御</strong>したい</li>
<li>新しい何かを<strong>生成</strong>したい</li>
</ul>
<p>そのために解析は必要？
未加工の生データこそ宝？</p>
</section>
<section>
<h2 id="データ解析って必要-生データ見ればいいべ">データ解析って必要？ 生データ見ればいいべ？</h2>
<p>往々にして複雑過ぎ、情報多すぎ、そのままでは手に負えない</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">ggplot2</span><span class="o">::</span><span class="n">diamonds</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>      carat       cut color clarity depth table price     x     y     z
      &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
    1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
    2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
    3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
    4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
   --                                                                  
53937  0.72      Good     D     SI1  63.1    55  2757  5.69  5.75  3.61
53938  0.70 Very Good     D     SI1  62.8    60  2757  5.66  5.68  3.56
53939  0.86   Premium     H     SI2  61.0    58  2757  6.15  6.12  3.74
53940  0.75     Ideal     D     SI2  62.2    55  2757  5.83  5.87  3.64
</code></pre><p>ダイヤモンド53,940個について10項目の値を持つデータセット</p>

</section>
<section>
<h2 id="要約統計量を見てみよう">要約統計量を見てみよう</h2>
<p>各列の<strong>平均</strong>とか<strong>標準偏差</strong>とか:</p>
<pre tabindex="0"><code>   stat carat depth table    price     x     y     z
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  mean  0.80 61.75 57.46  3932.80  5.73  5.73  3.54
2    sd  0.47  1.43  2.23  3989.44  1.12  1.14  0.71
3   max  5.01 79.00 95.00 18823.00 10.74 58.90 31.80
</code></pre><p>大きさ <code>carat</code> と価格 <code>price</code> の<strong>相関係数</strong>は 0.92 (かなり高い)。</p>
<p><strong>生のままよりは把握しやすい</strong>かも。</p>
<p>しかし要注意&hellip;</p>

</section>
<section>
<h2 id="平均値ばかり見て可視化を怠ると構造を見逃す">平均値ばかり見て可視化を怠ると構造を見逃す</h2>
<figure style="position: relative;">
<a href="https://www.autodesk.com/research/publications/same-stats-different-graphs">
<img src="/slides/image/rstats/datasaurus.png" width="800">
<figcaption class="url">https://www.autodesk.com/research/publications/same-stats-different-graphs</figcaption>
</a>
<img src="/slides/image/rstats/DataDino-600x455.gif" width="180"
     style="position: absolute; left: 0; top: 0; z-index: 255;">
</figure>

</section>
<section>
<h2 id="作図してみると全体像構造が見やすい">作図してみると全体像・構造が見やすい</h2>
<p>情報をうまく絞って整理 → <strong>直感的にわかる</strong></p>
<p><img src="figure/simplify-diamonds-1.png" alt="plot of chunk simplify-diamonds"></p>
<p><code>carat</code> が大きいほど <code>price</code> も高いらしい。<br>
その度合いは <code>clarity</code> によって異なるらしい。</p>

</section>
<section>
<h2 id="統計とは">統計とは</h2>
<p>データをうまくまとめ、それに基づいて推論するための手法。</p>
<ul>
<li><strong>記述統計</strong>: データそのものを要約する
<ul>
<li>要約統計量 (e.g., 平均、標準偏差、etc.)</li>
<li>作図、作表</li>
</ul>
</li>
<li><strong>推測統計</strong>: データの背後にある母集団・生成過程を考える
<ul>
<li>数理モデル</li>
<li>確率分布</li>
<li>パラメータ(母数)</li>
</ul>
</li>
</ul>
<p>「グラフを眺めてなんとなく分かる」以上の分析には<strong>モデル</strong>が必要</p>

</section>
<section>
<h2 id="モデルとは">モデルとは</h2>
<p>対象システムを単純化・理想化して扱いやすくしたもの</p>
<dl>
<dt>Mathematical Model 数理モデル<img src="../tokiomarine2021/image/hill-equation.png" width="150" align="right" style="margin: 0 -5px;"></dt>
<dd>数学的な方程式として記述されるもの。</dd>
<dd>e.g., Lotka-Volterra eq., <span style="color: #888;">Hill eq.</span></dd>
<dd><br>
</dd>
<dt>Computational Model 数値計算モデル<img src="/slides/image/tumopp/Chex_Lconst.gif" width="140" align="right"></dt>
<dd>数値計算の手続きとして記述されるもの。</dd>
<dd>e.g., Schelling’s Segregation Model, <span style="color: #888;"><em>tumopp</em></span></dd>
<dd><br>
</dd>
<dt>Concrete Model 具象モデル<img src="../tokiomarine2021/image/weisberg-sfbay.jpg" width="260" align="right"></dt>
<dd>具体的な事物で作られるもの。</dd>
<dd>e.g., San Francisco Bay-Delta Model</dd>
</dl>
<cite>
Weisberg 2012 "Simulation and Similarity" (科学とモデル)
</cite>
</section>
<section>
<h2 id="データ科学における数理モデル">データ科学における数理モデル</h2>
<p>データ生成をうまく真似できそうな仮定の数式表現。<br>
 </p>
<figure>
<img src="../tokiomarine2021/math-model.drawio.svg"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>
</section>
<section>
<h2 id="データ科学における数理モデル">データ科学における数理モデル</h2>
<p>データ生成をうまく真似できそうな仮定の数式表現。<br>
e.g., 大きいほど高く売れる: $\text{price} = A \times \text{carat} + B + \epsilon$</p>
<p><img src="figure/lm-diamonds-1.png" alt="plot of chunk lm-diamonds"></p>
<p>新しく採れたダイヤモンドの価格予想とかにも使える。</p>
<p>このように「YをXの関数として表す」ようなモデルを<strong>回帰</strong>と呼ぶ。</p>

</section>
<section>
<h2 id="今回は回帰を軸とした統計モデリングの解説">今回は回帰を軸とした統計モデリングの解説</h2>
<p>単純な直線あてはめから出発し、ちょっとずつ統計モデリング。</p>
<figure>
<a href="https://kuboweb.github.io/-kubo/ce/LinksGlm.html">
<img src="../tokiomarine2021/image/kubo-p2.png" width="100%">
<figcaption class="url">久保さん https://kuboweb.github.io/-kubo/ce/LinksGlm.html</figcaption>
</a>
</figure>
</section>
<section>
<h2 id="回帰は教師あり機械学習の一種とも言える">回帰は教師あり機械学習の一種とも言える</h2>
<figure>
<img src="../tokiomarine2021/regression-in-ml.drawio.svg">
</figure>
<p>でも統計モデリングはいわゆる“機械学習”とは違う気もする&hellip;?</p>
</section>
<section>
<h2 id="モデリングにおける2つのアプローチ">モデリングにおける2つのアプローチ</h2>
<figure>
<img src="../tokiomarine2021/model-approaches.drawio.svg"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>
</section>
<section>
<h2 id="どっちも知っておいて使い分けたい">どっちも知っておいて使い分けたい</h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">項目</th>
          <th style="text-align: left">統計モデリング</th>
          <th style="text-align: left">近年の機械学習</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">例</td>
          <td style="text-align: left">一般化線形モデル<br>階層ベイズモデル</td>
          <td style="text-align: left">ランダムフォレスト<br>ニューラルネットワーク</td>
      </tr>
      <tr>
          <td style="text-align: left">モデル構造</td>
          <td style="text-align: left">単純化したい</td>
          <td style="text-align: left">性能のためなら複雑化</td>
      </tr>
      <tr>
          <td style="text-align: left">モデル解釈</td>
          <td style="text-align: left"><strong>ここが強み</strong></td>
          <td style="text-align: left">難しい。重視しない。途上。</td>
      </tr>
      <tr>
          <td style="text-align: left">予測・生成</td>
          <td style="text-align: left">うまくすれば頑健</td>
          <td style="text-align: left"><strong>主目的</strong>。強力。高精度</td>
      </tr>
      <tr>
          <td style="text-align: left">データ量</td>
          <td style="text-align: left">少なくてもそれなり</td>
          <td style="text-align: left">大量に必要</td>
      </tr>
      <tr>
          <td style="text-align: left">計算量</td>
          <td style="text-align: left">場合による</td>
          <td style="text-align: left">場合による</td>
      </tr>
  </tbody>
</table>

</section>
<section>
<h2 id="統計モデリングのお品書き">統計モデリングのお品書き</h2>
<figure style="float: right;">
<a href="https://kuboweb.github.io/-kubo/ce/IwanamiBook.html">
<img src="../tokiomarine2021/image/kubo-book.jpg" width="280" alt="データ解析のための統計モデリング入門 久保拓弥 2012">
</a>
</figure>
<p>久保先生の&quot;緑本&quot;こと<br>
「データ解析のための統計モデリング入門」<br>
をベースに回帰分析の概要を紹介。</p>
<ol>
<li>イントロ <a href="6-distribution.html">(#6 今回)</a></li>
<li>統計モデルの基本
<ul>
<li>確率変数・<strong>確率分布</strong> 👈 主役</li>
<li>尤度・最尤推定</li>
</ul>
</li>
<li>一般化線形モデル、混合モデル <a href="7-glm.html">(#7 次回)</a></li>
<li><del>ベイズ統計、階層ベイズモデル</del> 今回はここまでやらない</li>
</ol>
<p>回帰のキモは<strong>線ではなく分布</strong>。</p>
<hr>
<cite>
<p><a href="https://heavywatal.github.io/slides/tokiomarine2021/">Data Science Hill Climb 2021 (東京海上) での講義 (~6時間)</a>
の演習無し抜粋バージョン (~2時間 x 2回)。</p>
</cite>

</section>
<section>
<h2 id="回帰モデルの2段階">回帰モデルの2段階</h2>
<ol>
<li>
<p>Define a <strong>family of models</strong>: だいたいどんな形か、式をたてる</p>
<ul>
<li>直線: $y = a_1 + a_2 x$</li>
<li>対数: $\log(y) = a_1 + a_2 x$</li>
<li>二次曲線: $y = a_1 + a_2 x^2$</li>
</ul>
</li>
<li>
<p>Generate a <strong>fitted model</strong>: データに合うようにパラメータを調整</p>
<ul>
<li>$y = 3x + 7$</li>
<li>$y = 9x^2$</li>
</ul>
</li>
</ol>
<cite>
<a href="https://r4ds.had.co.nz/model-basics.html" class="url">https://r4ds.had.co.nz/model-basics.html</a>
</cite>
</section>
<section>
<h2 id="たぶん身長が高いほど体重も重い">たぶん身長が高いほど体重も重い</h2>
<p>なんとなく $y = a x + b$ でいい線が引けそう<br>
 </p>
<p><img src="figure/weight-height-1.png" alt="plot of chunk weight-height"></p>

</section>
<section>
<h2 id="たぶん身長が高いほど体重も重い">たぶん身長が高いほど体重も重い</h2>
<p>なんとなく $y = a x + b$ でいい線が引けそう<br>
じゃあ切片と傾き、どう決める？</p>
<p><img src="figure/weight-lines-1.png" alt="plot of chunk weight-lines"></p>

</section>
<section>
<h2 id="最小二乗法">最小二乗法</h2>
<p>回帰直線からの<strong style="color: #3366ff">残差</strong>平方和(RSS)を最小化する。</p>
<p><img src="figure/weight-residual-1.png" alt="plot of chunk weight-residual"></p>

</section>
<section>
<h2 id="残差平方和rssが最小となるパラメータを探せ">残差平方和(RSS)が最小となるパラメータを探せ</h2>
<p>ランダムに試してみて、上位のものを採用</p>
<p><img src="figure/weight-goodlines-1.png" alt="plot of chunk weight-goodlines"></p>

</section>
<section>
<h2 id="残差平方和rssが最小となるパラメータを探せ">残差平方和(RSS)が最小となるパラメータを探せ</h2>
<p><strong>グリッドサーチ</strong>: パラメータ空間の一定範囲内を均等に試す</p>
<p><img src="figure/weight-grid-1.png" alt="plot of chunk weight-grid"></p>
<p>こうした<strong>最適化</strong>の手法はいろいろあるけど、ここでは扱わない。</p>

</section>
<section>
<h2 id="これくらいなら一瞬で計算してもらえる">これくらいなら一瞬で計算してもらえる</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">par_init</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="nf">optim</span><span class="p">(</span><span class="n">par_init</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">rss_weight</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">$</span><span class="n">par</span>
</span></span></code></pre></div><pre tabindex="0"><code>intercept     slope 
-50.54532  67.18659 
</code></pre><p><img src="figure/weight-lm-1.png" alt="plot of chunk weight-lm"></p>
<p>上記コードは最適化一般の書き方。<br>
回帰が目的なら次ページのようにするのが楽 →</p>

</section>
<section>
<h2 id="lm-で直線あてはめしてみる"><code>lm()</code> で直線あてはめしてみる</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="nf">lm</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">formula</span> <span class="o">=</span> <span class="n">hwy</span> <span class="o">~</span> <span class="n">displ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>         term  estimate std.error statistic       p.value
        &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1 (Intercept) 35.697651 0.7203676  49.55477 2.123519e-125
2       displ -3.530589 0.1945137 -18.15085  2.038974e-46
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mpg_added</span> <span class="o">=</span> <span class="n">modelr</span><span class="o">::</span><span class="nf">add_predictions</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">fit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg_added</span><span class="p">)</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#3366ff&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="figure/lm-mpg-1.png" alt="plot of chunk lm-mpg"></p>
<p>🔰 <code>diamonds</code> などほかのデータでも <code>lm()</code> を試してみよう。</p>

</section>
<section>
<h2 id="何でもかんでも直線あてはめではよろしくない">何でもかんでも直線あてはめではよろしくない</h2>
<p><img src="figure/lm-bad-1.png" alt="plot of chunk lm-bad"></p>
<ul>
<li>観察データは常に<strong>正の値</strong>なのに予測が負に突入してない？</li>
<li><strong>縦軸は整数</strong>。しかもの<strong>ばらつき</strong>が横軸に応じて変化？</li>
</ul>
</section>
<section>
<h2 id="何でもかんでも直線あてはめではよろしくない">何でもかんでも直線あてはめではよろしくない</h2>
<p><img src="figure/glm-better-1.png" alt="plot of chunk glm-better"></p>
<ul>
<li>観察データは常に<strong>正の値</strong>なのに予測が負に突入してない？</li>
<li><strong>縦軸は整数</strong>。しかもの<strong>ばらつき</strong>が横軸に応じて変化？</li>
<li><strong>データに合わせた統計モデルを使うとマシ</strong></li>
</ul>
</section>
<section>
<h2 id="ちょっとずつ線形モデルを発展させていく">ちょっとずつ線形モデルを発展させていく</h2>
<p><strong>線形モデル LM</strong> (単純な直線あてはめ)</p>
<p><span style="color: #888888;">    ↓ いろんな<strong>確率分布</strong>を扱いたい</span> 👈 統計モデルの重要な部品</p>
<p><strong>一般化線形モデル GLM</strong></p>
<p><span style="color: #888888;">    ↓ 個体差などの変量効果を扱いたい</span></p>
<p><strong>一般化線形混合モデル GLMM</strong></p>
<p><span style="color: #888888;">    ↓ もっと自由なモデリングを！</span></p>
<p><strong>階層ベイズモデル HBM</strong></p>
<p><cite><a href="https://amzn.to/33suMIZ">データ解析のための統計モデリング入門</a> 久保拓弥 2012 より改変</cite></p>

</section>
<section>
<h2 id="確率分布">確率分布</h2>
<p>発生する事象(値)と頻度の関係。</p>
<p>手元のデータを数えて作るのが<strong>経験分布</strong><br>
e.g., サイコロを12回投げた結果、学生1000人の身長</p>
<p><img src="figure/distribution-1.png" alt="plot of chunk distribution"></p>
<p>一方、少数のパラメータと数式で作るのが<strong>理論分布</strong>。<br>
(こちらを単に「確率分布」と呼ぶことが多い印象）</p>

</section>
<section>
<h2 id="確率変数xはパラメータthetaの確率分布fに従う">確率変数$X$はパラメータ$\theta$の確率分布$f$に従う&hellip;?</h2>
<p>$X \sim f(\theta)$</p>
<p>e.g.,<br>
コインを3枚投げたうち表の出る枚数 $X$ は<strong>二項分布に従う</strong>。<br>
$X \sim \text{Binomial}(n = 3, p = 0.5)$</p>
<div class="column-container">
  <div class="column" style="flex-shrink: 2.0;">
<p><img src="figure/dbinom-1.png" alt="plot of chunk dbinom"></p>
  </div>
  <div class="column" style="padding-top: 10px;">
\[\begin{split}
\text{Prob}(X = k) &= \binom n k p^k (1 - p)^{n - k} \\
k &\in \{0, 1, 2, \ldots, n\}
\end{split}\]
  </div>
</div>
<p>一緒に実験してみよう。</p>

</section>
<section>
<h2 id="試行を繰り返して記録してみる">試行を繰り返して記録してみる</h2>
<p>コインを3枚投げたうち表の出た枚数 $X$</p>
<p>試行1: <strong>表</strong> 裏 <strong>表</strong> → $X = 2$<br>
試行2: 裏 裏 裏 → $X = 0$<br>
試行3: <strong>表</strong> 裏 裏 → $X = 1$ 続けて $2, 1, 3, 0, 2, \ldots$</p>
<p><img src="figure/rbinom-1.png" alt="plot of chunk rbinom"></p>
<div style="text-align: right;">
試行回数を増やすほど<b>二項分布</b>の形に近づく。<br>
0と3はレア。1と2が3倍ほど出やすいらしい。
</div>
</section>
<section>
<h2 id="コイントスしなくても-x-らしきものを生成できる">コイントスしなくても $X$ らしきものを生成できる</h2>
<ul>
<li>コインを3枚投げたうち表の出る枚数 $X$</li>
<li>$n = 3, p = 0.5$ の二項分布からサンプルする乱数 $X$</li>
</ul>
<div class="column-container">
  <div class="column" style="flex-shrink: 2.0;">
<img src="figure/dbinom-1.png" alt="plot of chunk dbinom">
  </div>
  <div class="column" style="padding-top: 10px;">
$X \sim \text{Binomial}(n = 3, p = 0.5)$
<p>   ↓ サンプル</p>
<p>{2, 0, 1, 2, 1, 3, 0, 2, &hellip;}</p>
  </div>
</div>
<p>これらはとてもよく似ているので<br>
<strong>「コインをn枚投げたうち表の出る枚数は二項分布に従う」</strong><br>
みたいな言い方をする。逆に言うと<br>
<strong>「二項分布とはn回試行のうちの成功回数を確率変数とする分布」</strong><br>
のように理解できる。</p>

</section>
<section>
<h2 id="統計モデリングの一環とも捉えられる">統計モデリングの一環とも捉えられる</h2>
<p>コイン3枚投げを繰り返して得たデータ {2, 0, 1, 2, 1, 3, 0, 2, &hellip;}</p>
<p>   ↓ たった2つのパラメータで記述。情報を圧縮。</p>
<p>$n = 3, p = 0.5$ の二項分布で説明・再現できるぞ</p>
<figure>
<img src="../tokiomarine2021/math-model.drawio.svg" width="600"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>
<p>こういうふうに現象と対応した確率分布、ほかにもある？</p>

</section>
<section>
<h2 id="有名な確率分布それに従うもの">有名な確率分布、それに「従う」もの</h2>
<dl>
<dt>離散一様分布</dt>
<dd>コインの表裏、サイコロの出目1–6</dd>
<dt>幾何分布</dt>
<dd>成功率pの試行が初めて成功するまでの失敗回数</dd>
<dt>二項分布</dt>
<dd>成功率p、試行回数nのうちの成功回数</dd>
<dt>ポアソン分布</dt>
<dd>単位時間あたり平均$\lambda$回起こる事象の発生回数</dd>
<dt>ガンマ分布</dt>
<dd>ポアソン過程でk回起こるまでの待ち時間</dd>
<dd>(k = 1のとき<strong>指数分布</strong>と呼ばれる)</dd>
<dt>正規分布</dt>
<dd>確率変数の和、平均値</dd>
</dl>

</section>
<section>
<h2 id="離散一様分布">離散一様分布</h2>
<p>同じ確率で起こるn通りの事象のうち実際に起こった事象X</p>
<p>e.g., コインの表裏、サイコロの出目1–6</p>
<p><img src="figure/dunif-1.png" alt="plot of chunk dunif"></p>
<p>🔰 一様分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="幾何分布-textgeomp">幾何分布 $~\text{Geom}(p)$</h2>
<p>成功率pの試行が初めて成功するまでの失敗回数X</p>
<p>e.g., コイントスで表が出るまでに何回裏が出るか</p>
<p><img src="figure/geometric-1.png" alt="plot of chunk geometric"></p>
<p>\[
\text{Prob}(X = k \mid p) = p (1 - p)^k
\]</p>
<p>「初めて成功するまでの試行回数」とする定義もある。</p>
<p>🔰 幾何分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="二項分布-textbinomialnp">二項分布 $~\text{Binomial}(n,~p)$</h2>
<p>確率$p$で当たるクジを$n$回引いたうち当たった回数X。平均は$np$。</p>
<p><img src="figure/dbinom-n-1.png" alt="plot of chunk dbinom-n"></p>
<p>\[
\text{Prob}(X = k \mid n,~p) = \binom n k p^k (1 - p)^{n - k}
\]</p>
<p>🔰 二項分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="ポアソン分布-textpoissonlambda">ポアソン分布 $~\text{Poisson}(\lambda)$</h2>
<p>単位時間(空間)あたりに平均$\lambda$回発生する事象が実際に起きた回数X。</p>
<p>e.g., 1時間あたりのメッセージ受信件数、メッシュ区画内の生物個体数</p>
<p><img src="figure/dpoisson-1.png" alt="plot of chunk dpoisson"></p>
<p>\[
\text{Prob}(X = k \mid \lambda) = \frac {\lambda^k e^{-\lambda}} {k!}
\]</p>
<p>二項分布の極限 $(\lambda = np;~n \to \infty;~p \to 0)$。<br>
めったに起きないことを何回も試行するような感じ。</p>

</section>
<section>
<h2 id="指数分布-textexplambda">指数分布 $~\text{Exp}(\lambda)$</h2>
<p>ポアソン過程の事象の発生間隔x。平均は $1 / \lambda$ 。</p>
<p>e.g., メッセージの受信間隔、道路沿いに落ちてる手袋の間隔</p>
<p><img src="figure/dexp-1.png" alt="plot of chunk dexp"></p>
<p>\[
\text{Prob}(x \mid \lambda) = \lambda e^{-\lambda x}
\]</p>
<p>幾何分布の連続値版。</p>
<p>🔰 ポアソン分布・指数分布になりそうな例を考えてみよう</p>

</section>
<section>
<h2 id="ガンマ分布-textgammaklambda">ガンマ分布 $~\text{Gamma}(k,~\lambda)$</h2>
<p>ポアソン過程の事象k回発生までの待ち時間x</p>
<p>e.g., メッセージを2つ受信するまでの待ち時間</p>
<p><img src="figure/dgamma-1.png" alt="plot of chunk dgamma"></p>
<p>\[
\text{Prob}(x \mid k,~\lambda) = \frac {\lambda^k x^{k - 1} e^{-\lambda x}} {\Gamma(k)}
\]</p>
<p>指数分布をkのぶん右に膨らませた感じ。<br>
shapeパラメータ $k = 1$ のとき指数分布と一致。</p>

</section>
<section>
<h2 id="正規分布-mathcalnmusigma">正規分布 $~\mathcal{N}(\mu,~\sigma)$</h2>
<p>平均 $\mu$、標準偏差 $\sigma$ の美しい分布。よく登場する。<br>
e.g., $\mu = 50, ~\sigma = 10$ (濃い灰色にデータの95%, 99%が含まれる):</p>
<p><img src="figure/gaussian-1.png" alt="plot of chunk gaussian"></p>
<p>\[
\text{Prob}(x \mid \mu,~\sigma) = \frac 1 {\sqrt{2 \pi \sigma^2}} \exp \left(\frac {-(x - \mu)^2} {2\sigma^2} \right)
\]</p>

</section>
<section>
<h2 id="正規分布に近づくものがいろいろある">正規分布に近づくものがいろいろある</h2>
<p>標本平均の反復(<strong>中心極限定理</strong>);
e.g., 一様分布 [0, 100) から40サンプル</p>
<p><img src="figure/central-limit-1.png" alt="plot of chunk central-limit"></p>
<p>大きい$n$の二項分布</p>
<p><img src="figure/binom-normal-1.png" alt="plot of chunk binom-normal"></p>

</section>
<section>
<h2 id="正規分布に近づくものがいろいろある">正規分布に近づくものがいろいろある</h2>
<p>大きい$\lambda$のポアソン分布</p>
<p><img src="figure/poisson-normal-1.png" alt="plot of chunk poisson-normal"></p>
<p>平均値固定なら$k$が大きくなるほど左右対称に尖るガンマ分布</p>
<p><img src="figure/gamma-normal-1.png" alt="plot of chunk gamma-normal"></p>

</section>
<section>
<h2 id="有名な確率分布対応関係ふりかえり">有名な確率分布対応関係ふりかえり</h2>
<figure style="float: right;">
<img src="../tokiomarine2021/math-model.drawio.svg" width="300"><br>
</figure>
<dl>
<dt>離散一様分布</dt>
<dd>コインの表裏、サイコロの出目1–6</dd>
<dt>幾何分布</dt>
<dd>成功率pの試行が初めて成功するまでの失敗回数</dd>
<dt>二項分布</dt>
<dd>成功率p、試行回数nのうちの成功回数</dd>
<dt>ポアソン分布</dt>
<dd>単位時間あたり平均$\lambda$回起こる事象の発生回数</dd>
<dt>ガンマ分布</dt>
<dd>ポアソン過程でk回起こるまでの待ち時間</dd>
<dd>(k = 1のとき<strong>指数分布</strong>と呼ばれる)</dd>
<dt>正規分布</dt>
<dd>確率変数の和、平均値。使い勝手が良く、よく登場する。</dd>
</dl>

</section>
<section>
<h2 id="現実には確率分布に従わないことが多い">現実には、確率分布に「従わない」ことが多い</h2>
<p>植物100個体から8個ずつ種子を取って植えたら全体で半分ちょい発芽。<br>
親1個体あたりの生存数は<span style="color: #3366ff;">n=8の二項分布</span>になるはずだけど、<br>
極端な値(全部死亡、全部生存)が多かった。</p>
<img src="figure/overdispersion-1.png" alt="plot of chunk overdispersion" width=400>
<p>「それはなぜ？」と考えて要因を探るのも統計モデリングの仕事。<br>
<strong>「普通はこれに従うはず」を理解してこそ</strong>できる思考。</p>

</section>
<section>
<h2 id="疑似乱数生成器-pseudo-random-number-generator">疑似乱数生成器 Pseudo Random Number Generator</h2>
<p>コンピューター上でランダム<strong>っぽい</strong>数値を出力する装置。<br>
実際には<strong>決定論的</strong>に計算されているので、<br>
シード(出発点)と呼び出し回数が同じなら出る数も同じになる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">runif</span><span class="p">(</span><span class="m">3L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.9148060 0.9370754 0.2861395</span>
</span></span><span class="line"><span class="cl"><span class="nf">runif</span><span class="p">(</span><span class="m">3L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.8304476 0.6417455 0.5190959</span>
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">runif</span><span class="p">(</span><span class="m">6L</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.9148060 0.9370754 0.2861395 0.8304476 0.6417455 0.5190959</span>
</span></span></code></pre></div><p>シードに適当な固定値を与えておくことで再現性を保てる。<br>
ただし「このシードじゃないと良い結果が出ない」はダメ。</p>
<p>さまざまな「分布に従う」乱数を生成することもできる。</p>

</section>
<section>
<h2 id="いろんな乱数を生成可視化して感覚を掴もう">いろんな乱数を生成・可視化して感覚を掴もう</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">sample.int</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rgeom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="m">50</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_histogram</span><span class="p">()</span> <span class="c1"># for continuous values</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">()</span>       <span class="c1"># for discrete values</span>
</span></span></code></pre></div><p>🔰 小さい <code>n</code> から徐々に大きくして変化を確認しよう。</p>
<p>🔰 ほかのオプションもいろいろ変えて変化を確認しよう。</p>
<p>🔰 1%の当たりを狙って10連ガチャを回す人が100万人いたら、<br>
全部はずれ、1つ当たり、2つ当たり&hellip; の人はどれくらいいるか？</p>

</section>
<section>
<h2 id="データに分布をあてはめたい">データに分布をあてはめたい</h2>
<p>ある植物を50個体調べて、それぞれの種子数Xを数えた。</p>
<p><img src="figure/poisson-seed-1.png" alt="plot of chunk poisson-seed"></p>
<p>カウントデータだからポアソン分布っぽい。<br>
ポアソン分布のパラメータ $\lambda$ はどう決める？</p>

</section>
<section>
<h2 id="データに分布をあてはめたい">データに分布をあてはめたい</h2>
<p>ある植物を50個体調べて、それぞれの種子数Xを数えた。</p>
<p><img src="figure/poisson-seed-lambda-1.png" alt="plot of chunk poisson-seed-lambda"></p>
<p>カウントデータだからポアソン分布っぽい。<br>
ポアソン分布のパラメータ $\lambda$ はどう決める？<br>
(黒が観察データ。<span style="color: #3366ff;">青がポアソン分布</span>。よく重なるのは？)</p>

</section>
<section>
<h2 id="ruby尤rtゆうrt度ruby-likelihood"><ruby>尤<rt>ゆう</rt>度</ruby> (likelihood)</h2>
<p><ruby>尤<rt>もっと</rt></ruby>もらしさ。
モデルのあてはまりの良さの尺度のひとつ。</p>
<p><strong>あるモデル$M$の下でそのデータ$D$が観察される確率</strong>。<br>
定義通り素直に書くと<br>
$\text{Prob}(D \mid M)$</p>
<p>データ$D$を固定し、モデル$M$の関数とみなしたものが<strong>尤度関数</strong>:<br>
$L(M \mid D)$</p>
<p>モデルの構造も固定してパラメータ$\theta$だけ動かす場合はこう書く:<br>
$L(\theta \mid D)$ とか $L(\theta)$ とか</p>

</section>
<section>
<h2 id="尤度を手計算できる例">尤度を手計算できる例</h2>
<p>コインを5枚投げた結果 $D$: 表 4, 裏 1</p>
<p>表が出る確率 $p = 0.5$ と仮定:</p>
<div>\[\begin{split}
L(0.5 \mid D)
  &= \binom 5 1 \times \text{Prob}(表 \mid 0.5) ^ 4 \times \text{Prob}(裏 \mid 0.5) ^ 1 \\
  &= 5 \times 0.5 ^ 4 \times 0.5 ^ 1 = 0.15625
\end{split}\]</div>
<p>表が出る確率 $p = 0.8$ と仮定:</p>
<div>\[\begin{split}
L(0.8 \mid D)
  &= \binom 5 1 \times \text{Prob}(表 \mid 0.8) ^ 4 \times \text{Prob}(裏 \mid 0.8) ^ 1 \\
  &= 5 \times 0.8 ^ 4 \times 0.2 ^ 1 = 0.4096
\end{split}\]</div>
<p>$L(0.8 \mid D) &gt; L(0.5 \mid D)$</p>
<p>$p = 0.8$ のほうがより尤もらしい。</p>

</section>
<section>
<h2 id="種子数ポアソン分布の例でも尤度を計算してみる">種子数ポアソン分布の例でも尤度を計算してみる</h2>
<p>ある植物が作った種子を数える。$n = 50$個体ぶん。</p>
<div>\[\begin{split}
L(\lambda \mid D)
  = \prod _i ^n \text{Prob}(X_i \mid \lambda)
  = \prod _i ^n \frac {\lambda ^ {X_i} e ^ {-\lambda}} {X_i !}
\end{split}\]</div>
<p><img src="figure/poisson-seed-likelihood-1.png" alt="plot of chunk poisson-seed-likelihood"></p>
<p>この中では $\lambda = 3$ がいいけど、より尤もらしい値を求めたい。</p>

</section>
<section>
<h2 id="最尤推定-umuaximum-uluikelihood-ueustimation">最尤推定 <u>M</u>aximum <u>L</u>ikelihood <u>E</u>stimation</h2>
<p>扱いやすい <strong>対数尤度</strong> (log likelihood) にしてから計算する。<br>
一階微分が0になる $\lambda$ を求めると&hellip;この場合は<strong>標本平均</strong>と一致。</p>
<div>\[\begin{split}
\log L(\lambda \mid D)
  &= \sum _i ^n \left[ X_i \log (\lambda) - \lambda - \log (X_i !) \right] \\
\frac {\mathrm d \log L(\lambda \mid D)} {\mathrm d \lambda}
  &= \frac 1 \lambda \sum _i ^n X_i - n = 0 \\
\hat \lambda &= \frac 1 n \sum _i ^n X_i
\end{split}\]</div>
<p><img src="figure/poisson-mle-1.png" alt="plot of chunk poisson-mle"></p>

</section>
<section>
<h2 id="最尤推定を使っても真のλは得られない">最尤推定を使っても“真のλ”は得られない</h2>
<p>今回のデータは真の生成ルール“$X \sim \text{Poisson}(\lambda = 3.0)$”で作った。<br>
「50個体サンプル→最尤推定」を1,000回繰り返してみると:</p>
<p><img src="figure/poisson-mle-repl-1.png" alt="plot of chunk poisson-mle-repl"></p>
<p>サンプルの取れ方によってはかなりズレた推定をしてしまう。<br>
(標本データへのあてはまりはかなり良く見えるのに！)</p>

</section>
<section>
<h2 id="サンプルサイズを増やすほどマシにはなる">サンプルサイズを増やすほどマシにはなる</h2>
<p>“$X \sim \text{Poisson}(\lambda = 3.0)$”からnサンプル→最尤推定を1,000回繰り返す:</p>
<p><img src="figure/poisson-mle-nsam-1.png" alt="plot of chunk poisson-mle-nsam"></p>
<p>Q. じゃあどれくらいのサンプル数nを確保すればいいのか？<br>
A. 推定したい統計量とか、許容できる誤差とかによる。</p>

</section>
<section>
<h2 id="すべてのモデルは間違っている">すべてのモデルは間違っている</h2>
<p>確率分布がいい感じに最尤推定できたとしても、<br>
それはあくまでモデル。仮定。近似。</p>
<blockquote>
<p>All models are wrong, but some are useful. &mdash; George E. P. Box</p>
</blockquote>
<figure>
<img src="../tokiomarine2021/math-model.drawio.svg" width="600"><br>
<figcaption><cite>「データ分析のための数理モデル入門」江崎貴裕 2020 より改変</cite></figcaption>
</figure>

</section>
<section>
<h2 id="統計モデリングの道具-----まとめ">統計モデリングの道具 &mdash; まとめ</h2>
<ul>
<li>何はともあれ作図して俯瞰</li>
<li><strong>確率変数</strong> $X$</li>
<li><strong>確率分布</strong> $X \sim f(\theta)$
<ul>
<li><strong>少ないパラメータ</strong> $\theta$ でばらつきの様子を表現</li>
<li><strong>この現象はこの分布を作りがち(〜に従う)</strong> という知見がある</li>
</ul>
</li>
<li><strong>尤度</strong>
<ul>
<li>あるモデルでこのデータになる確率 $\text{Prob}(D \mid M)$</li>
<li>データ固定でモデル探索 → <strong>尤度関数</strong> $L(M \mid D),~L(\theta \mid D)$</li>
<li>対数を取ったほうが扱いやすい → <strong>対数尤度</strong> $\log L(M \mid D)$</li>
<li>これを最大化するようなパラメータ $\hat \theta$ 探し ＝ <strong>最尤法</strong></li>
</ul>
</li>
</ul>

</section>
<section>
<h2 id="-3日目の課題2">🔰 3日目の課題2</h2>
<p>サイコロを10回振ったら6の目が3回出た。</p>
<ol>
<li>
<p>6の目の出る確率が1/6だとした場合の尤度は?</p>
</li>
<li>
<p>6の目の出る確率が0.2だとした場合の尤度は?</p>
</li>
<li>
<p>横軸を6の目の出る確率、縦軸を対数尤度とするグラフを描こう。</p>
</li>
<li>
<p>このサイコロで6の目が出る確率を最尤推定しよう。<br>
数学で解ければ優。Rで見つければ良。目分量・勘で可。</p>
</li>
</ol>
<dl>
<dt>ヒント</dt>
<dd>確率pで当たるクジをn回引いてk回当たる確率、と同じ計算を使う。</dd>
<dd>数学の $\binom 5 2 = {}_5 \mathrm{C} _2 = 10$ はRでは <code>choose(5, 2)</code> 。</dd>
</dl>

</section>
<section>
<h2 id="参考文献">参考文献</h2>
<ul>
<li><a href="https://amzn.to/33suMIZ">データ解析のための統計モデリング入門</a> 久保拓弥 2012</li>
<li><a href="https://amzn.to/3uwx7Pb">StanとRでベイズ統計モデリング</a> 松浦健太郎 2016</li>
<li><a href="https://amzn.to/3o1eCzP">RとStanではじめる ベイズ統計モデリングによるデータ分析入門</a> 馬場真哉 2019</li>
<li><a href="https://amzn.to/3uCxTKo">データ分析のための数理モデル入門</a> 江崎貴裕 2020</li>
<li><a href="https://amzn.to/3uznzCK">分析者のためのデータ解釈学入門</a> 江崎貴裕 2020</li>
<li><a href="https://amzn.to/3ty80Kv">統計学を哲学する</a> 大塚淳 2020</li>
<li><a href="https://amzn.to/2Q0f6JQ">科学とモデル&mdash;シミュレーションの哲学 入門</a> Michael Weisberg 2017<br>
(原著: <a href="https://amzn.to/3bdvhuI">Simulation and Similarity</a> 2013)</li>
</ul>
<a href="7-glm.html" rel="next" class="readmore">
7. 統計モデリング2: 一般化線形モデル
</a>

</section>
</div>
</div>
</body>
</html>
